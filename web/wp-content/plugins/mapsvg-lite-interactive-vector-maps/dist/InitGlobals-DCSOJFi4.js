import{p as t,_ as e,u as i,m as s,t as o,a as n,r,b as a,c as l,d as h,i as c,e as d,R as u,g as p,s as m,f as g,h as f,j as v,k as y,l as b,n as w,o as x,q as k,v as S,w as E,x as T,y as _,M as C}from"./Mapsvg-Dt-f87Eo.js";function B(t){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},B(t)}var D=/^\s+/,M=/\s+$/;function R(t,e){if(e=e||{},(t=t||"")instanceof R)return t;if(!(this instanceof R))return new R(t,e);var i=function(t){var e={r:0,g:0,b:0},i=1,s=null,o=null,n=null,r=!1,a=!1;"string"==typeof t&&(t=function(t){t=t.replace(D,"").replace(M,"").toLowerCase();var e,i=!1;if(Q[t])t=Q[t],i=!0;else if("transparent"==t)return{r:0,g:0,b:0,a:0,format:"name"};if(e=ht.rgb.exec(t))return{r:e[1],g:e[2],b:e[3]};if(e=ht.rgba.exec(t))return{r:e[1],g:e[2],b:e[3],a:e[4]};if(e=ht.hsl.exec(t))return{h:e[1],s:e[2],l:e[3]};if(e=ht.hsla.exec(t))return{h:e[1],s:e[2],l:e[3],a:e[4]};if(e=ht.hsv.exec(t))return{h:e[1],s:e[2],v:e[3]};if(e=ht.hsva.exec(t))return{h:e[1],s:e[2],v:e[3],a:e[4]};if(e=ht.hex8.exec(t))return{r:tt(e[1]),g:tt(e[2]),b:tt(e[3]),a:ot(e[4]),format:i?"name":"hex8"};if(e=ht.hex6.exec(t))return{r:tt(e[1]),g:tt(e[2]),b:tt(e[3]),format:i?"name":"hex"};if(e=ht.hex4.exec(t))return{r:tt(e[1]+""+e[1]),g:tt(e[2]+""+e[2]),b:tt(e[3]+""+e[3]),a:ot(e[4]+""+e[4]),format:i?"name":"hex8"};if(e=ht.hex3.exec(t))return{r:tt(e[1]+""+e[1]),g:tt(e[2]+""+e[2]),b:tt(e[3]+""+e[3]),format:i?"name":"hex"};return!1}(t));"object"==B(t)&&(ct(t.r)&&ct(t.g)&&ct(t.b)?(l=t.r,h=t.g,c=t.b,e={r:255*K(l,255),g:255*K(h,255),b:255*K(c,255)},r=!0,a="%"===String(t.r).substr(-1)?"prgb":"rgb"):ct(t.h)&&ct(t.s)&&ct(t.v)?(s=it(t.s),o=it(t.v),e=function(t,e,i){t=6*K(t,360),e=K(e,100),i=K(i,100);var s=Math.floor(t),o=t-s,n=i*(1-e),r=i*(1-o*e),a=i*(1-(1-o)*e),l=s%6,h=[i,r,n,n,a,i][l],c=[a,i,i,r,n,n][l],d=[n,n,a,i,i,r][l];return{r:255*h,g:255*c,b:255*d}}(t.h,s,o),r=!0,a="hsv"):ct(t.h)&&ct(t.s)&&ct(t.l)&&(s=it(t.s),n=it(t.l),e=function(t,e,i){var s,o,n;function r(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}if(t=K(t,360),e=K(e,100),i=K(i,100),0===e)s=o=n=i;else{var a=i<.5?i*(1+e):i+e-i*e,l=2*i-a;s=r(l,a,t+1/3),o=r(l,a,t),n=r(l,a,t-1/3)}return{r:255*s,g:255*o,b:255*n}}(t.h,s,n),r=!0,a="hsl"),t.hasOwnProperty("a")&&(i=t.a));var l,h,c;return i=Z(i),{ok:r,format:t.format||a,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:i}}(t);this._originalInput=t,this._r=i.r,this._g=i.g,this._b=i.b,this._a=i.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||i.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=i.ok}function A(t,e,i){t=K(t,255),e=K(e,255),i=K(i,255);var s,o,n=Math.max(t,e,i),r=Math.min(t,e,i),a=(n+r)/2;if(n==r)s=o=0;else{var l=n-r;switch(o=a>.5?l/(2-n-r):l/(n+r),n){case t:s=(e-i)/l+(e<i?6:0);break;case e:s=(i-t)/l+2;break;case i:s=(t-e)/l+4}s/=6}return{h:s,s:o,l:a}}function j(t,e,i){t=K(t,255),e=K(e,255),i=K(i,255);var s,o,n=Math.max(t,e,i),r=Math.min(t,e,i),a=n,l=n-r;if(o=0===n?0:l/n,n==r)s=0;else{switch(n){case t:s=(e-i)/l+(e<i?6:0);break;case e:s=(i-t)/l+2;break;case i:s=(t-e)/l+4}s/=6}return{h:s,s:o,v:a}}function L(t,e,i,s){var o=[et(Math.round(t).toString(16)),et(Math.round(e).toString(16)),et(Math.round(i).toString(16))];return s&&o[0].charAt(0)==o[0].charAt(1)&&o[1].charAt(0)==o[1].charAt(1)&&o[2].charAt(0)==o[2].charAt(1)?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0):o.join("")}function P(t,e,i,s){return[et(st(s)),et(Math.round(t).toString(16)),et(Math.round(e).toString(16)),et(Math.round(i).toString(16))].join("")}function F(t,e){e=0===e?0:e||10;var i=R(t).toHsl();return i.s-=e/100,i.s=J(i.s),R(i)}function O(t,e){e=0===e?0:e||10;var i=R(t).toHsl();return i.s+=e/100,i.s=J(i.s),R(i)}function I(t){return R(t).desaturate(100)}function N(t,e){e=0===e?0:e||10;var i=R(t).toHsl();return i.l+=e/100,i.l=J(i.l),R(i)}function H(t,e){e=0===e?0:e||10;var i=R(t).toRgb();return i.r=Math.max(0,Math.min(255,i.r-Math.round(-e/100*255))),i.g=Math.max(0,Math.min(255,i.g-Math.round(-e/100*255))),i.b=Math.max(0,Math.min(255,i.b-Math.round(-e/100*255))),R(i)}function z(t,e){e=0===e?0:e||10;var i=R(t).toHsl();return i.l-=e/100,i.l=J(i.l),R(i)}function V(t,e){var i=R(t).toHsl(),s=(i.h+e)%360;return i.h=s<0?360+s:s,R(i)}function q(t){var e=R(t).toHsl();return e.h=(e.h+180)%360,R(e)}function G(t,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var i=R(t).toHsl(),s=[R(t)],o=360/e,n=1;n<e;n++)s.push(R({h:(i.h+n*o)%360,s:i.s,l:i.l}));return s}function U(t){var e=R(t).toHsl(),i=e.h;return[R(t),R({h:(i+72)%360,s:e.s,l:e.l}),R({h:(i+216)%360,s:e.s,l:e.l})]}function W(t,e,i){e=e||6,i=i||30;var s=R(t).toHsl(),o=360/i,n=[R(t)];for(s.h=(s.h-(o*e>>1)+720)%360;--e;)s.h=(s.h+o)%360,n.push(R(s));return n}function X(t,e){e=e||6;for(var i=R(t).toHsv(),s=i.h,o=i.s,n=i.v,r=[],a=1/e;e--;)r.push(R({h:s,s:o,v:n})),n=(n+a)%1;return r}R.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var t=this.toRgb();return(299*t.r+587*t.g+114*t.b)/1e3},getLuminance:function(){var t,e,i,s=this.toRgb();return t=s.r/255,e=s.g/255,i=s.b/255,.2126*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.7152*(e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4))+.0722*(i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4))},setAlpha:function(t){return this._a=Z(t),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var t=j(this._r,this._g,this._b);return{h:360*t.h,s:t.s,v:t.v,a:this._a}},toHsvString:function(){var t=j(this._r,this._g,this._b),e=Math.round(360*t.h),i=Math.round(100*t.s),s=Math.round(100*t.v);return 1==this._a?"hsv("+e+", "+i+"%, "+s+"%)":"hsva("+e+", "+i+"%, "+s+"%, "+this._roundA+")"},toHsl:function(){var t=A(this._r,this._g,this._b);return{h:360*t.h,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=A(this._r,this._g,this._b),e=Math.round(360*t.h),i=Math.round(100*t.s),s=Math.round(100*t.l);return 1==this._a?"hsl("+e+", "+i+"%, "+s+"%)":"hsla("+e+", "+i+"%, "+s+"%, "+this._roundA+")"},toHex:function(t){return L(this._r,this._g,this._b,t)},toHexString:function(t){return"#"+this.toHex(t)},toHex8:function(t){return function(t,e,i,s,o){var n=[et(Math.round(t).toString(16)),et(Math.round(e).toString(16)),et(Math.round(i).toString(16)),et(st(s))];if(o&&n[0].charAt(0)==n[0].charAt(1)&&n[1].charAt(0)==n[1].charAt(1)&&n[2].charAt(0)==n[2].charAt(1)&&n[3].charAt(0)==n[3].charAt(1))return n[0].charAt(0)+n[1].charAt(0)+n[2].charAt(0)+n[3].charAt(0);return n.join("")}(this._r,this._g,this._b,this._a,t)},toHex8String:function(t){return"#"+this.toHex8(t)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(100*K(this._r,255))+"%",g:Math.round(100*K(this._g,255))+"%",b:Math.round(100*K(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+Math.round(100*K(this._r,255))+"%, "+Math.round(100*K(this._g,255))+"%, "+Math.round(100*K(this._b,255))+"%)":"rgba("+Math.round(100*K(this._r,255))+"%, "+Math.round(100*K(this._g,255))+"%, "+Math.round(100*K(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(Y[L(this._r,this._g,this._b,!0)]||!1)},toFilter:function(t){var e="#"+P(this._r,this._g,this._b,this._a),i=e,s=this._gradientType?"GradientType = 1, ":"";if(t){var o=R(t);i="#"+P(o._r,o._g,o._b,o._a)}return"progid:DXImageTransform.Microsoft.gradient("+s+"startColorstr="+e+",endColorstr="+i+")"},toString:function(t){var e=!!t;t=t||this._format;var i=!1,s=this._a<1&&this._a>=0;return e||!s||"hex"!==t&&"hex6"!==t&&"hex3"!==t&&"hex4"!==t&&"hex8"!==t&&"name"!==t?("rgb"===t&&(i=this.toRgbString()),"prgb"===t&&(i=this.toPercentageRgbString()),"hex"!==t&&"hex6"!==t||(i=this.toHexString()),"hex3"===t&&(i=this.toHexString(!0)),"hex4"===t&&(i=this.toHex8String(!0)),"hex8"===t&&(i=this.toHex8String()),"name"===t&&(i=this.toName()),"hsl"===t&&(i=this.toHslString()),"hsv"===t&&(i=this.toHsvString()),i||this.toHexString()):"name"===t&&0===this._a?this.toName():this.toRgbString()},clone:function(){return R(this.toString())},_applyModification:function(t,e){var i=t.apply(null,[this].concat([].slice.call(e)));return this._r=i._r,this._g=i._g,this._b=i._b,this.setAlpha(i._a),this},lighten:function(){return this._applyModification(N,arguments)},brighten:function(){return this._applyModification(H,arguments)},darken:function(){return this._applyModification(z,arguments)},desaturate:function(){return this._applyModification(F,arguments)},saturate:function(){return this._applyModification(O,arguments)},greyscale:function(){return this._applyModification(I,arguments)},spin:function(){return this._applyModification(V,arguments)},_applyCombination:function(t,e){return t.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(W,arguments)},complement:function(){return this._applyCombination(q,arguments)},monochromatic:function(){return this._applyCombination(X,arguments)},splitcomplement:function(){return this._applyCombination(U,arguments)},triad:function(){return this._applyCombination(G,[3])},tetrad:function(){return this._applyCombination(G,[4])}},R.fromRatio=function(t,e){if("object"==B(t)){var i={};for(var s in t)t.hasOwnProperty(s)&&(i[s]="a"===s?t[s]:it(t[s]));t=i}return R(t,e)},R.equals=function(t,e){return!(!t||!e)&&R(t).toRgbString()==R(e).toRgbString()},R.random=function(){return R.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})},R.mix=function(t,e,i){i=0===i?0:i||50;var s=R(t).toRgb(),o=R(e).toRgb(),n=i/100;return R({r:(o.r-s.r)*n+s.r,g:(o.g-s.g)*n+s.g,b:(o.b-s.b)*n+s.b,a:(o.a-s.a)*n+s.a})},R.readability=function(t,e){var i=R(t),s=R(e);return(Math.max(i.getLuminance(),s.getLuminance())+.05)/(Math.min(i.getLuminance(),s.getLuminance())+.05)},R.isReadable=function(t,e,i){var s,o,n=R.readability(t,e);switch(o=!1,(s=function(t){var e,i;e=((t=t||{level:"AA",size:"small"}).level||"AA").toUpperCase(),i=(t.size||"small").toLowerCase(),"AA"!==e&&"AAA"!==e&&(e="AA");"small"!==i&&"large"!==i&&(i="small");return{level:e,size:i}}(i)).level+s.size){case"AAsmall":case"AAAlarge":o=n>=4.5;break;case"AAlarge":o=n>=3;break;case"AAAsmall":o=n>=7}return o},R.mostReadable=function(t,e,i){var s,o,n,r,a=null,l=0;o=(i=i||{}).includeFallbackColors,n=i.level,r=i.size;for(var h=0;h<e.length;h++)(s=R.readability(t,e[h]))>l&&(l=s,a=R(e[h]));return R.isReadable(t,a,{level:n,size:r})||!o?a:(i.includeFallbackColors=!1,R.mostReadable(t,["#fff","#000"],i))};var Q=R.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},Y=R.hexNames=function(t){var e={};for(var i in t)t.hasOwnProperty(i)&&(e[t[i]]=i);return e}(Q);function Z(t){return t=parseFloat(t),(isNaN(t)||t<0||t>1)&&(t=1),t}function K(t,e){(function(t){return"string"==typeof t&&-1!=t.indexOf(".")&&1===parseFloat(t)})(t)&&(t="100%");var i=function(t){return"string"==typeof t&&-1!=t.indexOf("%")}(t);return t=Math.min(e,Math.max(0,parseFloat(t))),i&&(t=parseInt(t*e,10)/100),Math.abs(t-e)<1e-6?1:t%e/parseFloat(e)}function J(t){return Math.min(1,Math.max(0,t))}function tt(t){return parseInt(t,16)}function et(t){return 1==t.length?"0"+t:""+t}function it(t){return t<=1&&(t=100*t+"%"),t}function st(t){return Math.round(255*parseFloat(t)).toString(16)}function ot(t){return tt(t)/255}var nt,rt,at,lt,ht=(rt="[\\s|\\(]+("+(nt="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+nt+")[,|\\s]+("+nt+")\\s*\\)?",at="[\\s|\\(]+("+nt+")[,|\\s]+("+nt+")[,|\\s]+("+nt+")[,|\\s]+("+nt+")\\s*\\)?",{CSS_UNIT:new RegExp(nt),rgb:new RegExp("rgb"+rt),rgba:new RegExp("rgba"+at),hsl:new RegExp("hsl"+rt),hsla:new RegExp("hsla"+at),hsv:new RegExp("hsv"+rt),hsva:new RegExp("hsva"+at),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});function ct(t){return!!ht.CSS_UNIT.exec(t)}class dt extends Array{constructor(t,e,i){if(e?super(...e):super(),this.key=t,this.dict={},this.nextId=1,this.options=Object.assign({autoId:!1,unique:!1},i),this.length>0){let t=0;const e=this;if(this.options.autoId){let t=0,i=!1;this.forEach((function(s){null!=s[e.key]?s[e.key]>t&&(t=s[e.key]):i=!0})),this.nextId=++t,i&&this.forEach((function(t){null==t[e.key]&&(t[e.key]=e.nextId,e.nextId++)}))}this.forEach((function(i){e.dict[i[e.key]]=t,t++}))}}push(...t){return t.forEach((t=>{(!this.options.unique||this.options.unique&&!this.get(t[this.key]))&&(super.push(t),!0===this.options.autoId&&(t[this.key]=this.nextId++),this.dict[t[this.key]]=this.length-1)})),this.length}pop(){const t=this[this.length-1][this.key];return super.pop(),delete this.dict[t],this.reindex(),super.pop()}update(t){if(null!=t[this.key]){const e=this.get(t[this.key]);for(const i in t)e[i]=t[i];return e}return!1}get(t){return this.findById(t)}findById(t){const e=this.dict[t];return void 0===e?void 0:this[e]}deleteById(t){const e=this.dict[t];void 0!==e&&(delete this.dict[t],this.splice(e,1))}delete(t){this.deleteById(t)}clear(){return this.splice(0,this.length),this.length=0,this.reindex(),this}reindex(){const t=this;this.dict={},this.forEach((function(e,i){t.dict[e[t.key]]=i}))}sort(t){return super.sort(t),this.reindex(),this}splice(t,e){const i=super.splice(t,e);return this.reindex(),i}toObject(){const t={};for(const e of this)t[e[this.key]]=e;return t}}function ut(t){return t&&"clientX"in t&&"clientY"in t}class pt{constructor(t){this.handler=t.handler,this.name=t.name,this.options=t.options||{}}}class mt{constructor({context:t,contextName:e,parent:i,map:s}){this.listeners=new Array,this.context=t,this.contextName=e,this.bubbleTo=i,this.map=s}on(t,e,i){if(null==i?void 0:i.unique){const e=this.listeners.find((e=>e.name===t&&e.options.unique));e&&this.off(t,e.handler)}const s=new pt({handler:e,name:t,options:i});return this.listeners.push(s),this}once(t,e){return this.on(t,e,{repeat:1})}off(t,e){const i=this.listeners.filter((e=>e.name===t));return i.length&&i.forEach(((t,i)=>{if(void 0===e||t.handler===e){const e=this.listeners.indexOf(t);this.listeners.splice(e,1)}})),this}trigger(t,e,i){var s;const o=ut(e)?e:void 0,n=null!==(s=ut(e)?i:e)&&void 0!==s?s:{},r=this.listeners.filter((e=>e.name===t)),a={domEvent:o,data:n,name:t,map:this.map};if(r.length>0){const t=[];r.forEach(((e,i)=>{try{if(-1!==e.name.indexOf("old")){const t=Array.from(Object.values(n));e.handler&&e.handler.apply(this.context,t||[this.context])}else e.handler&&e.handler.apply(this.context,[a]);e.options.repeat&&e.options.repeat--,0===e.options.repeat&&t.push(e)}catch(t){console.error(t)}})),this.listeners=this.listeners.filter(((e,i)=>!t.includes(e)))}if(this.bubbleTo)o?this.bubbleTo.trigger(t+"."+this.contextName,o,n):this.bubbleTo.trigger(t+"."+this.contextName,n);else{const e=new CustomEvent(t+".mapsvg",{detail:a});window.dispatchEvent(e)}return this}}!function(t){t.REQUEST="request",t.RESPONSE="response",t.RENDER="render",t.MAP_LOAD="mapLoad"}(lt||(lt={}));class gt{constructor(){this.middlewares=[]}add(t,e,i=!1){if(i){const e=this.middlewares.find((e=>e.name===t&&e.options.unique));e&&this.off(t,e.handler)}return e&&this.middlewares.push({name:t,handler:e,options:{unique:null!=i&&i}}),this.middlewares}get(t){return this.middlewares.filter((e=>e.name===t)).map((t=>t.handler))}clear(){return this.middlewares.splice(0,this.middlewares.length-1),this.middlewares}off(t,e){const i=this.middlewares.filter((e=>e.name===t));return i.length&&i.forEach(((t,i)=>{if(void 0===e||t.handler===e){const e=this.middlewares.indexOf(t);this.middlewares.splice(e,1)}})),this}removeByType(t){return this.middlewares=this.middlewares.filter((e=>e.name!==t)),this.middlewares}run(t,e){const i=this.middlewares.filter((e=>e.name===t)).map((t=>t.handler));let s=e[0];for(const o of i){let i;try{i=o.apply(this,e)}catch(s){console.error(`Error in middleware ${t}:`,s),i=e[0]}s=i}return s}}const ft={type:"text",db_type:"varchar(255)",label:"",name:"",renamable:!0,visible:!0,hiddenOnTable:!1,searchable:!1,readonly:!1,protected:!1};class vt{constructor(e){const i=Object.assign(Object.assign({},ft),e);Object.assign(this,i),"distance"===this.type&&(this.parameterName="Object.distance",this.parameterNameShort="distance"),["visible","searchable","readonly","protected","renamable"].forEach((e=>{this[e]=t(this[e])})),!this.options||this.options instanceof dt||(this.options=new dt("value",this.options))}getEnumLabel(t){if(!this.options)return null;const e=this.options.get(t);return void 0!==e?e.label:""}}var yt;!function(t){t.UPDATE="update"}(yt||(yt={}));const bt={strict:!0,type:"object"};class wt{constructor(t){this.fields=new dt("name"),this.apiEndpoints=new dt("name");const i=Object.assign(Object.assign({},bt),t),{name:s,type:o}=i,n=e(i,["name","type"]);this.setName(s),this.setType(o),this.build(n),this.lastChangeTime=Date.now(),this.events=new mt({context:this,contextName:"schema"})}setAuthorization(t){this.authorization=t}setApiEndpoints(t){return this.apiEndpoints.clear(),t&&this.apiEndpoints.push(...t),this.apiEndpoints}setApiBaseUrl(t){t&&(this.apiBaseUrl=t.replace(/\/+$/,""))}setObjectNameSingular(t){this.objectNameSingular=t}setObjectNamePlural(t){this.objectNamePlural=t}build(t){for(const e in t){const s="set"+i(e);void 0!==t[e]&&"function"==typeof this[s]&&this[s](t[e])}}setType(t){this.type=t;if(["region","object","post"].includes(this.type)){const t=(e=this.type,"post"===e||"object"===e?[{url:"/objects/%name%",method:"GET",name:"index"},{url:"/objects/%name%/[:id]",method:"GET",name:"show"},{url:"/objects/%name%",method:"POST",name:"create"},{url:"/objects/%name%/[:id]",method:"PUT",name:"update"},{url:"/objects/%name%/[:id]",method:"DELETE",name:"delete"},{url:"/objects/%name%/[:id]/import",method:"POST",name:"import"},{url:"/objects/%name%",method:"DELETE",name:"clear"}]:"region"===e?[{url:"/regions/%name%",method:"GET",name:"index"},{url:"/regions/%name%/[:id]",method:"GET",name:"show"},{url:"/regions/%name%",method:"POST",name:"create"},{url:"/regions/%name%/[:id]",method:"PUT",name:"update"},{url:"/regions/%name%/[:id]/import",method:"POST",name:"import"},{url:"/regions/%name%/[:id]",method:"DELETE",name:"delete"}]:[]).map((t=>Object.assign(Object.assign({},t),{url:t.url.replace("%name%",this.name)})));this.setApiEndpoints(t),this.setApiBaseUrl(s.routes.api.replace(/\/+$/,""))}var e}update(t){this.build(t)}setRemote(t){this.remote=t}setStrict(t){this.strict=t}setId(t){this.id=t}setTitle(t){this.title=t}setName(t){this.name=t}loaded(){return 0!==this.fields.length}setFields(t){t&&(this.fields.clear(),t.forEach((t=>{this.fields.push(new vt(t))})))}addField(t){const e=t instanceof vt?t:new vt(t);this.fields.push(e),o(this.events.trigger,500,this,[yt.UPDATE,{schema:this}])}getFields(){return this.fields}getFieldNames(){return this.fields.map((t=>t.name))}getField(t){return this.fields.findById(t)}getFieldByType(t){let e=null;return this.fields.forEach((function(i){i.type===t&&(e=i)})),e}getColumns(t){t=t||{};const e=this.fields,i=0!==Object.keys(t).length;let s=[];if(i){let i;e.forEach((function(e){i=!0;for(const s in t)i=e[s]==t[s];i&&s.push(e)}))}else s=e;return s}getData(){return{id:this.id,title:this.title,name:this.name,fields:this.fields,type:this.type,authorization:this.authorization,apiEndpoints:this.apiEndpoints,apiBaseUrl:this.apiBaseUrl,objectNamePlural:this.objectNamePlural,objectNameSingular:this.objectNameSingular,remote:this.remote}}}class xt{constructor(t){for(const e in t)this[e]=t[e];this.state=this._state,this.state_short=this._state_short,this.zip=this._zip,this.county=this._county}getData(){const t={};return["route","address_formatted","administrative_area_level_1","administrative_area_level_1_short","administrative_area_level_2","administrative_area_level_2_short","country","country_short","postal_code"].forEach((e=>{this[e]&&(t[e]=this[e])})),t}get _state(){return"US"===this.country_short?this.administrative_area_level_1:null}get _state_short(){return"US"===this.country_short?this.administrative_area_level_1_short:null}get _county(){return"US"===this.country_short?this.administrative_area_level_2:null}get _zip(){return this.postal_code}}class kt{constructor(t,e){this.x=t,this.y=e}}function St(t){return"object"==typeof t&&"x"in t&&"y"in t}let Et=class{constructor(t,e){let i,s;"object"==typeof t?t.x&&t.y?(i=parseFloat(t.x+""),s=parseFloat(t.y+"")):(console.error("MapSVG: incorrect format of {x, y} object for SVGPoint."),i=0,s=0):(i=parseFloat(t+""),s=parseFloat(e+"")),this.x=i,this.y=s}toString(){return this.x+","+this.y}};class Tt{constructor(t,e){let i,s;"object"==typeof t?t.lat&&t.lng?(i=parseFloat(t.lat+""),s=parseFloat(t.lng+"")):(console.error("MapSVG: incorrect format of {lat, lng} object for GeoPoint."),i=0,s=0):(i=parseFloat(t+""),s=parseFloat(e+"")),this.lat=i,this.lng=s}toString(){return this.lat+","+this.lng}}class _t{constructor(t){t.img=t.img||"_pin_default.png",this.update(t)}update(t){t.object&&this.setObject(t.object),t.img&&this.setImage(t.img),t.address&&this.setAddress(t.address),t.svgPoint&&this.setSvgPoint(t.svgPoint),t.geoPoint&&this.setGeoPoint(t.geoPoint)}setObject(t){this.object=t}setImage(t){if("string"!=typeof t)return;let e=t.split("/").pop();-1!==t.indexOf("uploads")&&(e="uploads/"+e),this.img=e,this.imagePath=this.getImageUrl(),this.marker&&this.marker&&this.marker.setImage(this.imagePath)}getImageUrl(){return this.img&&0===this.img.indexOf("uploads/")?s.routes.uploads+"markers/"+this.img.replace("uploads/",""):s.routes.root+"markers/"+(this.img||"_pin_default.png")}setAddress(t){this.address=new xt(t)}setSvgPoint(t){this.svgPoint=t instanceof Et?t:new Et(t),this.marker&&this.marker.setSvgPointFromLocation()}setGeoPoint(t){this.geoPoint=t instanceof Tt?t:new Tt(t),this.marker&&this.marker.setSvgPointFromLocation()}getMarkerImage(){return this.img&&0===this.img.indexOf("uploads/")?s.routes.uploads+"markers/"+this.img.replace("uploads/",""):s.routes.root+"markers/"+(this.img||"_pin_default.png")}getData(){const t={img:this.img,imagePath:this.imagePath,markerImagePath:this.marker&&this.marker.object?this.marker.object.getMarkerImage():this.imagePath,address:this.address};return this.geoPoint&&(t.geoPoint={lat:this.geoPoint.lat,lng:this.geoPoint.lng}),this.svgPoint&&(t.svgPoint={x:this.svgPoint.x,y:this.svgPoint.y}),t}}const Ct={set:(t,e,i,s)=>(e in t?t[e]=i:t.build({[e]:i}),!0),get:(t,e,i)=>e in t._data?t._data[e]:"function"==typeof t[e]?function(...i){return t[e](...i)}:e in t?t[e]:void 0};class Bt{constructor(t,e){return this.initialLoad=!0,this._data={},e&&this.setSchema(e),this.dirtyFields=[],this.initialLoad=!0,this.build(t),this.initialLoad=!1,this._data.id&&this.clearDirtyFields(),new Proxy(this,Ct)}setSchema(t){this.schema=t}get(t){if(this.schema.getField(t))return this._data[t]}set(t,e){this.schema.getField(t)&&this.update({[t]:e})}update(t){return this.build(t)}build(t){for(const e in t){let s=this.schema.getField(e);if(!s){if(this.schema.strict)continue;s=new vt({type:"text",name:e,label:i(e),db_type:"text"}),this.schema.addField(s)}switch(this.initialLoad||this.dirtyFields.push(e),s.type){case"region":this._data.regions=t[e];break;case"location":if(null!=t[e]&&""!=t[e]&&0!==Object.keys(t[e]).length)if(t[e]instanceof _t)this._data.location=t[e];else{const i={img:this.isMarkersByFieldEnabled()?this.getMarkerImage():t[e].img,address:new xt(t[e].address)};t[e].geoPoint&&t[e].geoPoint.lat&&t[e].geoPoint.lng?i.geoPoint=new Tt(t[e].geoPoint):t[e].svgPoint&&t[e].svgPoint.x&&t[e].svgPoint.y&&(i.svgPoint=new Et(t[e].svgPoint)),null!=this._data.location?this._data.location.update(i):this._data.location=new _t(i)}else this._data.location=null;break;case"datetime":null!=t[e]&&""!=t[e]?this._data[e]=new Date(t[e]):this._data[e]=null;break;case"json":this._data[e]="string"==typeof t[e]?JSON.parse(t[e]):t[e];break;default:this._data[e]=t[e]}}this.getLocationField()&&this.isMarkersByFieldEnabled()&&this.isMarkerFieldChanged(t)&&this.reloadMarkerImage()}isMarkerFieldChanged(t){return-1!==Object.keys(t).indexOf(this.getLocationField().markerField)}setLocationField(){}getLocationField(){return this.schema.getFieldByType("location")}reloadMarkerImage(){this._data.location&&this._data.location.setImage(this.getMarkerImage())}getMarkerImage(){let t;if(this.isMarkersByFieldEnabled()){const e=this.getLocationField();return t=this._data[e.markerField],t?("regions"===e.markerField?t=t[0]&&t[0].id:"object"==typeof t&&t.length&&(t=t[0].value),e.markersByField[t]||e.defaultMarkerPath||s.defaultMarkerImage):e.defaultMarkerPath||s.defaultMarkerImage}return this._data.location.imagePath}isMarkersByFieldEnabled(){const t=this.getLocationField();return!!t&&!!(t.markersByFieldEnabled&&t.markerField&&Object.values(t.markersByField).length>0)}clone(){const t=this.getData();return new Bt(t,this.schema)}getEnumLabel(t,e,i){const s=t.options.get(e[i]);return void 0!==s?s.label:""}getDirtyFields(){const t={};return this.dirtyFields.forEach((e=>{t[e]=this._data[e]})),t.id=this._data.id,null!=t.location&&t.location instanceof _t&&(t.location=t.location.getData()),this.schema.getFieldByType("region")&&(t.regions=this._data.regions),t}clearDirtyFields(){this.dirtyFields=[]}getData(){const t={};for(const e in this._data){null!==this._data[e]&&void 0!==this._data[e]&&"function"==typeof this._data[e].getData?t[e]=this._data[e].getData():t[e]=this._data[e];const i=this.schema.getField(e);["select","radio","enum","status"].includes(i.type)&&(t[e+"_text"]=i.getEnumLabel(t[e]))}return t}getRegions(t){return this._data.regions}getRegionsForTable(t){return this._data.regions?this._data.regions.filter((e=>!e.tableName||e.tableName===t)):[]}linkToRegions(t,e){if(0===t.length)return;const i=this.getRegionsForTable(e).map((t=>t.id));i.length>0&&t.filter((t=>i.includes(t.id))).forEach((t=>{t.objects.clear(),t.objects.push(this)}))}}const Dt=new wt({id:-1,type:"schema",name:"schema",title:"Schema",apiEndpoints:new dt("name",[{name:"index",url:"schemas",method:"GET"},{name:"show",url:"schemas/[:id]",method:"GET"},{name:"create",url:"schemas",method:"POST"},{name:"update",url:"schemas/[:id]",method:"PUT"},{name:"delete",url:"schemas/[:id]",method:"DELETE"},{name:"clear",url:"schemas",method:"DELETE"}]),objectNameSingular:"schema",objectNamePlural:"schemas",strict:!0,remote:!1,fields:[{name:"id",type:"id"},{name:"type",type:"text"},{name:"title",type:"text"},{name:"fields",type:"text"},{name:"apiEndpoints",type:"text"},{name:"objectNameSingular",type:"text"},{name:"objectNamePlural",type:"text"},{name:"strict",type:"boolean"},{name:"remote",type:"boolean"}]});class Mt{constructor(t){if(this.filters={},this.filterout={},this.page=1,this.setSearch(""),t)for(const e in t)void 0!==t[e]&&(this[e]=t[e])}setFields(t){const e=this;for(const i in t)"filters"==i?e.setFilters(t[i]):e[i]=t[i]}update(t){for(const e in t)void 0!==t[e]&&("filters"===e?this.setFilters(t[e]):this[e]=t[e])}get(){return{search:this.search,searchField:this.searchField,searchFallback:this.searchFallback,filters:this.filters,filterout:this.filterout,page:this.page,sort:this.sort,perpage:this.perpage,lastpage:this.lastpage}}clearFilters(){this.resetFilters()}setFilters(t){const e=this;for(const i in t)null===t[i]||""===t[i]||void 0===t[i]?e.filters[i]&&delete e.filters[i]:e.filters[i]=t[i]}setSearch(t){this.search=t}setFilterOut(t){null===t?delete this.filterout:this.filterout=t}resetFilters(t){this.filters={},this.setSearch("")}setFilterField(t,e){this.filters[t]=e}hasFilters(){return Object.keys(this.filters).length>0||this.search&&this.search.length>0}removeFilter(t){this.filters[t]=null,delete this.filters[t]}requestSchema(t){this.withSchema=t||!0}}const Rt=jQuery;class At{constructor(t){this.putAvailable=null,this.deleteAvailable=null,this.apiUrl=t}getUrl(t){return 0===t.indexOf("http:")||0===t.indexOf("https:")?t:n(this.apiUrl)+r(t)}get(t,e){return Rt.ajax({url:this.getUrl(t),type:"GET",data:e,beforeSend:t=>{this.addNonceHeader(t)}})}fetch(t,e){return fetch(0===t.indexOf("http:")?t:this.apiUrl+t)}post(t,e){const i={url:this.getUrl(t),type:"POST",data:e,beforeSend:t=>{this.addNonceHeader(t)}};return e instanceof FormData&&(i.processData=!1,i.contentType=!1),!1!==i.processData&&this.processObjectData(e),Rt.ajax(i)}put(t,e){return Rt.Deferred((i=>{this.ensureMethodAvailability("PUT").then((s=>{const o={url:this.getUrl(t),type:s?"PUT":"POST",data:e,beforeSend:t=>{this.addNonceHeader(t),s||t.setRequestHeader("X-HTTP-Method-Override","PUT")}};e instanceof FormData&&(o.processData=!1,o.contentType=!1),!1!==o.processData&&this.processObjectData(e),Rt.ajax(o).done((t=>i.resolve(t))).fail(((t,e,s)=>i.reject(t,e,s)))}))})).promise()}delete(t){return Rt.Deferred((e=>{this.ensureMethodAvailability("DELETE").then((i=>{Rt.ajax({url:this.getUrl(t),type:i?"DELETE":"POST",beforeSend:t=>{this.addNonceHeader(t),i||t.setRequestHeader("X-HTTP-Method-Override","DELETE")}}).done((t=>e.resolve(t))).fail(((t,i,s)=>e.reject(t,i,s)))}))})).promise()}ajax(t,e){return e.url=this.getUrl(t),e.beforeSend=t=>{this.addNonceHeader(t)},Rt.ajax(e)}ensureMethodAvailability(t){return"PUT"===t&&null!==this.putAvailable?Promise.resolve(this.putAvailable):"DELETE"===t&&null!==this.deleteAvailable?Promise.resolve(this.deleteAvailable):this.checkMethodAvailability(t).then((e=>("PUT"===t?this.putAvailable=e:this.deleteAvailable=e,e)))}checkMethodAvailability(t){return a(this,void 0,void 0,(function*(){try{return yield Rt.ajax({url:this.getUrl("/method-check"),type:t,beforeSend:t=>{this.addNonceHeader(t)}}),!0}catch(t){return!1}}))}processObjectData(t){t instanceof Object&&Object.keys(t).forEach((e=>{Array.isArray(t[e])&&0===t[e].length?t[e]=null:t[e]instanceof Object&&this.processObjectData(t[e])}))}addNonceHeader(t){s.nonce&&t.setRequestHeader("X-WP-Nonce",s.nonce)}}const jt=jQuery;var Lt;!function(t){t.AFTER_INIT="afterInit",t.AFTER_LOAD="afterLoad",t.FAILED_LOAD="failedLoad",t.BEFORE_LOAD="beforeLoad",t.BEFORE_FETCH="beforeFetch",t.AFTER_FETCH="afterFetch",t.CHANGE="change",t.BEFORE_UPDATE="beforeUpdate",t.AFTER_UPDATE="afterUpdate",t.BEFORE_CREATE="beforeCreate",t.AFTER_CREATE="afterCreate",t.BEFORE_DELETE="beforeDelete",t.AFTER_DELETE="afterDelete",t.AFTER_UPDATE_SCHEMA="afterUpdateSchema"}(Lt||(Lt={}));class Pt{constructor(t,e){this.hasMore=!1,this.className="",this.classType=Bt,this.map=e,this.server=new At(s.routes.api),this.query=new Mt,this.objects=new dt("id"),this.completeChunks=0,this.setSchema(t),this.middlewares=new gt}getApiEndpoint(t,e){const i=this.schema.apiEndpoints.get(t);if(!i)return null;const o=i.url.replace(/\[:(\w+)\]/g,((t,i)=>e&&void 0!==e[i]?e[i]:`[:${i}]`));return{url:n(this.schema.apiBaseUrl||s.routes.api)+r(o),method:i.method,name:i.name}}init(){var t;this.events=new mt({context:this,contextName:"repository",map:this.map,parent:null===(t=this.map)||void 0===t?void 0:t.events}),this.events.trigger(Lt.AFTER_INIT,{repository:this})}setNoFiltersNoLoad(t){this.noFiltersNoLoad=t}setSchema(t){if(t instanceof wt)this.schema=t,this.schema.events.on(yt.UPDATE,(()=>this.find()));else{const e=()=>a(this,void 0,void 0,(function*(){const{useRepository:e}=yield Promise.resolve().then((function(){return Nt}));e("schemas",this.map).find({filters:{name:t}}).done((t=>{const e=t.items[0];e?(this.setSchema(e),this.find()):console.error("Schema not found")}))}));e()}}getSchema(){return this.schema}loadDataFromResponse(t,e){t=this.middlewares.run(lt.RESPONSE,[t,Object.assign(Object.assign({},e),{repository:this,map:this.map})]);const i=this.defaultResponseMiddleware(t,e);this.objects.clear(),this.schema.objectNamePlural,this.events.trigger(Lt.BEFORE_LOAD,{data:i,repository:this}),"items"in i&&"object"==typeof i.items?(i.items.forEach((t=>{this.objects.push(t)})),this.hasMore=i.hasMore):this.hasMore=!1,this.loaded=!0,this.events.trigger(Lt.AFTER_LOAD,{data:t,repository:this})}reload(){return a(this,void 0,void 0,(function*(){return yield this.find()}))}create(t){const e=jQuery.Deferred();e.promise();const i={};i[this.schema.objectNameSingular]=this.encodeData(t);const s=this.getRequest("create",null,i);return this.events.trigger(Lt.BEFORE_CREATE,{object:i[this.schema.objectNameSingular]}),this.server.post(s.url,s.data).done((t=>{const i=this.getResponse(t,s),o=i.data[this.schema.objectNameSingular];o?(this.objects.push(o),this.events.trigger(Lt.AFTER_CREATE,{object:o}),e.resolve(o)):e.reject(i)})).fail((t=>{e.reject(t)})),e}findById(t,e=!1){const i=jQuery.Deferred();i.promise();const s=this.getRequest("show",{id:t});let o;return e||(o=this.objects.findById(t.toString())),!e&&o?i.resolve(o):this.server.get(s.url,s.data).done((t=>{const e=this.getResponse(t,s);this.events.trigger(Lt.AFTER_LOAD,{data:e.data,repository:this});const o=e.data[this.schema.objectNameSingular];o?i.resolve(o):i.reject(e)})).fail((t=>{i.reject(t)})),i}getRequest(t,e,i={}){const s=this.getApiEndpoint(t,e);if(!s)throw new Error(`API endpoint ${s} does not exists for repository '${this.schema.objectNamePlural}'`);const o={repository:this,url:s.url,action:s.name,method:s.method,data:i};return o.data=this.middlewares.run(lt.REQUEST,[o.data,{request:o,repository:this,map:this.map}]),o}getResponse(t,e){const i={data:t};return i.data=this.middlewares.run(lt.RESPONSE,[i.data,{request:e,response:i,repository:this,map:this.map}]),i.data=this.defaultResponseMiddleware(i.data,{request:e,response:i}),i}find(t){const e=jQuery.Deferred();e.promise(),void 0!==t&&this.query.update(t);const i=this.getRequest("index",null,this.query);i.data!==this.query&&this.query.update(i.data);const s={query:this.query,repository:this};if(this.events.trigger(Lt.BEFORE_LOAD,{query:this.query,repository:this}),s.query!==this.query&&(s.query instanceof Mt||(s.query=new Mt(s.query)),this.query=s.query),this.noFiltersNoLoad&&!this.query.hasFilters())return this.objects.clear(),this.events.trigger(Lt.AFTER_LOAD,{data:{},repository:this}),e.resolve(this.getLoaded()),e;let o=!1;return 0===this.schema.fields.length&&(this.query.update({withSchema:!0}),o=!0),this.server.get(i.url,i.data).done((t=>{o&&this.query.update({withSchema:!1});const s={data:t};this.loadDataFromResponse(s.data,{request:i,response:s}),e.resolve(this.getLoaded())})).fail((t=>{e.reject(t)})),e}getLoaded(){return this.objects}getLoadedObject(t){return this.objects.findById(t.toString())}getLoadedAsArray(){return this.objects}update(t){const e=jQuery.Deferred();e.promise();const i={},s="getDirtyFields"in t?t.getDirtyFields():t,o=this.encodeData(s);i[this.schema.objectNameSingular]=o;const n=this.getRequest("update",{id:s.id},i);return this.events.trigger(Lt.BEFORE_UPDATE,{object:i[this.schema.objectNameSingular]}),this.server.put(n.url,n.data).done((i=>{"clearDirtyFields"in t&&t.clearDirtyFields(),this.getResponse(i,n),e.resolve(t),this.events.trigger(Lt.AFTER_UPDATE,{object:t,updatedFields:o})})).fail(((t,i)=>{e.reject(t,i)})),e}delete(t){const e=jQuery.Deferred();e.promise();const i=this.getRequest("delete",{id:t});return this.events.trigger(Lt.BEFORE_DELETE,{object:Object.assign({id:t},this.objects.findById(t))}),this.server.delete(i.url).done((s=>{this.getResponse(s,i),this.objects.delete(t.toString()),this.events.trigger(Lt.AFTER_DELETE,{repository:this,object:{id:t}}),e.resolve()})).fail((t=>{e.reject(t)})),e}clear(){const t=jQuery.Deferred();t.promise();const e=this.getRequest("clear",null);return this.server.delete(e.url).done((i=>{this.objects.clear(),this.getResponse(i,e),this.events.trigger(Lt.AFTER_LOAD,{repository:this,data:this.objects}),t.resolve()})).fail((e=>{t.reject(e)})),t}onFirstPage(){return 1===this.query.page}onLastPage(){return!1===this.hasMore}encodeData(t){return t}defaultResponseMiddleware(t,e){let i;const s=t;if(i="string"==typeof s?JSON.parse(s):Object.assign({},s),"items"in i&&"hasMore"in i){const{items:t,schema:e,hasMore:s}=i;if(e&&this.schema.update(e),t&&Array.isArray(t)&&t.length>0){const e=t[0];i.items="objectNamePlural"in e?t.map((t=>new wt(t))):t.map((t=>new Bt(t,this.schema)))}}else"schema"in i&&(i.schema=new wt(i.schema)),this.schema.objectNameSingular in i&&(i[this.schema.objectNameSingular]=new Bt(i[this.schema.objectNameSingular],this.schema));return i}import(t,e,i){const s=this,o=s.schema.getFieldByType("location");let n="en";return o&&o.language&&(n=o.language),t=this.formatCSV(t,i),this.importByChunks(t,n,e).done((function(){s.find()}))}importByChunks(t,e,i){const s=this;let o,n,r;const a=[];for(o=0,n=t.length;o<n;o+=50)r=t.slice(o,o+50),a.push(r);if(a.length>0){let t=0;const o=a[0][0]&&a[0][0].location?1e3:0,n=jt.Deferred();return n.promise(),s.completeChunks=0,a.forEach((function(r){t+=o,setTimeout((function(){const t={language:e,convertLatlngToAddress:i};t[s.schema.objectNamePlural]=JSON.stringify(r);const o="region"===s.schema.type?"regions":"objects";s.server.post(o+"/"+s.schema.name+"/import",t).done((function(t){s.completeChunk(a,n)})).fail((t=>{console.error(t)}))}),t)})),n}return null}completeChunk(t,e){this.completeChunks++,this.completeChunks===t.length&&e.resolve()}formatCSV(t,e){const i=this,s=/^[-+]?([1-8]?\d(\.\d+)?|90(\.0+)?)[\s]?[,\s]?[\s]?[-+]?(180(\.0+)?|((1[0-7]\d)|([1-9]?\d))(\.\d+)?)$/g,o=e.regionsRepository.getSchema().name;return t.forEach((function(n,r){const a={};for(const t in n){const r=i.schema.getField(t);if(void 0!==r)switch(r.type){case"region":a[t]={},a[t]=n[t].split(",").map((function(t){return t.trim()})).filter((function(t){return void 0!==e.getRegion(t)||void 0!==e.regions.find((function(e){return e.title===t}))})).map((function(t){let i=e.getRegion(t);return void 0===i&&(i=e.regions.find((function(e){return e.title===t}))),{id:i.id,title:i.title,tableName:o}}));break;case"location":if(n[t].match(s)){let e=",";-1!==n[t].indexOf(",")?e=",":-1!==n[t].indexOf(" ")&&(e=" ");const i=n[t].split(e).map((function(t){return parseFloat(t)}));2==i.length&&i[0]>-90&&i[0]<90&&i[1]>-180&&i[1]<180?a[t]={geoPoint:{lat:i[0],lng:i[1]}}:a[t]=""}else n[t]&&(a[t]={address:n[t]});"object"==typeof a[t]&&(a[t].img=e.options.defaultMarkerImage);break;case"select":if(i.schema.getField(t).multiselect){const e=i.schema.getField(t).options.map((function(t){return t.label}));if(a[t]=n[t].split(",").map((function(t){return t.trim()})).filter((function(t){return-1!==e.indexOf(t)})).map((function(e){return i.schema.getField(t).options.filter((function(t){return t.label==e}))[0]})),0===a[t].length){const e=i.schema.getField(t).options.map((function(t){return t.value+""}));a[t]=n[t].split(",").map((function(t){return t.trim()})).filter((function(t){return-1!==e.indexOf(t)})).map((function(e){return i.schema.getField(t).options.filter((function(t){return t.value==e}))[0]}))}}else a[t]=n[t];break;default:a[t]=n[t]}}t[r]=a})),t}}class Ft extends Pt{constructor(t,e){super(t,e),this.className="Schema"}update(t){const e=jQuery.Deferred();e.promise();const i={};i[this.schema.objectNameSingular]=this.encodeData(t);const s=this.getRequest("update",{id:t.id},i);return this.server.put(s.url,s.data).done((i=>{e.resolve(i),this.events.trigger(Lt.AFTER_UPDATE,{schema:i}),t instanceof wt&&t.events.trigger("update")})).fail((()=>{e.reject()})),e}encodeData(t){const e=t.getData();let i=JSON.stringify(e);i=i.replace(/select/g,"!mapsvg-encoded-slct"),i=i.replace(/table/g,"!mapsvg-encoded-tbl"),i=i.replace(/database/g,"!mapsvg-encoded-db"),i=i.replace(/varchar/g,"!mapsvg-encoded-vc"),i=i.replace(/int\(11\)/g,"!mapsvg-encoded-int");const s=JSON.parse(i);return s.fields=JSON.stringify(e.fields),s.apiEndpoints=JSON.stringify(e.apiEndpoints),s}}class Ot extends Pt{constructor(t,e){super(t,e)}encodeData(t){const e={};return void 0!==t.options&&(e.options=JSON.stringify(t.options),e.options=e.options.replace(/select/g,"!mapsvg-encoded-slct"),e.options=e.options.replace(/table/g,"!mapsvg-encoded-tbl"),e.options=e.options.replace(/database/g,"!mapsvg-encoded-db"),e.options=e.options.replace(/varchar/g,"!mapsvg-encoded-vc"),e.options=e.options.replace(/int\(11\)/g,"!mapsvg-encoded-int")),void 0!==t.title&&(e.title=t.title),void 0!==t.id&&(e.id=t.id),void 0!==t.status&&(e.status=t.status),void 0!==t.version&&(e.version=t.version),void 0!==t.svgFileLastChanged&&(e.svgFileLastChanged=t.svgFileLastChanged),e}defaultResponseMiddleware(t){let e;return e="string"==typeof t?JSON.parse(t):t,e}copy(t,e){const i=jQuery.Deferred();i.promise();const s={options:{title:e}},o=this.getRequest("copy",{id:t},s);return this.server.post(o.url,this.encodeData(s)).done((t=>{const e=this.defaultResponseMiddleware(t);this.objects.clear(),this.events.trigger(Lt.AFTER_LOAD),this.events.trigger("cleared"),i.resolve(e.map)})).fail((()=>{i.reject()})),i}createFromV2(t){const e=jQuery.Deferred();e.promise();const i={};i[this.schema.objectNameSingular]=this.encodeData(t);const s=this.getRequest("createFromV2",null,i);return this.server.post(s.url,i).done((t=>{const i=this.defaultResponseMiddleware(t)[this.schema.objectNameSingular];this.objects.push(i),e.resolve(i),this.events.trigger(Lt.AFTER_CREATE,this,[i])})).fail((()=>{e.reject()})),e}}function It(t,e){const i={maps:{class:Ot,schema:{name:"maps",objectNameSingular:"map",objectNamePlural:"maps",apiEndpoints:[{url:"maps",method:"GET",name:"index"},{url:"maps/[:id]",method:"GET",name:"show"},{url:"maps",method:"POST",name:"create"},{url:"maps/createFromV2",method:"POST",name:"createFromV2"},{url:"maps/[:id]/copy",method:"POST",name:"copy"},{url:"maps/[:id]",method:"PUT",name:"update"},{url:"maps/[:id]",method:"DELETE",name:"delete"},{url:"maps",method:"DELETE",name:"clear"}],fields:[{name:"id",label:"ID",type:"ID",db_type:"int(11)",visible:!0,protected:!0},{name:"title",label:"Title",type:"text",db_type:"varchar(255)",visible:!0},{name:"options",label:"Options",type:"textarea",db_type:"longtext",visible:!0},{name:"svgFilePath",label:"SVG file path",type:"text",db_type:"varchar(512)",visible:!0},{name:"svgFileLastChanged",label:"SVG file last changed",type:"text",db_type:"int(11)",visible:!0},{name:"version",label:"Version",type:"text",db_type:"varchar(50)",visible:!0},{name:"status",label:"Status",type:"text",db_type:"tinyint",visible:!1},{name:"statusChangedAt",label:"Status Changed At",type:"text",db_type:"timestamp",visible:!1}]}},regions:{class:Pt,schema:{objectNameSingular:"region",objectNamePlural:"regions",apiEndpoints:[{url:"regions/[:name]",method:"GET",name:"index"},{url:"regions/[:name]/[:id]",method:"GET",name:"show"},{url:"regions/[:name]",method:"POST",name:"create"},{url:"regions/[:name]/[:id]",method:"PUT",name:"update"},{url:"regions/[:name]/[:id]/import",method:"POST",name:"import"},{url:"regions/[:name]/[:id]",method:"DELETE",name:"delete"}]}},objects:{class:Pt,schema:{objectNameSingular:"object",objectNamePlural:"objects",apiEndpoints:[{url:"objects/[:name]",method:"GET",name:"index"},{url:"objects/[:name]/[:id]",method:"GET",name:"show"},{url:"objects/[:name]",method:"POST",name:"create"},{url:"objects/[:name]/[:id]",method:"PUT",name:"update"},{url:"objects/[:name]/[:id]",method:"DELETE",name:"delete"},{url:"objects/[:name]/[:id]/import",method:"POST",name:"import"},{url:"objects/[:name]",method:"DELETE",name:"clear"}]}},schemas:{class:Ft,schema:Dt},logs:{class:Pt,schema:{objectNameSingular:"log",objectNamePlural:"logs"}},tokens:{class:Pt,schema:{name:"tokens",objectNameSingular:"token",objectNamePlural:"tokens",apiEndpoints:new dt("name",[{name:"index",url:"tokens",method:"GET"},{name:"create",url:"tokens",method:"POST"},{name:"delete",url:"tokens/[:id]",method:"DELETE"}]),fields:[{name:"id",label:"ID",type:"id",db_type:"int(11)",protected:!0,auto_increment:!0},{label:"Token",name:"token",type:"text",db_type:"varchar(255)"},{label:"Token first four",name:"tokenFirstFour",type:"text",db_type:"varchar(255)"},{label:"Hashed token",name:"hashedToken",type:"text",db_type:"varchar(255)"},{name:"createdAt",label:"Created at",type:"datetime",db_type:"datetime"},{name:"lastUsedAt",label:"Last used at",type:"datetime",db_type:"datetime"},{name:"accessRights",label:"Access rights",type:"json",db_type:"json"}]}}};let s,o;if("string"==typeof t){let n=t;if(-1!==n.indexOf("regions")?n="regions":-1===n.indexOf("objects")&&-1===n.indexOf("database")||(n="objects"),s=new wt(i[n].schema),["objects","regions"].includes(n)&&s.apiEndpoints.forEach((e=>{e.url=e.url.replace(/\[:name\]/,t)})),o=new i[n].class(s,e),("regions"===n||"objects"===n)&&e){e.middlewares.middlewares.filter((t=>t.name===lt.REQUEST||t.name===lt.RESPONSE)).forEach((t=>{o.middlewares.add(t.name,t.handler,t.options.unique)}))}}else if(s=new wt(t),o=new Pt(s,e),("regions"===s.objectNamePlural||"objects"===s.objectNamePlural)&&e){e.middlewares.middlewares.filter((t=>t.name===lt.REQUEST||t.name===lt.RESPONSE)).forEach((t=>{o.middlewares.add(t.name,t.handler,t.options.unique)}))}return o.init(),o}var Nt=Object.freeze({__proto__:null,useRepository:It});const Ht=jQuery;var zt;!function(t){t.RESIZE="resize",t.BEFORE_SHOW="beforeShow",t.AFTER_SHOW="afterShow",t.BEFORE_CLOSE="beforeClose",t.AFTER_CLOSE="afterClose",t.BEFORE_REDRAW="beforeRedraw",t.AFTER_REDRAW="afterRedraw",t.BEFORE_LOAD="beforeLoad",t.AFTER_LOAD="afterLoad",t.AFTER_UNLOAD="afterUnload"}(zt||(zt={}));class Vt{constructor(e){var i,s;this.openedFullscreen=!1,this.uid=l(),this.containers={parent:e.container},this.parent=e.parent,this.destroyed=!1,this.options=e.options,this.position=e.position,this.classList=e.classList||[],this.classList.push("mapsvg-controller-container"),this.opened=!0,this.loaded=!1,this.closable=null!==(i=e.closable)&&void 0!==i&&i,this.canClose=!0,this.fullscreen=h({sm:!1,md:!1,lg:!1},e.fullscreen),this.map=e.map,this.template=e.template||"",this.scrollable=void 0===e.scrollable||e.scrollable,this.withToolbar=void 0===e.withToolbar||e.withToolbar,this.noPadding=null!==(s=e.noPadding)&&void 0!==s&&s,this.autoresize=t(e.autoresize),this.setState(e.state),this.eventOptions=e.events,this.middlewareOptions=e.middleware,e.styles&&(this.styles=e.styles),this.middlewares=new gt}viewDidLoad(){}viewDidAppear(){}viewDidDisappear(){}viewWillRedraw(){}viewDidRedraw(){}updateScroll(){if(!this.scrollable)return;const t=this;Ht(this.containers.contentWrap).nanoScroller({preventPageScrolling:!0}),setTimeout((function(){Ht(t.containers.contentWrap).nanoScroller({preventPageScrolling:!0})}),300)}adjustHeight(){const t=this;Ht(t.containers.main).height(Ht(t.containers.main).find(".mapsvg-auto-height").outerHeight()+(t.containers.toolbar?Ht(t.containers.toolbar).outerHeight():0))}init(){if(!this.destroyed){if(this.position&&this.classList.push("mapsvg-"+this.position),this.events=new mt({context:this,contextName:this.name,map:this.map,parent:this.parent&&this.parent.events?this.parent.events:void 0}),this.events)for(const t in this.eventOptions)"function"==typeof this.eventOptions[t]&&this.events.on(t,this.eventOptions[t]);this.middlewareOptions&&this.middlewareOptions.forEach((t=>this.middlewares.add(t.name,t.handler))),this.templates={toolbar:Handlebars.compile(this.getToolbarTemplate()),main:Handlebars.compile(this.getMainTemplate())},this.render()}}getToolbarTemplate(){return this.closable&&this.withToolbar?'<div class="mapsvg-popover-close mapsvg-details-close"></div>':""}setMainTemplate(t){return this.templates.main=Handlebars.compile(t)}getMainTemplate(){return this.template||""}getWrapperTemplate(){return"<div></div>"}setStyles(t){Object.assign(this.containers.main.style,t)}render(){if(!this.destroyed){for(const[t,e]of Object.entries(this.fullscreen))e&&this.classList.push(`mapsvg-fullscreen-${t}`);(c()&&this.fullscreen.sm||d()&&this.fullscreen.md||this.fullscreen.lg)&&(this.containers.parent=document.body,this.openedFullscreen=!0,document.body.classList.add("mapsvg-modal-fullscreen")),this.containers.main=Ht("<div />")[0],this.containers.main.classList.add(...this.classList),this.setStyles(this.styles),Ht(this.containers.main).toggleClass("mapsvg-invisible",!this.opened),this.containers.view=Ht("<div />").attr("id","mapsvg-controller-"+this.name).addClass("mapsvg-controller-view")[0],this.containers.contentWrap=Ht("<div />").addClass("mapsvg-controller-view-wrap")[0],this.containers.contentWrap2=Ht("<div />")[0],this.containers.sizer=Ht("<div />").addClass("mapsvg-auto-height")[0],this.containers.contentView=Ht("<div />").toggleClass("mapsvg-controller-view-content",!this.noPadding)[0],this.containers.sizer.appendChild(this.containers.contentView),this.scrollable&&(Ht(this.containers.contentWrap).addClass("nano"),Ht(this.containers.contentWrap2).addClass("nano-content")),this.containers.contentWrap.appendChild(this.containers.contentWrap2),this.containers.contentWrap2.appendChild(this.containers.sizer),this.withToolbar&&this.templates.toolbar&&(this.containers.toolbar=Ht("<div />").addClass("mapsvg-controller-view-toolbar")[0],this.containers.view.appendChild(this.containers.toolbar)),this.containers.view.append(this.containers.contentWrap),this.containers.main.append(this.containers.view),this.containers.parent.appendChild(this.containers.main),this.autoresize&&(this.resizeSensor=new u(this.containers.sizer,(()=>{this.adjustHeight(),this.updateScroll(),this.events.trigger(zt.RESIZE,{controller:this})}))),this.closable&&!this.mobileCloseBtn&&(this.mobileCloseBtn=Ht('<button class="mapsvg-mobile-modal-close">'+this.map.getData().options.mobileView.labelClose+"</button>")[0],Ht(this.containers.view).append(this.mobileCloseBtn)),this.loaded=!0,this.viewDidLoad(),this.events.trigger(zt.AFTER_LOAD,{controller:this}),setTimeout((()=>{this.setEventHandlers(),this.redraw()}),1)}}setState(t,e=!1){this.state=e?t:Object.assign(Object.assign({},this.state),t),this.loaded&&this.redraw()}redraw(){if(this.destroyed)return;this.events.trigger(zt.BEFORE_REDRAW,{controller:this});let t=Object.assign({},this.state);t=this.middlewares.run(lt.RENDER,[t,{controller:this}]),this.viewWillRedraw();try{Ht(this.containers.contentView).html(this.templates.main(t))}catch(t){console.error(t),Ht(this.containers.contentView).html("")}this.withToolbar&&this.templates.toolbar&&Ht(this.containers.toolbar).html(this.templates.toolbar(t)),this.resize(),this.viewDidRedraw(),this.events.trigger(zt.AFTER_REDRAW,{controller:this})}resize(){this.updateTopShift(),this.updateScroll(),this.autoresize&&(this.adjustHeight(),this.resizeSensor.setScroll())}updateTopShift(){const t=this;this.withToolbar&&(Ht(t.containers.contentWrap).css({top:Ht(t.containers.toolbar).outerHeight(!0)+"px"}),setTimeout((function(){Ht(t.containers.contentWrap).css({top:Ht(t.containers.toolbar).outerHeight(!0)+"px"})}),100),setTimeout((function(){Ht(t.containers.contentWrap).css({top:Ht(t.containers.toolbar).outerHeight(!0)+"px"})}),200),setTimeout((function(){Ht(t.containers.contentWrap).css({top:Ht(t.containers.toolbar).outerHeight(!0)+"px"}),t.updateScroll()}),500))}setEventHandlers(){const t=t=>(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),"click"!==t.type&&"touchend"!==t.type||this.close(),!1);this.closable&&(Ht(this.containers.toolbar).on("click touchend touchstart mousedown",".mapsvg-popover-close",(e=>{t(e)})),Ht(this.containers.view).on("click touchend touchstart mousedown",".mapsvg-mobile-modal-close",(e=>{t(e)})),Ht(window).off("keydown.details.mapsvg-"+this.map.id).on("keydown.details.mapsvg-"+this.map.id,(t=>{27==t.keyCode&&this.close()})))}open(){!this.closable&&this.destroyed||(this.events.trigger(zt.BEFORE_SHOW,{controller:this}),Ht(this.containers.main).toggleClass("mapsvg-invisible",!1),this.opened=!0,this.resize(),this.viewDidAppear(),this.events.trigger(zt.AFTER_SHOW,{controller:this}))}close(){this.closable&&this.canClose&&this.opened&&!1!==this.viewWillClose()&&(this.openedFullscreen&&document.body.classList.remove("mapsvg-modal-fullscreen"),this.events.trigger(zt.BEFORE_CLOSE,{controller:this}),Ht(this.containers.main).toggleClass("mapsvg-invisible",!0),this.opened=!1,this.events.trigger(zt.AFTER_CLOSE,{controller:this}))}set canClose(t){this._canClose=t}get canClose(){return this._canClose}viewWillClose(){return!0}viewWillGetDestroyed(){}destroy(){this.destroyed||(this.close(),this.viewWillGetDestroyed(),this.resizeSensor&&this.resizeSensor.destroy(),delete this.resizeSensor,Ht(this.containers.view).empty().remove(),Ht(this.containers.main).empty().remove(),Ht(window).off("keydown.details.mapsvg-"+this.map.id),Ht("body").off("mouseup.popover.mapsvg touchend.popover.mapsvg"),this.events.trigger(zt.AFTER_UNLOAD,{controller:this}),this.events=null,this.destroyed=!0)}setOptions(t){}is(t){return"details"!==t&&"modal"!==t||(t="detailsView"),this.name===t}}jQuery;class qt extends Vt{constructor(t){super(t),this.name="detailsView",this.classList.push("mapsvg-details-container"),this.closable=!0,this.autoresize=t.autoresize,this.position=t.position||"absolute"}viewDidLoad(){}}const Gt=jQuery;class Ut{constructor(t,e,i){var s;this.readonly=void 0!==t.readonly&&t.readonly,this.protected=void 0!==t.protected&&t.protected,this.renamable=void 0===t.renamable||t.renamable,this.auto_increment=void 0!==t.auto_increment&&t.auto_increment,this.not_null=void 0!==t.not_null&&t.not_null,this.searchable=void 0!==t.searchable&&t.searchable,this.visible=void 0===t.visible||t.visible,this.hiddenOnTable=void 0!==t.hiddenOnTable&&t.hiddenOnTable,this.showIf=null!==(s=t.showIf)&&void 0!==s?s:{},this.typeLabel="Form Element",this.formBuilder=e,this.events=new mt({context:this,contextName:"formElement",map:this.formBuilder.mapsvg,parent:this.formBuilder.events}),this.type=t.type,this.value=t.value,this.db_type=t.db_type||"varchar(255)",this.label=this.label||(void 0===t.label?"Label":t.label),this.name=this.name||t.name||"label",this.help=t.help||"",this.placeholder=t.placeholder,this.setExternal(i);let o=this.type;"marker"===o&&this.mapIsGeo&&(o="marker-geo"),"location"===o&&this.mapIsGeo&&(o="location-geo"),this.filtersMode?(this.parameterName=t.parameterName||"",this.parameterNameShort="distance"===this.type?"distance":this.parameterName.split(".")[1],this.name=this.parameterNameShort,this.placeholder=t.placeholder||"",this.templates={main:Handlebars.compile(Gt("#mapsvg-filters-tmpl-"+o+"-view").html())}):this.templates={main:Handlebars.compile(Gt("#mapsvg-data-tmpl-"+o+"-view").html())},this.inputs={}}init(){this.setDomElements(),this.setEventHandlers()}setDomElements(){this.domElements={main:Gt(this.templates.main(this.getDataForTemplate()))[0]},Gt(this.domElements.main).data("formElement",this),this.visible||Gt(this.domElements.main).hide(),this.addSelect2()}setEventHandlers(){const t=this;this.formBuilder.editMode&&Gt(this.domElements.main).on("click",(()=>{t.events.trigger("click",{formElement:this})}))}addSelect2(){Gt().mselect2&&(Gt(this.domElements.main).find("select").css({width:"100%",display:"block"}).mselect2().on("select2:focus",(function(){Gt(this).mselect2("open")})),Gt(this.domElements.main).find(".select2-selection--multiple .select2-search__field").css("width","100%"))}setEditorEventHandlers(){const t=this;Gt(this.domElements.edit).on("click","button.mapsvg-remove",(function(){t.destroy()})),Gt(this.domElements.edit).on("click",".mapsvg-filter-insert-options",(function(){const e=t.parameterName.split(".")[0],i=t.parameterName.split(".")[1];let s;if("Object"==e)s=t.formBuilder.mapsvg.objectsRepository.getSchema().getField(i);else if("id"==i){const e=[];t.formBuilder.mapsvg.regions.forEach((function(t){e.push({label:t.id,value:t.id})})),s={options:e}}else if("title"===i){const e=[];t.formBuilder.mapsvg.regions.forEach((function(t){e.push({label:t.title,value:t.title})})),s={options:e}}else s=t.formBuilder.mapsvg.regionsRepository.getSchema().getField(i);if(s&&s.options||"regions"===i){let e;if("regions"==i){const i=t.formBuilder.mapsvg.regions.map((t=>({id:t.id,title:t.title})));i.sort((function(t,e){return t.title<e.title?-1:t.title>e.title?1:0})),e=i.map((function(t){return(t.title||t.id)+":"+t.id}))}else e=s.options.map((function(t){return t.label+":"+t.value}));Gt(this).closest(".form-group").find("textarea").val(e.join("\n")).trigger("change")}})),Gt(this.domElements.edit).on("keyup change paste","input, textarea, select",(function(){const e=Gt(this).attr("name"),i=Gt(this).data("array");if("status"===t.type&&i){const e=Gt(this).data("param"),i=Gt(this).closest("tr").index();t.options[i]=t.options[i]||{label:"",value:"",color:"",disabled:!1},t.options[i][e]=Gt(this).is(":checkbox")?Gt(this).prop("checked"):Gt(this).val(),t.redraw()}else if("distance"===t.type&&i){const e=Gt(this).data("param"),i=Gt(this).closest("tr").index();t.options[i]||(t.options[i]={value:"",default:!1}),"default"===e?(t.options.forEach((function(t){t.default=!1})),t.options[i].default=Gt(this).prop("checked")):t.options[i].value=Gt(this).val(),t.redraw()}else{if("label"==e||"name"==e)return!1;{let i;if(i="checkbox"==Gt(this).attr("type")?Gt(this).prop("checked"):Gt(this).val(),"radio"==Gt(this).attr("type")){const t=Gt(this).attr("name");i=Gt('input[name="'+t+'"]:checked').val()}t.update(e,i)}}})),Gt(this.domElements.edit).on("keyup change paste",'input[name="label"]',(function(){if(!t.nameChanged){if(t.label=Gt(this).val()+"",!1!==t.renamable&&"region"!=t.type&&"location"!=t.type&&"title"!=t.type){let e=Gt(this).val()+"";e=e.toLowerCase().replace(/ /g,"_").replace(/\W/g,""),e.length<64&&Gt(t.domElements.edit).find('input[name="name"]').val(e),t.name=e+""}Gt(t.domElements.main).find("label").first().html(t.label),t.filtersMode||Gt(t.domElements.main).find("label").first().append('<div class="field-name">'+t.name+"</div>")}})),Gt(this.domElements.edit).on("keyup change paste",'input[name="name"]',(function(e){e.target.value&&(e.target.value.match(/[^a-zA-Z0-9_]/g)&&(e.target.value=e.target.value.replace(/[^a-zA-Z0-9_]/g,""),Gt(e.target).trigger("change")),e.target.value[0].match(/[^a-zA-Z_]/g)&&(e.target.value=e.target.value[0].replace(/[^a-zA-Z_]/g,"")+e.target.value.slice(1),Gt(e.target).trigger("change"))),"region"!=t.type&&(t.name=e.target.value),Gt(t.domElements.main).find("label").html(t.label+'<div class="field-name">'+t.name+"</div>"),t.nameChanged=!0})),Gt(this.domElements.edit).on("keyup change paste",'textarea[name="help"]',(function(e){Gt(t.domElements.main).find(".form-text").text(e.target.value)}))}getEditor(){return this.filtersMode?this.templates.edit=this.templates.edit||Handlebars.compile(Gt("#mapsvg-filters-tmpl-"+this.type+"-control").html()):this.templates.edit=this.templates.edit||Handlebars.compile(Gt("#mapsvg-data-tmpl-"+this.type+"-control").html()),this.domElements.edit=Gt("<div>"+this.templates.edit(this.getDataForTemplate())+"</div>")[0],this.domElements.edit}destroyEditor(){Gt(this.domElements.edit).empty().remove()}initEditor(){Gt(this.domElements.edit).find("input").first().select(),Gt().colorpicker&&Gt(this.domElements.edit).find(".cpicker").colorpicker().on("changeColor.colorpicker",(function(){""==Gt(this).find("input").val()&&Gt(this).find("i").css({"background-color":""})})),Gt().mselect2&&"distance"!==this.type&&Gt(this.domElements.edit).find("select").css({width:"100%",display:"block"}).mselect2(),this.setEditorEventHandlers()}getSchema(){return Object.assign({type:this.type,db_type:this.db_type,label:this.label,name:this.name,value:this.value,searchable:this.searchable,help:this.help,visible:void 0===this.visible||this.visible,readonly:this.readonly,placeholder:this.placeholder,protected:this.protected,renamable:this.renamable,auto_increment:this.auto_increment,not_null:this.not_null,options:this.options?this.getSchemaFieldOptionsList():void 0},this.filtersMode?{parameterName:this.parameterName,parameterNameShort:"distance"===this.type?"distance":this.parameterName.split(".")[1]}:void 0)}getSchemaFieldOptionsList(){const t=[];return this.options.forEach(((e,i)=>{""!==this.options[i].value&&t.push(this.options[i])})),t}getDataForTemplate(){const t=this.getSchema();if(t._name=t.name,this.namespace){t.name=this.name.split("[")[0];let e=this.name.split("[")[1]||"";e&&(e="["+e),t.name=this.namespace+"["+t.name+"]"+e}return t.external=this.external,t}update(t,e){const i=this;if("options"==t){const t=[];e=e.split("\n").forEach((function(e){e=e.trim().split(":"),"checkbox"==i.type&&3==e.length?t.push({label:e[0],name:e[1],value:e[2]}):"radio"!=i.type&&"select"!=i.type&&"checkboxes"!=i.type||2!=e.length||t.push({label:e[0],value:e[1]})})),this.options=t}else this[t]=e;"parameterName"==t&&Gt(this.domElements.edit).find(".mapsvg-filter-param-name").text(e)}redraw(){const t=Gt(this.templates.main(this.getDataForTemplate()));Gt(this.domElements.main).html(t.html()),Gt().mselect2&&("distance"!==this.type?Gt(this.domElements.main).find("select").css({width:"100%",display:"block"}).mselect2().on("select2:focus",(function(){Gt(this).mselect2("open")})):Gt(this.domElements.main).find("select").mselect2().on("select2:focus",(function(){Gt(this).mselect2("open")})))}redrawEditor(){this.domElements.edit&&(Gt(this.domElements.edit).empty(),Gt(this.domElements.edit).html("<div>"+this.templates.edit(this.getDataForTemplate())+"</div>"),this.initEditor())}setOptions(t){return t?(this.options=[],this.optionsDict={},t.forEach(((t,e)=>{this.options.push(t),this.optionsDict[e]=t})),this.options):this.setOptions([{label:"Option one",name:"option_one",value:1},{label:"Option two",name:"option_two",value:2}])}getData(){return{name:this.name,value:this.getValue()}}destroy(){if(Gt().mselect2){const t=Gt(this.domElements.main).find(".mapsvg-select2");t.length&&t.mselect2("destroy")}Gt(this.domElements.main).empty().remove(),Gt(this.domElements.edit).empty().remove(),this.events.trigger("delete",{formElement:this})}show(){Gt(this.domElements.main).show()}hide(){Gt(this.domElements.main).hide()}setExternal(t){this.external=t,void 0!==this.external.mapIsGeo&&(this.mapIsGeo=this.external.mapIsGeo),void 0!==this.external.editMode&&(this.editMode=this.external.editMode),void 0!==this.external.filtersMode&&(this.filtersMode=this.external.filtersMode),void 0!==this.external.namespace&&(this.namespace=this.external.namespace)}getValue(){return this.value}setValue(t,e=!0){this.value=t,e&&this.setInputValue(t)}setInputValue(t){}triggerChanged(){this.events.trigger("change",{formElement:this,name:this.name,field:this.name,value:this.value})}}const Wt=jQuery;class $t extends Ut{constructor(t,e,i){super(t,e,i),void 0===t.showAsSwitch?this.showAsSwitch=!0:this.showAsSwitch=t.showAsSwitch,this.db_type="tinyint(1)",this.typeLabel="Checkbox",this.checkboxLabel=t.checkboxLabel,this.checkboxValue=t.checkboxValue}setDomElements(){super.setDomElements(),this.inputs.checkbox=Wt(this.domElements.main).find("input")[0],this.inputs.switch=Wt(this.domElements.main).find("input")[0]}setEventHandlers(){super.setEventHandlers(),Wt(this.inputs.checkbox).on("change",(t=>{this.setValue(t.target.checked,!1),this.triggerChanged()}))}setEditorEventHandlers(){super.setEditorEventHandlers(),Wt(this.domElements.edit).on("change","[name='showAsSwitch']",(t=>{this.showAsSwitch&&Wt(this.domElements.main).find("[name='checkboxToSwitch']").addClass("form-switch form-switch-md"),this.showAsSwitch||Wt(this.domElements.main).find("[name='checkboxToSwitch']").removeClass("form-switch form-switch-md")})),Wt(this.domElements.edit).on("keyup change paste",'[name="checkboxLabel"]',(t=>{Wt(this.domElements.main).find(".form-check-label").text(t.target.value)}))}getSchema(){const t=super.getSchema();return this.checkboxLabel&&(t.checkboxLabel=this.checkboxLabel),this.checkboxValue&&(t.checkboxValue=this.checkboxValue),t.showAsSwitch=this.showAsSwitch,t}setInputValue(t){this.inputs.checkbox.checked=!0===t}}const Xt=jQuery;class Qt extends Ut{constructor(t,e,i){super(t,e,i),this.db_type="text",this.typeLabel="Checkboxes",this.checkboxLabel=t.checkboxLabel,this.setOptions(t.options)}setDomElements(){super.setDomElements(),this.$checkboxes=Xt(this.domElements.main).find('input[type="checkbox"]'),this.setInputValue(this.value||[])}setEventHandlers(){super.setEventHandlers(),this.$checkboxes.on("change",(t=>{const e=[];Xt(this.domElements.main).find("input:checked").each(((t,i)=>{e.push(jQuery(i).attr("value"))})),this.setValue(e,!1),this.triggerChanged()}))}setInputValue(t){null===t?Xt(this.domElements.main).find("input").prop("checked",!1):t.forEach((t=>{Xt(this.domElements.main).find(`input[value="${t}"]`).prop("checked",!0)}))}}const Yt=jQuery;class Zt extends Ut{constructor(t,e,i){super(t,e,i),this.formBuilder.admin&&(this.languages=["en-GB","ar","az","bg","bs","ca","cs","cy","da","de","el","es","et","eu","fa","fi","fo","fr","gl","he","hr","hu","hy","id","is","it","ja","ka","kh","kk","kr","lt","lv","mk","ms","nb","nl","nl-BE","no","pl","pt-BR","pt","ro","rs","rs-latin","ru","sk","sl","sq","sr","sr-latin","sv","sw","th","tr","uk","vi","zh-CN","zh-TW"]),this.db_type="varchar(50)",this.typeLabel="Datetime",this.language=t.language}setDomElements(){super.setDomElements(),this.inputs.date=Yt(this.domElements.main).find("input")[0]}setEventHandlers(){super.setEventHandlers(),Yt(this.inputs.date).on("change",(t=>{this.setValue(t.target.value,!1),this.triggerChanged()}))}getSchema(){const t=super.getSchema();return t.language=this.language,t}getDataForTemplate(){const t=super.getDataForTemplate();return this.formBuilder.admin&&(t.languages=this.languages),t.language=this.language,t}}var Kt,Jt,te,ee,ie="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function se(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/function oe(){if(Jt)return Kt;Jt=1;var t=Object.getOwnPropertySymbols,e=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;return Kt=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},i=0;i<10;i++)e["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var s={};return"abcdefghijklmnopqrst".split("").forEach((function(t){s[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},s)).join("")}catch(t){return!1}}()?Object.assign:function(s,o){for(var n,r,a=function(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(s),l=1;l<arguments.length;l++){for(var h in n=Object(arguments[l]))e.call(n,h)&&(a[h]=n[h]);if(t){r=t(n);for(var c=0;c<r.length;c++)i.call(n,r[c])&&(a[r[c]]=n[r[c]])}}return a},Kt}function ne(){if(ee)return te;ee=1;var t=oe(),e={isMsie:function(){return!!/(msie|trident)/i.test(navigator.userAgent)&&navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]},isBlankString:function(t){return!t||/^\s*$/.test(t)},escapeRegExChars:function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isArray:Array.isArray,isFunction:function(t){return"function"==typeof t},isObject:function(t){return"object"==typeof t},isUndefined:function(t){return void 0===t},isElement:function(t){return!(!t||1!==t.nodeType)},isJQuery:function(t){return t instanceof $},toStr:function(t){return e.isUndefined(t)||null===t?"":t+""},bind:function(t,e){return t.bind(e)},each:function(t,e){t.forEach(e)},map:function(t,e){return t.map(e)},filter:function(t,e){return t.filter(e)},every:function(t,e){var i=!0;if(!t)return i;for(var s in t)if(t.hasOwnProperty(s)){var o=t[s];if(!(i=e.call(null,o,s,t)))return!1}return!!i},some:function(t,e){var i=!1;if(!t)return i;for(var s in t)if(t.hasOwnProperty(s)){var o=t[s];if(i=e.call(null,o,s,t))return!1}return!!i},mixin:oe(),identity:function(t){return t},clone:function(e){return t({},e)},getIdGenerator:function(){var t=0;return function(){return t++}},templatify:function(t){return e.isFunction(t)?t:function(){return String(t)}},defer:function(t){setTimeout(t,0)},debounce:function(t,e,i){var s,o;return function(){var n,r,a=this,l=arguments;return n=function(){s=null,i||(o=t.apply(a,l))},r=i&&!s,clearTimeout(s),s=setTimeout(n,e),r&&(o=t.apply(a,l)),o}},throttle:function(t,e){var i,s,o,n,r,a;return r=0,a=function(){r=new Date,o=null,n=t.apply(i,s)},function(){var l=new Date,h=e-(l-r);return i=this,s=arguments,h<=0?(clearTimeout(o),o=null,r=l,n=t.apply(i,s)):o||(o=setTimeout(a,h)),n}},stringify:function(t){return e.isString(t)?t:JSON.stringify(t)},noop:function(){},error:function(t){throw new Error(t)}};return te=e}function re(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ae,le,he,ce,de,ue,pe,me={exports:{}};
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   3.3.1
 */me.exports;function ge(){return ae||(ae=1,me.exports=function(){function t(t){return"function"==typeof t||"object"==typeof t&&null!==t}function e(t){return"function"==typeof t}var i=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},s=0,o=void 0,n=void 0,r=function(t,e){b[s]=t,b[s+1]=e,2===(s+=2)&&(n?n(w):k())};function a(t){n=t}function l(t){r=t}var h="undefined"!=typeof window?window:void 0,c=h||{},d=c.MutationObserver||c.WebKitMutationObserver,u="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),p="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function m(){return function(){return process.nextTick(w)}}function g(){return function(){o(w)}}function f(){var t=0,e=new d(w),i=document.createTextNode("");return e.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}function v(){var t=new MessageChannel;return t.port1.onmessage=w,function(){return t.port2.postMessage(0)}}function y(){var t=setTimeout;return function(){return t(w,1)}}var b=new Array(1e3);function w(){for(var t=0;t<s;t+=2)(0,b[t])(b[t+1]),b[t]=void 0,b[t+1]=void 0;s=0}function x(){try{var t=re("vertx");return o=t.runOnLoop||t.runOnContext,g()}catch(t){return y()}}var k=void 0;function S(t,e){var i=arguments,s=this,o=new this.constructor(_);void 0===o[T]&&Z(o);var n,a=s._state;return a?(n=i[a-1],r((function(){return $(a,o,n,s._result)}))):V(s,o,t,e),o}function E(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var i=new e(_);return I(i,t),i}k=u?m():d?f():p?v():void 0===h?x():y();var T=Math.random().toString(36).substring(16);function _(){}var C=void 0,B=1,D=2,M=new G;function R(){return new TypeError("You cannot resolve a promise with itself")}function A(){return new TypeError("A promises callback cannot return that same promise.")}function j(t){try{return t.then}catch(t){return M.error=t,M}}function L(t,e,i,s){try{t.call(e,i,s)}catch(t){return t}}function P(t,e,i){r((function(t){var s=!1,o=L(i,e,(function(i){s||(s=!0,e!==i?I(t,i):H(t,i))}),(function(e){s||(s=!0,z(t,e))}),"Settle: "+(t._label||" unknown promise"));!s&&o&&(s=!0,z(t,o))}),t)}function F(t,e){e._state===B?H(t,e._result):e._state===D?z(t,e._result):V(e,void 0,(function(e){return I(t,e)}),(function(e){return z(t,e)}))}function O(t,i,s){i.constructor===t.constructor&&s===S&&i.constructor.resolve===E?F(t,i):s===M?z(t,M.error):void 0===s?H(t,i):e(s)?P(t,i,s):H(t,i)}function I(e,i){e===i?z(e,R()):t(i)?O(e,i,j(i)):H(e,i)}function N(t){t._onerror&&t._onerror(t._result),q(t)}function H(t,e){t._state===C&&(t._result=e,t._state=B,0!==t._subscribers.length&&r(q,t))}function z(t,e){t._state===C&&(t._state=D,t._result=e,r(N,t))}function V(t,e,i,s){var o=t._subscribers,n=o.length;t._onerror=null,o[n]=e,o[n+B]=i,o[n+D]=s,0===n&&t._state&&r(q,t)}function q(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var s=void 0,o=void 0,n=t._result,r=0;r<e.length;r+=3)s=e[r],o=e[r+i],s?$(i,s,o,n):o(n);t._subscribers.length=0}}function G(){this.error=null}var U=new G;function W(t,e){try{return t(e)}catch(t){return U.error=t,U}}function $(t,i,s,o){var n=e(s),r=void 0,a=void 0,l=void 0,h=void 0;if(n){if((r=W(s,o))===U?(h=!0,a=r.error,r=null):l=!0,i===r)return void z(i,A())}else r=o,l=!0;i._state!==C||(n&&l?I(i,r):h?z(i,a):t===B?H(i,r):t===D&&z(i,r))}function X(t,e){try{e((function(e){I(t,e)}),(function(e){z(t,e)}))}catch(e){z(t,e)}}var Q=0;function Y(){return Q++}function Z(t){t[T]=Q++,t._state=void 0,t._result=void 0,t._subscribers=[]}function K(t,e){this._instanceConstructor=t,this.promise=new t(_),this.promise[T]||Z(this.promise),i(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?H(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&H(this.promise,this._result))):z(this.promise,J())}function J(){return new Error("Array Methods must be provided an Array")}function tt(t){return new K(this,t).promise}function et(t){var e=this;return i(t)?new e((function(i,s){for(var o=t.length,n=0;n<o;n++)e.resolve(t[n]).then(i,s)})):new e((function(t,e){return e(new TypeError("You must pass an array to race."))}))}function it(t){var e=new this(_);return z(e,t),e}function st(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function ot(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function nt(t){this[T]=Y(),this._result=this._state=void 0,this._subscribers=[],_!==t&&("function"!=typeof t&&st(),this instanceof nt?X(this,t):ot())}function rt(){var t=void 0;if(void 0!==ie)t=ie;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var i=null;try{i=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===i&&!e.cast)return}t.Promise=nt}return K.prototype._enumerate=function(){for(var t=this.length,e=this._input,i=0;this._state===C&&i<t;i++)this._eachEntry(e[i],i)},K.prototype._eachEntry=function(t,e){var i=this._instanceConstructor,s=i.resolve;if(s===E){var o=j(t);if(o===S&&t._state!==C)this._settledAt(t._state,e,t._result);else if("function"!=typeof o)this._remaining--,this._result[e]=t;else if(i===nt){var n=new i(_);O(n,t,o),this._willSettleAt(n,e)}else this._willSettleAt(new i((function(e){return e(t)})),e)}else this._willSettleAt(s(t),e)},K.prototype._settledAt=function(t,e,i){var s=this.promise;s._state===C&&(this._remaining--,t===D?z(s,i):this._result[e]=i),0===this._remaining&&H(s,this._result)},K.prototype._willSettleAt=function(t,e){var i=this;V(t,void 0,(function(t){return i._settledAt(B,e,t)}),(function(t){return i._settledAt(D,e,t)}))},nt.all=tt,nt.race=et,nt.resolve=E,nt.reject=it,nt._setScheduler=a,nt._setAsap=l,nt._asap=r,nt.prototype={constructor:nt,then:S,catch:function(t){return this.then(null,t)}},rt(),nt.polyfill=rt,nt.Promise=nt,nt}()),me.exports}function fe(){if(de)return ce;de=1;var t=function(){if(he)return le;he=1;var t=ne();function e(e){this.maxSize=t.isNumber(e)?e:100,this.reset(),this.maxSize<=0&&(this.set=this.get=t.noop)}function i(){this.head=this.tail=null}function s(t,e){this.key=t,this.val=e,this.prev=this.next=null}return t.mixin(e.prototype,{set:function(t,e){var i,o=this.list.tail;this.size>=this.maxSize&&(this.list.remove(o),delete this.hash[o.key],this.size--),(i=this.hash[t])?(i.val=e,this.list.moveToFront(i)):(i=new s(t,e),this.list.add(i),this.hash[t]=i,this.size++)},get:function(t){var e=this.hash[t];if(e)return this.list.moveToFront(e),e.val},reset:function(){this.size=0,this.hash={},this.list=new i}}),t.mixin(i.prototype,{add:function(t){this.head&&(t.next=this.head,this.head.prev=t),this.head=t,this.tail=this.tail||t},remove:function(t){t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev},moveToFront:function(t){this.remove(t),this.add(t)}}),le=e}(),e=ne(),i=0,s={},o=6,n=new t(10);function r(e){e=e||{},this.cancelled=!1,this.lastReq=null,this._send=e.transport,this._get=e.limiter?e.limiter(this._get):this._get,this._cache=!1===e.cache?new t(0):n}return r.setMaxPendingRequests=function(t){o=t},r.resetCache=function(){n.reset()},e.mixin(r.prototype,{_fingerprint:function(t){return(t=t||{}).url+t.type+JSON.stringify(t.data||{})},_get:function(t,e){var n,r,a=this;function l(t){e(null,t),a._cache.set(n,t)}function h(){e(!0)}function c(){i--,delete s[n],a.onDeckRequestArgs&&(a._get.apply(a,a.onDeckRequestArgs),a.onDeckRequestArgs=null)}n=this._fingerprint(t),this.cancelled||n!==this.lastReq||((r=s[n])?r.then(l,h):i<o?(i++,s[n]=this._send(t).then((function(t){l(t),c()}),(function(){h(),c()}))):this.onDeckRequestArgs=[].slice.call(arguments,0))},get:function(t,i){var s,o;i=i||e.noop,t=e.isString(t)?{url:t}:t||{},o=this._fingerprint(t),this.cancelled=!1,this.lastReq=o,(s=this._cache.get(o))?i(null,s):this._get(t,i)},cancel:function(){this.cancelled=!0}}),ce=r}var ve,ye,be,we,xe,ke,Se,Ee,Te,_e,Ce,Be,De,Me={exports:{}};function Re(){return ye?ve:(ye=1,ve=function(t){var e=0;for(var i in t)t.hasOwnProperty(i)&&(e+=1);return e})}function Ae(){if(ke)return xe;return ke=1,xe={create:function(t,e,i){var s,o;i?((s=new Date).setTime(s.getTime()+24*i*60*60*1e3),o="; expires="+s.toGMTString()):o="",document.cookie=t+"="+e+o+"; path=/"},read:function(t){var e,i,s=t+"=",o=document.cookie.split(";");for(e=0;e<o.length;e++){for(i=o[e];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(s))return i.substring(s.length,i.length)}return null}}}function je(){if(Se)return Me.exports;Se=1;var t=function(){if(we)return be;we=1;var t=Re();function e(t,e,i){this._obj=t||{},this._set=e,this._clear=i,this.length=0}var i=e.prototype;return i.setItem=function(t,e){t=encodeURIComponent(t),this._obj[t]=e,this._updateLength(),this._set&&this._set(this._obj)},i.getItem=function(t){return t=encodeURIComponent(t),void 0===this._obj[t]?null:this._obj[t]},i.removeItem=function(t){t=encodeURIComponent(t),delete this._obj[t],this._updateLength(),this._set&&this._set(this._obj)},i.key=function(t){var e=0;for(var i in this._obj){if(e===t)return decodeURIComponent(i);e++}return null},i.clear=function(){delete this._obj,this._clear&&this._clear()},i._updateLength=function(){this.length=t(this._obj)},be=e}(),e=Ae(),i=!0;try{window.localStorage.setItem("test","42"),window.sessionStorage.setItem("test","42")}catch(t){i=!1}if(i)window.localStorage.removeItem("test"),window.sessionStorage.removeItem("test"),Me.exports={localStorage:window.localStorage,sessionStorage:window.sessionStorage};else{var s=e.read("localStorage"),o=new t(s?JSON.parse(s):{},(function(t){e.create("localStorage",JSON.stringify(t),365)}),(function(){e.create("localStorage","",365)})),n=new t;Me.exports={localStorage:o,sessionStorage:n}}return Me.exports}function Le(){if(Te)return Ee;Te=1;var t,e=je(),i=ne();try{(t=e.localStorage).setItem("~~~","!"),t.removeItem("~~~")}catch(e){t=null}function s(e,s){this.prefix=["__",e,"__"].join(""),this.ttlKey="__ttl__",this.keyMatcher=new RegExp("^"+i.escapeRegExChars(this.prefix)),this.ls=s||t,!this.ls&&this._noop()}function o(){return(new Date).getTime()}function n(t){return JSON.stringify(i.isUndefined(t)?null:t)}function r(t){return JSON.parse(t)}return i.mixin(s.prototype,{_prefix:function(t){return this.prefix+t},_ttlKey:function(t){return this._prefix(t)+this.ttlKey},_noop:function(){this.get=this.set=this.remove=this.clear=this.isExpired=i.noop},_safeSet:function(t,e){try{this.ls.setItem(t,e)}catch(t){"QuotaExceededError"===t.name&&(this.clear(),this._noop())}},get:function(t){return this.isExpired(t)&&this.remove(t),r(this.ls.getItem(this._prefix(t)))},set:function(t,e,s){return i.isNumber(s)?this._safeSet(this._ttlKey(t),n(o()+s)):this.ls.removeItem(this._ttlKey(t)),this._safeSet(this._prefix(t),n(e))},remove:function(t){return this.ls.removeItem(this._ttlKey(t)),this.ls.removeItem(this._prefix(t)),this},clear:function(){var e,i=function(e){var i,s,o=[],n=t.length;for(i=0;i<n;i++)(s=t.key(i)).match(e)&&o.push(s.replace(e,""));return o}(this.keyMatcher);for(e=i.length;e--;)this.remove(i[e]);return this},isExpired:function(t){var e=r(this.ls.getItem(this._ttlKey(t)));return!!(i.isNumber(e)&&o()>e)}}),Ee=s}function Pe(){if(De)return Be;De=1;var t=ne();function e(e){return(e=t.toStr(e))?e.split(/\s+/):[]}function i(e){return(e=t.toStr(e))?e.split(/\W+/):[]}function s(e){return function(i){return i=t.isArray(i)?i:[].slice.call(arguments,0),function(s){var o=[];return t.each(i,(function(i){o=o.concat(e(t.toStr(s[i])))})),o}}}return Be={nonword:i,whitespace:e,obj:{nonword:s(i),whitespace:s(e)}}}var Fe,Oe,Ie,Ne,He,ze={exports:{}},Ve={exports:{}};function qe(){return Fe||(Fe=1,function(t){function e(t){if(t)return function(t){for(var i in e.prototype)t[i]=e.prototype[i];return t}(t)}Ve.exports=e,e.prototype.on=e.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},e.prototype.once=function(t,e){function i(){this.off(t,i),e.apply(this,arguments)}return i.fn=e,this.on(t,i),this},e.prototype.off=e.prototype.removeListener=e.prototype.removeAllListeners=e.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var i,s=this._callbacks["$"+t];if(!s)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var o=0;o<s.length;o++)if((i=s[o])===e||i.fn===e){s.splice(o,1);break}return 0===s.length&&delete this._callbacks["$"+t],this},e.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),i=this._callbacks["$"+t],s=1;s<arguments.length;s++)e[s-1]=arguments[s];if(i){s=0;for(var o=(i=i.slice(0)).length;s<o;++s)i[s].apply(this,e)}return this},e.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},e.prototype.hasListeners=function(t){return!!this.listeners(t).length}}()),Ve.exports}function Ge(){if(Ie)return Oe;return Ie=1,Oe=function(t){return null!==t&&"object"==typeof t}}function Ue(){if(He)return Ne;He=1;var t=Ge();function e(t){if(t)return function(t){for(var i in e.prototype)t[i]=e.prototype[i];return t}(t)}Ne=e,e.prototype.clearTimeout=function(){return clearTimeout(this._timer),clearTimeout(this._responseTimeoutTimer),delete this._timer,delete this._responseTimeoutTimer,this},e.prototype.parse=function(t){return this._parser=t,this},e.prototype.responseType=function(t){return this._responseType=t,this},e.prototype.serialize=function(t){return this._serializer=t,this},e.prototype.timeout=function(t){if(!t||"object"!=typeof t)return this._timeout=t,this._responseTimeout=0,this;for(var e in t)switch(e){case"deadline":this._timeout=t.deadline;break;case"response":this._responseTimeout=t.response;break;default:console.warn("Unknown timeout option",e)}return this},e.prototype.retry=function(t,e){return 0!==arguments.length&&!0!==t||(t=1),t<=0&&(t=0),this._maxRetries=t,this._retries=0,this._retryCallback=e,this};var i=["ECONNRESET","ETIMEDOUT","EADDRINFO","ESOCKETTIMEDOUT"];return e.prototype._shouldRetry=function(t,e){if(!this._maxRetries||this._retries++>=this._maxRetries)return!1;if(this._retryCallback)try{var s=this._retryCallback(t,e);if(!0===s)return!0;if(!1===s)return!1}catch(t){console.error(t)}if(e&&e.status&&e.status>=500&&501!=e.status)return!0;if(t){if(t.code&&~i.indexOf(t.code))return!0;if(t.timeout&&"ECONNABORTED"==t.code)return!0;if(t.crossDomain)return!0}return!1},e.prototype._retry=function(){return this.clearTimeout(),this.req&&(this.req=null,this.req=this.request()),this._aborted=!1,this.timedout=!1,this._end()},e.prototype.then=function(t,e){if(!this._fullfilledPromise){var i=this;this._endCalled&&console.warn("Warning: superagent request was sent twice, because both .end() and .then() were called. Never call .end() if you use promises"),this._fullfilledPromise=new Promise((function(t,e){i.end((function(i,s){i?e(i):t(s)}))}))}return this._fullfilledPromise.then(t,e)},e.prototype.catch=function(t){return this.then(void 0,t)},e.prototype.use=function(t){return t(this),this},e.prototype.ok=function(t){if("function"!=typeof t)throw Error("Callback required");return this._okCallback=t,this},e.prototype._isResponseOK=function(t){return!!t&&(this._okCallback?this._okCallback(t):t.status>=200&&t.status<300)},e.prototype.get=function(t){return this._header[t.toLowerCase()]},e.prototype.getHeader=e.prototype.get,e.prototype.set=function(e,i){if(t(e)){for(var s in e)this.set(s,e[s]);return this}return this._header[e.toLowerCase()]=i,this.header[e]=i,this},e.prototype.unset=function(t){return delete this._header[t.toLowerCase()],delete this.header[t],this},e.prototype.field=function(e,i){if(null==e)throw new Error(".field(name, val) name can not be empty");if(this._data&&console.error(".field() can't be used if .send() is used. Please use only .send() or only .field() & .attach()"),t(e)){for(var s in e)this.field(s,e[s]);return this}if(Array.isArray(i)){for(var o in i)this.field(e,i[o]);return this}if(null==i)throw new Error(".field(name, val) val can not be empty");return"boolean"==typeof i&&(i=""+i),this._getFormData().append(e,i),this},e.prototype.abort=function(){return this._aborted||(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit("abort")),this},e.prototype._auth=function(t,e,i,s){switch(i.type){case"basic":this.set("Authorization","Basic "+s(t+":"+e));break;case"auto":this.username=t,this.password=e;break;case"bearer":this.set("Authorization","Bearer "+t)}return this},e.prototype.withCredentials=function(t){return null==t&&(t=!0),this._withCredentials=t,this},e.prototype.redirects=function(t){return this._maxRedirects=t,this},e.prototype.maxResponseSize=function(t){if("number"!=typeof t)throw TypeError("Invalid argument");return this._maxResponseSize=t,this},e.prototype.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},e.prototype.send=function(e){var i=t(e),s=this._header["content-type"];if(this._formData&&console.error(".send() can't be used if .attach() or .field() is used. Please use only .send() or only .field() & .attach()"),i&&!this._data)Array.isArray(e)?this._data=[]:this._isHost(e)||(this._data={});else if(e&&this._data&&this._isHost(this._data))throw Error("Can't merge these send calls");if(i&&t(this._data))for(var o in e)this._data[o]=e[o];else"string"==typeof e?(s||this.type("form"),s=this._header["content-type"],this._data="application/x-www-form-urlencoded"==s?this._data?this._data+"&"+e:e:(this._data||"")+e):this._data=e;return!i||this._isHost(e)||s||this.type("json"),this},e.prototype.sortQuery=function(t){return this._sort=void 0===t||t,this},e.prototype._finalizeQueryString=function(){var t=this._query.join("&");if(t&&(this.url+=(this.url.indexOf("?")>=0?"&":"?")+t),this._query.length=0,this._sort){var e=this.url.indexOf("?");if(e>=0){var i=this.url.substring(e+1).split("&");"function"==typeof this._sort?i.sort(this._sort):i.sort(),this.url=this.url.substring(0,e)+"?"+i.join("&")}}},e.prototype._appendQueryString=function(){console.trace("Unsupported")},e.prototype._timeoutError=function(t,e,i){if(!this._aborted){var s=new Error(t+e+"ms exceeded");s.timeout=e,s.code="ECONNABORTED",s.errno=i,this.timedout=!0,this.abort(),this.callback(s)}},e.prototype._setTimeouts=function(){var t=this;this._timeout&&!this._timer&&(this._timer=setTimeout((function(){t._timeoutError("Timeout of ",t._timeout,"ETIME")}),this._timeout)),this._responseTimeout&&!this._responseTimeoutTimer&&(this._responseTimeoutTimer=setTimeout((function(){t._timeoutError("Response timeout of ",t._responseTimeout,"ETIMEDOUT")}),this._responseTimeout))},Ne}var We,$e,Xe,Qe,Ye,Ze={};function Ke(){return We||(We=1,Ze.type=function(t){return t.split(/ *; */).shift()},Ze.params=function(t){return t.split(/ *; */).reduce((function(t,e){var i=e.split(/ *= */),s=i.shift(),o=i.shift();return s&&o&&(t[s]=o),t}),{})},Ze.parseLinks=function(t){return t.split(/ *, */).reduce((function(t,e){var i=e.split(/ *; */),s=i[0].slice(1,-1);return t[i[1].split(/ *= */)[1].slice(1,-1)]=s,t}),{})},Ze.cleanHeader=function(t,e){return delete t["content-type"],delete t["content-length"],delete t["transfer-encoding"],delete t.host,e&&(delete t.authorization,delete t.cookie),t}),Ze}function Je(){if(Xe)return $e;Xe=1;var t=Ke();function e(t){if(t)return function(t){for(var i in e.prototype)t[i]=e.prototype[i];return t}(t)}return $e=e,e.prototype.get=function(t){return this.header[t.toLowerCase()]},e.prototype._setHeaderProperties=function(e){var i=e["content-type"]||"";this.type=t.type(i);var s=t.params(i);for(var o in s)this[o]=s[o];this.links={};try{e.link&&(this.links=t.parseLinks(e.link))}catch(t){}},e.prototype._setStatusProperties=function(t){var e=t/100|0;this.status=this.statusCode=t,this.statusType=e,this.info=1==e,this.ok=2==e,this.redirect=3==e,this.clientError=4==e,this.serverError=5==e,this.error=(4==e||5==e)&&this.toError(),this.created=201==t,this.accepted=202==t,this.noContent=204==t,this.badRequest=400==t,this.unauthorized=401==t,this.notAcceptable=406==t,this.forbidden=403==t,this.notFound=404==t,this.unprocessableEntity=422==t},$e}var ti,ei,ii,si,oi,ni,ri,ai,li,hi,ci,di,ui,pi=ze.exports;function mi(){return ti||(ti=1,function(t,e){var i;"undefined"!=typeof window?i=window:"undefined"!=typeof self?i=self:(console.warn("Using browser-only version of superagent in non-browser environment"),i=pi);var s=qe(),o=Ue(),n=Ge(),r=Je(),a=function(){if(Ye)return Qe;function t(){this._defaults=[]}return Ye=1,["use","on","once","set","query","type","accept","auth","withCredentials","sortQuery","retry","ok","redirects","timeout","buffer","serialize","parse","ca","key","pfx","cert"].forEach((function(e){t.prototype[e]=function(){return this._defaults.push({fn:e,arguments:arguments}),this}})),t.prototype._setDefaults=function(t){this._defaults.forEach((function(e){t[e.fn].apply(t,e.arguments)}))},Qe=t}();function l(){}var h=e=t.exports=function(t,i){return"function"==typeof i?new e.Request("GET",t).end(i):1==arguments.length?new e.Request("GET",t):new e.Request(t,i)};e.Request=f,h.getXHR=function(){if(!(!i.XMLHttpRequest||i.location&&"file:"==i.location.protocol&&i.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){}throw Error("Browser-only version of superagent could not find XHR")};var c="".trim?function(t){return t.trim()}:function(t){return t.replace(/(^\s*|\s*$)/g,"")};function d(t){if(!n(t))return t;var e=[];for(var i in t)u(e,i,t[i]);return e.join("&")}function u(t,e,i){if(null!=i)if(Array.isArray(i))i.forEach((function(i){u(t,e,i)}));else if(n(i))for(var s in i)u(t,e+"["+s+"]",i[s]);else t.push(encodeURIComponent(e)+"="+encodeURIComponent(i));else null===i&&t.push(encodeURIComponent(e))}function p(t){for(var e,i,s={},o=t.split("&"),n=0,r=o.length;n<r;++n)-1==(i=(e=o[n]).indexOf("="))?s[decodeURIComponent(e)]="":s[decodeURIComponent(e.slice(0,i))]=decodeURIComponent(e.slice(i+1));return s}function m(t){return/[\/+]json($|[^-\w])/.test(t)}function g(t){this.req=t,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||void 0===this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText;var e=this.xhr.status;1223===e&&(e=204),this._setStatusProperties(e),this.header=this.headers=function(t){for(var e,i,s,o,n=t.split(/\r?\n/),r={},a=0,l=n.length;a<l;++a)-1!==(e=(i=n[a]).indexOf(":"))&&(s=i.slice(0,e).toLowerCase(),o=c(i.slice(e+1)),r[s]=o);return r}(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),null===this.text&&t._responseType?this.body=this.xhr.response:this.body="HEAD"!=this.req.method?this._parseBody(this.text?this.text:this.xhr.response):null}function f(t,e){var i=this;this._query=this._query||[],this.method=t,this.url=e,this.header={},this._header={},this.on("end",(function(){var t,e=null,s=null;try{s=new g(i)}catch(t){return(e=new Error("Parser is unable to parse the response")).parse=!0,e.original=t,i.xhr?(e.rawResponse=void 0===i.xhr.responseType?i.xhr.responseText:i.xhr.response,e.status=i.xhr.status?i.xhr.status:null,e.statusCode=e.status):(e.rawResponse=null,e.status=null),i.callback(e)}i.emit("response",s);try{i._isResponseOK(s)||(t=new Error(s.statusText||"Unsuccessful HTTP response"))}catch(e){t=e}t?(t.original=e,t.response=s,t.status=s.status,i.callback(t,s)):i.callback(null,s)}))}function v(t,e,i){var s=h("DELETE",t);return"function"==typeof e&&(i=e,e=null),e&&s.send(e),i&&s.end(i),s}h.serializeObject=d,h.parseString=p,h.types={html:"text/html",json:"application/json",xml:"text/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},h.serialize={"application/x-www-form-urlencoded":d,"application/json":JSON.stringify},h.parse={"application/x-www-form-urlencoded":p,"application/json":JSON.parse},r(g.prototype),g.prototype._parseBody=function(t){var e=h.parse[this.type];return this.req._parser?this.req._parser(this,t):(!e&&m(this.type)&&(e=h.parse["application/json"]),e&&t&&(t.length||t instanceof Object)?e(t):null)},g.prototype.toError=function(){var t=this.req,e=t.method,i=t.url,s="cannot "+e+" "+i+" ("+this.status+")",o=new Error(s);return o.status=this.status,o.method=e,o.url=i,o},h.Response=g,s(f.prototype),o(f.prototype),f.prototype.type=function(t){return this.set("Content-Type",h.types[t]||t),this},f.prototype.accept=function(t){return this.set("Accept",h.types[t]||t),this},f.prototype.auth=function(t,e,i){1===arguments.length&&(e=""),"object"==typeof e&&null!==e&&(i=e,e=""),i||(i={type:"function"==typeof btoa?"basic":"auto"});return this._auth(t,e,i,(function(t){if("function"==typeof btoa)return btoa(t);throw new Error("Cannot use basic auth, btoa is not a function")}))},f.prototype.query=function(t){return"string"!=typeof t&&(t=d(t)),t&&this._query.push(t),this},f.prototype.attach=function(t,e,i){if(e){if(this._data)throw Error("superagent can't mix .send() and .attach()");this._getFormData().append(t,e,i||e.name)}return this},f.prototype._getFormData=function(){return this._formData||(this._formData=new i.FormData),this._formData},f.prototype.callback=function(t,e){if(this._shouldRetry(t,e))return this._retry();var i=this._callback;this.clearTimeout(),t&&(this._maxRetries&&(t.retries=this._retries-1),this.emit("error",t)),i(t,e)},f.prototype.crossDomainError=function(){var t=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");t.crossDomain=!0,t.status=this.status,t.method=this.method,t.url=this.url,this.callback(t)},f.prototype.buffer=f.prototype.ca=f.prototype.agent=function(){return console.warn("This is not supported in browser version of superagent"),this},f.prototype.pipe=f.prototype.write=function(){throw Error("Streaming is not supported in browser version of superagent")},f.prototype._isHost=function(t){return t&&"object"==typeof t&&!Array.isArray(t)&&"[object Object]"!==Object.prototype.toString.call(t)},f.prototype.end=function(t){return this._endCalled&&console.warn("Warning: .end() was called twice. This is not supported in superagent"),this._endCalled=!0,this._callback=t||l,this._finalizeQueryString(),this._end()},f.prototype._end=function(){var t=this,e=this.xhr=h.getXHR(),i=this._formData||this._data;this._setTimeouts(),e.onreadystatechange=function(){var i=e.readyState;if(i>=2&&t._responseTimeoutTimer&&clearTimeout(t._responseTimeoutTimer),4==i){var s;try{s=e.status}catch(t){s=0}if(!s){if(t.timedout||t._aborted)return;return t.crossDomainError()}t.emit("end")}};var s=function(e,i){i.total>0&&(i.percent=i.loaded/i.total*100),i.direction=e,t.emit("progress",i)};if(this.hasListeners("progress"))try{e.onprogress=s.bind(null,"download"),e.upload&&(e.upload.onprogress=s.bind(null,"upload"))}catch(t){}try{this.username&&this.password?e.open(this.method,this.url,!0,this.username,this.password):e.open(this.method,this.url,!0)}catch(t){return this.callback(t)}if(this._withCredentials&&(e.withCredentials=!0),!this._formData&&"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof i&&!this._isHost(i)){var o=this._header["content-type"],n=this._serializer||h.serialize[o?o.split(";")[0]:""];!n&&m(o)&&(n=h.serialize["application/json"]),n&&(i=n(i))}for(var r in this.header)null!=this.header[r]&&this.header.hasOwnProperty(r)&&e.setRequestHeader(r,this.header[r]);return this._responseType&&(e.responseType=this._responseType),this.emit("request",this),e.send(void 0!==i?i:null),this},h.agent=function(){return new a},["GET","POST","OPTIONS","PATCH","PUT","DELETE"].forEach((function(t){a.prototype[t.toLowerCase()]=function(e,i){var s=new h.Request(t,e);return this._setDefaults(s),i&&s.end(i),s}})),a.prototype.del=a.prototype.delete,h.get=function(t,e,i){var s=h("GET",t);return"function"==typeof e&&(i=e,e=null),e&&s.query(e),i&&s.end(i),s},h.head=function(t,e,i){var s=h("HEAD",t);return"function"==typeof e&&(i=e,e=null),e&&s.query(e),i&&s.end(i),s},h.options=function(t,e,i){var s=h("OPTIONS",t);return"function"==typeof e&&(i=e,e=null),e&&s.send(e),i&&s.end(i),s},h.del=v,h.delete=v,h.patch=function(t,e,i){var s=h("PATCH",t);return"function"==typeof e&&(i=e,e=null),e&&s.send(e),i&&s.end(i),s},h.post=function(t,e,i){var s=h("POST",t);return"function"==typeof e&&(i=e,e=null),e&&s.send(e),i&&s.end(i),s},h.put=function(t,e,i){var s=h("PUT",t);return"function"==typeof e&&(i=e,e=null),e&&s.send(e),i&&s.end(i),s}}(ze,ze.exports)),ze.exports}function gi(){if(ii)return ei;ii=1;var t=ge().Promise,e=mi();return ei=function(i){return new t((function(t,s){e.get(i.url).end((function(e,i){if(e)return s(e);t(i.body)}))}))}}function fi(){if(ri)return ni;ri=1;var t=ne(),e=gi(),i=oi?si:(oi=1,si="1.0.0");return ni=function(s){var o,n;return o={initialize:!0,identify:t.stringify,datumTokenizer:null,queryTokenizer:null,sufficient:5,sorter:null,local:[],prefetch:null,remote:null},!(s=t.mixin(o,s||{})).datumTokenizer&&t.error("datumTokenizer is required"),!s.queryTokenizer&&t.error("queryTokenizer is required"),n=s.sorter,s.sorter=n?function(t){return t.sort(n)}:t.identity,s.local=t.isFunction(s.local)?s.local():s.local,s.prefetch=function(s){var o;if(!s)return null;return o={url:null,ttl:864e5,cache:!0,cacheKey:null,thumbprint:"",prepare:t.identity,transform:t.identity,transport:null},s=t.isString(s)?{url:s}:s,s=t.mixin(o,s),!s.url&&t.error("prefetch requires url to be set"),s.transform=s.filter||s.transform,s.cacheKey=s.cacheKey||s.url,s.thumbprint=i+s.thumbprint,s.transport=s.transport?(s.transport,function(t){}):e,s}(s.prefetch),s.remote=function(i){var s;if(!i)return;return s={url:null,cache:!0,prepare:null,replace:null,wildcard:null,limiter:null,rateLimitBy:"debounce",rateLimitWait:300,transform:t.identity,transport:null},i=t.isString(i)?{url:i}:i,i=t.mixin(s,i),!i.url&&t.error("remote requires url to be set"),i.transform=i.filter||i.transform,i.prepare=function(t){var e,i,s;if(e=t.prepare,i=t.replace,s=t.wildcard,e)return e;e=i?o:t.wildcard?n:r;return e;function o(t,e){return e.url=i(e.url,t),e}function n(t,e){return e.url=e.url.replace(s,encodeURIComponent(t)),e}function r(t,e){return e}}(i),i.limiter=function(e){var i,s,o;i=e.limiter,s=e.rateLimitBy,o=e.rateLimitWait,i||(i=/^throttle$/i.test(s)?r(o):n(o));return i;function n(e){return function(i){return t.debounce(i,e)}}function r(e){return function(i){return t.throttle(i,e)}}}(i),i.transport=i.transport?(i.transport,function(t){}):e,delete i.replace,delete i.wildcard,delete i.rateLimitBy,delete i.rateLimitWait,i}(s.remote),s},ni}function vi(){if(ci)return hi;ci=1;var t=ne(),e=ge().Promise,i=function(){if(pe)return ue;pe=1;var t=ne(),e=fe();function i(t){this.url=t.url,this.prepare=t.prepare,this.transform=t.transform,this.transport=new e({cache:t.cache,limiter:t.limiter,transport:t.transport})}return t.mixin(i.prototype,{_settings:function(){return{url:this.url,type:"GET",dataType:"json"}},get:function(t,e){var i,s=this;if(e)return t=t||"",i=this.prepare(t,this._settings()),this.transport.get(i,(function(t,i){e(t?[]:s.transform(i))}))},cancelLastRequest:function(){this.transport.cancel()}}),ue=i}(),s=function(){if(Ce)return _e;Ce=1;var t=Le(),e=ne(),i="data",s="protocol",o="thumbprint",n=null;function r(e){this.url=e.url,this.ttl=e.ttl,this.cache=e.cache,this.prepare=e.prepare,this.transform=e.transform,this.transport=e.transport,this.thumbprint=e.thumbprint,this.storage=new t(e.cacheKey)}return n="undefined"!=typeof window?window.location:{protocol:"https:"},e.mixin(r.prototype,{_settings:function(){return{url:this.url,type:"GET",dataType:"json"}},store:function(t){this.cache&&(this.storage.set(i,t,this.ttl),this.storage.set(s,n.protocol,this.ttl),this.storage.set(o,this.thumbprint,this.ttl))},fromCache:function(){var t,e={};return this.cache?(e.data=this.storage.get(i),e.protocol=this.storage.get(s),e.thumbprint=this.storage.get(o),t=e.thumbprint!==this.thumbprint||e.protocol!==n.protocol,e.data&&!t?e.data:null):null},fromNetwork:function(t){var e,i=this;t&&(e=this.prepare(this._settings()),this.transport(e).then((function(e){t(null,i.transform(e))}),(function(){t(!0)})))},clear:function(){return this.storage.clear(),this}}),_e=r}(),o=Pe(),n=fi(),r=function(){if(li)return ai;li=1;var t=ne(),e="c";function i(e){if(!(e=e||{}).datumTokenizer||!e.queryTokenizer)throw new Error("datumTokenizer and queryTokenizer are both required");this.identify=e.identify||t.stringify,this.datumTokenizer=e.datumTokenizer,this.queryTokenizer=e.queryTokenizer,this.reset()}function s(e){return e=t.filter(e,(function(t){return!!t})),t.map(e,(function(t){return t.toLowerCase()}))}function o(){var t={i:[]};return t[e]={},t}return t.mixin(i.prototype,{bootstrap:function(t){this.datums=t.datums,this.trie=t.trie},add:function(i){var n=this;i=t.isArray(i)?i:[i],t.each(i,(function(i){var r,a;n.datums[r=n.identify(i)]=i,a=s(n.datumTokenizer(i)),t.each(a,(function(t){var i,s,a;for(i=n.trie,s=t.split("");a=s.shift();)(i=i[e][a]||(i[e][a]=o())).i.push(r)}))}))},get:function(e){var i=this;return t.map(e,(function(t){return i.datums[t]}))},search:function(i){var o,n,r=this;return o=s(this.queryTokenizer(i)),t.each(o,(function(t){var i,s,o,a;if(n&&0===n.length)return!1;for(i=r.trie,s=t.split("");i&&(o=s.shift());)i=i[e][o];if(!i||0!==s.length)return n=[],!1;a=i.i.slice(0),n=n?function(t,e){var i=0,s=0,o=[];t=t.sort(),e=e.sort();for(var n=t.length,r=e.length;i<n&&s<r;)t[i]<e[s]?i++:(t[i]>e[s]||(o.push(t[i]),i++),s++);return o}(n,a):a})),n?t.map(function(t){for(var e={},i=[],s=0,o=t.length;s<o;s++)e[t[s]]||(e[t[s]]=!0,i.push(t[s]));return i}(n),(function(t){return r.datums[t]})):[]},all:function(){var t=[];for(var e in this.datums)t.push(this.datums[e]);return t},reset:function(){this.datums={},this.trie=o()},serialize:function(){return{datums:this.datums,trie:this.trie}}}),ai=i}(),a=fe();function l(t){t=n(t),this.sorter=t.sorter,this.identify=t.identify,this.sufficient=t.sufficient,this.local=t.local,this.remote=t.remote?new i(t.remote):null,this.prefetch=t.prefetch?new s(t.prefetch):null,this.index=new r({identify:this.identify,datumTokenizer:t.datumTokenizer,queryTokenizer:t.queryTokenizer}),!1!==t.initialize&&this.initialize()}return l.tokenizers=o,t.mixin(l.prototype,{__ttAdapter:function(){var t=this;return this.remote?function(e,i,s){return t.search(e,i,s)}:function(e,i){return t.search(e,i)}},_loadPrefetch:function(){var t,i=this;return this.prefetch?(t=this.prefetch.fromCache())?(this.index.bootstrap(t),new e((function(t,e){t()}))):new e((function(t,e){i.prefetch.fromNetwork((function(s,o){if(s)return e(s);try{i.add(o),i.prefetch.store(i.index.serialize()),t()}catch(t){e(t)}}))})):new e((function(t,e){t()}))},_initialize:function(){var t=this;return this.clear(),(this.initPromise=this._loadPrefetch()).then((function(){t.add(t.local)})),this.initPromise},initialize:function(t){return!this.initPromise||t?this._initialize():this.initPromise},add:function(t){return this.index.add(t),this},get:function(e){return e=t.isArray(e)?e:[].slice.call(arguments),this.index.get(e)},search:function(e,i,s){var o,n=this;return o=this.sorter(this.index.search(e)),i(this.remote?o.slice():o),this.remote&&o.length<this.sufficient?this.remote.get(e,(function(e){var i=[];t.each(e,(function(e){!t.some(o,(function(t){return n.identify(e)===n.identify(t)}))&&i.push(e)})),s&&s(i)})):this.remote&&this.remote.cancelLastRequest(),this},all:function(){return this.index.all()},clear:function(){return this.index.reset(),this},clearPrefetchCache:function(){return this.prefetch&&this.prefetch.clear(),this},clearRemoteCache:function(){return a.resetCache(),this},ttAdapter:function(){return this.__ttAdapter()}}),hi=l}var yi=se(ui?di:(ui=1,di=vi()));const bi=jQuery;class wi extends Ut{constructor(e,i,s){var o,n;super(e,i,s),this.name="distance",this.typeLabel="Search by address",this.label=this.label||(void 0===e.label?"Search radius":e.label),this.distanceControl=e.distanceControl||"select",this.distanceUnits=e.distanceUnits||"km",this.distanceUnitsLabel=e.distanceUnitsLabel||"km",this.fromLabel=e.fromLabel||"from",this.placeholder=e.placeholder,this.userLocationButton=e.userLocationButton||!1,this.type=e.type,this.addressField=e.addressField||!0,this.addressFieldPlaceholder=e.addressFieldPlaceholder||"Address",this.languages=[{value:"sq",label:"Albanian"},{value:"ar",label:"Arabic"},{value:"eu",label:"Basque"},{value:"be",label:"Belarusian"},{value:"bg",label:"Bulgarian"},{value:"my",label:"Burmese"},{value:"bn",label:"Bengali"},{value:"ca",label:"Catalan"},{value:"zh-cn",label:"Chinese (simplified)"},{value:"zh-tw",label:"Chinese (traditional)"},{value:"hr",label:"Croatian"},{value:"cs",label:"Czech"},{value:"da",label:"Danish"},{value:"nl",label:"Dutch"},{value:"en",label:"English"},{value:"en-au",label:"English (australian)"},{value:"en-gb",label:"English (great Britain)"},{value:"fa",label:"Farsi"},{value:"fi",label:"Finnish"},{value:"fil",label:"Filipino"},{value:"fr",label:"French"},{value:"gl",label:"Galician"},{value:"de",label:"German"},{value:"el",label:"Greek"},{value:"gu",label:"Gujarati"},{value:"iw",label:"Hebrew"},{value:"hi",label:"Hindi"},{value:"hu",label:"Hungarian"},{value:"id",label:"Indonesian"},{value:"it",label:"Italian"},{value:"ja",label:"Japanese"},{value:"kn",label:"Kannada"},{value:"kk",label:"Kazakh"},{value:"ko",label:"Korean"},{value:"ky",label:"Kyrgyz"},{value:"lt",label:"Lithuanian"},{value:"lv",label:"Latvian"},{value:"mk",label:"Macedonian"},{value:"ml",label:"Malayalam"},{value:"mr",label:"Marathi"},{value:"no",label:"Norwegian"},{value:"pl",label:"Polish"},{value:"pt",label:"Portuguese"},{value:"pt-br",label:"Portuguese (brazil)"},{value:"pt-pt",label:"Portuguese (portugal)"},{value:"pa",label:"Punjabi"},{value:"ro",label:"Romanian"},{value:"ru",label:"Russian"},{value:"sr",label:"Serbian"},{value:"sk",label:"Slovak"},{value:"sl",label:"Slovenian"},{value:"es",label:"Spanish"},{value:"sv",label:"Swedish"},{value:"tl",label:"Tagalog"},{value:"ta",label:"Tamil"},{value:"te",label:"Telugu"},{value:"th",label:"Thai"},{value:"tr",label:"Turkish"},{value:"uk",label:"Ukrainian"},{value:"uz",label:"Uzbek"},{value:"vi",label:"Vietnamese"}],this.countries=window.mapsvg.countries,this.country=e.country,this.language=e.language,this.searchByZip=e.searchByZip,this.zipLength=parseInt(e.zipLength)||5,this.userLocationButton=t(e.userLocationButton),this.options=e.options||[{value:"10",default:!0},{value:"30",default:!1},{value:"50",default:!1},{value:"100",default:!1}],this.value||(this.value={units:this.distanceUnits,geoPoint:{lat:null,lng:null},length:(null===(o=this.options.find((t=>t.default)))||void 0===o?void 0:o.value)||(null===(n=this.options[0])||void 0===n?void 0:n.value),address:"",country:this.country}),this.defaultLength=this.value.length}setDomElements(){super.setDomElements(),this.inputs.units=bi(this.domElements.main).find('[name="distanceUnits"]')[0],this.inputs.geoPoint=bi(this.domElements.main).find('[name="distanceGeoPoint"]')[0],this.inputs.length=bi(this.domElements.main).find('[name="distanceLength"]')[0],this.inputs.address=bi(this.domElements.main).find('[name="distance"]')[0]}getSchema(){const e=super.getSchema();return e.distanceControl=this.distanceControl,e.distanceUnits=this.distanceUnits,e.distanceUnitsLabel=this.distanceUnitsLabel,e.fromLabel=this.fromLabel,e.addressField=this.addressField,e.addressFieldPlaceholder=this.addressFieldPlaceholder,e.userLocationButton=this.userLocationButton,e.placeholder=this.placeholder,e.language=this.language,e.country=this.country,e.searchByZip=this.searchByZip,e.zipLength=parseInt(this.zipLength+""),e.userLocationButton=t(this.userLocationButton),"none"===e.distanceControl&&(e.distanceDefault=e.options.filter((function(t){return t.default}))[0].value),e.options.forEach((function(i,s){""===e.options[s].value?e.options.splice(s,1):e.options[s].default=t(e.options[s].default)})),e}getDataForTemplate(){const e=super.getDataForTemplate();return this.formBuilder.admin&&(e.languages=this.languages,e.countries=this.countries),e.language=this.language,e.country=this.country,e.searchByZip=this.searchByZip,e.zipLength=this.zipLength,e.userLocationButton=t(this.userLocationButton),e}initEditor(){super.initEditor(),this.mayBeAddDistanceRow(),bi().mselect2&&bi(this.domElements.edit).find("select").mselect2()}setEventHandlers(){super.setEventHandlers();const t=this;bi(this.domElements.edit).on("keyup change paste",".mapsvg-edit-distance-row input",(function(){t.mayBeAddDistanceRow()}));const e=new At(s.routes.api),i=new yi({datumTokenizer:yi.tokenizers.obj.whitespace("formatted_address"),queryTokenizer:yi.tokenizers.whitespace,remote:{url:e.getUrl("geocoding")+"?address="+(!0===this.searchByZip?"zip%20":"")+"%QUERY%&language="+this.language+(this.country?"&country="+this.country:""),wildcard:"%QUERY%",transform:function(t){return t.error_message&&console.error(t.error_message),t.results},rateLimitWait:600}}),o=bi(this.domElements.main).find(".typeahead");if(this.spinner=bi("<span class='spinner-border spinner-border-sm'></span>")[0],this.searchByZip?(bi(this.domElements.main).find(".mapsvg-distance-fields").addClass("search-by-zip"),o.on("change keyup",(e=>{const s=bi(e.target).val().toString();s.length===t.zipLength&&(bi(this.spinner).appendTo(bi(e.target).closest(".distance-search-wrap")),this.formBuilder.setIsLoading(!0),i.search(bi(e.target).val(),(t=>this.handleAddressFieldChange(s,t)),(t=>this.handleAddressFieldChange(s,t,!0))))}))):(o.typeahead({minLength:3},{name:"mapsvg-addresses",display:"formatted_address",limit:5,async:!0,source:(t,e,i)=>{const s={address:t};this.country&&(s.componentRestrictions={country:this.country}),p(s,i)}}).on("typeahead:asyncrequest",(t=>{bi(this.spinner).appendTo(bi(t.target).closest(".twitter-typeahead")),this.formBuilder.setIsLoading(!0)})).on("typeahead:asynccancel typeahead:asyncreceive",(t=>{bi(this.spinner).remove(),this.formBuilder.setIsLoading(!1)})),bi(this.domElements.main).find(".mapsvg-distance-fields").removeClass("search-by-zip")),t.userLocationButton){bi(this.domElements.main).find(".user-location-button").on("click",(()=>{t.formBuilder.mapsvg.showUserLocation((t=>{i.search(t.geoPoint.lat+","+t.geoPoint.lng,(e=>this.setAddressByUserLocation(e,t)),(e=>this.setAddressByUserLocation(e,t))),this.setValue({geoPoint:t.geoPoint}),this.triggerChanged()}))}))}o.on("change keyup",(t=>{""===t.target.value&&null!==this.getValue()&&(this.setValue(null),this.triggerChanged())})),o.on("typeahead:select",((t,e)=>{this.setValue({address:e.formatted_address,geoPoint:e.geometry.location.toJSON()}),this.triggerChanged(),o.blur()})),bi(this.inputs.geoPoint).on("change",(t=>{const e=t.target.value.split(",").map((t=>parseFloat(t)));this.setValue({geoPoint:{lat:e[0],lng:e[1]}},!1),this.triggerChanged()})),bi(this.inputs.length).on("change",(t=>{this.setLength(parseInt(t.target.value),!1),this.triggerChanged()}))}setAddressByUserLocation(t,e){t&&t[0]?this.setAddress(t[0].formatted_address):this.setAddress(e.geoPoint.lat+","+e.geoPoint.lng)}handleAddressFieldChange(t,e,i=!1){i&&(bi(this.spinner).remove(),this.formBuilder.setIsLoading(!1)),e&&e[0]&&(this.setValue({address:t,geoPoint:e[0].geometry.location},!1),this.triggerChanged())}addSelect2(){bi().mselect2&&bi(this.domElements.main).find("select").mselect2().on("select2:focus",(function(){bi(this).mselect2("open")}))}mayBeAddDistanceRow(){const t=this,e=bi(bi("#mapsvg-edit-distance-row").html()),i=bi(t.domElements.edit).find(".mapsvg-edit-distance-row:last-child input");if(i&&i.last()&&i.last().val()&&i.last().val().toString().trim().length){e.clone().insertAfter(bi(t.domElements.edit).find(".mapsvg-edit-distance-row:last-child"))}const s=bi(t.domElements.edit).find(".mapsvg-edit-distance-row"),o=s.eq(s.length-2),n=s.eq(s.length-1);o.length&&n.length&&!o.find("input:eq(0)").val().toString().trim()&&!n.find("input:eq(0)").val().toString().trim()&&n.remove()}setValue(t,e=!0){if(null===t)this.setGeoPoint(null),this.setAddress("");else for(const s in t)if(void 0!==this.value[s]){const o="set"+i(s);"function"==typeof this[o]&&this[o](t[s],e)}}setGeoPoint(t,e=!0){this.value.geoPoint=null===t?{lat:null,lng:null}:t,e&&this.setInputGeoPointValue(t)}setInputGeoPointValue(t){this.inputs.geoPoint.value=t?t.lat+","+t.lng:""}setLength(t,e=!0){this.value.length=parseInt(t.toString()),this.defaultLength=this.value.length,e&&this.setInputLengthValue(this.value.length)}setInputLengthValue(t){this.inputs.length.value=t.toString()}setAddress(t,e=!0){this.value.address=null!==t?t:"",e&&this.setInputAddressValue(this.value.address)}setInputAddressValue(t){this.inputs.address.value=t}getValue(){return null===this.value.geoPoint.lat?null:this.value}}const xi=jQuery;class ki extends Ut{constructor(e,i,s){super(e,i,s),this.searchFallback=t(e.searchFallback),this.width=this.formBuilder.filtersHide&&!this.formBuilder.modal?null:e.width||"100%",this.db_type="varchar(255)",this.typeLabel="Colorpicker"}setDomElements(){super.setDomElements(),this.inputs.text=xi(this.domElements.main).find("input.cpicker")[0],xi(this.domElements.main).find(".colorpicker-element").colorpicker()}getSchema(){const t=super.getSchema();return t.searchType=this.searchType,t}setEventHandlers(){super.setEventHandlers(),xi(this.inputs.text).on("change keyup paste",(t=>{this.setValue(t.target.value,!1),this.triggerChanged()})),xi(this.domElements.main).find(".colorpicker-element").colorpicker().on("changeColor.colorpicker",(t=>{this.setValue(this.inputs.text.value,!1),this.triggerChanged()}))}setInputValue(t){this.inputs.text.value=t}}jQuery;class Si extends Ut{constructor(t,e,i){super(t,e,i),this.readonly=!0,this.typeLabel="Empty"}}class Ei extends Ut{constructor(t,e,i){super(t,e,i),this.typeLabel="ID"}getData(){return{name:"id",value:this.value}}}
/**!
 * Sortable 1.15.2
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Ti(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function _i(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Ti(Object(i),!0).forEach((function(e){Bi(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ti(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function Ci(t){return Ci="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ci(t)}function Bi(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Di(){return Di=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},Di.apply(this,arguments)}function Mi(t,e){if(null==t)return{};var i,s,o=function(t,e){if(null==t)return{};var i,s,o={},n=Object.keys(t);for(s=0;s<n.length;s++)i=n[s],e.indexOf(i)>=0||(o[i]=t[i]);return o}(t,e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(s=0;s<n.length;s++)i=n[s],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(o[i]=t[i])}return o}function Ri(t){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(t)}var Ai=Ri(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),ji=Ri(/Edge/i),Li=Ri(/firefox/i),Pi=Ri(/safari/i)&&!Ri(/chrome/i)&&!Ri(/android/i),Fi=Ri(/iP(ad|od|hone)/i),Oi=Ri(/chrome/i)&&Ri(/android/i),Ii={capture:!1,passive:!1};function Ni(t,e,i){t.addEventListener(e,i,!Ai&&Ii)}function Hi(t,e,i){t.removeEventListener(e,i,!Ai&&Ii)}function zi(t,e){if(e){if(">"===e[0]&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch(t){return!1}return!1}}function Vi(t){return t.host&&t!==document&&t.host.nodeType?t.host:t.parentNode}function qi(t,e,i,s){if(t){i=i||document;do{if(null!=e&&(">"===e[0]?t.parentNode===i&&zi(t,e):zi(t,e))||s&&t===i)return t;if(t===i)break}while(t=Vi(t))}return null}var Gi,Ui=/\s+/g;function Wi(t,e,i){if(t&&e)if(t.classList)t.classList[i?"add":"remove"](e);else{var s=(" "+t.className+" ").replace(Ui," ").replace(" "+e+" "," ");t.className=(s+(i?" "+e:"")).replace(Ui," ")}}function $i(t,e,i){var s=t&&t.style;if(s){if(void 0===i)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(i=t.currentStyle),void 0===e?i:i[e];e in s||-1!==e.indexOf("webkit")||(e="-webkit-"+e),s[e]=i+("string"==typeof i?"":"px")}}function Xi(t,e){var i="";if("string"==typeof t)i=t;else do{var s=$i(t,"transform");s&&"none"!==s&&(i=s+" "+i)}while(!e&&(t=t.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(i)}function Qi(t,e,i){if(t){var s=t.getElementsByTagName(e),o=0,n=s.length;if(i)for(;o<n;o++)i(s[o],o);return s}return[]}function Yi(){var t=document.scrollingElement;return t||document.documentElement}function Zi(t,e,i,s,o){if(t.getBoundingClientRect||t===window){var n,r,a,l,h,c,d;if(t!==window&&t.parentNode&&t!==Yi()?(r=(n=t.getBoundingClientRect()).top,a=n.left,l=n.bottom,h=n.right,c=n.height,d=n.width):(r=0,a=0,l=window.innerHeight,h=window.innerWidth,c=window.innerHeight,d=window.innerWidth),(e||i)&&t!==window&&(o=o||t.parentNode,!Ai))do{if(o&&o.getBoundingClientRect&&("none"!==$i(o,"transform")||i&&"static"!==$i(o,"position"))){var u=o.getBoundingClientRect();r-=u.top+parseInt($i(o,"border-top-width")),a-=u.left+parseInt($i(o,"border-left-width")),l=r+n.height,h=a+n.width;break}}while(o=o.parentNode);if(s&&t!==window){var p=Xi(o||t),m=p&&p.a,g=p&&p.d;p&&(l=(r/=g)+(c/=g),h=(a/=m)+(d/=m))}return{top:r,left:a,bottom:l,right:h,width:d,height:c}}}function Ki(t,e,i){for(var s=ss(t,!0),o=Zi(t)[e];s;){if(!(o>=Zi(s)[i]))return s;if(s===Yi())break;s=ss(s,!1)}return!1}function Ji(t,e,i,s){for(var o=0,n=0,r=t.children;n<r.length;){if("none"!==r[n].style.display&&r[n]!==ao.ghost&&(s||r[n]!==ao.dragged)&&qi(r[n],i.draggable,t,!1)){if(o===e)return r[n];o++}n++}return null}function ts(t,e){for(var i=t.lastElementChild;i&&(i===ao.ghost||"none"===$i(i,"display")||e&&!zi(i,e));)i=i.previousElementSibling;return i||null}function es(t,e){var i=0;if(!t||!t.parentNode)return-1;for(;t=t.previousElementSibling;)"TEMPLATE"===t.nodeName.toUpperCase()||t===ao.clone||e&&!zi(t,e)||i++;return i}function is(t){var e=0,i=0,s=Yi();if(t)do{var o=Xi(t),n=o.a,r=o.d;e+=t.scrollLeft*n,i+=t.scrollTop*r}while(t!==s&&(t=t.parentNode));return[e,i]}function ss(t,e){if(!t||!t.getBoundingClientRect)return Yi();var i=t,s=!1;do{if(i.clientWidth<i.scrollWidth||i.clientHeight<i.scrollHeight){var o=$i(i);if(i.clientWidth<i.scrollWidth&&("auto"==o.overflowX||"scroll"==o.overflowX)||i.clientHeight<i.scrollHeight&&("auto"==o.overflowY||"scroll"==o.overflowY)){if(!i.getBoundingClientRect||i===document.body)return Yi();if(s||e)return i;s=!0}}}while(i=i.parentNode);return Yi()}function os(t,e){return Math.round(t.top)===Math.round(e.top)&&Math.round(t.left)===Math.round(e.left)&&Math.round(t.height)===Math.round(e.height)&&Math.round(t.width)===Math.round(e.width)}function ns(t,e){return function(){if(!Gi){var i=arguments;1===i.length?t.call(this,i[0]):t.apply(this,i),Gi=setTimeout((function(){Gi=void 0}),e)}}}function rs(t,e,i){t.scrollLeft+=e,t.scrollTop+=i}function as(t){var e=window.Polymer,i=window.jQuery||window.Zepto;return e&&e.dom?e.dom(t).cloneNode(!0):i?i(t).clone(!0)[0]:t.cloneNode(!0)}function ls(t,e,i){var s={};return Array.from(t.children).forEach((function(o){var n,r,a,l;if(qi(o,e.draggable,t,!1)&&!o.animated&&o!==i){var h=Zi(o);s.left=Math.min(null!==(n=s.left)&&void 0!==n?n:1/0,h.left),s.top=Math.min(null!==(r=s.top)&&void 0!==r?r:1/0,h.top),s.right=Math.max(null!==(a=s.right)&&void 0!==a?a:-1/0,h.right),s.bottom=Math.max(null!==(l=s.bottom)&&void 0!==l?l:-1/0,h.bottom)}})),s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}var hs="Sortable"+(new Date).getTime();function cs(){var t,e=[];return{captureAnimationState:function(){(e=[],this.options.animation)&&[].slice.call(this.el.children).forEach((function(t){if("none"!==$i(t,"display")&&t!==ao.ghost){e.push({target:t,rect:Zi(t)});var i=_i({},e[e.length-1].rect);if(t.thisAnimationDuration){var s=Xi(t,!0);s&&(i.top-=s.f,i.left-=s.e)}t.fromRect=i}}))},addAnimationState:function(t){e.push(t)},removeAnimationState:function(t){e.splice(function(t,e){for(var i in t)if(t.hasOwnProperty(i))for(var s in e)if(e.hasOwnProperty(s)&&e[s]===t[i][s])return Number(i);return-1}(e,{target:t}),1)},animateAll:function(i){var s=this;if(!this.options.animation)return clearTimeout(t),void("function"==typeof i&&i());var o=!1,n=0;e.forEach((function(t){var e=0,i=t.target,r=i.fromRect,a=Zi(i),l=i.prevFromRect,h=i.prevToRect,c=t.rect,d=Xi(i,!0);d&&(a.top-=d.f,a.left-=d.e),i.toRect=a,i.thisAnimationDuration&&os(l,a)&&!os(r,a)&&(c.top-a.top)/(c.left-a.left)==(r.top-a.top)/(r.left-a.left)&&(e=function(t,e,i,s){return Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))/Math.sqrt(Math.pow(e.top-i.top,2)+Math.pow(e.left-i.left,2))*s.animation}(c,l,h,s.options)),os(a,r)||(i.prevFromRect=r,i.prevToRect=a,e||(e=s.options.animation),s.animate(i,c,a,e)),e&&(o=!0,n=Math.max(n,e),clearTimeout(i.animationResetTimer),i.animationResetTimer=setTimeout((function(){i.animationTime=0,i.prevFromRect=null,i.fromRect=null,i.prevToRect=null,i.thisAnimationDuration=null}),e),i.thisAnimationDuration=e)})),clearTimeout(t),o?t=setTimeout((function(){"function"==typeof i&&i()}),n):"function"==typeof i&&i(),e=[]},animate:function(t,e,i,s){if(s){$i(t,"transition",""),$i(t,"transform","");var o=Xi(this.el),n=o&&o.a,r=o&&o.d,a=(e.left-i.left)/(n||1),l=(e.top-i.top)/(r||1);t.animatingX=!!a,t.animatingY=!!l,$i(t,"transform","translate3d("+a+"px,"+l+"px,0)"),this.forRepaintDummy=function(t){return t.offsetWidth}(t),$i(t,"transition","transform "+s+"ms"+(this.options.easing?" "+this.options.easing:"")),$i(t,"transform","translate3d(0,0,0)"),"number"==typeof t.animated&&clearTimeout(t.animated),t.animated=setTimeout((function(){$i(t,"transition",""),$i(t,"transform",""),t.animated=!1,t.animatingX=!1,t.animatingY=!1}),s)}}}}var ds=[],us={initializeByDefault:!0},ps={mount:function(t){for(var e in us)us.hasOwnProperty(e)&&!(e in t)&&(t[e]=us[e]);ds.forEach((function(e){if(e.pluginName===t.pluginName)throw"Sortable: Cannot mount plugin ".concat(t.pluginName," more than once")})),ds.push(t)},pluginEvent:function(t,e,i){var s=this;this.eventCanceled=!1,i.cancel=function(){s.eventCanceled=!0};var o=t+"Global";ds.forEach((function(s){e[s.pluginName]&&(e[s.pluginName][o]&&e[s.pluginName][o](_i({sortable:e},i)),e.options[s.pluginName]&&e[s.pluginName][t]&&e[s.pluginName][t](_i({sortable:e},i)))}))},initializePlugins:function(t,e,i,s){for(var o in ds.forEach((function(s){var o=s.pluginName;if(t.options[o]||s.initializeByDefault){var n=new s(t,e,t.options);n.sortable=t,n.options=t.options,t[o]=n,Di(i,n.defaults)}})),t.options)if(t.options.hasOwnProperty(o)){var n=this.modifyOption(t,o,t.options[o]);void 0!==n&&(t.options[o]=n)}},getEventProperties:function(t,e){var i={};return ds.forEach((function(s){"function"==typeof s.eventProperties&&Di(i,s.eventProperties.call(e[s.pluginName],t))})),i},modifyOption:function(t,e,i){var s;return ds.forEach((function(o){t[o.pluginName]&&o.optionListeners&&"function"==typeof o.optionListeners[e]&&(s=o.optionListeners[e].call(t[o.pluginName],i))})),s}};var ms=["evt"],gs=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=i.evt,o=Mi(i,ms);ps.pluginEvent.bind(ao)(t,e,_i({dragEl:vs,parentEl:ys,ghostEl:bs,rootEl:ws,nextEl:xs,lastDownEl:ks,cloneEl:Ss,cloneHidden:Es,dragStarted:Os,putSortable:Ms,activeSortable:ao.active,originalEvent:s,oldIndex:Ts,oldDraggableIndex:Cs,newIndex:_s,newDraggableIndex:Bs,hideGhostForTarget:so,unhideGhostForTarget:oo,cloneNowHidden:function(){Es=!0},cloneNowShown:function(){Es=!1},dispatchSortableEvent:function(t){fs({sortable:e,name:t,originalEvent:s})}},o))};function fs(t){!function(t){var e=t.sortable,i=t.rootEl,s=t.name,o=t.targetEl,n=t.cloneEl,r=t.toEl,a=t.fromEl,l=t.oldIndex,h=t.newIndex,c=t.oldDraggableIndex,d=t.newDraggableIndex,u=t.originalEvent,p=t.putSortable,m=t.extraEventProperties;if(e=e||i&&i[hs]){var g,f=e.options,v="on"+s.charAt(0).toUpperCase()+s.substr(1);!window.CustomEvent||Ai||ji?(g=document.createEvent("Event")).initEvent(s,!0,!0):g=new CustomEvent(s,{bubbles:!0,cancelable:!0}),g.to=r||i,g.from=a||i,g.item=o||i,g.clone=n,g.oldIndex=l,g.newIndex=h,g.oldDraggableIndex=c,g.newDraggableIndex=d,g.originalEvent=u,g.pullMode=p?p.lastPutMode:void 0;var y=_i(_i({},m),ps.getEventProperties(s,e));for(var b in y)g[b]=y[b];i&&i.dispatchEvent(g),f[v]&&f[v].call(e,g)}}(_i({putSortable:Ms,cloneEl:Ss,targetEl:vs,rootEl:ws,oldIndex:Ts,oldDraggableIndex:Cs,newIndex:_s,newDraggableIndex:Bs},t))}var vs,ys,bs,ws,xs,ks,Ss,Es,Ts,_s,Cs,Bs,Ds,Ms,Rs,As,js,Ls,Ps,Fs,Os,Is,Ns,Hs,zs,Vs=!1,qs=!1,Gs=[],Us=!1,Ws=!1,$s=[],Xs=!1,Qs=[],Ys="undefined"!=typeof document,Zs=Fi,Ks=ji||Ai?"cssFloat":"float",Js=Ys&&!Oi&&!Fi&&"draggable"in document.createElement("div"),to=function(){if(Ys){if(Ai)return!1;var t=document.createElement("x");return t.style.cssText="pointer-events:auto","auto"===t.style.pointerEvents}}(),eo=function(t,e){var i=$i(t),s=parseInt(i.width)-parseInt(i.paddingLeft)-parseInt(i.paddingRight)-parseInt(i.borderLeftWidth)-parseInt(i.borderRightWidth),o=Ji(t,0,e),n=Ji(t,1,e),r=o&&$i(o),a=n&&$i(n),l=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+Zi(o).width,h=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+Zi(n).width;if("flex"===i.display)return"column"===i.flexDirection||"column-reverse"===i.flexDirection?"vertical":"horizontal";if("grid"===i.display)return i.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(o&&r.float&&"none"!==r.float){var c="left"===r.float?"left":"right";return!n||"both"!==a.clear&&a.clear!==c?"horizontal":"vertical"}return o&&("block"===r.display||"flex"===r.display||"table"===r.display||"grid"===r.display||l>=s&&"none"===i[Ks]||n&&"none"===i[Ks]&&l+h>s)?"vertical":"horizontal"},io=function(t){function e(t,i){return function(s,o,n,r){var a=s.options.group.name&&o.options.group.name&&s.options.group.name===o.options.group.name;if(null==t&&(i||a))return!0;if(null==t||!1===t)return!1;if(i&&"clone"===t)return t;if("function"==typeof t)return e(t(s,o,n,r),i)(s,o,n,r);var l=(i?s:o).options.group.name;return!0===t||"string"==typeof t&&t===l||t.join&&t.indexOf(l)>-1}}var i={},s=t.group;s&&"object"==Ci(s)||(s={name:s}),i.name=s.name,i.checkPull=e(s.pull,!0),i.checkPut=e(s.put),i.revertClone=s.revertClone,t.group=i},so=function(){!to&&bs&&$i(bs,"display","none")},oo=function(){!to&&bs&&$i(bs,"display","")};Ys&&!Oi&&document.addEventListener("click",(function(t){if(qs)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),qs=!1,!1}),!0);var no=function(t){if(vs){t=t.touches?t.touches[0]:t;var e=(o=t.clientX,n=t.clientY,Gs.some((function(t){var e=t[hs].options.emptyInsertThreshold;if(e&&!ts(t)){var i=Zi(t),s=o>=i.left-e&&o<=i.right+e,a=n>=i.top-e&&n<=i.bottom+e;return s&&a?r=t:void 0}})),r);if(e){var i={};for(var s in t)t.hasOwnProperty(s)&&(i[s]=t[s]);i.target=i.rootEl=e,i.preventDefault=void 0,i.stopPropagation=void 0,e[hs]._onDragOver(i)}}var o,n,r},ro=function(t){vs&&vs.parentNode[hs]._isOutsideThisEl(t.target)};function ao(t,e){if(!t||!t.nodeType||1!==t.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.el=t,this.options=e=Di({},e),t[hs]=this;var i={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return eo(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(t,e){t.setData("Text",e.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==ao.supportPointer&&"PointerEvent"in window&&!Pi,emptyInsertThreshold:5};for(var s in ps.initializePlugins(this,t,i),i)!(s in e)&&(e[s]=i[s]);for(var o in io(e),this)"_"===o.charAt(0)&&"function"==typeof this[o]&&(this[o]=this[o].bind(this));this.nativeDraggable=!e.forceFallback&&Js,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?Ni(t,"pointerdown",this._onTapStart):(Ni(t,"mousedown",this._onTapStart),Ni(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(Ni(t,"dragover",this),Ni(t,"dragenter",this)),Gs.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),Di(this,cs())}function lo(t,e,i,s,o,n,r,a){var l,h,c=t[hs],d=c.options.onMove;return!window.CustomEvent||Ai||ji?(l=document.createEvent("Event")).initEvent("move",!0,!0):l=new CustomEvent("move",{bubbles:!0,cancelable:!0}),l.to=e,l.from=t,l.dragged=i,l.draggedRect=s,l.related=o||e,l.relatedRect=n||Zi(e),l.willInsertAfter=a,l.originalEvent=r,t.dispatchEvent(l),d&&(h=d.call(c,l,r)),h}function ho(t){t.draggable=!1}function co(){Xs=!1}function uo(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,i=e.length,s=0;i--;)s+=e.charCodeAt(i);return s.toString(36)}function po(t){return setTimeout(t,0)}function mo(t){return clearTimeout(t)}ao.prototype={constructor:ao,_isOutsideThisEl:function(t){this.el.contains(t)||t===this.el||(Is=null)},_getDirection:function(t,e){return"function"==typeof this.options.direction?this.options.direction.call(this,t,e,vs):this.options.direction},_onTapStart:function(t){if(t.cancelable){var e=this,i=this.el,s=this.options,o=s.preventOnFilter,n=t.type,r=t.touches&&t.touches[0]||t.pointerType&&"touch"===t.pointerType&&t,a=(r||t).target,l=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||a,h=s.filter;if(function(t){Qs.length=0;var e=t.getElementsByTagName("input"),i=e.length;for(;i--;){var s=e[i];s.checked&&Qs.push(s)}}(i),!vs&&!(/mousedown|pointerdown/.test(n)&&0!==t.button||s.disabled)&&!l.isContentEditable&&(this.nativeDraggable||!Pi||!a||"SELECT"!==a.tagName.toUpperCase())&&!((a=qi(a,s.draggable,i,!1))&&a.animated||ks===a)){if(Ts=es(a),Cs=es(a,s.draggable),"function"==typeof h){if(h.call(this,t,a,this))return fs({sortable:e,rootEl:l,name:"filter",targetEl:a,toEl:i,fromEl:i}),gs("filter",e,{evt:t}),void(o&&t.cancelable&&t.preventDefault())}else if(h&&(h=h.split(",").some((function(s){if(s=qi(l,s.trim(),i,!1))return fs({sortable:e,rootEl:s,name:"filter",targetEl:a,fromEl:i,toEl:i}),gs("filter",e,{evt:t}),!0}))))return void(o&&t.cancelable&&t.preventDefault());s.handle&&!qi(l,s.handle,i,!1)||this._prepareDragStart(t,r,a)}}},_prepareDragStart:function(t,e,i){var s,o=this,n=o.el,r=o.options,a=n.ownerDocument;if(i&&!vs&&i.parentNode===n){var l=Zi(i);if(ws=n,ys=(vs=i).parentNode,xs=vs.nextSibling,ks=i,Ds=r.group,ao.dragged=vs,Rs={target:vs,clientX:(e||t).clientX,clientY:(e||t).clientY},Ps=Rs.clientX-l.left,Fs=Rs.clientY-l.top,this._lastX=(e||t).clientX,this._lastY=(e||t).clientY,vs.style["will-change"]="all",s=function(){gs("delayEnded",o,{evt:t}),ao.eventCanceled?o._onDrop():(o._disableDelayedDragEvents(),!Li&&o.nativeDraggable&&(vs.draggable=!0),o._triggerDragStart(t,e),fs({sortable:o,name:"choose",originalEvent:t}),Wi(vs,r.chosenClass,!0))},r.ignore.split(",").forEach((function(t){Qi(vs,t.trim(),ho)})),Ni(a,"dragover",no),Ni(a,"mousemove",no),Ni(a,"touchmove",no),Ni(a,"mouseup",o._onDrop),Ni(a,"touchend",o._onDrop),Ni(a,"touchcancel",o._onDrop),Li&&this.nativeDraggable&&(this.options.touchStartThreshold=4,vs.draggable=!0),gs("delayStart",this,{evt:t}),!r.delay||r.delayOnTouchOnly&&!e||this.nativeDraggable&&(ji||Ai))s();else{if(ao.eventCanceled)return void this._onDrop();Ni(a,"mouseup",o._disableDelayedDrag),Ni(a,"touchend",o._disableDelayedDrag),Ni(a,"touchcancel",o._disableDelayedDrag),Ni(a,"mousemove",o._delayedDragTouchMoveHandler),Ni(a,"touchmove",o._delayedDragTouchMoveHandler),r.supportPointer&&Ni(a,"pointermove",o._delayedDragTouchMoveHandler),o._dragStartTimer=setTimeout(s,r.delay)}}},_delayedDragTouchMoveHandler:function(t){var e=t.touches?t.touches[0]:t;Math.max(Math.abs(e.clientX-this._lastX),Math.abs(e.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){vs&&ho(vs),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var t=this.el.ownerDocument;Hi(t,"mouseup",this._disableDelayedDrag),Hi(t,"touchend",this._disableDelayedDrag),Hi(t,"touchcancel",this._disableDelayedDrag),Hi(t,"mousemove",this._delayedDragTouchMoveHandler),Hi(t,"touchmove",this._delayedDragTouchMoveHandler),Hi(t,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,e){e=e||"touch"==t.pointerType&&t,!this.nativeDraggable||e?this.options.supportPointer?Ni(document,"pointermove",this._onTouchMove):Ni(document,e?"touchmove":"mousemove",this._onTouchMove):(Ni(vs,"dragend",this),Ni(ws,"dragstart",this._onDragStart));try{document.selection?po((function(){document.selection.empty()})):window.getSelection().removeAllRanges()}catch(t){}},_dragStarted:function(t,e){if(Vs=!1,ws&&vs){gs("dragStarted",this,{evt:e}),this.nativeDraggable&&Ni(document,"dragover",ro);var i=this.options;!t&&Wi(vs,i.dragClass,!1),Wi(vs,i.ghostClass,!0),ao.active=this,t&&this._appendGhost(),fs({sortable:this,name:"start",originalEvent:e})}else this._nulling()},_emulateDragOver:function(){if(As){this._lastX=As.clientX,this._lastY=As.clientY,so();for(var t=document.elementFromPoint(As.clientX,As.clientY),e=t;t&&t.shadowRoot&&(t=t.shadowRoot.elementFromPoint(As.clientX,As.clientY))!==e;)e=t;if(vs.parentNode[hs]._isOutsideThisEl(t),e)do{if(e[hs]){if(e[hs]._onDragOver({clientX:As.clientX,clientY:As.clientY,target:t,rootEl:e})&&!this.options.dragoverBubble)break}t=e}while(e=e.parentNode);oo()}},_onTouchMove:function(t){if(Rs){var e=this.options,i=e.fallbackTolerance,s=e.fallbackOffset,o=t.touches?t.touches[0]:t,n=bs&&Xi(bs,!0),r=bs&&n&&n.a,a=bs&&n&&n.d,l=Zs&&zs&&is(zs),h=(o.clientX-Rs.clientX+s.x)/(r||1)+(l?l[0]-$s[0]:0)/(r||1),c=(o.clientY-Rs.clientY+s.y)/(a||1)+(l?l[1]-$s[1]:0)/(a||1);if(!ao.active&&!Vs){if(i&&Math.max(Math.abs(o.clientX-this._lastX),Math.abs(o.clientY-this._lastY))<i)return;this._onDragStart(t,!0)}if(bs){n?(n.e+=h-(js||0),n.f+=c-(Ls||0)):n={a:1,b:0,c:0,d:1,e:h,f:c};var d="matrix(".concat(n.a,",").concat(n.b,",").concat(n.c,",").concat(n.d,",").concat(n.e,",").concat(n.f,")");$i(bs,"webkitTransform",d),$i(bs,"mozTransform",d),$i(bs,"msTransform",d),$i(bs,"transform",d),js=h,Ls=c,As=o}t.cancelable&&t.preventDefault()}},_appendGhost:function(){if(!bs){var t=this.options.fallbackOnBody?document.body:ws,e=Zi(vs,!0,Zs,!0,t),i=this.options;if(Zs){for(zs=t;"static"===$i(zs,"position")&&"none"===$i(zs,"transform")&&zs!==document;)zs=zs.parentNode;zs!==document.body&&zs!==document.documentElement?(zs===document&&(zs=Yi()),e.top+=zs.scrollTop,e.left+=zs.scrollLeft):zs=Yi(),$s=is(zs)}Wi(bs=vs.cloneNode(!0),i.ghostClass,!1),Wi(bs,i.fallbackClass,!0),Wi(bs,i.dragClass,!0),$i(bs,"transition",""),$i(bs,"transform",""),$i(bs,"box-sizing","border-box"),$i(bs,"margin",0),$i(bs,"top",e.top),$i(bs,"left",e.left),$i(bs,"width",e.width),$i(bs,"height",e.height),$i(bs,"opacity","0.8"),$i(bs,"position",Zs?"absolute":"fixed"),$i(bs,"zIndex","100000"),$i(bs,"pointerEvents","none"),ao.ghost=bs,t.appendChild(bs),$i(bs,"transform-origin",Ps/parseInt(bs.style.width)*100+"% "+Fs/parseInt(bs.style.height)*100+"%")}},_onDragStart:function(t,e){var i=this,s=t.dataTransfer,o=i.options;gs("dragStart",this,{evt:t}),ao.eventCanceled?this._onDrop():(gs("setupClone",this),ao.eventCanceled||((Ss=as(vs)).removeAttribute("id"),Ss.draggable=!1,Ss.style["will-change"]="",this._hideClone(),Wi(Ss,this.options.chosenClass,!1),ao.clone=Ss),i.cloneId=po((function(){gs("clone",i),ao.eventCanceled||(i.options.removeCloneOnHide||ws.insertBefore(Ss,vs),i._hideClone(),fs({sortable:i,name:"clone"}))})),!e&&Wi(vs,o.dragClass,!0),e?(qs=!0,i._loopId=setInterval(i._emulateDragOver,50)):(Hi(document,"mouseup",i._onDrop),Hi(document,"touchend",i._onDrop),Hi(document,"touchcancel",i._onDrop),s&&(s.effectAllowed="move",o.setData&&o.setData.call(i,s,vs)),Ni(document,"drop",i),$i(vs,"transform","translateZ(0)")),Vs=!0,i._dragStartId=po(i._dragStarted.bind(i,e,t)),Ni(document,"selectstart",i),Os=!0,Pi&&$i(document.body,"user-select","none"))},_onDragOver:function(t){var e,i,s,o,n=this.el,r=t.target,a=this.options,l=a.group,h=ao.active,c=Ds===l,d=a.sort,u=Ms||h,p=this,m=!1;if(!Xs){if(void 0!==t.preventDefault&&t.cancelable&&t.preventDefault(),r=qi(r,a.draggable,n,!0),D("dragOver"),ao.eventCanceled)return m;if(vs.contains(t.target)||r.animated&&r.animatingX&&r.animatingY||p._ignoreWhileAnimating===r)return R(!1);if(qs=!1,h&&!a.disabled&&(c?d||(s=ys!==ws):Ms===this||(this.lastPutMode=Ds.checkPull(this,h,vs,t))&&l.checkPut(this,h,vs,t))){if(o="vertical"===this._getDirection(t,r),e=Zi(vs),D("dragOverValid"),ao.eventCanceled)return m;if(s)return ys=ws,M(),this._hideClone(),D("revert"),ao.eventCanceled||(xs?ws.insertBefore(vs,xs):ws.appendChild(vs)),R(!0);var g=ts(n,a.draggable);if(!g||function(t,e,i){var s=Zi(ts(i.el,i.options.draggable)),o=ls(i.el,i.options,bs),n=10;return e?t.clientX>o.right+n||t.clientY>s.bottom&&t.clientX>s.left:t.clientY>o.bottom+n||t.clientX>s.right&&t.clientY>s.top}(t,o,this)&&!g.animated){if(g===vs)return R(!1);if(g&&n===t.target&&(r=g),r&&(i=Zi(r)),!1!==lo(ws,n,vs,e,r,i,t,!!r))return M(),g&&g.nextSibling?n.insertBefore(vs,g.nextSibling):n.appendChild(vs),ys=n,A(),R(!0)}else if(g&&function(t,e,i){var s=Zi(Ji(i.el,0,i.options,!0)),o=ls(i.el,i.options,bs),n=10;return e?t.clientX<o.left-n||t.clientY<s.top&&t.clientX<s.right:t.clientY<o.top-n||t.clientY<s.bottom&&t.clientX<s.left}(t,o,this)){var f=Ji(n,0,a,!0);if(f===vs)return R(!1);if(i=Zi(r=f),!1!==lo(ws,n,vs,e,r,i,t,!1))return M(),n.insertBefore(vs,f),ys=n,A(),R(!0)}else if(r.parentNode===n){i=Zi(r);var v,y,b,w=vs.parentNode!==n,x=!function(t,e,i){var s=i?t.left:t.top,o=i?t.right:t.bottom,n=i?t.width:t.height,r=i?e.left:e.top,a=i?e.right:e.bottom,l=i?e.width:e.height;return s===r||o===a||s+n/2===r+l/2}(vs.animated&&vs.toRect||e,r.animated&&r.toRect||i,o),k=o?"top":"left",S=Ki(r,"top","top")||Ki(vs,"top","top"),E=S?S.scrollTop:void 0;if(Is!==r&&(y=i[k],Us=!1,Ws=!x&&a.invertSwap||w),v=function(t,e,i,s,o,n,r,a){var l=s?t.clientY:t.clientX,h=s?i.height:i.width,c=s?i.top:i.left,d=s?i.bottom:i.right,u=!1;if(!r)if(a&&Hs<h*o){if(!Us&&(1===Ns?l>c+h*n/2:l<d-h*n/2)&&(Us=!0),Us)u=!0;else if(1===Ns?l<c+Hs:l>d-Hs)return-Ns}else if(l>c+h*(1-o)/2&&l<d-h*(1-o)/2)return function(t){return es(vs)<es(t)?1:-1}(e);if((u=u||r)&&(l<c+h*n/2||l>d-h*n/2))return l>c+h/2?1:-1;return 0}(t,r,i,o,x?1:a.swapThreshold,null==a.invertedSwapThreshold?a.swapThreshold:a.invertedSwapThreshold,Ws,Is===r),0!==v){var T=es(vs);do{T-=v,b=ys.children[T]}while(b&&("none"===$i(b,"display")||b===bs))}if(0===v||b===r)return R(!1);Is=r,Ns=v;var _=r.nextElementSibling,C=!1,B=lo(ws,n,vs,e,r,i,t,C=1===v);if(!1!==B)return 1!==B&&-1!==B||(C=1===B),Xs=!0,setTimeout(co,30),M(),C&&!_?n.appendChild(vs):r.parentNode.insertBefore(vs,C?_:r),S&&rs(S,0,E-S.scrollTop),ys=vs.parentNode,void 0===y||Ws||(Hs=Math.abs(y-Zi(r)[k])),A(),R(!0)}if(n.contains(vs))return R(!1)}return!1}function D(a,l){gs(a,p,_i({evt:t,isOwner:c,axis:o?"vertical":"horizontal",revert:s,dragRect:e,targetRect:i,canSort:d,fromSortable:u,target:r,completed:R,onMove:function(i,s){return lo(ws,n,vs,e,i,Zi(i),t,s)},changed:A},l))}function M(){D("dragOverAnimationCapture"),p.captureAnimationState(),p!==u&&u.captureAnimationState()}function R(e){return D("dragOverCompleted",{insertion:e}),e&&(c?h._hideClone():h._showClone(p),p!==u&&(Wi(vs,Ms?Ms.options.ghostClass:h.options.ghostClass,!1),Wi(vs,a.ghostClass,!0)),Ms!==p&&p!==ao.active?Ms=p:p===ao.active&&Ms&&(Ms=null),u===p&&(p._ignoreWhileAnimating=r),p.animateAll((function(){D("dragOverAnimationComplete"),p._ignoreWhileAnimating=null})),p!==u&&(u.animateAll(),u._ignoreWhileAnimating=null)),(r===vs&&!vs.animated||r===n&&!r.animated)&&(Is=null),a.dragoverBubble||t.rootEl||r===document||(vs.parentNode[hs]._isOutsideThisEl(t.target),!e&&no(t)),!a.dragoverBubble&&t.stopPropagation&&t.stopPropagation(),m=!0}function A(){_s=es(vs),Bs=es(vs,a.draggable),fs({sortable:p,name:"change",toEl:n,newIndex:_s,newDraggableIndex:Bs,originalEvent:t})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){Hi(document,"mousemove",this._onTouchMove),Hi(document,"touchmove",this._onTouchMove),Hi(document,"pointermove",this._onTouchMove),Hi(document,"dragover",no),Hi(document,"mousemove",no),Hi(document,"touchmove",no)},_offUpEvents:function(){var t=this.el.ownerDocument;Hi(t,"mouseup",this._onDrop),Hi(t,"touchend",this._onDrop),Hi(t,"pointerup",this._onDrop),Hi(t,"touchcancel",this._onDrop),Hi(document,"selectstart",this)},_onDrop:function(t){var e=this.el,i=this.options;_s=es(vs),Bs=es(vs,i.draggable),gs("drop",this,{evt:t}),ys=vs&&vs.parentNode,_s=es(vs),Bs=es(vs,i.draggable),ao.eventCanceled||(Vs=!1,Ws=!1,Us=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),mo(this.cloneId),mo(this._dragStartId),this.nativeDraggable&&(Hi(document,"drop",this),Hi(e,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Pi&&$i(document.body,"user-select",""),$i(vs,"transform",""),t&&(Os&&(t.cancelable&&t.preventDefault(),!i.dropBubble&&t.stopPropagation()),bs&&bs.parentNode&&bs.parentNode.removeChild(bs),(ws===ys||Ms&&"clone"!==Ms.lastPutMode)&&Ss&&Ss.parentNode&&Ss.parentNode.removeChild(Ss),vs&&(this.nativeDraggable&&Hi(vs,"dragend",this),ho(vs),vs.style["will-change"]="",Os&&!Vs&&Wi(vs,Ms?Ms.options.ghostClass:this.options.ghostClass,!1),Wi(vs,this.options.chosenClass,!1),fs({sortable:this,name:"unchoose",toEl:ys,newIndex:null,newDraggableIndex:null,originalEvent:t}),ws!==ys?(_s>=0&&(fs({rootEl:ys,name:"add",toEl:ys,fromEl:ws,originalEvent:t}),fs({sortable:this,name:"remove",toEl:ys,originalEvent:t}),fs({rootEl:ys,name:"sort",toEl:ys,fromEl:ws,originalEvent:t}),fs({sortable:this,name:"sort",toEl:ys,originalEvent:t})),Ms&&Ms.save()):_s!==Ts&&_s>=0&&(fs({sortable:this,name:"update",toEl:ys,originalEvent:t}),fs({sortable:this,name:"sort",toEl:ys,originalEvent:t})),ao.active&&(null!=_s&&-1!==_s||(_s=Ts,Bs=Cs),fs({sortable:this,name:"end",toEl:ys,originalEvent:t}),this.save())))),this._nulling()},_nulling:function(){gs("nulling",this),ws=vs=ys=bs=xs=Ss=ks=Es=Rs=As=Os=_s=Bs=Ts=Cs=Is=Ns=Ms=Ds=ao.dragged=ao.ghost=ao.clone=ao.active=null,Qs.forEach((function(t){t.checked=!0})),Qs.length=js=Ls=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":vs&&(this._onDragOver(t),function(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move");t.cancelable&&t.preventDefault()}(t));break;case"selectstart":t.preventDefault()}},toArray:function(){for(var t,e=[],i=this.el.children,s=0,o=i.length,n=this.options;s<o;s++)qi(t=i[s],n.draggable,this.el,!1)&&e.push(t.getAttribute(n.dataIdAttr)||uo(t));return e},sort:function(t,e){var i={},s=this.el;this.toArray().forEach((function(t,e){var o=s.children[e];qi(o,this.options.draggable,s,!1)&&(i[t]=o)}),this),e&&this.captureAnimationState(),t.forEach((function(t){i[t]&&(s.removeChild(i[t]),s.appendChild(i[t]))})),e&&this.animateAll()},save:function(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,e){return qi(t,e||this.options.draggable,this.el,!1)},option:function(t,e){var i=this.options;if(void 0===e)return i[t];var s=ps.modifyOption(this,t,e);i[t]=void 0!==s?s:e,"group"===t&&io(i)},destroy:function(){gs("destroy",this);var t=this.el;t[hs]=null,Hi(t,"mousedown",this._onTapStart),Hi(t,"touchstart",this._onTapStart),Hi(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(Hi(t,"dragover",this),Hi(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),(function(t){t.removeAttribute("draggable")})),this._onDrop(),this._disableDelayedDragEvents(),Gs.splice(Gs.indexOf(this.el),1),this.el=t=null},_hideClone:function(){if(!Es){if(gs("hideClone",this),ao.eventCanceled)return;$i(Ss,"display","none"),this.options.removeCloneOnHide&&Ss.parentNode&&Ss.parentNode.removeChild(Ss),Es=!0}},_showClone:function(t){if("clone"===t.lastPutMode){if(Es){if(gs("showClone",this),ao.eventCanceled)return;vs.parentNode!=ws||this.options.group.revertClone?xs?ws.insertBefore(Ss,xs):ws.appendChild(Ss):ws.insertBefore(Ss,vs),this.options.group.revertClone&&this.animate(vs,Ss),$i(Ss,"display",""),Es=!1}}else this._hideClone()}},Ys&&Ni(document,"touchmove",(function(t){(ao.active||Vs)&&t.cancelable&&t.preventDefault()})),ao.utils={on:Ni,off:Hi,css:$i,find:Qi,is:function(t,e){return!!qi(t,e,t,!1)},extend:function(t,e){if(t&&e)for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},throttle:ns,closest:qi,toggleClass:Wi,clone:as,index:es,nextTick:po,cancelNextTick:mo,detectDirection:eo,getChild:Ji},ao.get=function(t){return t[hs]},ao.mount=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e[0].constructor===Array&&(e=e[0]),e.forEach((function(t){if(!t.prototype||!t.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(t));t.utils&&(ao.utils=_i(_i({},ao.utils),t.utils)),ps.mount(t)}))},ao.create=function(t,e){return new ao(t,e)},ao.version="1.15.2";var go,fo,vo,yo,bo,wo,xo=[],ko=!1;function So(){xo.forEach((function(t){clearInterval(t.pid)})),xo=[]}function Eo(){clearInterval(wo)}var To=ns((function(t,e,i,s){if(e.scroll){var o,n=(t.touches?t.touches[0]:t).clientX,r=(t.touches?t.touches[0]:t).clientY,a=e.scrollSensitivity,l=e.scrollSpeed,h=Yi(),c=!1;fo!==i&&(fo=i,So(),go=e.scroll,o=e.scrollFn,!0===go&&(go=ss(i,!0)));var d=0,u=go;do{var p=u,m=Zi(p),g=m.top,f=m.bottom,v=m.left,y=m.right,b=m.width,w=m.height,x=void 0,k=void 0,S=p.scrollWidth,E=p.scrollHeight,T=$i(p),_=p.scrollLeft,C=p.scrollTop;p===h?(x=b<S&&("auto"===T.overflowX||"scroll"===T.overflowX||"visible"===T.overflowX),k=w<E&&("auto"===T.overflowY||"scroll"===T.overflowY||"visible"===T.overflowY)):(x=b<S&&("auto"===T.overflowX||"scroll"===T.overflowX),k=w<E&&("auto"===T.overflowY||"scroll"===T.overflowY));var B=x&&(Math.abs(y-n)<=a&&_+b<S)-(Math.abs(v-n)<=a&&!!_),D=k&&(Math.abs(f-r)<=a&&C+w<E)-(Math.abs(g-r)<=a&&!!C);if(!xo[d])for(var M=0;M<=d;M++)xo[M]||(xo[M]={});xo[d].vx==B&&xo[d].vy==D&&xo[d].el===p||(xo[d].el=p,xo[d].vx=B,xo[d].vy=D,clearInterval(xo[d].pid),0==B&&0==D||(c=!0,xo[d].pid=setInterval(function(){s&&0===this.layer&&ao.active._onTouchMove(bo);var e=xo[this.layer].vy?xo[this.layer].vy*l:0,i=xo[this.layer].vx?xo[this.layer].vx*l:0;"function"==typeof o&&"continue"!==o.call(ao.dragged.parentNode[hs],i,e,t,bo,xo[this.layer].el)||rs(xo[this.layer].el,i,e)}.bind({layer:d}),24))),d++}while(e.bubbleScroll&&u!==h&&(u=ss(u,!1)));ko=c}}),30),_o=function(t){var e=t.originalEvent,i=t.putSortable,s=t.dragEl,o=t.activeSortable,n=t.dispatchSortableEvent,r=t.hideGhostForTarget,a=t.unhideGhostForTarget;if(e){var l=i||o;r();var h=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e,c=document.elementFromPoint(h.clientX,h.clientY);a(),l&&!l.el.contains(c)&&(n("spill"),this.onSpill({dragEl:s,putSortable:i}))}};function Co(){}function Bo(){}Co.prototype={startIndex:null,dragStart:function(t){var e=t.oldDraggableIndex;this.startIndex=e},onSpill:function(t){var e=t.dragEl,i=t.putSortable;this.sortable.captureAnimationState(),i&&i.captureAnimationState();var s=Ji(this.sortable.el,this.startIndex,this.options);s?this.sortable.el.insertBefore(e,s):this.sortable.el.appendChild(e),this.sortable.animateAll(),i&&i.animateAll()},drop:_o},Di(Co,{pluginName:"revertOnSpill"}),Bo.prototype={onSpill:function(t){var e=t.dragEl,i=t.putSortable||this.sortable;i.captureAnimationState(),e.parentNode&&e.parentNode.removeChild(e),i.animateAll()},drop:_o},Di(Bo,{pluginName:"removeOnSpill"}),ao.mount(new function(){function t(){for(var t in this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===t.charAt(0)&&"function"==typeof this[t]&&(this[t]=this[t].bind(this))}return t.prototype={dragStarted:function(t){var e=t.originalEvent;this.sortable.nativeDraggable?Ni(document,"dragover",this._handleAutoScroll):this.options.supportPointer?Ni(document,"pointermove",this._handleFallbackAutoScroll):e.touches?Ni(document,"touchmove",this._handleFallbackAutoScroll):Ni(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var e=t.originalEvent;this.options.dragOverBubble||e.rootEl||this._handleAutoScroll(e)},drop:function(){this.sortable.nativeDraggable?Hi(document,"dragover",this._handleAutoScroll):(Hi(document,"pointermove",this._handleFallbackAutoScroll),Hi(document,"touchmove",this._handleFallbackAutoScroll),Hi(document,"mousemove",this._handleFallbackAutoScroll)),Eo(),So(),clearTimeout(Gi),Gi=void 0},nulling:function(){bo=fo=go=ko=wo=vo=yo=null,xo.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,e){var i=this,s=(t.touches?t.touches[0]:t).clientX,o=(t.touches?t.touches[0]:t).clientY,n=document.elementFromPoint(s,o);if(bo=t,e||this.options.forceAutoScrollFallback||ji||Ai||Pi){To(t,this.options,n,e);var r=ss(n,!0);!ko||wo&&s===vo&&o===yo||(wo&&Eo(),wo=setInterval((function(){var n=ss(document.elementFromPoint(s,o),!0);n!==r&&(r=n,So()),To(t,i.options,n,e)}),10),vo=s,yo=o)}else{if(!this.options.bubbleScroll||ss(n,!0)===Yi())return void So();To(t,this.options,ss(n,!1),!1)}}},Di(t,{pluginName:"scroll",initializeByDefault:!0})}),ao.mount(Bo,Co);const Do=jQuery;class Mo extends Ut{constructor(t,e,i){super(t,e,i),this.searchType=t.searchType||"fulltext",this.mediaUploader=i.mediaUploader,this.typeLabel="Images",this.button_text=t.button_text||"Browse...",this.db_type="text",this.label=t.label||"Images",this.name=t.name||"images",this.images=this.value||[],this.value=JSON.stringify(this.value)}init(){super.init(),this.redrawImages()}setDomElements(){super.setDomElements()}getData(){return this.updateData(),{name:this.name,value:this.images}}getSchema(){const t=super.getSchema();return t.button_text=this.button_text,t}updateData(){const t=[];Do(this.domElements.main).find(".mapsvg-thumbnail-wrap").each((function(e,i){const s=Do(i).data("image");t.push(s)})),this.images=t,this.value=JSON.stringify(this.images),Do(this.domElements.main).find("input").val(this.value)}setEventHandlers(){if(super.setEventHandlers(),this.formBuilder.editMode)return;const t=this,e=Do(this.domElements.main).find(".mapsvg-data-images");this.external.mediaUploader.on("select",(()=>{if(t.formBuilder.mediaUploaderisOpenedFor!==t)return!1;t.external.mediaUploader.state().get("selection").toJSON().forEach((function(e){const i={sizes:{}};for(const t in e.sizes)i[t]=e.sizes[t].url.replace("http://","//").replace("https://","//"),i.sizes[t]={width:e.sizes[t].width,height:e.sizes[t].height};i.thumbnail||(i.thumbnail=i.full,i.sizes.thumbnail={width:e.sizes.full.width,height:e.sizes.full.height}),i.medium||(i.medium=i.full,i.sizes.medium={width:e.sizes.full.width,height:e.sizes.full.height}),i.caption=e.caption,i.description=e.description,t.images.push(i)})),this.setValue(this.images),t.redrawImages()})),Do(t.domElements.main).on("click",".mapsvg-upload-image",(function(e){e.preventDefault(),t.formBuilder.mediaUploaderisOpenedFor=t,t.external.mediaUploader.open()})),Do(t.domElements.main).on("click",".mapsvg-image-delete",(function(e){e.preventDefault(),Do(this).closest(".mapsvg-thumbnail-wrap").remove(),t.updateData()})),t.sortable=new ao(e[0],{animation:150,onStart:function(){Do(t.domElements.main).addClass("sorting")},onEnd:function(e){t.images=[],Do(t.domElements.main).find("img").each((function(e,i){t.images.push(Do(i).data("image"))})),this.value=JSON.stringify(t.images),Do(t.domElements.main).find("input").val(this.value),Do(t.domElements.main).removeClass("sorting")}})}redrawImages(){const t=Do(this.domElements.main).find(".mapsvg-data-images");t.empty(),this.images&&this.images.forEach((function(e){const i=Do('<img class="mapsvg-data-thumbnail" />').attr("src",e.thumbnail).data("image",e),s=Do('<div class="mapsvg-thumbnail-wrap"></div>').data("image",e);s.append(i),s.append('<i class="bi bi-x-lg  mapsvg-image-delete"></i>'),t.append(s)})),Do(this.domElements.main).find("input").val(this.value)}destroy(){super.destroy(),this.external.mediaUploader.off("select")}}var Ro,Ao={exports:{}},jo={exports:{}},Lo=jo.exports;function Po(){return Ro||(Ro=1,t=jo,function(e,i){t.exports=e.document?i(e,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return i(t)}}("undefined"!=typeof window?window:Lo,(function(t,e){var i=[],s=Object.getPrototypeOf,o=i.slice,n=i.flat?function(t){return i.flat.call(t)}:function(t){return i.concat.apply([],t)},r=i.push,a=i.indexOf,l={},h=l.toString,c=l.hasOwnProperty,d=c.toString,u=d.call(Object),p={},m=function(t){return"function"==typeof t&&"number"!=typeof t.nodeType&&"function"!=typeof t.item},g=function(t){return null!=t&&t===t.window},f=t.document,v={type:!0,src:!0,nonce:!0,noModule:!0};function y(t,e,i){var s,o,n=(i=i||f).createElement("script");if(n.text=t,e)for(s in v)(o=e[s]||e.getAttribute&&e.getAttribute(s))&&n.setAttribute(s,o);i.head.appendChild(n).parentNode.removeChild(n)}function b(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?l[h.call(t)]||"object":typeof t}var w="3.7.1",x=/HTML$/i,k=function(t,e){return new k.fn.init(t,e)};function S(t){var e=!!t&&"length"in t&&t.length,i=b(t);return!m(t)&&!g(t)&&("array"===i||0===e||"number"==typeof e&&e>0&&e-1 in t)}function E(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()}k.fn=k.prototype={jquery:w,constructor:k,length:0,toArray:function(){return o.call(this)},get:function(t){return null==t?o.call(this):t<0?this[t+this.length]:this[t]},pushStack:function(t){var e=k.merge(this.constructor(),t);return e.prevObject=this,e},each:function(t){return k.each(this,t)},map:function(t){return this.pushStack(k.map(this,(function(e,i){return t.call(e,i,e)})))},slice:function(){return this.pushStack(o.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(k.grep(this,(function(t,e){return(e+1)%2})))},odd:function(){return this.pushStack(k.grep(this,(function(t,e){return e%2})))},eq:function(t){var e=this.length,i=+t+(t<0?e:0);return this.pushStack(i>=0&&i<e?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:r,sort:i.sort,splice:i.splice},k.extend=k.fn.extend=function(){var t,e,i,s,o,n,r=arguments[0]||{},a=1,l=arguments.length,h=!1;for("boolean"==typeof r&&(h=r,r=arguments[a]||{},a++),"object"==typeof r||m(r)||(r={}),a===l&&(r=this,a--);a<l;a++)if(null!=(t=arguments[a]))for(e in t)s=t[e],"__proto__"!==e&&r!==s&&(h&&s&&(k.isPlainObject(s)||(o=Array.isArray(s)))?(i=r[e],n=o&&!Array.isArray(i)?[]:o||k.isPlainObject(i)?i:{},o=!1,r[e]=k.extend(h,n,s)):void 0!==s&&(r[e]=s));return r},k.extend({expando:"jQuery"+(w+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isPlainObject:function(t){var e,i;return!(!t||"[object Object]"!==h.call(t)||(e=s(t))&&("function"!=typeof(i=c.call(e,"constructor")&&e.constructor)||d.call(i)!==u))},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},globalEval:function(t,e,i){y(t,{nonce:e&&e.nonce},i)},each:function(t,e){var i,s=0;if(S(t))for(i=t.length;s<i&&!1!==e.call(t[s],s,t[s]);s++);else for(s in t)if(!1===e.call(t[s],s,t[s]))break;return t},text:function(t){var e,i="",s=0,o=t.nodeType;if(!o)for(;e=t[s++];)i+=k.text(e);return 1===o||11===o?t.textContent:9===o?t.documentElement.textContent:3===o||4===o?t.nodeValue:i},makeArray:function(t,e){var i=e||[];return null!=t&&(S(Object(t))?k.merge(i,"string"==typeof t?[t]:t):r.call(i,t)),i},inArray:function(t,e,i){return null==e?-1:a.call(e,t,i)},isXMLDoc:function(t){var e=t&&t.namespaceURI,i=t&&(t.ownerDocument||t).documentElement;return!x.test(e||i&&i.nodeName||"HTML")},merge:function(t,e){for(var i=+e.length,s=0,o=t.length;s<i;s++)t[o++]=e[s];return t.length=o,t},grep:function(t,e,i){for(var s=[],o=0,n=t.length,r=!i;o<n;o++)!e(t[o],o)!==r&&s.push(t[o]);return s},map:function(t,e,i){var s,o,r=0,a=[];if(S(t))for(s=t.length;r<s;r++)null!=(o=e(t[r],r,i))&&a.push(o);else for(r in t)null!=(o=e(t[r],r,i))&&a.push(o);return n(a)},guid:1,support:p}),"function"==typeof Symbol&&(k.fn[Symbol.iterator]=i[Symbol.iterator]),k.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(t,e){l["[object "+e+"]"]=e.toLowerCase()}));var T=i.pop,_=i.sort,C=i.splice,B="[\\x20\\t\\r\\n\\f]",D=new RegExp("^"+B+"+|((?:^|[^\\\\])(?:\\\\.)*)"+B+"+$","g");k.contains=function(t,e){var i=e&&e.parentNode;return t===i||!(!i||1!==i.nodeType||!(t.contains?t.contains(i):t.compareDocumentPosition&&16&t.compareDocumentPosition(i)))};var M=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function R(t,e){return e?"\0"===t?"":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t}k.escapeSelector=function(t){return(t+"").replace(M,R)};var A=f,j=r;!function(){var e,s,n,r,l,h,d,u,m,g,f=j,v=k.expando,y=0,b=0,w=tt(),x=tt(),S=tt(),M=tt(),R=function(t,e){return t===e&&(l=!0),0},L="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",P="(?:\\\\[\\da-fA-F]{1,6}"+B+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",F="\\["+B+"*("+P+")(?:"+B+"*([*^$|!~]?=)"+B+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+P+"))|)"+B+"*\\]",O=":("+P+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+F+")*)|.*)\\)|)",I=new RegExp(B+"+","g"),N=new RegExp("^"+B+"*,"+B+"*"),H=new RegExp("^"+B+"*([>+~]|"+B+")"+B+"*"),z=new RegExp(B+"|>"),V=new RegExp(O),q=new RegExp("^"+P+"$"),G={ID:new RegExp("^#("+P+")"),CLASS:new RegExp("^\\.("+P+")"),TAG:new RegExp("^("+P+"|[*])"),ATTR:new RegExp("^"+F),PSEUDO:new RegExp("^"+O),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+B+"*(even|odd|(([+-]|)(\\d*)n|)"+B+"*(?:([+-]|)"+B+"*(\\d+)|))"+B+"*\\)|)","i"),bool:new RegExp("^(?:"+L+")$","i"),needsContext:new RegExp("^"+B+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+B+"*((?:-\\d)?\\d*)"+B+"*\\)|)(?=[^-]|$)","i")},U=/^(?:input|select|textarea|button)$/i,W=/^h\d$/i,$=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,X=/[+~]/,Q=new RegExp("\\\\[\\da-fA-F]{1,6}"+B+"?|\\\\([^\\r\\n\\f])","g"),Y=function(t,e){var i="0x"+t.slice(1)-65536;return e||(i<0?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,1023&i|56320))},Z=function(){lt()},K=ut((function(t){return!0===t.disabled&&E(t,"fieldset")}),{dir:"parentNode",next:"legend"});try{f.apply(i=o.call(A.childNodes),A.childNodes),i[A.childNodes.length].nodeType}catch(t){f={apply:function(t,e){j.apply(t,o.call(e))},call:function(t){j.apply(t,o.call(arguments,1))}}}function J(t,e,i,s){var o,n,r,a,l,c,d,g=e&&e.ownerDocument,y=e?e.nodeType:9;if(i=i||[],"string"!=typeof t||!t||1!==y&&9!==y&&11!==y)return i;if(!s&&(lt(e),e=e||h,u)){if(11!==y&&(l=$.exec(t)))if(o=l[1]){if(9===y){if(!(r=e.getElementById(o)))return i;if(r.id===o)return f.call(i,r),i}else if(g&&(r=g.getElementById(o))&&J.contains(e,r)&&r.id===o)return f.call(i,r),i}else{if(l[2])return f.apply(i,e.getElementsByTagName(t)),i;if((o=l[3])&&e.getElementsByClassName)return f.apply(i,e.getElementsByClassName(o)),i}if(!(M[t+" "]||m&&m.test(t))){if(d=t,g=e,1===y&&(z.test(t)||H.test(t))){for((g=X.test(t)&&at(e.parentNode)||e)==e&&p.scope||((a=e.getAttribute("id"))?a=k.escapeSelector(a):e.setAttribute("id",a=v)),n=(c=ct(t)).length;n--;)c[n]=(a?"#"+a:":scope")+" "+dt(c[n]);d=c.join(",")}try{return f.apply(i,g.querySelectorAll(d)),i}catch(e){M(t,!0)}finally{a===v&&e.removeAttribute("id")}}}return yt(t.replace(D,"$1"),e,i,s)}function tt(){var t=[];return function e(i,o){return t.push(i+" ")>s.cacheLength&&delete e[t.shift()],e[i+" "]=o}}function et(t){return t[v]=!0,t}function it(t){var e=h.createElement("fieldset");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function st(t){return function(e){return E(e,"input")&&e.type===t}}function ot(t){return function(e){return(E(e,"input")||E(e,"button"))&&e.type===t}}function nt(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&K(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function rt(t){return et((function(e){return e=+e,et((function(i,s){for(var o,n=t([],i.length,e),r=n.length;r--;)i[o=n[r]]&&(i[o]=!(s[o]=i[o]))}))}))}function at(t){return t&&void 0!==t.getElementsByTagName&&t}function lt(t){var e,i=t?t.ownerDocument||t:A;return i!=h&&9===i.nodeType&&i.documentElement?(d=(h=i).documentElement,u=!k.isXMLDoc(h),g=d.matches||d.webkitMatchesSelector||d.msMatchesSelector,d.msMatchesSelector&&A!=h&&(e=h.defaultView)&&e.top!==e&&e.addEventListener("unload",Z),p.getById=it((function(t){return d.appendChild(t).id=k.expando,!h.getElementsByName||!h.getElementsByName(k.expando).length})),p.disconnectedMatch=it((function(t){return g.call(t,"*")})),p.scope=it((function(){return h.querySelectorAll(":scope")})),p.cssHas=it((function(){try{return h.querySelector(":has(*,:jqfake)"),!1}catch(t){return!0}})),p.getById?(s.filter.ID=function(t){var e=t.replace(Q,Y);return function(t){return t.getAttribute("id")===e}},s.find.ID=function(t,e){if(void 0!==e.getElementById&&u){var i=e.getElementById(t);return i?[i]:[]}}):(s.filter.ID=function(t){var e=t.replace(Q,Y);return function(t){var i=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return i&&i.value===e}},s.find.ID=function(t,e){if(void 0!==e.getElementById&&u){var i,s,o,n=e.getElementById(t);if(n){if((i=n.getAttributeNode("id"))&&i.value===t)return[n];for(o=e.getElementsByName(t),s=0;n=o[s++];)if((i=n.getAttributeNode("id"))&&i.value===t)return[n]}return[]}}),s.find.TAG=function(t,e){return void 0!==e.getElementsByTagName?e.getElementsByTagName(t):e.querySelectorAll(t)},s.find.CLASS=function(t,e){if(void 0!==e.getElementsByClassName&&u)return e.getElementsByClassName(t)},m=[],it((function(t){var e;d.appendChild(t).innerHTML="<a id='"+v+"' href='' disabled='disabled'></a><select id='"+v+"-\r\\' disabled='disabled'><option selected=''></option></select>",t.querySelectorAll("[selected]").length||m.push("\\["+B+"*(?:value|"+L+")"),t.querySelectorAll("[id~="+v+"-]").length||m.push("~="),t.querySelectorAll("a#"+v+"+*").length||m.push(".#.+[+~]"),t.querySelectorAll(":checked").length||m.push(":checked"),(e=h.createElement("input")).setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),d.appendChild(t).disabled=!0,2!==t.querySelectorAll(":disabled").length&&m.push(":enabled",":disabled"),(e=h.createElement("input")).setAttribute("name",""),t.appendChild(e),t.querySelectorAll("[name='']").length||m.push("\\["+B+"*name"+B+"*="+B+"*(?:''|\"\")")})),p.cssHas||m.push(":has"),m=m.length&&new RegExp(m.join("|")),R=function(t,e){if(t===e)return l=!0,0;var i=!t.compareDocumentPosition-!e.compareDocumentPosition;return i||(1&(i=(t.ownerDocument||t)==(e.ownerDocument||e)?t.compareDocumentPosition(e):1)||!p.sortDetached&&e.compareDocumentPosition(t)===i?t===h||t.ownerDocument==A&&J.contains(A,t)?-1:e===h||e.ownerDocument==A&&J.contains(A,e)?1:r?a.call(r,t)-a.call(r,e):0:4&i?-1:1)},h):h}for(e in J.matches=function(t,e){return J(t,null,null,e)},J.matchesSelector=function(t,e){if(lt(t),u&&!M[e+" "]&&(!m||!m.test(e)))try{var i=g.call(t,e);if(i||p.disconnectedMatch||t.document&&11!==t.document.nodeType)return i}catch(t){M(e,!0)}return J(e,h,null,[t]).length>0},J.contains=function(t,e){return(t.ownerDocument||t)!=h&&lt(t),k.contains(t,e)},J.attr=function(t,e){(t.ownerDocument||t)!=h&&lt(t);var i=s.attrHandle[e.toLowerCase()],o=i&&c.call(s.attrHandle,e.toLowerCase())?i(t,e,!u):void 0;return void 0!==o?o:t.getAttribute(e)},J.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},k.uniqueSort=function(t){var e,i=[],s=0,n=0;if(l=!p.sortStable,r=!p.sortStable&&o.call(t,0),_.call(t,R),l){for(;e=t[n++];)e===t[n]&&(s=i.push(n));for(;s--;)C.call(t,i[s],1)}return r=null,t},k.fn.uniqueSort=function(){return this.pushStack(k.uniqueSort(o.apply(this)))},s=k.expr={cacheLength:50,createPseudo:et,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(Q,Y),t[3]=(t[3]||t[4]||t[5]||"").replace(Q,Y),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||J.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&J.error(t[0]),t},PSEUDO:function(t){var e,i=!t[6]&&t[2];return G.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":i&&V.test(i)&&(e=ct(i,!0))&&(e=i.indexOf(")",i.length-e)-i.length)&&(t[0]=t[0].slice(0,e),t[2]=i.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(Q,Y).toLowerCase();return"*"===t?function(){return!0}:function(t){return E(t,e)}},CLASS:function(t){var e=w[t+" "];return e||(e=new RegExp("(^|"+B+")"+t+"("+B+"|$)"))&&w(t,(function(t){return e.test("string"==typeof t.className&&t.className||void 0!==t.getAttribute&&t.getAttribute("class")||"")}))},ATTR:function(t,e,i){return function(s){var o=J.attr(s,t);return null==o?"!="===e:!e||(o+="","="===e?o===i:"!="===e?o!==i:"^="===e?i&&0===o.indexOf(i):"*="===e?i&&o.indexOf(i)>-1:"$="===e?i&&o.slice(-i.length)===i:"~="===e?(" "+o.replace(I," ")+" ").indexOf(i)>-1:"|="===e&&(o===i||o.slice(0,i.length+1)===i+"-"))}},CHILD:function(t,e,i,s,o){var n="nth"!==t.slice(0,3),r="last"!==t.slice(-4),a="of-type"===e;return 1===s&&0===o?function(t){return!!t.parentNode}:function(e,i,l){var h,c,d,u,p,m=n!==r?"nextSibling":"previousSibling",g=e.parentNode,f=a&&e.nodeName.toLowerCase(),b=!l&&!a,w=!1;if(g){if(n){for(;m;){for(d=e;d=d[m];)if(a?E(d,f):1===d.nodeType)return!1;p=m="only"===t&&!p&&"nextSibling"}return!0}if(p=[r?g.firstChild:g.lastChild],r&&b){for(w=(u=(h=(c=g[v]||(g[v]={}))[t]||[])[0]===y&&h[1])&&h[2],d=u&&g.childNodes[u];d=++u&&d&&d[m]||(w=u=0)||p.pop();)if(1===d.nodeType&&++w&&d===e){c[t]=[y,u,w];break}}else if(b&&(w=u=(h=(c=e[v]||(e[v]={}))[t]||[])[0]===y&&h[1]),!1===w)for(;(d=++u&&d&&d[m]||(w=u=0)||p.pop())&&(!(a?E(d,f):1===d.nodeType)||!++w||(b&&((c=d[v]||(d[v]={}))[t]=[y,w]),d!==e)););return(w-=o)===s||w%s==0&&w/s>=0}}},PSEUDO:function(t,e){var i,o=s.pseudos[t]||s.setFilters[t.toLowerCase()]||J.error("unsupported pseudo: "+t);return o[v]?o(e):o.length>1?(i=[t,t,"",e],s.setFilters.hasOwnProperty(t.toLowerCase())?et((function(t,i){for(var s,n=o(t,e),r=n.length;r--;)t[s=a.call(t,n[r])]=!(i[s]=n[r])})):function(t){return o(t,0,i)}):o}},pseudos:{not:et((function(t){var e=[],i=[],s=vt(t.replace(D,"$1"));return s[v]?et((function(t,e,i,o){for(var n,r=s(t,null,o,[]),a=t.length;a--;)(n=r[a])&&(t[a]=!(e[a]=n))})):function(t,o,n){return e[0]=t,s(e,null,n,i),e[0]=null,!i.pop()}})),has:et((function(t){return function(e){return J(t,e).length>0}})),contains:et((function(t){return t=t.replace(Q,Y),function(e){return(e.textContent||k.text(e)).indexOf(t)>-1}})),lang:et((function(t){return q.test(t||"")||J.error("unsupported lang: "+t),t=t.replace(Q,Y).toLowerCase(),function(e){var i;do{if(i=u?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(i=i.toLowerCase())===t||0===i.indexOf(t+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}})),target:function(e){var i=t.location&&t.location.hash;return i&&i.slice(1)===e.id},root:function(t){return t===d},focus:function(t){return t===function(){try{return h.activeElement}catch(t){}}()&&h.hasFocus()&&!!(t.type||t.href||~t.tabIndex)},enabled:nt(!1),disabled:nt(!0),checked:function(t){return E(t,"input")&&!!t.checked||E(t,"option")&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!s.pseudos.empty(t)},header:function(t){return W.test(t.nodeName)},input:function(t){return U.test(t.nodeName)},button:function(t){return E(t,"input")&&"button"===t.type||E(t,"button")},text:function(t){var e;return E(t,"input")&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:rt((function(){return[0]})),last:rt((function(t,e){return[e-1]})),eq:rt((function(t,e,i){return[i<0?i+e:i]})),even:rt((function(t,e){for(var i=0;i<e;i+=2)t.push(i);return t})),odd:rt((function(t,e){for(var i=1;i<e;i+=2)t.push(i);return t})),lt:rt((function(t,e,i){var s;for(s=i<0?i+e:i>e?e:i;--s>=0;)t.push(s);return t})),gt:rt((function(t,e,i){for(var s=i<0?i+e:i;++s<e;)t.push(s);return t}))}},s.pseudos.nth=s.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})s.pseudos[e]=st(e);for(e in{submit:!0,reset:!0})s.pseudos[e]=ot(e);function ht(){}function ct(t,e){var i,o,n,r,a,l,h,c=x[t+" "];if(c)return e?0:c.slice(0);for(a=t,l=[],h=s.preFilter;a;){for(r in i&&!(o=N.exec(a))||(o&&(a=a.slice(o[0].length)||a),l.push(n=[])),i=!1,(o=H.exec(a))&&(i=o.shift(),n.push({value:i,type:o[0].replace(D," ")}),a=a.slice(i.length)),s.filter)!(o=G[r].exec(a))||h[r]&&!(o=h[r](o))||(i=o.shift(),n.push({value:i,type:r,matches:o}),a=a.slice(i.length));if(!i)break}return e?a.length:a?J.error(t):x(t,l).slice(0)}function dt(t){for(var e=0,i=t.length,s="";e<i;e++)s+=t[e].value;return s}function ut(t,e,i){var s=e.dir,o=e.next,n=o||s,r=i&&"parentNode"===n,a=b++;return e.first?function(e,i,o){for(;e=e[s];)if(1===e.nodeType||r)return t(e,i,o);return!1}:function(e,i,l){var h,c,d=[y,a];if(l){for(;e=e[s];)if((1===e.nodeType||r)&&t(e,i,l))return!0}else for(;e=e[s];)if(1===e.nodeType||r)if(c=e[v]||(e[v]={}),o&&E(e,o))e=e[s]||e;else{if((h=c[n])&&h[0]===y&&h[1]===a)return d[2]=h[2];if(c[n]=d,d[2]=t(e,i,l))return!0}return!1}}function pt(t){return t.length>1?function(e,i,s){for(var o=t.length;o--;)if(!t[o](e,i,s))return!1;return!0}:t[0]}function mt(t,e,i,s,o){for(var n,r=[],a=0,l=t.length,h=null!=e;a<l;a++)(n=t[a])&&(i&&!i(n,s,o)||(r.push(n),h&&e.push(a)));return r}function gt(t,e,i,s,o,n){return s&&!s[v]&&(s=gt(s)),o&&!o[v]&&(o=gt(o,n)),et((function(n,r,l,h){var c,d,u,p,m=[],g=[],v=r.length,y=n||function(t,e,i){for(var s=0,o=e.length;s<o;s++)J(t,e[s],i);return i}(e||"*",l.nodeType?[l]:l,[]),b=!t||!n&&e?y:mt(y,m,t,l,h);if(i?i(b,p=o||(n?t:v||s)?[]:r,l,h):p=b,s)for(c=mt(p,g),s(c,[],l,h),d=c.length;d--;)(u=c[d])&&(p[g[d]]=!(b[g[d]]=u));if(n){if(o||t){if(o){for(c=[],d=p.length;d--;)(u=p[d])&&c.push(b[d]=u);o(null,p=[],c,h)}for(d=p.length;d--;)(u=p[d])&&(c=o?a.call(n,u):m[d])>-1&&(n[c]=!(r[c]=u))}}else p=mt(p===r?p.splice(v,p.length):p),o?o(null,r,p,h):f.apply(r,p)}))}function ft(t){for(var e,i,o,r=t.length,l=s.relative[t[0].type],h=l||s.relative[" "],c=l?1:0,d=ut((function(t){return t===e}),h,!0),u=ut((function(t){return a.call(e,t)>-1}),h,!0),p=[function(t,i,s){var o=!l&&(s||i!=n)||((e=i).nodeType?d(t,i,s):u(t,i,s));return e=null,o}];c<r;c++)if(i=s.relative[t[c].type])p=[ut(pt(p),i)];else{if((i=s.filter[t[c].type].apply(null,t[c].matches))[v]){for(o=++c;o<r&&!s.relative[t[o].type];o++);return gt(c>1&&pt(p),c>1&&dt(t.slice(0,c-1).concat({value:" "===t[c-2].type?"*":""})).replace(D,"$1"),i,c<o&&ft(t.slice(c,o)),o<r&&ft(t=t.slice(o)),o<r&&dt(t))}p.push(i)}return pt(p)}function vt(t,e){var i,o=[],r=[],a=S[t+" "];if(!a){for(e||(e=ct(t)),i=e.length;i--;)(a=ft(e[i]))[v]?o.push(a):r.push(a);a=S(t,function(t,e){var i=e.length>0,o=t.length>0,r=function(r,a,l,c,d){var p,m,g,v=0,b="0",w=r&&[],x=[],S=n,E=r||o&&s.find.TAG("*",d),_=y+=null==S?1:Math.random()||.1,C=E.length;for(d&&(n=a==h||a||d);b!==C&&null!=(p=E[b]);b++){if(o&&p){for(m=0,a||p.ownerDocument==h||(lt(p),l=!u);g=t[m++];)if(g(p,a||h,l)){f.call(c,p);break}d&&(y=_)}i&&((p=!g&&p)&&v--,r&&w.push(p))}if(v+=b,i&&b!==v){for(m=0;g=e[m++];)g(w,x,a,l);if(r){if(v>0)for(;b--;)w[b]||x[b]||(x[b]=T.call(c));x=mt(x)}f.apply(c,x),d&&!r&&x.length>0&&v+e.length>1&&k.uniqueSort(c)}return d&&(y=_,n=S),w};return i?et(r):r}(r,o)),a.selector=t}return a}function yt(t,e,i,o){var n,r,a,l,h,c="function"==typeof t&&t,d=!o&&ct(t=c.selector||t);if(i=i||[],1===d.length){if((r=d[0]=d[0].slice(0)).length>2&&"ID"===(a=r[0]).type&&9===e.nodeType&&u&&s.relative[r[1].type]){if(!(e=(s.find.ID(a.matches[0].replace(Q,Y),e)||[])[0]))return i;c&&(e=e.parentNode),t=t.slice(r.shift().value.length)}for(n=G.needsContext.test(t)?0:r.length;n--&&(a=r[n],!s.relative[l=a.type]);)if((h=s.find[l])&&(o=h(a.matches[0].replace(Q,Y),X.test(r[0].type)&&at(e.parentNode)||e))){if(r.splice(n,1),!(t=o.length&&dt(r)))return f.apply(i,o),i;break}}return(c||vt(t,d))(o,e,!u,i,!e||X.test(t)&&at(e.parentNode)||e),i}ht.prototype=s.filters=s.pseudos,s.setFilters=new ht,p.sortStable=v.split("").sort(R).join("")===v,lt(),p.sortDetached=it((function(t){return 1&t.compareDocumentPosition(h.createElement("fieldset"))})),k.find=J,k.expr[":"]=k.expr.pseudos,k.unique=k.uniqueSort,J.compile=vt,J.select=yt,J.setDocument=lt,J.tokenize=ct,J.escape=k.escapeSelector,J.getText=k.text,J.isXML=k.isXMLDoc,J.selectors=k.expr,J.support=k.support,J.uniqueSort=k.uniqueSort}();var L=function(t,e,i){for(var s=[],o=void 0!==i;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(o&&k(t).is(i))break;s.push(t)}return s},P=function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i},F=k.expr.match.needsContext,O=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function I(t,e,i){return m(e)?k.grep(t,(function(t,s){return!!e.call(t,s,t)!==i})):e.nodeType?k.grep(t,(function(t){return t===e!==i})):"string"!=typeof e?k.grep(t,(function(t){return a.call(e,t)>-1!==i})):k.filter(e,t,i)}k.filter=function(t,e,i){var s=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===s.nodeType?k.find.matchesSelector(s,t)?[s]:[]:k.find.matches(t,k.grep(e,(function(t){return 1===t.nodeType})))},k.fn.extend({find:function(t){var e,i,s=this.length,o=this;if("string"!=typeof t)return this.pushStack(k(t).filter((function(){for(e=0;e<s;e++)if(k.contains(o[e],this))return!0})));for(i=this.pushStack([]),e=0;e<s;e++)k.find(t,o[e],i);return s>1?k.uniqueSort(i):i},filter:function(t){return this.pushStack(I(this,t||[],!1))},not:function(t){return this.pushStack(I(this,t||[],!0))},is:function(t){return!!I(this,"string"==typeof t&&F.test(t)?k(t):t||[],!1).length}});var N,H=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(k.fn.init=function(t,e,i){var s,o;if(!t)return this;if(i=i||N,"string"==typeof t){if(!(s="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:H.exec(t))||!s[1]&&e)return!e||e.jquery?(e||i).find(t):this.constructor(e).find(t);if(s[1]){if(e=e instanceof k?e[0]:e,k.merge(this,k.parseHTML(s[1],e&&e.nodeType?e.ownerDocument||e:f,!0)),O.test(s[1])&&k.isPlainObject(e))for(s in e)m(this[s])?this[s](e[s]):this.attr(s,e[s]);return this}return(o=f.getElementById(s[2]))&&(this[0]=o,this.length=1),this}return t.nodeType?(this[0]=t,this.length=1,this):m(t)?void 0!==i.ready?i.ready(t):t(k):k.makeArray(t,this)}).prototype=k.fn,N=k(f);var z=/^(?:parents|prev(?:Until|All))/,V={children:!0,contents:!0,next:!0,prev:!0};function q(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}k.fn.extend({has:function(t){var e=k(t,this),i=e.length;return this.filter((function(){for(var t=0;t<i;t++)if(k.contains(this,e[t]))return!0}))},closest:function(t,e){var i,s=0,o=this.length,n=[],r="string"!=typeof t&&k(t);if(!F.test(t))for(;s<o;s++)for(i=this[s];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(r?r.index(i)>-1:1===i.nodeType&&k.find.matchesSelector(i,t))){n.push(i);break}return this.pushStack(n.length>1?k.uniqueSort(n):n)},index:function(t){return t?"string"==typeof t?a.call(k(t),this[0]):a.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(k.uniqueSort(k.merge(this.get(),k(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),k.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return L(t,"parentNode")},parentsUntil:function(t,e,i){return L(t,"parentNode",i)},next:function(t){return q(t,"nextSibling")},prev:function(t){return q(t,"previousSibling")},nextAll:function(t){return L(t,"nextSibling")},prevAll:function(t){return L(t,"previousSibling")},nextUntil:function(t,e,i){return L(t,"nextSibling",i)},prevUntil:function(t,e,i){return L(t,"previousSibling",i)},siblings:function(t){return P((t.parentNode||{}).firstChild,t)},children:function(t){return P(t.firstChild)},contents:function(t){return null!=t.contentDocument&&s(t.contentDocument)?t.contentDocument:(E(t,"template")&&(t=t.content||t),k.merge([],t.childNodes))}},(function(t,e){k.fn[t]=function(i,s){var o=k.map(this,e,i);return"Until"!==t.slice(-5)&&(s=i),s&&"string"==typeof s&&(o=k.filter(s,o)),this.length>1&&(V[t]||k.uniqueSort(o),z.test(t)&&o.reverse()),this.pushStack(o)}}));var G=/[^\x20\t\r\n\f]+/g;function U(t){return t}function W(t){throw t}function $(t,e,i,s){var o;try{t&&m(o=t.promise)?o.call(t).done(e).fail(i):t&&m(o=t.then)?o.call(t,e,i):e.apply(void 0,[t].slice(s))}catch(t){i.apply(void 0,[t])}}k.Callbacks=function(t){t="string"==typeof t?function(t){var e={};return k.each(t.match(G)||[],(function(t,i){e[i]=!0})),e}(t):k.extend({},t);var e,i,s,o,n=[],r=[],a=-1,l=function(){for(o=o||t.once,s=e=!0;r.length;a=-1)for(i=r.shift();++a<n.length;)!1===n[a].apply(i[0],i[1])&&t.stopOnFalse&&(a=n.length,i=!1);t.memory||(i=!1),e=!1,o&&(n=i?[]:"")},h={add:function(){return n&&(i&&!e&&(a=n.length-1,r.push(i)),function e(i){k.each(i,(function(i,s){m(s)?t.unique&&h.has(s)||n.push(s):s&&s.length&&"string"!==b(s)&&e(s)}))}(arguments),i&&!e&&l()),this},remove:function(){return k.each(arguments,(function(t,e){for(var i;(i=k.inArray(e,n,i))>-1;)n.splice(i,1),i<=a&&a--})),this},has:function(t){return t?k.inArray(t,n)>-1:n.length>0},empty:function(){return n&&(n=[]),this},disable:function(){return o=r=[],n=i="",this},disabled:function(){return!n},lock:function(){return o=r=[],i||e||(n=i=""),this},locked:function(){return!!o},fireWith:function(t,i){return o||(i=[t,(i=i||[]).slice?i.slice():i],r.push(i),e||l()),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!s}};return h},k.extend({Deferred:function(e){var i=[["notify","progress",k.Callbacks("memory"),k.Callbacks("memory"),2],["resolve","done",k.Callbacks("once memory"),k.Callbacks("once memory"),0,"resolved"],["reject","fail",k.Callbacks("once memory"),k.Callbacks("once memory"),1,"rejected"]],s="pending",o={state:function(){return s},always:function(){return n.done(arguments).fail(arguments),this},catch:function(t){return o.then(null,t)},pipe:function(){var t=arguments;return k.Deferred((function(e){k.each(i,(function(i,s){var o=m(t[s[4]])&&t[s[4]];n[s[1]]((function(){var t=o&&o.apply(this,arguments);t&&m(t.promise)?t.promise().progress(e.notify).done(e.resolve).fail(e.reject):e[s[0]+"With"](this,o?[t]:arguments)}))})),t=null})).promise()},then:function(e,s,o){var n=0;function r(e,i,s,o){return function(){var a=this,l=arguments,h=function(){var t,h;if(!(e<n)){if((t=s.apply(a,l))===i.promise())throw new TypeError("Thenable self-resolution");h=t&&("object"==typeof t||"function"==typeof t)&&t.then,m(h)?o?h.call(t,r(n,i,U,o),r(n,i,W,o)):(n++,h.call(t,r(n,i,U,o),r(n,i,W,o),r(n,i,U,i.notifyWith))):(s!==U&&(a=void 0,l=[t]),(o||i.resolveWith)(a,l))}},c=o?h:function(){try{h()}catch(t){k.Deferred.exceptionHook&&k.Deferred.exceptionHook(t,c.error),e+1>=n&&(s!==W&&(a=void 0,l=[t]),i.rejectWith(a,l))}};e?c():(k.Deferred.getErrorHook?c.error=k.Deferred.getErrorHook():k.Deferred.getStackHook&&(c.error=k.Deferred.getStackHook()),t.setTimeout(c))}}return k.Deferred((function(t){i[0][3].add(r(0,t,m(o)?o:U,t.notifyWith)),i[1][3].add(r(0,t,m(e)?e:U)),i[2][3].add(r(0,t,m(s)?s:W))})).promise()},promise:function(t){return null!=t?k.extend(t,o):o}},n={};return k.each(i,(function(t,e){var r=e[2],a=e[5];o[e[1]]=r.add,a&&r.add((function(){s=a}),i[3-t][2].disable,i[3-t][3].disable,i[0][2].lock,i[0][3].lock),r.add(e[3].fire),n[e[0]]=function(){return n[e[0]+"With"](this===n?void 0:this,arguments),this},n[e[0]+"With"]=r.fireWith})),o.promise(n),e&&e.call(n,n),n},when:function(t){var e=arguments.length,i=e,s=Array(i),n=o.call(arguments),r=k.Deferred(),a=function(t){return function(i){s[t]=this,n[t]=arguments.length>1?o.call(arguments):i,--e||r.resolveWith(s,n)}};if(e<=1&&($(t,r.done(a(i)).resolve,r.reject,!e),"pending"===r.state()||m(n[i]&&n[i].then)))return r.then();for(;i--;)$(n[i],a(i),r.reject);return r.promise()}});var X=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;k.Deferred.exceptionHook=function(e,i){t.console&&t.console.warn&&e&&X.test(e.name)&&t.console.warn("jQuery.Deferred exception: "+e.message,e.stack,i)},k.readyException=function(e){t.setTimeout((function(){throw e}))};var Q=k.Deferred();function Y(){f.removeEventListener("DOMContentLoaded",Y),t.removeEventListener("load",Y),k.ready()}k.fn.ready=function(t){return Q.then(t).catch((function(t){k.readyException(t)})),this},k.extend({isReady:!1,readyWait:1,ready:function(t){(!0===t?--k.readyWait:k.isReady)||(k.isReady=!0,!0!==t&&--k.readyWait>0||Q.resolveWith(f,[k]))}}),k.ready.then=Q.then,"complete"===f.readyState||"loading"!==f.readyState&&!f.documentElement.doScroll?t.setTimeout(k.ready):(f.addEventListener("DOMContentLoaded",Y),t.addEventListener("load",Y));var Z=function(t,e,i,s,o,n,r){var a=0,l=t.length,h=null==i;if("object"===b(i))for(a in o=!0,i)Z(t,e,a,i[a],!0,n,r);else if(void 0!==s&&(o=!0,m(s)||(r=!0),h&&(r?(e.call(t,s),e=null):(h=e,e=function(t,e,i){return h.call(k(t),i)})),e))for(;a<l;a++)e(t[a],i,r?s:s.call(t[a],a,e(t[a],i)));return o?t:h?e.call(t):l?e(t[0],i):n},K=/^-ms-/,J=/-([a-z])/g;function tt(t,e){return e.toUpperCase()}function et(t){return t.replace(K,"ms-").replace(J,tt)}var it=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType};function st(){this.expando=k.expando+st.uid++}st.uid=1,st.prototype={cache:function(t){var e=t[this.expando];return e||(e={},it(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,i){var s,o=this.cache(t);if("string"==typeof e)o[et(e)]=i;else for(s in e)o[et(s)]=e[s];return o},get:function(t,e){return void 0===e?this.cache(t):t[this.expando]&&t[this.expando][et(e)]},access:function(t,e,i){return void 0===e||e&&"string"==typeof e&&void 0===i?this.get(t,e):(this.set(t,e,i),void 0!==i?i:e)},remove:function(t,e){var i,s=t[this.expando];if(void 0!==s){if(void 0!==e){i=(e=Array.isArray(e)?e.map(et):(e=et(e))in s?[e]:e.match(G)||[]).length;for(;i--;)delete s[e[i]]}(void 0===e||k.isEmptyObject(s))&&(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){var e=t[this.expando];return void 0!==e&&!k.isEmptyObject(e)}};var ot=new st,nt=new st,rt=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,at=/[A-Z]/g;function lt(t,e,i){var s;if(void 0===i&&1===t.nodeType)if(s="data-"+e.replace(at,"-$&").toLowerCase(),"string"==typeof(i=t.getAttribute(s))){try{i=function(t){return"true"===t||"false"!==t&&("null"===t?null:t===+t+""?+t:rt.test(t)?JSON.parse(t):t)}(i)}catch(t){}nt.set(t,e,i)}else i=void 0;return i}k.extend({hasData:function(t){return nt.hasData(t)||ot.hasData(t)},data:function(t,e,i){return nt.access(t,e,i)},removeData:function(t,e){nt.remove(t,e)},_data:function(t,e,i){return ot.access(t,e,i)},_removeData:function(t,e){ot.remove(t,e)}}),k.fn.extend({data:function(t,e){var i,s,o,n=this[0],r=n&&n.attributes;if(void 0===t){if(this.length&&(o=nt.get(n),1===n.nodeType&&!ot.get(n,"hasDataAttrs"))){for(i=r.length;i--;)r[i]&&0===(s=r[i].name).indexOf("data-")&&(s=et(s.slice(5)),lt(n,s,o[s]));ot.set(n,"hasDataAttrs",!0)}return o}return"object"==typeof t?this.each((function(){nt.set(this,t)})):Z(this,(function(e){var i;if(n&&void 0===e)return void 0!==(i=nt.get(n,t))||void 0!==(i=lt(n,t))?i:void 0;this.each((function(){nt.set(this,t,e)}))}),null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each((function(){nt.remove(this,t)}))}}),k.extend({queue:function(t,e,i){var s;if(t)return e=(e||"fx")+"queue",s=ot.get(t,e),i&&(!s||Array.isArray(i)?s=ot.access(t,e,k.makeArray(i)):s.push(i)),s||[]},dequeue:function(t,e){e=e||"fx";var i=k.queue(t,e),s=i.length,o=i.shift(),n=k._queueHooks(t,e);"inprogress"===o&&(o=i.shift(),s--),o&&("fx"===e&&i.unshift("inprogress"),delete n.stop,o.call(t,(function(){k.dequeue(t,e)}),n)),!s&&n&&n.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return ot.get(t,i)||ot.access(t,i,{empty:k.Callbacks("once memory").add((function(){ot.remove(t,[e+"queue",i])}))})}}),k.fn.extend({queue:function(t,e){var i=2;return"string"!=typeof t&&(e=t,t="fx",i--),arguments.length<i?k.queue(this[0],t):void 0===e?this:this.each((function(){var i=k.queue(this,t,e);k._queueHooks(this,t),"fx"===t&&"inprogress"!==i[0]&&k.dequeue(this,t)}))},dequeue:function(t){return this.each((function(){k.dequeue(this,t)}))},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var i,s=1,o=k.Deferred(),n=this,r=this.length,a=function(){--s||o.resolveWith(n,[n])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";r--;)(i=ot.get(n[r],t+"queueHooks"))&&i.empty&&(s++,i.empty.add(a));return a(),o.promise(e)}});var ht=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ct=new RegExp("^(?:([+-])=|)("+ht+")([a-z%]*)$","i"),dt=["Top","Right","Bottom","Left"],ut=f.documentElement,pt=function(t){return k.contains(t.ownerDocument,t)},mt={composed:!0};ut.getRootNode&&(pt=function(t){return k.contains(t.ownerDocument,t)||t.getRootNode(mt)===t.ownerDocument});var gt=function(t,e){return"none"===(t=e||t).style.display||""===t.style.display&&pt(t)&&"none"===k.css(t,"display")};function ft(t,e,i,s){var o,n,r=20,a=s?function(){return s.cur()}:function(){return k.css(t,e,"")},l=a(),h=i&&i[3]||(k.cssNumber[e]?"":"px"),c=t.nodeType&&(k.cssNumber[e]||"px"!==h&&+l)&&ct.exec(k.css(t,e));if(c&&c[3]!==h){for(l/=2,h=h||c[3],c=+l||1;r--;)k.style(t,e,c+h),(1-n)*(1-(n=a()/l||.5))<=0&&(r=0),c/=n;c*=2,k.style(t,e,c+h),i=i||[]}return i&&(c=+c||+l||0,o=i[1]?c+(i[1]+1)*i[2]:+i[2],s&&(s.unit=h,s.start=c,s.end=o)),o}var vt={};function yt(t){var e,i=t.ownerDocument,s=t.nodeName,o=vt[s];return o||(e=i.body.appendChild(i.createElement(s)),o=k.css(e,"display"),e.parentNode.removeChild(e),"none"===o&&(o="block"),vt[s]=o,o)}function bt(t,e){for(var i,s,o=[],n=0,r=t.length;n<r;n++)(s=t[n]).style&&(i=s.style.display,e?("none"===i&&(o[n]=ot.get(s,"display")||null,o[n]||(s.style.display="")),""===s.style.display&&gt(s)&&(o[n]=yt(s))):"none"!==i&&(o[n]="none",ot.set(s,"display",i)));for(n=0;n<r;n++)null!=o[n]&&(t[n].style.display=o[n]);return t}k.fn.extend({show:function(){return bt(this,!0)},hide:function(){return bt(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each((function(){gt(this)?k(this).show():k(this).hide()}))}});var wt,xt,kt=/^(?:checkbox|radio)$/i,St=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Et=/^$|^module$|\/(?:java|ecma)script/i;wt=f.createDocumentFragment().appendChild(f.createElement("div")),(xt=f.createElement("input")).setAttribute("type","radio"),xt.setAttribute("checked","checked"),xt.setAttribute("name","t"),wt.appendChild(xt),p.checkClone=wt.cloneNode(!0).cloneNode(!0).lastChild.checked,wt.innerHTML="<textarea>x</textarea>",p.noCloneChecked=!!wt.cloneNode(!0).lastChild.defaultValue,wt.innerHTML="<option></option>",p.option=!!wt.lastChild;var Tt={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function _t(t,e){var i;return i=void 0!==t.getElementsByTagName?t.getElementsByTagName(e||"*"):void 0!==t.querySelectorAll?t.querySelectorAll(e||"*"):[],void 0===e||e&&E(t,e)?k.merge([t],i):i}function Ct(t,e){for(var i=0,s=t.length;i<s;i++)ot.set(t[i],"globalEval",!e||ot.get(e[i],"globalEval"))}Tt.tbody=Tt.tfoot=Tt.colgroup=Tt.caption=Tt.thead,Tt.th=Tt.td,p.option||(Tt.optgroup=Tt.option=[1,"<select multiple='multiple'>","</select>"]);var Bt=/<|&#?\w+;/;function Dt(t,e,i,s,o){for(var n,r,a,l,h,c,d=e.createDocumentFragment(),u=[],p=0,m=t.length;p<m;p++)if((n=t[p])||0===n)if("object"===b(n))k.merge(u,n.nodeType?[n]:n);else if(Bt.test(n)){for(r=r||d.appendChild(e.createElement("div")),a=(St.exec(n)||["",""])[1].toLowerCase(),l=Tt[a]||Tt._default,r.innerHTML=l[1]+k.htmlPrefilter(n)+l[2],c=l[0];c--;)r=r.lastChild;k.merge(u,r.childNodes),(r=d.firstChild).textContent=""}else u.push(e.createTextNode(n));for(d.textContent="",p=0;n=u[p++];)if(s&&k.inArray(n,s)>-1)o&&o.push(n);else if(h=pt(n),r=_t(d.appendChild(n),"script"),h&&Ct(r),i)for(c=0;n=r[c++];)Et.test(n.type||"")&&i.push(n);return d}var Mt=/^([^.]*)(?:\.(.+)|)/;function Rt(){return!0}function At(){return!1}function jt(t,e,i,s,o,n){var r,a;if("object"==typeof e){for(a in"string"!=typeof i&&(s=s||i,i=void 0),e)jt(t,a,i,s,e[a],n);return t}if(null==s&&null==o?(o=i,s=i=void 0):null==o&&("string"==typeof i?(o=s,s=void 0):(o=s,s=i,i=void 0)),!1===o)o=At;else if(!o)return t;return 1===n&&(r=o,o=function(t){return k().off(t),r.apply(this,arguments)},o.guid=r.guid||(r.guid=k.guid++)),t.each((function(){k.event.add(this,e,o,s,i)}))}function Lt(t,e,i){i?(ot.set(t,e,!1),k.event.add(t,e,{namespace:!1,handler:function(t){var i,s=ot.get(this,e);if(1&t.isTrigger&&this[e]){if(s)(k.event.special[e]||{}).delegateType&&t.stopPropagation();else if(s=o.call(arguments),ot.set(this,e,s),this[e](),i=ot.get(this,e),ot.set(this,e,!1),s!==i)return t.stopImmediatePropagation(),t.preventDefault(),i}else s&&(ot.set(this,e,k.event.trigger(s[0],s.slice(1),this)),t.stopPropagation(),t.isImmediatePropagationStopped=Rt)}})):void 0===ot.get(t,e)&&k.event.add(t,e,Rt)}k.event={global:{},add:function(t,e,i,s,o){var n,r,a,l,h,c,d,u,p,m,g,f=ot.get(t);if(it(t))for(i.handler&&(i=(n=i).handler,o=n.selector),o&&k.find.matchesSelector(ut,o),i.guid||(i.guid=k.guid++),(l=f.events)||(l=f.events=Object.create(null)),(r=f.handle)||(r=f.handle=function(e){return void 0!==k&&k.event.triggered!==e.type?k.event.dispatch.apply(t,arguments):void 0}),h=(e=(e||"").match(G)||[""]).length;h--;)p=g=(a=Mt.exec(e[h])||[])[1],m=(a[2]||"").split(".").sort(),p&&(d=k.event.special[p]||{},p=(o?d.delegateType:d.bindType)||p,d=k.event.special[p]||{},c=k.extend({type:p,origType:g,data:s,handler:i,guid:i.guid,selector:o,needsContext:o&&k.expr.match.needsContext.test(o),namespace:m.join(".")},n),(u=l[p])||((u=l[p]=[]).delegateCount=0,d.setup&&!1!==d.setup.call(t,s,m,r)||t.addEventListener&&t.addEventListener(p,r)),d.add&&(d.add.call(t,c),c.handler.guid||(c.handler.guid=i.guid)),o?u.splice(u.delegateCount++,0,c):u.push(c),k.event.global[p]=!0)},remove:function(t,e,i,s,o){var n,r,a,l,h,c,d,u,p,m,g,f=ot.hasData(t)&&ot.get(t);if(f&&(l=f.events)){for(h=(e=(e||"").match(G)||[""]).length;h--;)if(p=g=(a=Mt.exec(e[h])||[])[1],m=(a[2]||"").split(".").sort(),p){for(d=k.event.special[p]||{},u=l[p=(s?d.delegateType:d.bindType)||p]||[],a=a[2]&&new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"),r=n=u.length;n--;)c=u[n],!o&&g!==c.origType||i&&i.guid!==c.guid||a&&!a.test(c.namespace)||s&&s!==c.selector&&("**"!==s||!c.selector)||(u.splice(n,1),c.selector&&u.delegateCount--,d.remove&&d.remove.call(t,c));r&&!u.length&&(d.teardown&&!1!==d.teardown.call(t,m,f.handle)||k.removeEvent(t,p,f.handle),delete l[p])}else for(p in l)k.event.remove(t,p+e[h],i,s,!0);k.isEmptyObject(l)&&ot.remove(t,"handle events")}},dispatch:function(t){var e,i,s,o,n,r,a=new Array(arguments.length),l=k.event.fix(t),h=(ot.get(this,"events")||Object.create(null))[l.type]||[],c=k.event.special[l.type]||{};for(a[0]=l,e=1;e<arguments.length;e++)a[e]=arguments[e];if(l.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,l)){for(r=k.event.handlers.call(this,l,h),e=0;(o=r[e++])&&!l.isPropagationStopped();)for(l.currentTarget=o.elem,i=0;(n=o.handlers[i++])&&!l.isImmediatePropagationStopped();)l.rnamespace&&!1!==n.namespace&&!l.rnamespace.test(n.namespace)||(l.handleObj=n,l.data=n.data,void 0!==(s=((k.event.special[n.origType]||{}).handle||n.handler).apply(o.elem,a))&&!1===(l.result=s)&&(l.preventDefault(),l.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,l),l.result}},handlers:function(t,e){var i,s,o,n,r,a=[],l=e.delegateCount,h=t.target;if(l&&h.nodeType&&!("click"===t.type&&t.button>=1))for(;h!==this;h=h.parentNode||this)if(1===h.nodeType&&("click"!==t.type||!0!==h.disabled)){for(n=[],r={},i=0;i<l;i++)void 0===r[o=(s=e[i]).selector+" "]&&(r[o]=s.needsContext?k(o,this).index(h)>-1:k.find(o,this,null,[h]).length),r[o]&&n.push(s);n.length&&a.push({elem:h,handlers:n})}return h=this,l<e.length&&a.push({elem:h,handlers:e.slice(l)}),a},addProp:function(t,e){Object.defineProperty(k.Event.prototype,t,{enumerable:!0,configurable:!0,get:m(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(t){return t[k.expando]?t:new k.Event(t)},special:{load:{noBubble:!0},click:{setup:function(t){var e=this||t;return kt.test(e.type)&&e.click&&E(e,"input")&&Lt(e,"click",!0),!1},trigger:function(t){var e=this||t;return kt.test(e.type)&&e.click&&E(e,"input")&&Lt(e,"click"),!0},_default:function(t){var e=t.target;return kt.test(e.type)&&e.click&&E(e,"input")&&ot.get(e,"click")||E(e,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},k.removeEvent=function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i)},k.Event=function(t,e){if(!(this instanceof k.Event))return new k.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&!1===t.returnValue?Rt:At,this.target=t.target&&3===t.target.nodeType?t.target.parentNode:t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,e&&k.extend(this,e),this.timeStamp=t&&t.timeStamp||Date.now(),this[k.expando]=!0},k.Event.prototype={constructor:k.Event,isDefaultPrevented:At,isPropagationStopped:At,isImmediatePropagationStopped:At,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=Rt,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=Rt,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=Rt,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},k.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},k.event.addProp),k.each({focus:"focusin",blur:"focusout"},(function(t,e){function i(t){if(f.documentMode){var i=ot.get(this,"handle"),s=k.event.fix(t);s.type="focusin"===t.type?"focus":"blur",s.isSimulated=!0,i(t),s.target===s.currentTarget&&i(s)}else k.event.simulate(e,t.target,k.event.fix(t))}k.event.special[t]={setup:function(){var s;if(Lt(this,t,!0),!f.documentMode)return!1;(s=ot.get(this,e))||this.addEventListener(e,i),ot.set(this,e,(s||0)+1)},trigger:function(){return Lt(this,t),!0},teardown:function(){var t;if(!f.documentMode)return!1;(t=ot.get(this,e)-1)?ot.set(this,e,t):(this.removeEventListener(e,i),ot.remove(this,e))},_default:function(e){return ot.get(e.target,t)},delegateType:e},k.event.special[e]={setup:function(){var s=this.ownerDocument||this.document||this,o=f.documentMode?this:s,n=ot.get(o,e);n||(f.documentMode?this.addEventListener(e,i):s.addEventListener(t,i,!0)),ot.set(o,e,(n||0)+1)},teardown:function(){var s=this.ownerDocument||this.document||this,o=f.documentMode?this:s,n=ot.get(o,e)-1;n?ot.set(o,e,n):(f.documentMode?this.removeEventListener(e,i):s.removeEventListener(t,i,!0),ot.remove(o,e))}}})),k.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(t,e){k.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,s=t.relatedTarget,o=t.handleObj;return s&&(s===this||k.contains(this,s))||(t.type=o.origType,i=o.handler.apply(this,arguments),t.type=e),i}}})),k.fn.extend({on:function(t,e,i,s){return jt(this,t,e,i,s)},one:function(t,e,i,s){return jt(this,t,e,i,s,1)},off:function(t,e,i){var s,o;if(t&&t.preventDefault&&t.handleObj)return s=t.handleObj,k(t.delegateTarget).off(s.namespace?s.origType+"."+s.namespace:s.origType,s.selector,s.handler),this;if("object"==typeof t){for(o in t)this.off(o,e,t[o]);return this}return!1!==e&&"function"!=typeof e||(i=e,e=void 0),!1===i&&(i=At),this.each((function(){k.event.remove(this,t,i,e)}))}});var Pt=/<script|<style|<link/i,Ft=/checked\s*(?:[^=]|=\s*.checked.)/i,Ot=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function It(t,e){return E(t,"table")&&E(11!==e.nodeType?e:e.firstChild,"tr")&&k(t).children("tbody")[0]||t}function Nt(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function Ht(t){return"true/"===(t.type||"").slice(0,5)?t.type=t.type.slice(5):t.removeAttribute("type"),t}function zt(t,e){var i,s,o,n,r,a;if(1===e.nodeType){if(ot.hasData(t)&&(a=ot.get(t).events))for(o in ot.remove(e,"handle events"),a)for(i=0,s=a[o].length;i<s;i++)k.event.add(e,o,a[o][i]);nt.hasData(t)&&(n=nt.access(t),r=k.extend({},n),nt.set(e,r))}}function Vt(t,e){var i=e.nodeName.toLowerCase();"input"===i&&kt.test(t.type)?e.checked=t.checked:"input"!==i&&"textarea"!==i||(e.defaultValue=t.defaultValue)}function qt(t,e,i,s){e=n(e);var o,r,a,l,h,c,d=0,u=t.length,g=u-1,f=e[0],v=m(f);if(v||u>1&&"string"==typeof f&&!p.checkClone&&Ft.test(f))return t.each((function(o){var n=t.eq(o);v&&(e[0]=f.call(this,o,n.html())),qt(n,e,i,s)}));if(u&&(r=(o=Dt(e,t[0].ownerDocument,!1,t,s)).firstChild,1===o.childNodes.length&&(o=r),r||s)){for(l=(a=k.map(_t(o,"script"),Nt)).length;d<u;d++)h=o,d!==g&&(h=k.clone(h,!0,!0),l&&k.merge(a,_t(h,"script"))),i.call(t[d],h,d);if(l)for(c=a[a.length-1].ownerDocument,k.map(a,Ht),d=0;d<l;d++)h=a[d],Et.test(h.type||"")&&!ot.access(h,"globalEval")&&k.contains(c,h)&&(h.src&&"module"!==(h.type||"").toLowerCase()?k._evalUrl&&!h.noModule&&k._evalUrl(h.src,{nonce:h.nonce||h.getAttribute("nonce")},c):y(h.textContent.replace(Ot,""),h,c))}return t}function Gt(t,e,i){for(var s,o=e?k.filter(e,t):t,n=0;null!=(s=o[n]);n++)i||1!==s.nodeType||k.cleanData(_t(s)),s.parentNode&&(i&&pt(s)&&Ct(_t(s,"script")),s.parentNode.removeChild(s));return t}k.extend({htmlPrefilter:function(t){return t},clone:function(t,e,i){var s,o,n,r,a=t.cloneNode(!0),l=pt(t);if(!(p.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||k.isXMLDoc(t)))for(r=_t(a),s=0,o=(n=_t(t)).length;s<o;s++)Vt(n[s],r[s]);if(e)if(i)for(n=n||_t(t),r=r||_t(a),s=0,o=n.length;s<o;s++)zt(n[s],r[s]);else zt(t,a);return(r=_t(a,"script")).length>0&&Ct(r,!l&&_t(t,"script")),a},cleanData:function(t){for(var e,i,s,o=k.event.special,n=0;void 0!==(i=t[n]);n++)if(it(i)){if(e=i[ot.expando]){if(e.events)for(s in e.events)o[s]?k.event.remove(i,s):k.removeEvent(i,s,e.handle);i[ot.expando]=void 0}i[nt.expando]&&(i[nt.expando]=void 0)}}}),k.fn.extend({detach:function(t){return Gt(this,t,!0)},remove:function(t){return Gt(this,t)},text:function(t){return Z(this,(function(t){return void 0===t?k.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)}))}),null,t,arguments.length)},append:function(){return qt(this,arguments,(function(t){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||It(this,t).appendChild(t)}))},prepend:function(){return qt(this,arguments,(function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=It(this,t);e.insertBefore(t,e.firstChild)}}))},before:function(){return qt(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this)}))},after:function(){return qt(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)}))},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(k.cleanData(_t(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map((function(){return k.clone(this,t,e)}))},html:function(t){return Z(this,(function(t){var e=this[0]||{},i=0,s=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!Pt.test(t)&&!Tt[(St.exec(t)||["",""])[1].toLowerCase()]){t=k.htmlPrefilter(t);try{for(;i<s;i++)1===(e=this[i]||{}).nodeType&&(k.cleanData(_t(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)}),null,t,arguments.length)},replaceWith:function(){var t=[];return qt(this,arguments,(function(e){var i=this.parentNode;k.inArray(this,t)<0&&(k.cleanData(_t(this)),i&&i.replaceChild(e,this))}),t)}}),k.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(t,e){k.fn[t]=function(t){for(var i,s=[],o=k(t),n=o.length-1,a=0;a<=n;a++)i=a===n?this:this.clone(!0),k(o[a])[e](i),r.apply(s,i.get());return this.pushStack(s)}}));var Ut=new RegExp("^("+ht+")(?!px)[a-z%]+$","i"),Wt=/^--/,$t=function(e){var i=e.ownerDocument.defaultView;return i&&i.opener||(i=t),i.getComputedStyle(e)},Xt=function(t,e,i){var s,o,n={};for(o in e)n[o]=t.style[o],t.style[o]=e[o];for(o in s=i.call(t),e)t.style[o]=n[o];return s},Qt=new RegExp(dt.join("|"),"i");function Yt(t,e,i){var s,o,n,r,a=Wt.test(e),l=t.style;return(i=i||$t(t))&&(r=i.getPropertyValue(e)||i[e],a&&r&&(r=r.replace(D,"$1")||void 0),""!==r||pt(t)||(r=k.style(t,e)),!p.pixelBoxStyles()&&Ut.test(r)&&Qt.test(e)&&(s=l.width,o=l.minWidth,n=l.maxWidth,l.minWidth=l.maxWidth=l.width=r,r=i.width,l.width=s,l.minWidth=o,l.maxWidth=n)),void 0!==r?r+"":r}function Zt(t,e){return{get:function(){if(!t())return(this.get=e).apply(this,arguments);delete this.get}}}!function(){function e(){if(c){h.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",c.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",ut.appendChild(h).appendChild(c);var e=t.getComputedStyle(c);s="1%"!==e.top,l=12===i(e.marginLeft),c.style.right="60%",r=36===i(e.right),o=36===i(e.width),c.style.position="absolute",n=12===i(c.offsetWidth/3),ut.removeChild(h),c=null}}function i(t){return Math.round(parseFloat(t))}var s,o,n,r,a,l,h=f.createElement("div"),c=f.createElement("div");c.style&&(c.style.backgroundClip="content-box",c.cloneNode(!0).style.backgroundClip="",p.clearCloneStyle="content-box"===c.style.backgroundClip,k.extend(p,{boxSizingReliable:function(){return e(),o},pixelBoxStyles:function(){return e(),r},pixelPosition:function(){return e(),s},reliableMarginLeft:function(){return e(),l},scrollboxSize:function(){return e(),n},reliableTrDimensions:function(){var e,i,s,o;return null==a&&(e=f.createElement("table"),i=f.createElement("tr"),s=f.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",i.style.cssText="box-sizing:content-box;border:1px solid",i.style.height="1px",s.style.height="9px",s.style.display="block",ut.appendChild(e).appendChild(i).appendChild(s),o=t.getComputedStyle(i),a=parseInt(o.height,10)+parseInt(o.borderTopWidth,10)+parseInt(o.borderBottomWidth,10)===i.offsetHeight,ut.removeChild(e)),a}}))}();var Kt=["Webkit","Moz","ms"],Jt=f.createElement("div").style,te={};function ee(t){var e=k.cssProps[t]||te[t];return e||(t in Jt?t:te[t]=function(t){for(var e=t[0].toUpperCase()+t.slice(1),i=Kt.length;i--;)if((t=Kt[i]+e)in Jt)return t}(t)||t)}var ie=/^(none|table(?!-c[ea]).+)/,se={position:"absolute",visibility:"hidden",display:"block"},oe={letterSpacing:"0",fontWeight:"400"};function ne(t,e,i){var s=ct.exec(e);return s?Math.max(0,s[2]-(i||0))+(s[3]||"px"):e}function re(t,e,i,s,o,n){var r="width"===e?1:0,a=0,l=0,h=0;if(i===(s?"border":"content"))return 0;for(;r<4;r+=2)"margin"===i&&(h+=k.css(t,i+dt[r],!0,o)),s?("content"===i&&(l-=k.css(t,"padding"+dt[r],!0,o)),"margin"!==i&&(l-=k.css(t,"border"+dt[r]+"Width",!0,o))):(l+=k.css(t,"padding"+dt[r],!0,o),"padding"!==i?l+=k.css(t,"border"+dt[r]+"Width",!0,o):a+=k.css(t,"border"+dt[r]+"Width",!0,o));return!s&&n>=0&&(l+=Math.max(0,Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-n-l-a-.5))||0),l+h}function ae(t,e,i){var s=$t(t),o=(!p.boxSizingReliable()||i)&&"border-box"===k.css(t,"boxSizing",!1,s),n=o,r=Yt(t,e,s),a="offset"+e[0].toUpperCase()+e.slice(1);if(Ut.test(r)){if(!i)return r;r="auto"}return(!p.boxSizingReliable()&&o||!p.reliableTrDimensions()&&E(t,"tr")||"auto"===r||!parseFloat(r)&&"inline"===k.css(t,"display",!1,s))&&t.getClientRects().length&&(o="border-box"===k.css(t,"boxSizing",!1,s),(n=a in t)&&(r=t[a])),(r=parseFloat(r)||0)+re(t,e,i||(o?"border":"content"),n,s,r)+"px"}function le(t,e,i,s,o){return new le.prototype.init(t,e,i,s,o)}k.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=Yt(t,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(t,e,i,s){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var o,n,r,a=et(e),l=Wt.test(e),h=t.style;if(l||(e=ee(a)),r=k.cssHooks[e]||k.cssHooks[a],void 0===i)return r&&"get"in r&&void 0!==(o=r.get(t,!1,s))?o:h[e];"string"==(n=typeof i)&&(o=ct.exec(i))&&o[1]&&(i=ft(t,e,o),n="number"),null!=i&&i==i&&("number"!==n||l||(i+=o&&o[3]||(k.cssNumber[a]?"":"px")),p.clearCloneStyle||""!==i||0!==e.indexOf("background")||(h[e]="inherit"),r&&"set"in r&&void 0===(i=r.set(t,i,s))||(l?h.setProperty(e,i):h[e]=i))}},css:function(t,e,i,s){var o,n,r,a=et(e);return Wt.test(e)||(e=ee(a)),(r=k.cssHooks[e]||k.cssHooks[a])&&"get"in r&&(o=r.get(t,!0,i)),void 0===o&&(o=Yt(t,e,s)),"normal"===o&&e in oe&&(o=oe[e]),""===i||i?(n=parseFloat(o),!0===i||isFinite(n)?n||0:o):o}}),k.each(["height","width"],(function(t,e){k.cssHooks[e]={get:function(t,i,s){if(i)return!ie.test(k.css(t,"display"))||t.getClientRects().length&&t.getBoundingClientRect().width?ae(t,e,s):Xt(t,se,(function(){return ae(t,e,s)}))},set:function(t,i,s){var o,n=$t(t),r=!p.scrollboxSize()&&"absolute"===n.position,a=(r||s)&&"border-box"===k.css(t,"boxSizing",!1,n),l=s?re(t,e,s,a,n):0;return a&&r&&(l-=Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-parseFloat(n[e])-re(t,e,"border",!1,n)-.5)),l&&(o=ct.exec(i))&&"px"!==(o[3]||"px")&&(t.style[e]=i,i=k.css(t,e)),ne(0,i,l)}}})),k.cssHooks.marginLeft=Zt(p.reliableMarginLeft,(function(t,e){if(e)return(parseFloat(Yt(t,"marginLeft"))||t.getBoundingClientRect().left-Xt(t,{marginLeft:0},(function(){return t.getBoundingClientRect().left})))+"px"})),k.each({margin:"",padding:"",border:"Width"},(function(t,e){k.cssHooks[t+e]={expand:function(i){for(var s=0,o={},n="string"==typeof i?i.split(" "):[i];s<4;s++)o[t+dt[s]+e]=n[s]||n[s-2]||n[0];return o}},"margin"!==t&&(k.cssHooks[t+e].set=ne)})),k.fn.extend({css:function(t,e){return Z(this,(function(t,e,i){var s,o,n={},r=0;if(Array.isArray(e)){for(s=$t(t),o=e.length;r<o;r++)n[e[r]]=k.css(t,e[r],!1,s);return n}return void 0!==i?k.style(t,e,i):k.css(t,e)}),t,e,arguments.length>1)}}),k.Tween=le,le.prototype={constructor:le,init:function(t,e,i,s,o,n){this.elem=t,this.prop=i,this.easing=o||k.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=s,this.unit=n||(k.cssNumber[i]?"":"px")},cur:function(){var t=le.propHooks[this.prop];return t&&t.get?t.get(this):le.propHooks._default.get(this)},run:function(t){var e,i=le.propHooks[this.prop];return this.options.duration?this.pos=e=k.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):le.propHooks._default.set(this),this}},le.prototype.init.prototype=le.prototype,le.propHooks={_default:{get:function(t){var e;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(e=k.css(t.elem,t.prop,""))&&"auto"!==e?e:0},set:function(t){k.fx.step[t.prop]?k.fx.step[t.prop](t):1!==t.elem.nodeType||!k.cssHooks[t.prop]&&null==t.elem.style[ee(t.prop)]?t.elem[t.prop]=t.now:k.style(t.elem,t.prop,t.now+t.unit)}}},le.propHooks.scrollTop=le.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},k.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},k.fx=le.prototype.init,k.fx.step={};var he,ce,de=/^(?:toggle|show|hide)$/,ue=/queueHooks$/;function pe(){ce&&(!1===f.hidden&&t.requestAnimationFrame?t.requestAnimationFrame(pe):t.setTimeout(pe,k.fx.interval),k.fx.tick())}function me(){return t.setTimeout((function(){he=void 0})),he=Date.now()}function ge(t,e){var i,s=0,o={height:t};for(e=e?1:0;s<4;s+=2-e)o["margin"+(i=dt[s])]=o["padding"+i]=t;return e&&(o.opacity=o.width=t),o}function fe(t,e,i){for(var s,o=(ve.tweeners[e]||[]).concat(ve.tweeners["*"]),n=0,r=o.length;n<r;n++)if(s=o[n].call(i,e,t))return s}function ve(t,e,i){var s,o,n=0,r=ve.prefilters.length,a=k.Deferred().always((function(){delete l.elem})),l=function(){if(o)return!1;for(var e=he||me(),i=Math.max(0,h.startTime+h.duration-e),s=1-(i/h.duration||0),n=0,r=h.tweens.length;n<r;n++)h.tweens[n].run(s);return a.notifyWith(t,[h,s,i]),s<1&&r?i:(r||a.notifyWith(t,[h,1,0]),a.resolveWith(t,[h]),!1)},h=a.promise({elem:t,props:k.extend({},e),opts:k.extend(!0,{specialEasing:{},easing:k.easing._default},i),originalProperties:e,originalOptions:i,startTime:he||me(),duration:i.duration,tweens:[],createTween:function(e,i){var s=k.Tween(t,h.opts,e,i,h.opts.specialEasing[e]||h.opts.easing);return h.tweens.push(s),s},stop:function(e){var i=0,s=e?h.tweens.length:0;if(o)return this;for(o=!0;i<s;i++)h.tweens[i].run(1);return e?(a.notifyWith(t,[h,1,0]),a.resolveWith(t,[h,e])):a.rejectWith(t,[h,e]),this}}),c=h.props;for(function(t,e){var i,s,o,n,r;for(i in t)if(o=e[s=et(i)],n=t[i],Array.isArray(n)&&(o=n[1],n=t[i]=n[0]),i!==s&&(t[s]=n,delete t[i]),(r=k.cssHooks[s])&&"expand"in r)for(i in n=r.expand(n),delete t[s],n)i in t||(t[i]=n[i],e[i]=o);else e[s]=o}(c,h.opts.specialEasing);n<r;n++)if(s=ve.prefilters[n].call(h,t,c,h.opts))return m(s.stop)&&(k._queueHooks(h.elem,h.opts.queue).stop=s.stop.bind(s)),s;return k.map(c,fe,h),m(h.opts.start)&&h.opts.start.call(t,h),h.progress(h.opts.progress).done(h.opts.done,h.opts.complete).fail(h.opts.fail).always(h.opts.always),k.fx.timer(k.extend(l,{elem:t,anim:h,queue:h.opts.queue})),h}k.Animation=k.extend(ve,{tweeners:{"*":[function(t,e){var i=this.createTween(t,e);return ft(i.elem,t,ct.exec(e),i),i}]},tweener:function(t,e){m(t)?(e=t,t=["*"]):t=t.match(G);for(var i,s=0,o=t.length;s<o;s++)i=t[s],ve.tweeners[i]=ve.tweeners[i]||[],ve.tweeners[i].unshift(e)},prefilters:[function(t,e,i){var s,o,n,r,a,l,h,c,d="width"in e||"height"in e,u=this,p={},m=t.style,g=t.nodeType&&gt(t),f=ot.get(t,"fxshow");for(s in i.queue||(null==(r=k._queueHooks(t,"fx")).unqueued&&(r.unqueued=0,a=r.empty.fire,r.empty.fire=function(){r.unqueued||a()}),r.unqueued++,u.always((function(){u.always((function(){r.unqueued--,k.queue(t,"fx").length||r.empty.fire()}))}))),e)if(o=e[s],de.test(o)){if(delete e[s],n=n||"toggle"===o,o===(g?"hide":"show")){if("show"!==o||!f||void 0===f[s])continue;g=!0}p[s]=f&&f[s]||k.style(t,s)}if((l=!k.isEmptyObject(e))||!k.isEmptyObject(p))for(s in d&&1===t.nodeType&&(i.overflow=[m.overflow,m.overflowX,m.overflowY],null==(h=f&&f.display)&&(h=ot.get(t,"display")),"none"===(c=k.css(t,"display"))&&(h?c=h:(bt([t],!0),h=t.style.display||h,c=k.css(t,"display"),bt([t]))),("inline"===c||"inline-block"===c&&null!=h)&&"none"===k.css(t,"float")&&(l||(u.done((function(){m.display=h})),null==h&&(c=m.display,h="none"===c?"":c)),m.display="inline-block")),i.overflow&&(m.overflow="hidden",u.always((function(){m.overflow=i.overflow[0],m.overflowX=i.overflow[1],m.overflowY=i.overflow[2]}))),l=!1,p)l||(f?"hidden"in f&&(g=f.hidden):f=ot.access(t,"fxshow",{display:h}),n&&(f.hidden=!g),g&&bt([t],!0),u.done((function(){for(s in g||bt([t]),ot.remove(t,"fxshow"),p)k.style(t,s,p[s])}))),l=fe(g?f[s]:0,s,u),s in f||(f[s]=l.start,g&&(l.end=l.start,l.start=0))}],prefilter:function(t,e){e?ve.prefilters.unshift(t):ve.prefilters.push(t)}}),k.speed=function(t,e,i){var s=t&&"object"==typeof t?k.extend({},t):{complete:i||!i&&e||m(t)&&t,duration:t,easing:i&&e||e&&!m(e)&&e};return k.fx.off?s.duration=0:"number"!=typeof s.duration&&(s.duration in k.fx.speeds?s.duration=k.fx.speeds[s.duration]:s.duration=k.fx.speeds._default),null!=s.queue&&!0!==s.queue||(s.queue="fx"),s.old=s.complete,s.complete=function(){m(s.old)&&s.old.call(this),s.queue&&k.dequeue(this,s.queue)},s},k.fn.extend({fadeTo:function(t,e,i,s){return this.filter(gt).css("opacity",0).show().end().animate({opacity:e},t,i,s)},animate:function(t,e,i,s){var o=k.isEmptyObject(t),n=k.speed(e,i,s),r=function(){var e=ve(this,k.extend({},t),n);(o||ot.get(this,"finish"))&&e.stop(!0)};return r.finish=r,o||!1===n.queue?this.each(r):this.queue(n.queue,r)},stop:function(t,e,i){var s=function(t){var e=t.stop;delete t.stop,e(i)};return"string"!=typeof t&&(i=e,e=t,t=void 0),e&&this.queue(t||"fx",[]),this.each((function(){var e=!0,o=null!=t&&t+"queueHooks",n=k.timers,r=ot.get(this);if(o)r[o]&&r[o].stop&&s(r[o]);else for(o in r)r[o]&&r[o].stop&&ue.test(o)&&s(r[o]);for(o=n.length;o--;)n[o].elem!==this||null!=t&&n[o].queue!==t||(n[o].anim.stop(i),e=!1,n.splice(o,1));!e&&i||k.dequeue(this,t)}))},finish:function(t){return!1!==t&&(t=t||"fx"),this.each((function(){var e,i=ot.get(this),s=i[t+"queue"],o=i[t+"queueHooks"],n=k.timers,r=s?s.length:0;for(i.finish=!0,k.queue(this,t,[]),o&&o.stop&&o.stop.call(this,!0),e=n.length;e--;)n[e].elem===this&&n[e].queue===t&&(n[e].anim.stop(!0),n.splice(e,1));for(e=0;e<r;e++)s[e]&&s[e].finish&&s[e].finish.call(this);delete i.finish}))}}),k.each(["toggle","show","hide"],(function(t,e){var i=k.fn[e];k.fn[e]=function(t,s,o){return null==t||"boolean"==typeof t?i.apply(this,arguments):this.animate(ge(e,!0),t,s,o)}})),k.each({slideDown:ge("show"),slideUp:ge("hide"),slideToggle:ge("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(t,e){k.fn[t]=function(t,i,s){return this.animate(e,t,i,s)}})),k.timers=[],k.fx.tick=function(){var t,e=0,i=k.timers;for(he=Date.now();e<i.length;e++)(t=i[e])()||i[e]!==t||i.splice(e--,1);i.length||k.fx.stop(),he=void 0},k.fx.timer=function(t){k.timers.push(t),k.fx.start()},k.fx.interval=13,k.fx.start=function(){ce||(ce=!0,pe())},k.fx.stop=function(){ce=null},k.fx.speeds={slow:600,fast:200,_default:400},k.fn.delay=function(e,i){return e=k.fx&&k.fx.speeds[e]||e,i=i||"fx",this.queue(i,(function(i,s){var o=t.setTimeout(i,e);s.stop=function(){t.clearTimeout(o)}}))},function(){var t=f.createElement("input"),e=f.createElement("select").appendChild(f.createElement("option"));t.type="checkbox",p.checkOn=""!==t.value,p.optSelected=e.selected,(t=f.createElement("input")).value="t",t.type="radio",p.radioValue="t"===t.value}();var ye,be=k.expr.attrHandle;k.fn.extend({attr:function(t,e){return Z(this,k.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each((function(){k.removeAttr(this,t)}))}}),k.extend({attr:function(t,e,i){var s,o,n=t.nodeType;if(3!==n&&8!==n&&2!==n)return void 0===t.getAttribute?k.prop(t,e,i):(1===n&&k.isXMLDoc(t)||(o=k.attrHooks[e.toLowerCase()]||(k.expr.match.bool.test(e)?ye:void 0)),void 0!==i?null===i?void k.removeAttr(t,e):o&&"set"in o&&void 0!==(s=o.set(t,i,e))?s:(t.setAttribute(e,i+""),i):o&&"get"in o&&null!==(s=o.get(t,e))?s:null==(s=k.find.attr(t,e))?void 0:s)},attrHooks:{type:{set:function(t,e){if(!p.radioValue&&"radio"===e&&E(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}},removeAttr:function(t,e){var i,s=0,o=e&&e.match(G);if(o&&1===t.nodeType)for(;i=o[s++];)t.removeAttribute(i)}}),ye={set:function(t,e,i){return!1===e?k.removeAttr(t,i):t.setAttribute(i,i),i}},k.each(k.expr.match.bool.source.match(/\w+/g),(function(t,e){var i=be[e]||k.find.attr;be[e]=function(t,e,s){var o,n,r=e.toLowerCase();return s||(n=be[r],be[r]=o,o=null!=i(t,e,s)?r:null,be[r]=n),o}}));var we=/^(?:input|select|textarea|button)$/i,xe=/^(?:a|area)$/i;function ke(t){return(t.match(G)||[]).join(" ")}function Se(t){return t.getAttribute&&t.getAttribute("class")||""}function Ee(t){return Array.isArray(t)?t:"string"==typeof t&&t.match(G)||[]}k.fn.extend({prop:function(t,e){return Z(this,k.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each((function(){delete this[k.propFix[t]||t]}))}}),k.extend({prop:function(t,e,i){var s,o,n=t.nodeType;if(3!==n&&8!==n&&2!==n)return 1===n&&k.isXMLDoc(t)||(e=k.propFix[e]||e,o=k.propHooks[e]),void 0!==i?o&&"set"in o&&void 0!==(s=o.set(t,i,e))?s:t[e]=i:o&&"get"in o&&null!==(s=o.get(t,e))?s:t[e]},propHooks:{tabIndex:{get:function(t){var e=k.find.attr(t,"tabindex");return e?parseInt(e,10):we.test(t.nodeName)||xe.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),p.optSelected||(k.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(t){var e=t.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),k.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){k.propFix[this.toLowerCase()]=this})),k.fn.extend({addClass:function(t){var e,i,s,o,n,r;return m(t)?this.each((function(e){k(this).addClass(t.call(this,e,Se(this)))})):(e=Ee(t)).length?this.each((function(){if(s=Se(this),i=1===this.nodeType&&" "+ke(s)+" "){for(n=0;n<e.length;n++)o=e[n],i.indexOf(" "+o+" ")<0&&(i+=o+" ");r=ke(i),s!==r&&this.setAttribute("class",r)}})):this},removeClass:function(t){var e,i,s,o,n,r;return m(t)?this.each((function(e){k(this).removeClass(t.call(this,e,Se(this)))})):arguments.length?(e=Ee(t)).length?this.each((function(){if(s=Se(this),i=1===this.nodeType&&" "+ke(s)+" "){for(n=0;n<e.length;n++)for(o=e[n];i.indexOf(" "+o+" ")>-1;)i=i.replace(" "+o+" "," ");r=ke(i),s!==r&&this.setAttribute("class",r)}})):this:this.attr("class","")},toggleClass:function(t,e){var i,s,o,n,r=typeof t,a="string"===r||Array.isArray(t);return m(t)?this.each((function(i){k(this).toggleClass(t.call(this,i,Se(this),e),e)})):"boolean"==typeof e&&a?e?this.addClass(t):this.removeClass(t):(i=Ee(t),this.each((function(){if(a)for(n=k(this),o=0;o<i.length;o++)s=i[o],n.hasClass(s)?n.removeClass(s):n.addClass(s);else void 0!==t&&"boolean"!==r||((s=Se(this))&&ot.set(this,"__className__",s),this.setAttribute&&this.setAttribute("class",s||!1===t?"":ot.get(this,"__className__")||""))})))},hasClass:function(t){var e,i,s=0;for(e=" "+t+" ";i=this[s++];)if(1===i.nodeType&&(" "+ke(Se(i))+" ").indexOf(e)>-1)return!0;return!1}});var Te=/\r/g;k.fn.extend({val:function(t){var e,i,s,o=this[0];return arguments.length?(s=m(t),this.each((function(i){var o;1===this.nodeType&&(null==(o=s?t.call(this,i,k(this).val()):t)?o="":"number"==typeof o?o+="":Array.isArray(o)&&(o=k.map(o,(function(t){return null==t?"":t+""}))),(e=k.valHooks[this.type]||k.valHooks[this.nodeName.toLowerCase()])&&"set"in e&&void 0!==e.set(this,o,"value")||(this.value=o))}))):o?(e=k.valHooks[o.type]||k.valHooks[o.nodeName.toLowerCase()])&&"get"in e&&void 0!==(i=e.get(o,"value"))?i:"string"==typeof(i=o.value)?i.replace(Te,""):null==i?"":i:void 0}}),k.extend({valHooks:{option:{get:function(t){var e=k.find.attr(t,"value");return null!=e?e:ke(k.text(t))}},select:{get:function(t){var e,i,s,o=t.options,n=t.selectedIndex,r="select-one"===t.type,a=r?null:[],l=r?n+1:o.length;for(s=n<0?l:r?n:0;s<l;s++)if(((i=o[s]).selected||s===n)&&!i.disabled&&(!i.parentNode.disabled||!E(i.parentNode,"optgroup"))){if(e=k(i).val(),r)return e;a.push(e)}return a},set:function(t,e){for(var i,s,o=t.options,n=k.makeArray(e),r=o.length;r--;)((s=o[r]).selected=k.inArray(k.valHooks.option.get(s),n)>-1)&&(i=!0);return i||(t.selectedIndex=-1),n}}}}),k.each(["radio","checkbox"],(function(){k.valHooks[this]={set:function(t,e){if(Array.isArray(e))return t.checked=k.inArray(k(t).val(),e)>-1}},p.checkOn||(k.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})}));var _e=t.location,Ce={guid:Date.now()},Be=/\?/;k.parseXML=function(e){var i,s;if(!e||"string"!=typeof e)return null;try{i=(new t.DOMParser).parseFromString(e,"text/xml")}catch(t){}return s=i&&i.getElementsByTagName("parsererror")[0],i&&!s||k.error("Invalid XML: "+(s?k.map(s.childNodes,(function(t){return t.textContent})).join("\n"):e)),i};var De=/^(?:focusinfocus|focusoutblur)$/,Me=function(t){t.stopPropagation()};k.extend(k.event,{trigger:function(e,i,s,o){var n,r,a,l,h,d,u,p,v=[s||f],y=c.call(e,"type")?e.type:e,b=c.call(e,"namespace")?e.namespace.split("."):[];if(r=p=a=s=s||f,3!==s.nodeType&&8!==s.nodeType&&!De.test(y+k.event.triggered)&&(y.indexOf(".")>-1&&(b=y.split("."),y=b.shift(),b.sort()),h=y.indexOf(":")<0&&"on"+y,(e=e[k.expando]?e:new k.Event(y,"object"==typeof e&&e)).isTrigger=o?2:3,e.namespace=b.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+b.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=s),i=null==i?[e]:k.makeArray(i,[e]),u=k.event.special[y]||{},o||!u.trigger||!1!==u.trigger.apply(s,i))){if(!o&&!u.noBubble&&!g(s)){for(l=u.delegateType||y,De.test(l+y)||(r=r.parentNode);r;r=r.parentNode)v.push(r),a=r;a===(s.ownerDocument||f)&&v.push(a.defaultView||a.parentWindow||t)}for(n=0;(r=v[n++])&&!e.isPropagationStopped();)p=r,e.type=n>1?l:u.bindType||y,(d=(ot.get(r,"events")||Object.create(null))[e.type]&&ot.get(r,"handle"))&&d.apply(r,i),(d=h&&r[h])&&d.apply&&it(r)&&(e.result=d.apply(r,i),!1===e.result&&e.preventDefault());return e.type=y,o||e.isDefaultPrevented()||u._default&&!1!==u._default.apply(v.pop(),i)||!it(s)||h&&m(s[y])&&!g(s)&&((a=s[h])&&(s[h]=null),k.event.triggered=y,e.isPropagationStopped()&&p.addEventListener(y,Me),s[y](),e.isPropagationStopped()&&p.removeEventListener(y,Me),k.event.triggered=void 0,a&&(s[h]=a)),e.result}},simulate:function(t,e,i){var s=k.extend(new k.Event,i,{type:t,isSimulated:!0});k.event.trigger(s,null,e)}}),k.fn.extend({trigger:function(t,e){return this.each((function(){k.event.trigger(t,e,this)}))},triggerHandler:function(t,e){var i=this[0];if(i)return k.event.trigger(t,e,i,!0)}});var Re=/\[\]$/,Ae=/\r?\n/g,je=/^(?:submit|button|image|reset|file)$/i,Le=/^(?:input|select|textarea|keygen)/i;function Pe(t,e,i,s){var o;if(Array.isArray(e))k.each(e,(function(e,o){i||Re.test(t)?s(t,o):Pe(t+"["+("object"==typeof o&&null!=o?e:"")+"]",o,i,s)}));else if(i||"object"!==b(e))s(t,e);else for(o in e)Pe(t+"["+o+"]",e[o],i,s)}k.param=function(t,e){var i,s=[],o=function(t,e){var i=m(e)?e():e;s[s.length]=encodeURIComponent(t)+"="+encodeURIComponent(null==i?"":i)};if(null==t)return"";if(Array.isArray(t)||t.jquery&&!k.isPlainObject(t))k.each(t,(function(){o(this.name,this.value)}));else for(i in t)Pe(i,t[i],e,o);return s.join("&")},k.fn.extend({serialize:function(){return k.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var t=k.prop(this,"elements");return t?k.makeArray(t):this})).filter((function(){var t=this.type;return this.name&&!k(this).is(":disabled")&&Le.test(this.nodeName)&&!je.test(t)&&(this.checked||!kt.test(t))})).map((function(t,e){var i=k(this).val();return null==i?null:Array.isArray(i)?k.map(i,(function(t){return{name:e.name,value:t.replace(Ae,"\r\n")}})):{name:e.name,value:i.replace(Ae,"\r\n")}})).get()}});var Fe=/%20/g,Oe=/#.*$/,Ie=/([?&])_=[^&]*/,Ne=/^(.*?):[ \t]*([^\r\n]*)$/gm,He=/^(?:GET|HEAD)$/,ze=/^\/\//,Ve={},qe={},Ge="*/".concat("*"),Ue=f.createElement("a");function We(t){return function(e,i){"string"!=typeof e&&(i=e,e="*");var s,o=0,n=e.toLowerCase().match(G)||[];if(m(i))for(;s=n[o++];)"+"===s[0]?(s=s.slice(1)||"*",(t[s]=t[s]||[]).unshift(i)):(t[s]=t[s]||[]).push(i)}}function $e(t,e,i,s){var o={},n=t===qe;function r(a){var l;return o[a]=!0,k.each(t[a]||[],(function(t,a){var h=a(e,i,s);return"string"!=typeof h||n||o[h]?n?!(l=h):void 0:(e.dataTypes.unshift(h),r(h),!1)})),l}return r(e.dataTypes[0])||!o["*"]&&r("*")}function Xe(t,e){var i,s,o=k.ajaxSettings.flatOptions||{};for(i in e)void 0!==e[i]&&((o[i]?t:s||(s={}))[i]=e[i]);return s&&k.extend(!0,t,s),t}Ue.href=_e.href,k.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:_e.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(_e.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Ge,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":k.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?Xe(Xe(t,k.ajaxSettings),e):Xe(k.ajaxSettings,t)},ajaxPrefilter:We(Ve),ajaxTransport:We(qe),ajax:function(e,i){"object"==typeof e&&(i=e,e=void 0),i=i||{};var s,o,n,r,a,l,h,c,d,u,p=k.ajaxSetup({},i),m=p.context||p,g=p.context&&(m.nodeType||m.jquery)?k(m):k.event,v=k.Deferred(),y=k.Callbacks("once memory"),b=p.statusCode||{},w={},x={},S="canceled",E={readyState:0,getResponseHeader:function(t){var e;if(h){if(!r)for(r={};e=Ne.exec(n);)r[e[1].toLowerCase()+" "]=(r[e[1].toLowerCase()+" "]||[]).concat(e[2]);e=r[t.toLowerCase()+" "]}return null==e?null:e.join(", ")},getAllResponseHeaders:function(){return h?n:null},setRequestHeader:function(t,e){return null==h&&(t=x[t.toLowerCase()]=x[t.toLowerCase()]||t,w[t]=e),this},overrideMimeType:function(t){return null==h&&(p.mimeType=t),this},statusCode:function(t){var e;if(t)if(h)E.always(t[E.status]);else for(e in t)b[e]=[b[e],t[e]];return this},abort:function(t){var e=t||S;return s&&s.abort(e),T(0,e),this}};if(v.promise(E),p.url=((e||p.url||_e.href)+"").replace(ze,_e.protocol+"//"),p.type=i.method||i.type||p.method||p.type,p.dataTypes=(p.dataType||"*").toLowerCase().match(G)||[""],null==p.crossDomain){l=f.createElement("a");try{l.href=p.url,l.href=l.href,p.crossDomain=Ue.protocol+"//"+Ue.host!=l.protocol+"//"+l.host}catch(t){p.crossDomain=!0}}if(p.data&&p.processData&&"string"!=typeof p.data&&(p.data=k.param(p.data,p.traditional)),$e(Ve,p,i,E),h)return E;for(d in(c=k.event&&p.global)&&0==k.active++&&k.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!He.test(p.type),o=p.url.replace(Oe,""),p.hasContent?p.data&&p.processData&&0===(p.contentType||"").indexOf("application/x-www-form-urlencoded")&&(p.data=p.data.replace(Fe,"+")):(u=p.url.slice(o.length),p.data&&(p.processData||"string"==typeof p.data)&&(o+=(Be.test(o)?"&":"?")+p.data,delete p.data),!1===p.cache&&(o=o.replace(Ie,"$1"),u=(Be.test(o)?"&":"?")+"_="+Ce.guid+++u),p.url=o+u),p.ifModified&&(k.lastModified[o]&&E.setRequestHeader("If-Modified-Since",k.lastModified[o]),k.etag[o]&&E.setRequestHeader("If-None-Match",k.etag[o])),(p.data&&p.hasContent&&!1!==p.contentType||i.contentType)&&E.setRequestHeader("Content-Type",p.contentType),E.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Ge+"; q=0.01":""):p.accepts["*"]),p.headers)E.setRequestHeader(d,p.headers[d]);if(p.beforeSend&&(!1===p.beforeSend.call(m,E,p)||h))return E.abort();if(S="abort",y.add(p.complete),E.done(p.success),E.fail(p.error),s=$e(qe,p,i,E)){if(E.readyState=1,c&&g.trigger("ajaxSend",[E,p]),h)return E;p.async&&p.timeout>0&&(a=t.setTimeout((function(){E.abort("timeout")}),p.timeout));try{h=!1,s.send(w,T)}catch(t){if(h)throw t;T(-1,t)}}else T(-1,"No Transport");function T(e,i,r,l){var d,u,f,w,x,S=i;h||(h=!0,a&&t.clearTimeout(a),s=void 0,n=l||"",E.readyState=e>0?4:0,d=e>=200&&e<300||304===e,r&&(w=function(t,e,i){for(var s,o,n,r,a=t.contents,l=t.dataTypes;"*"===l[0];)l.shift(),void 0===s&&(s=t.mimeType||e.getResponseHeader("Content-Type"));if(s)for(o in a)if(a[o]&&a[o].test(s)){l.unshift(o);break}if(l[0]in i)n=l[0];else{for(o in i){if(!l[0]||t.converters[o+" "+l[0]]){n=o;break}r||(r=o)}n=n||r}if(n)return n!==l[0]&&l.unshift(n),i[n]}(p,E,r)),!d&&k.inArray("script",p.dataTypes)>-1&&k.inArray("json",p.dataTypes)<0&&(p.converters["text script"]=function(){}),w=function(t,e,i,s){var o,n,r,a,l,h={},c=t.dataTypes.slice();if(c[1])for(r in t.converters)h[r.toLowerCase()]=t.converters[r];for(n=c.shift();n;)if(t.responseFields[n]&&(i[t.responseFields[n]]=e),!l&&s&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),l=n,n=c.shift())if("*"===n)n=l;else if("*"!==l&&l!==n){if(!(r=h[l+" "+n]||h["* "+n]))for(o in h)if((a=o.split(" "))[1]===n&&(r=h[l+" "+a[0]]||h["* "+a[0]])){!0===r?r=h[o]:!0!==h[o]&&(n=a[0],c.unshift(a[1]));break}if(!0!==r)if(r&&t.throws)e=r(e);else try{e=r(e)}catch(t){return{state:"parsererror",error:r?t:"No conversion from "+l+" to "+n}}}return{state:"success",data:e}}(p,w,E,d),d?(p.ifModified&&((x=E.getResponseHeader("Last-Modified"))&&(k.lastModified[o]=x),(x=E.getResponseHeader("etag"))&&(k.etag[o]=x)),204===e||"HEAD"===p.type?S="nocontent":304===e?S="notmodified":(S=w.state,u=w.data,d=!(f=w.error))):(f=S,!e&&S||(S="error",e<0&&(e=0))),E.status=e,E.statusText=(i||S)+"",d?v.resolveWith(m,[u,S,E]):v.rejectWith(m,[E,S,f]),E.statusCode(b),b=void 0,c&&g.trigger(d?"ajaxSuccess":"ajaxError",[E,p,d?u:f]),y.fireWith(m,[E,S]),c&&(g.trigger("ajaxComplete",[E,p]),--k.active||k.event.trigger("ajaxStop")))}return E},getJSON:function(t,e,i){return k.get(t,e,i,"json")},getScript:function(t,e){return k.get(t,void 0,e,"script")}}),k.each(["get","post"],(function(t,e){k[e]=function(t,i,s,o){return m(i)&&(o=o||s,s=i,i=void 0),k.ajax(k.extend({url:t,type:e,dataType:o,data:i,success:s},k.isPlainObject(t)&&t))}})),k.ajaxPrefilter((function(t){var e;for(e in t.headers)"content-type"===e.toLowerCase()&&(t.contentType=t.headers[e]||"")})),k._evalUrl=function(t,e,i){return k.ajax({url:t,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(t){k.globalEval(t,e,i)}})},k.fn.extend({wrapAll:function(t){var e;return this[0]&&(m(t)&&(t=t.call(this[0])),e=k(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map((function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t})).append(this)),this},wrapInner:function(t){return m(t)?this.each((function(e){k(this).wrapInner(t.call(this,e))})):this.each((function(){var e=k(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)}))},wrap:function(t){var e=m(t);return this.each((function(i){k(this).wrapAll(e?t.call(this,i):t)}))},unwrap:function(t){return this.parent(t).not("body").each((function(){k(this).replaceWith(this.childNodes)})),this}}),k.expr.pseudos.hidden=function(t){return!k.expr.pseudos.visible(t)},k.expr.pseudos.visible=function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},k.ajaxSettings.xhr=function(){try{return new t.XMLHttpRequest}catch(t){}};var Qe={0:200,1223:204},Ye=k.ajaxSettings.xhr();p.cors=!!Ye&&"withCredentials"in Ye,p.ajax=Ye=!!Ye,k.ajaxTransport((function(e){var i,s;if(p.cors||Ye&&!e.crossDomain)return{send:function(o,n){var r,a=e.xhr();if(a.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(r in e.xhrFields)a[r]=e.xhrFields[r];for(r in e.mimeType&&a.overrideMimeType&&a.overrideMimeType(e.mimeType),e.crossDomain||o["X-Requested-With"]||(o["X-Requested-With"]="XMLHttpRequest"),o)a.setRequestHeader(r,o[r]);i=function(t){return function(){i&&(i=s=a.onload=a.onerror=a.onabort=a.ontimeout=a.onreadystatechange=null,"abort"===t?a.abort():"error"===t?"number"!=typeof a.status?n(0,"error"):n(a.status,a.statusText):n(Qe[a.status]||a.status,a.statusText,"text"!==(a.responseType||"text")||"string"!=typeof a.responseText?{binary:a.response}:{text:a.responseText},a.getAllResponseHeaders()))}},a.onload=i(),s=a.onerror=a.ontimeout=i("error"),void 0!==a.onabort?a.onabort=s:a.onreadystatechange=function(){4===a.readyState&&t.setTimeout((function(){i&&s()}))},i=i("abort");try{a.send(e.hasContent&&e.data||null)}catch(t){if(i)throw t}},abort:function(){i&&i()}}})),k.ajaxPrefilter((function(t){t.crossDomain&&(t.contents.script=!1)})),k.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return k.globalEval(t),t}}}),k.ajaxPrefilter("script",(function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")})),k.ajaxTransport("script",(function(t){var e,i;if(t.crossDomain||t.scriptAttrs)return{send:function(s,o){e=k("<script>").attr(t.scriptAttrs||{}).prop({charset:t.scriptCharset,src:t.url}).on("load error",i=function(t){e.remove(),i=null,t&&o("error"===t.type?404:200,t.type)}),f.head.appendChild(e[0])},abort:function(){i&&i()}}}));var Ze,Ke=[],Je=/(=)\?(?=&|$)|\?\?/;k.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=Ke.pop()||k.expando+"_"+Ce.guid++;return this[t]=!0,t}}),k.ajaxPrefilter("json jsonp",(function(e,i,s){var o,n,r,a=!1!==e.jsonp&&(Je.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Je.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return o=e.jsonpCallback=m(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Je,"$1"+o):!1!==e.jsonp&&(e.url+=(Be.test(e.url)?"&":"?")+e.jsonp+"="+o),e.converters["script json"]=function(){return r||k.error(o+" was not called"),r[0]},e.dataTypes[0]="json",n=t[o],t[o]=function(){r=arguments},s.always((function(){void 0===n?k(t).removeProp(o):t[o]=n,e[o]&&(e.jsonpCallback=i.jsonpCallback,Ke.push(o)),r&&m(n)&&n(r[0]),r=n=void 0})),"script"})),p.createHTMLDocument=((Ze=f.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===Ze.childNodes.length),k.parseHTML=function(t,e,i){return"string"!=typeof t?[]:("boolean"==typeof e&&(i=e,e=!1),e||(p.createHTMLDocument?((s=(e=f.implementation.createHTMLDocument("")).createElement("base")).href=f.location.href,e.head.appendChild(s)):e=f),n=!i&&[],(o=O.exec(t))?[e.createElement(o[1])]:(o=Dt([t],e,n),n&&n.length&&k(n).remove(),k.merge([],o.childNodes)));var s,o,n},k.fn.load=function(t,e,i){var s,o,n,r=this,a=t.indexOf(" ");return a>-1&&(s=ke(t.slice(a)),t=t.slice(0,a)),m(e)?(i=e,e=void 0):e&&"object"==typeof e&&(o="POST"),r.length>0&&k.ajax({url:t,type:o||"GET",dataType:"html",data:e}).done((function(t){n=arguments,r.html(s?k("<div>").append(k.parseHTML(t)).find(s):t)})).always(i&&function(t,e){r.each((function(){i.apply(this,n||[t.responseText,e,t])}))}),this},k.expr.pseudos.animated=function(t){return k.grep(k.timers,(function(e){return t===e.elem})).length},k.offset={setOffset:function(t,e,i){var s,o,n,r,a,l,h=k.css(t,"position"),c=k(t),d={};"static"===h&&(t.style.position="relative"),a=c.offset(),n=k.css(t,"top"),l=k.css(t,"left"),("absolute"===h||"fixed"===h)&&(n+l).indexOf("auto")>-1?(r=(s=c.position()).top,o=s.left):(r=parseFloat(n)||0,o=parseFloat(l)||0),m(e)&&(e=e.call(t,i,k.extend({},a))),null!=e.top&&(d.top=e.top-a.top+r),null!=e.left&&(d.left=e.left-a.left+o),"using"in e?e.using.call(t,d):c.css(d)}},k.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each((function(e){k.offset.setOffset(this,t,e)}));var e,i,s=this[0];return s?s.getClientRects().length?(e=s.getBoundingClientRect(),i=s.ownerDocument.defaultView,{top:e.top+i.pageYOffset,left:e.left+i.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var t,e,i,s=this[0],o={top:0,left:0};if("fixed"===k.css(s,"position"))e=s.getBoundingClientRect();else{for(e=this.offset(),i=s.ownerDocument,t=s.offsetParent||i.documentElement;t&&(t===i.body||t===i.documentElement)&&"static"===k.css(t,"position");)t=t.parentNode;t&&t!==s&&1===t.nodeType&&((o=k(t).offset()).top+=k.css(t,"borderTopWidth",!0),o.left+=k.css(t,"borderLeftWidth",!0))}return{top:e.top-o.top-k.css(s,"marginTop",!0),left:e.left-o.left-k.css(s,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var t=this.offsetParent;t&&"static"===k.css(t,"position");)t=t.offsetParent;return t||ut}))}}),k.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(t,e){var i="pageYOffset"===e;k.fn[t]=function(s){return Z(this,(function(t,s,o){var n;if(g(t)?n=t:9===t.nodeType&&(n=t.defaultView),void 0===o)return n?n[e]:t[s];n?n.scrollTo(i?n.pageXOffset:o,i?o:n.pageYOffset):t[s]=o}),t,s,arguments.length)}})),k.each(["top","left"],(function(t,e){k.cssHooks[e]=Zt(p.pixelPosition,(function(t,i){if(i)return i=Yt(t,e),Ut.test(i)?k(t).position()[e]+"px":i}))})),k.each({Height:"height",Width:"width"},(function(t,e){k.each({padding:"inner"+t,content:e,"":"outer"+t},(function(i,s){k.fn[s]=function(o,n){var r=arguments.length&&(i||"boolean"!=typeof o),a=i||(!0===o||!0===n?"margin":"border");return Z(this,(function(e,i,o){var n;return g(e)?0===s.indexOf("outer")?e["inner"+t]:e.document.documentElement["client"+t]:9===e.nodeType?(n=e.documentElement,Math.max(e.body["scroll"+t],n["scroll"+t],e.body["offset"+t],n["offset"+t],n["client"+t])):void 0===o?k.css(e,i,a):k.style(e,i,o,a)}),e,r?o:void 0,r)}}))})),k.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(t,e){k.fn[e]=function(t){return this.on(e,t)}})),k.fn.extend({bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,i,s){return this.on(e,t,i,s)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)},hover:function(t,e){return this.on("mouseenter",t).on("mouseleave",e||t)}}),k.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(t,e){k.fn[e]=function(t,i){return arguments.length>0?this.on(e,null,t,i):this.trigger(e)}}));var ti=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;k.proxy=function(t,e){var i,s,n;if("string"==typeof e&&(i=t[e],e=t,t=i),m(t))return s=o.call(arguments,2),n=function(){return t.apply(e||this,s.concat(o.call(arguments)))},n.guid=t.guid=t.guid||k.guid++,n},k.holdReady=function(t){t?k.readyWait++:k.ready(!0)},k.isArray=Array.isArray,k.parseJSON=JSON.parse,k.nodeName=E,k.isFunction=m,k.isWindow=g,k.camelCase=et,k.type=b,k.now=Date.now,k.isNumeric=function(t){var e=k.type(t);return("number"===e||"string"===e)&&!isNaN(t-parseFloat(t))},k.trim=function(t){return null==t?"":(t+"").replace(ti,"$1")};var ei=t.jQuery,ii=t.$;return k.noConflict=function(e){return t.$===k&&(t.$=ii),e&&t.jQuery===k&&(t.jQuery=ei),k},void 0===e&&(t.jQuery=t.$=k),k}))),jo.exports;var t}
/*!
 * typeahead.js 0.11.1
 * https://github.com/twitter/typeahead.js
 * Copyright 2013-2015 Twitter, Inc. and other contributors; Licensed MIT
 */var Fo,Oo;Fo||(Fo=1,(Oo=Ao).exports=function(t){var e={isMsie:function(){return!!/(msie|trident)/i.test(navigator.userAgent)&&navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]},isBlankString:function(t){return!t||/^\s*$/.test(t)},escapeRegExChars:function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isArray:t.isArray,isFunction:t.isFunction,isObject:t.isPlainObject,isUndefined:function(t){return void 0===t},isElement:function(t){return!(!t||1!==t.nodeType)},isJQuery:function(e){return e instanceof t},toStr:function(t){return e.isUndefined(t)||null===t?"":t+""},bind:t.proxy,each:function(e,i){function s(t,e){return i(e,t)}t.each(e,s)},map:t.map,filter:t.grep,every:function(e,i){var s=!0;return e?(t.each(e,(function(t,o){if(!(s=i.call(null,o,t,e)))return!1})),!!s):s},some:function(e,i){var s=!1;return e?(t.each(e,(function(t,o){if(s=i.call(null,o,t,e))return!1})),!!s):s},mixin:t.extend,identity:function(t){return t},clone:function(e){return t.extend(!0,{},e)},getIdGenerator:function(){var t=0;return function(){return t++}},templatify:function(e){return t.isFunction(e)?e:i;function i(){return String(e)}},defer:function(t){setTimeout(t,0)},debounce:function(t,e,i){var s,o;return function(){var n,r,a=this,l=arguments;return n=function(){s=null,i||(o=t.apply(a,l))},r=i&&!s,clearTimeout(s),s=setTimeout(n,e),r&&(o=t.apply(a,l)),o}},throttle:function(t,e){var i,s,o,n,r,a;return r=0,a=function(){r=new Date,o=null,n=t.apply(i,s)},function(){var l=new Date,h=e-(l-r);return i=this,s=arguments,h<=0?(clearTimeout(o),o=null,r=l,n=t.apply(i,s)):o||(o=setTimeout(a,h)),n}},stringify:function(t){return e.isString(t)?t:JSON.stringify(t)},noop:function(){}},i="0.11.1",s=function(){return{nonword:i,whitespace:t,obj:{nonword:s(i),whitespace:s(t)}};function t(t){return(t=e.toStr(t))?t.split(/\s+/):[]}function i(t){return(t=e.toStr(t))?t.split(/\W+/):[]}function s(t){return function(i){return i=e.isArray(i)?i:[].slice.call(arguments,0),function(s){var o=[];return e.each(i,(function(i){o=o.concat(t(e.toStr(s[i])))})),o}}}}(),o=function(){function i(i){this.maxSize=e.isNumber(i)?i:100,this.reset(),this.maxSize<=0&&(this.set=this.get=t.noop)}function s(){this.head=this.tail=null}function o(t,e){this.key=t,this.val=e,this.prev=this.next=null}return e.mixin(i.prototype,{set:function(t,e){var i,s=this.list.tail;this.size>=this.maxSize&&(this.list.remove(s),delete this.hash[s.key],this.size--),(i=this.hash[t])?(i.val=e,this.list.moveToFront(i)):(i=new o(t,e),this.list.add(i),this.hash[t]=i,this.size++)},get:function(t){var e=this.hash[t];if(e)return this.list.moveToFront(e),e.val},reset:function(){this.size=0,this.hash={},this.list=new s}}),e.mixin(s.prototype,{add:function(t){this.head&&(t.next=this.head,this.head.prev=t),this.head=t,this.tail=this.tail||t},remove:function(t){t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev},moveToFront:function(t){this.remove(t),this.add(t)}}),i}(),n=function(){var i;try{(i=window.localStorage).setItem("~~~","!"),i.removeItem("~~~")}catch(t){i=null}function s(t,s){this.prefix=["__",t,"__"].join(""),this.ttlKey="__ttl__",this.keyMatcher=new RegExp("^"+e.escapeRegExChars(this.prefix)),this.ls=s||i,!this.ls&&this._noop()}return e.mixin(s.prototype,{_prefix:function(t){return this.prefix+t},_ttlKey:function(t){return this._prefix(t)+this.ttlKey},_noop:function(){this.get=this.set=this.remove=this.clear=this.isExpired=e.noop},_safeSet:function(t,e){try{this.ls.setItem(t,e)}catch(t){"QuotaExceededError"===t.name&&(this.clear(),this._noop())}},get:function(t){return this.isExpired(t)&&this.remove(t),r(this.ls.getItem(this._prefix(t)))},set:function(t,i,s){return e.isNumber(s)?this._safeSet(this._ttlKey(t),n(o()+s)):this.ls.removeItem(this._ttlKey(t)),this._safeSet(this._prefix(t),n(i))},remove:function(t){return this.ls.removeItem(this._ttlKey(t)),this.ls.removeItem(this._prefix(t)),this},clear:function(){var t,e=a(this.keyMatcher);for(t=e.length;t--;)this.remove(e[t]);return this},isExpired:function(t){var i=r(this.ls.getItem(this._ttlKey(t)));return!!(e.isNumber(i)&&o()>i)}}),s;function o(){return(new Date).getTime()}function n(t){return JSON.stringify(e.isUndefined(t)?null:t)}function r(e){return t.parseJSON(e)}function a(t){var e,s,o=[],n=i.length;for(e=0;e<n;e++)(s=i.key(e)).match(t)&&o.push(s.replace(t,""));return o}}(),r=function(){var i=0,s={},n=6,r=new o(10);function a(t){t=t||{},this.cancelled=!1,this.lastReq=null,this._send=t.transport,this._get=t.limiter?t.limiter(this._get):this._get,this._cache=!1===t.cache?new o(0):r}return a.setMaxPendingRequests=function(t){n=t},a.resetCache=function(){r.reset()},e.mixin(a.prototype,{_fingerprint:function(e){return(e=e||{}).url+e.type+t.param(e.data||{})},_get:function(t,e){var o,r,a=this;function l(t){e(null,t),a._cache.set(o,t)}function h(){e(!0)}function c(){i--,delete s[o],a.onDeckRequestArgs&&(a._get.apply(a,a.onDeckRequestArgs),a.onDeckRequestArgs=null)}o=this._fingerprint(t),this.cancelled||o!==this.lastReq||((r=s[o])?r.done(l).fail(h):i<n?(i++,s[o]=this._send(t).done(l).fail(h).always(c)):this.onDeckRequestArgs=[].slice.call(arguments,0))},get:function(i,s){var o,n;s=s||t.noop,i=e.isString(i)?{url:i}:i||{},n=this._fingerprint(i),this.cancelled=!1,this.lastReq=n,(o=this._cache.get(n))?s(null,o):this._get(i,s)},cancel:function(){this.cancelled=!0}}),a}(),a=window.SearchIndex=function(){var i="c",s="i";function o(i){(i=i||{}).datumTokenizer&&i.queryTokenizer||t.error("datumTokenizer and queryTokenizer are both required"),this.identify=i.identify||e.stringify,this.datumTokenizer=i.datumTokenizer,this.queryTokenizer=i.queryTokenizer,this.reset()}return e.mixin(o.prototype,{bootstrap:function(t){this.datums=t.datums,this.trie=t.trie},add:function(t){var o=this;t=e.isArray(t)?t:[t],e.each(t,(function(t){var a,l;o.datums[a=o.identify(t)]=t,l=n(o.datumTokenizer(t)),e.each(l,(function(t){var e,n,l;for(e=o.trie,n=t.split("");l=n.shift();)(e=e[i][l]||(e[i][l]=r()))[s].push(a)}))}))},get:function(t){var i=this;return e.map(t,(function(t){return i.datums[t]}))},search:function(t){var o,r,h=this;return o=n(this.queryTokenizer(t)),e.each(o,(function(t){var e,o,n,a;if(r&&0===r.length)return!1;for(e=h.trie,o=t.split("");e&&(n=o.shift());)e=e[i][n];if(!e||0!==o.length)return r=[],!1;a=e[s].slice(0),r=r?l(r,a):a})),r?e.map(a(r),(function(t){return h.datums[t]})):[]},all:function(){var t=[];for(var e in this.datums)t.push(this.datums[e]);return t},reset:function(){this.datums={},this.trie=r()},serialize:function(){return{datums:this.datums,trie:this.trie}}}),o;function n(t){return t=e.filter(t,(function(t){return!!t})),t=e.map(t,(function(t){return t.toLowerCase()}))}function r(){var t={};return t[s]=[],t[i]={},t}function a(t){for(var e={},i=[],s=0,o=t.length;s<o;s++)e[t[s]]||(e[t[s]]=!0,i.push(t[s]));return i}function l(t,e){var i=0,s=0,o=[];t=t.sort(),e=e.sort();for(var n=t.length,r=e.length;i<n&&s<r;)t[i]<e[s]?i++:(t[i]>e[s]||(o.push(t[i]),i++),s++);return o}}(),l=function(){var t;function i(t){this.url=t.url,this.ttl=t.ttl,this.cache=t.cache,this.prepare=t.prepare,this.transform=t.transform,this.transport=t.transport,this.thumbprint=t.thumbprint,this.storage=new n(t.cacheKey)}return t={data:"data",protocol:"protocol",thumbprint:"thumbprint"},e.mixin(i.prototype,{_settings:function(){return{url:this.url,type:"GET",dataType:"json"}},store:function(e){this.cache&&(this.storage.set(t.data,e,this.ttl),this.storage.set(t.protocol,location.protocol,this.ttl),this.storage.set(t.thumbprint,this.thumbprint,this.ttl))},fromCache:function(){var e,i={};return this.cache?(i.data=this.storage.get(t.data),i.protocol=this.storage.get(t.protocol),i.thumbprint=this.storage.get(t.thumbprint),e=i.thumbprint!==this.thumbprint||i.protocol!==location.protocol,i.data&&!e?i.data:null):null},fromNetwork:function(t){var e,i=this;function s(){t(!0)}function o(e){t(null,i.transform(e))}t&&(e=this.prepare(this._settings()),this.transport(e).fail(s).done(o))},clear:function(){return this.storage.clear(),this}}),i}(),h=function(){function t(t){this.url=t.url,this.prepare=t.prepare,this.transform=t.transform,this.transport=new r({cache:t.cache,limiter:t.limiter,transport:t.transport})}return e.mixin(t.prototype,{_settings:function(){return{url:this.url,type:"GET",dataType:"json"}},get:function(t,e){var i,s=this;if(e)return t=t||"",i=this.prepare(t,this._settings()),this.transport.get(i,o);function o(t,i){e(t?[]:s.transform(i))}},cancelLastRequest:function(){this.transport.cancel()}}),t}(),c=function(){return function(i){var n,r;return n={initialize:!0,identify:e.stringify,datumTokenizer:null,queryTokenizer:null,sufficient:5,sorter:null,local:[],prefetch:null,remote:null},!(i=e.mixin(n,i||{})).datumTokenizer&&t.error("datumTokenizer is required"),!i.queryTokenizer&&t.error("queryTokenizer is required"),r=i.sorter,i.sorter=r?function(t){return t.sort(r)}:e.identity,i.local=e.isFunction(i.local)?i.local():i.local,i.prefetch=s(i.prefetch),i.remote=o(i.remote),i};function s(s){var o;return s?(o={url:null,ttl:864e5,cache:!0,cacheKey:null,thumbprint:"",prepare:e.identity,transform:e.identity,transport:null},s=e.isString(s)?{url:s}:s,!(s=e.mixin(o,s)).url&&t.error("prefetch requires url to be set"),s.transform=s.filter||s.transform,s.cacheKey=s.cacheKey||s.url,s.thumbprint=i+s.thumbprint,s.transport=s.transport?a(s.transport):t.ajax,s):null}function o(i){var s;if(i)return s={url:null,cache:!0,prepare:null,replace:null,wildcard:null,limiter:null,rateLimitBy:"debounce",rateLimitWait:300,transform:e.identity,transport:null},i=e.isString(i)?{url:i}:i,!(i=e.mixin(s,i)).url&&t.error("remote requires url to be set"),i.transform=i.filter||i.transform,i.prepare=n(i),i.limiter=r(i),i.transport=i.transport?a(i.transport):t.ajax,delete i.replace,delete i.wildcard,delete i.rateLimitBy,delete i.rateLimitWait,i}function n(t){var e,i,s;return e=t.prepare,i=t.replace,s=t.wildcard,e||(e=i?o:t.wildcard?n:r);function o(t,e){return e.url=i(e.url,t),e}function n(t,e){return e.url=e.url.replace(s,encodeURIComponent(t)),e}function r(t,e){return e}}function r(t){var i,s,o;return i=t.limiter,s=t.rateLimitBy,o=t.rateLimitWait,i||(i=/^throttle$/i.test(s)?r(o):n(o)),i;function n(t){return function(i){return e.debounce(i,t)}}function r(t){return function(i){return e.throttle(i,t)}}}function a(i){return function(s){var o=t.Deferred();return i(s,n,r),o;function n(t){e.defer((function(){o.resolve(t)}))}function r(t){e.defer((function(){o.reject(t)}))}}}}(),d=function(){var i;function o(t){t=c(t),this.sorter=t.sorter,this.identify=t.identify,this.sufficient=t.sufficient,this.local=t.local,this.remote=t.remote?new h(t.remote):null,this.prefetch=t.prefetch?new l(t.prefetch):null,this.index=new a({identify:this.identify,datumTokenizer:t.datumTokenizer,queryTokenizer:t.queryTokenizer}),!1!==t.initialize&&this.initialize()}return i=window&&window.Bloodhound,o.noConflict=function(){return window&&(window.Bloodhound=i),o},o.tokenizers=s,e.mixin(o.prototype,{__ttAdapter:function(){var t=this;return this.remote?e:i;function e(e,i,s){return t.search(e,i,s)}function i(e,i){return t.search(e,i)}},_loadPrefetch:function(){var e,i,s=this;return e=t.Deferred(),this.prefetch?(i=this.prefetch.fromCache())?(this.index.bootstrap(i),e.resolve()):this.prefetch.fromNetwork(o):e.resolve(),e.promise();function o(t,i){if(t)return e.reject();s.add(i),s.prefetch.store(s.index.serialize()),e.resolve()}},_initialize:function(){var t=this;return this.clear(),(this.initPromise=this._loadPrefetch()).done(e),this.initPromise;function e(){t.add(t.local)}},initialize:function(t){return!this.initPromise||t?this._initialize():this.initPromise},add:function(t){return this.index.add(t),this},get:function(t){return t=e.isArray(t)?t:[].slice.call(arguments),this.index.get(t)},search:function(t,i,s){var o,n=this;return o=this.sorter(this.index.search(t)),i(this.remote?o.slice():o),this.remote&&o.length<this.sufficient?this.remote.get(t,r):this.remote&&this.remote.cancelLastRequest(),this;function r(t){var i=[];e.each(t,(function(t){!e.some(o,(function(e){return n.identify(t)===n.identify(e)}))&&i.push(t)})),s&&s(i)}},all:function(){return this.index.all()},clear:function(){return this.index.reset(),this},clearPrefetchCache:function(){return this.prefetch&&this.prefetch.clear(),this},clearRemoteCache:function(){return r.resetCache(),this},ttAdapter:function(){return this.__ttAdapter()}}),o}();return d}(Po()),Oo.exports=function(t){var e={isMsie:function(){return!!/(msie|trident)/i.test(navigator.userAgent)&&navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]},isBlankString:function(t){return!t||/^\s*$/.test(t)},escapeRegExChars:function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isArray:t.isArray,isFunction:t.isFunction,isObject:t.isPlainObject,isUndefined:function(t){return void 0===t},isElement:function(t){return!(!t||1!==t.nodeType)},isJQuery:function(e){return e instanceof t},toStr:function(t){return e.isUndefined(t)||null===t?"":t+""},bind:t.proxy,each:function(e,i){function s(t,e){return i(e,t)}t.each(e,s)},map:t.map,filter:t.grep,every:function(e,i){var s=!0;return e?(t.each(e,(function(t,o){if(!(s=i.call(null,o,t,e)))return!1})),!!s):s},some:function(e,i){var s=!1;return e?(t.each(e,(function(t,o){if(s=i.call(null,o,t,e))return!1})),!!s):s},mixin:t.extend,identity:function(t){return t},clone:function(e){return t.extend(!0,{},e)},getIdGenerator:function(){var t=0;return function(){return t++}},templatify:function(e){return t.isFunction(e)?e:i;function i(){return String(e)}},defer:function(t){setTimeout(t,0)},debounce:function(t,e,i){var s,o;return function(){var n,r,a=this,l=arguments;return n=function(){s=null,i||(o=t.apply(a,l))},r=i&&!s,clearTimeout(s),s=setTimeout(n,e),r&&(o=t.apply(a,l)),o}},throttle:function(t,e){var i,s,o,n,r,a;return r=0,a=function(){r=new Date,o=null,n=t.apply(i,s)},function(){var l=new Date,h=e-(l-r);return i=this,s=arguments,h<=0?(clearTimeout(o),o=null,r=l,n=t.apply(i,s)):o||(o=setTimeout(a,h)),n}},stringify:function(t){return e.isString(t)?t:JSON.stringify(t)},noop:function(){}},i=function(){var t={wrapper:"twitter-typeahead",input:"tt-input",hint:"tt-hint",menu:"tt-menu",dataset:"tt-dataset",suggestion:"tt-suggestion",selectable:"tt-selectable",empty:"tt-empty",open:"tt-open",cursor:"tt-cursor",highlight:"tt-highlight"};return i;function i(i){var r,a;return a=e.mixin({},t,i),{css:(r={css:n(),classes:a,html:s(a),selectors:o(a)}).css,html:r.html,classes:r.classes,selectors:r.selectors,mixin:function(t){e.mixin(t,r)}}}function s(t){return{wrapper:'<span class="'+t.wrapper+'"></span>',menu:'<div class="'+t.menu+'"></div>'}}function o(t){var i={};return e.each(t,(function(t,e){i[e]="."+t})),i}function n(){var t={wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none",opacity:"1"},input:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},inputWithNoHint:{position:"relative",verticalAlign:"top"},menu:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"},ltr:{left:"0",right:"auto"},rtl:{left:"auto",right:" 0"}};return e.isMsie()&&e.mixin(t.input,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"}),t}}(),s=function(){var i,s;function o(e){e&&e.el||t.error("EventBus initialized without el"),this.$el=t(e.el)}return i="typeahead:",s={render:"rendered",cursorchange:"cursorchanged",select:"selected",autocomplete:"autocompleted"},e.mixin(o.prototype,{_trigger:function(e,s){var o;return o=t.Event(i+e),(s=s||[]).unshift(o),this.$el.trigger.apply(this.$el,s),o},before:function(t){var e;return e=[].slice.call(arguments,1),this._trigger("before"+t,e).isDefaultPrevented()},trigger:function(t){var e;this._trigger(t,[].slice.call(arguments,1)),(e=s[t])&&this._trigger(e,[].slice.call(arguments,1))}}),o}(),o=function(){var t=/\s+/,e=l();return{onSync:o,onAsync:s,off:n,trigger:r};function i(e,i,s,o){var n;if(!s)return this;for(i=i.split(t),s=o?h(s,o):s,this._callbacks=this._callbacks||{};n=i.shift();)this._callbacks[n]=this._callbacks[n]||{sync:[],async:[]},this._callbacks[n][e].push(s);return this}function s(t,e,s){return i.call(this,"async",t,e,s)}function o(t,e,s){return i.call(this,"sync",t,e,s)}function n(e){var i;if(!this._callbacks)return this;for(e=e.split(t);i=e.shift();)delete this._callbacks[i];return this}function r(i){var s,o,n,r,l;if(!this._callbacks)return this;for(i=i.split(t),n=[].slice.call(arguments,1);(s=i.shift())&&(o=this._callbacks[s]);)r=a(o.sync,this,[s].concat(n)),l=a(o.async,this,[s].concat(n)),r()&&e(l);return this}function a(t,e,i){return s;function s(){for(var s,o=0,n=t.length;!s&&o<n;o+=1)s=!1===t[o].apply(e,i);return!s}}function l(){return window.setImmediate?function(t){setImmediate((function(){t()}))}:function(t){setTimeout((function(){t()}),0)}}function h(t,e){return t.bind?t.bind(e):function(){t.apply(e,[].slice.call(arguments,0))}}}(),n=function(t){var i={node:null,pattern:null,tagName:"strong",className:null,wordsOnly:!1,caseSensitive:!1};return function(o){var n;function r(e){var i,s,r;return(i=n.exec(e.data))&&(r=t.createElement(o.tagName),o.className&&(r.className=o.className),(s=e.splitText(i.index)).splitText(i[0].length),r.appendChild(s.cloneNode(!0)),e.parentNode.replaceChild(r,s)),!!i}function a(t,e){for(var i,s=3,o=0;o<t.childNodes.length;o++)(i=t.childNodes[o]).nodeType===s?o+=e(i)?1:0:a(i,e)}(o=e.mixin({},i,o)).node&&o.pattern&&(o.pattern=e.isArray(o.pattern)?o.pattern:[o.pattern],n=s(o.pattern,o.caseSensitive,o.wordsOnly),a(o.node,r))};function s(t,i,s){for(var o,n=[],r=0,a=t.length;r<a;r++)n.push(e.escapeRegExChars(t[r]));return o=s?"\\b("+n.join("|")+")\\b":"("+n.join("|")+")",i?new RegExp(o):new RegExp(o,"i")}}(window.document),r=function(){var i;function s(i,s){(i=i||{}).input||t.error("input is missing"),s.mixin(this),this.$hint=t(i.hint),this.$input=t(i.input),this.query=this.$input.val(),this.queryWhenFocused=this.hasFocus()?this.query:null,this.$overflowHelper=n(this.$input),this._checkLanguageDirection(),0===this.$hint.length&&(this.setHint=this.getHint=this.clearHint=this.clearHintIfInvalid=e.noop)}return i={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"},s.normalizeQuery=function(t){return e.toStr(t).replace(/^\s*/g,"").replace(/\s{2,}/g," ")},e.mixin(s.prototype,o,{_onBlur:function(){this.resetInputValue(),this.trigger("blurred")},_onFocus:function(){this.queryWhenFocused=this.query,this.trigger("focused")},_onKeydown:function(t){var e=i[t.which||t.keyCode];this._managePreventDefault(e,t),e&&this._shouldTrigger(e,t)&&this.trigger(e+"Keyed",t)},_onInput:function(){this._setQuery(this.getInputValue()),this.clearHintIfInvalid(),this._checkLanguageDirection()},_managePreventDefault:function(t,e){var i;switch(t){case"up":case"down":i=!a(e);break;default:i=!1}i&&e.preventDefault()},_shouldTrigger:function(t,e){return"tab"!==t||!a(e)},_checkLanguageDirection:function(){var t=(this.$input.css("direction")||"ltr").toLowerCase();this.dir!==t&&(this.dir=t,this.$hint.attr("dir",t),this.trigger("langDirChanged",t))},_setQuery:function(t,e){var i,s;s=!!(i=r(t,this.query))&&this.query.length!==t.length,this.query=t,e||i?!e&&s&&this.trigger("whitespaceChanged",this.query):this.trigger("queryChanged",this.query)},bind:function(){var t,s,o,n,r=this;return t=e.bind(this._onBlur,this),s=e.bind(this._onFocus,this),o=e.bind(this._onKeydown,this),n=e.bind(this._onInput,this),this.$input.on("blur.tt",t).on("focus.tt",s).on("keydown.tt",o),!e.isMsie()||e.isMsie()>9?this.$input.on("input.tt",n):this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",(function(t){i[t.which||t.keyCode]||e.defer(e.bind(r._onInput,r,t))})),this},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getLangDir:function(){return this.dir},getQuery:function(){return this.query||""},setQuery:function(t,e){this.setInputValue(t),this._setQuery(t,e)},hasQueryChangedSinceLastFocus:function(){return this.query!==this.queryWhenFocused},getInputValue:function(){return this.$input.val()},setInputValue:function(t){this.$input.val(t),this.clearHintIfInvalid(),this._checkLanguageDirection()},resetInputValue:function(){this.setInputValue(this.query)},getHint:function(){return this.$hint.val()},setHint:function(t){this.$hint.val(t)},clearHint:function(){this.setHint("")},clearHintIfInvalid:function(){var t,e,i;i=(t=this.getInputValue())!==(e=this.getHint())&&0===e.indexOf(t),(""===t||!i||this.hasOverflow())&&this.clearHint()},hasFocus:function(){return this.$input.is(":focus")},hasOverflow:function(){var t=this.$input.width()-2;return this.$overflowHelper.text(this.getInputValue()),this.$overflowHelper.width()>=t},isCursorAtEnd:function(){var t,i,s;return t=this.$input.val().length,i=this.$input[0].selectionStart,e.isNumber(i)?i===t:!document.selection||((s=document.selection.createRange()).moveStart("character",-t),t===s.text.length)},destroy:function(){this.$hint.off(".tt"),this.$input.off(".tt"),this.$overflowHelper.remove(),this.$hint=this.$input=this.$overflowHelper=t("<div>")}}),s;function n(e){return t('<pre aria-hidden="true"></pre>').css({position:"absolute",visibility:"hidden",whiteSpace:"pre",fontFamily:e.css("font-family"),fontSize:e.css("font-size"),fontStyle:e.css("font-style"),fontVariant:e.css("font-variant"),fontWeight:e.css("font-weight"),wordSpacing:e.css("word-spacing"),letterSpacing:e.css("letter-spacing"),textIndent:e.css("text-indent"),textRendering:e.css("text-rendering"),textTransform:e.css("text-transform")}).insertAfter(e)}function r(t,e){return s.normalizeQuery(t)===s.normalizeQuery(e)}function a(t){return t.altKey||t.ctrlKey||t.metaKey||t.shiftKey}}(),a=function(){var i,s;function r(i,o){(i=i||{}).templates=i.templates||{},i.templates.notFound=i.templates.notFound||i.templates.empty,i.source||t.error("missing source"),i.node||t.error("missing node"),i.name&&!h(i.name)&&t.error("invalid dataset name: "+i.name),o.mixin(this),this.highlight=!!i.highlight,this.name=i.name||s(),this.limit=i.limit||5,this.displayFn=a(i.display||i.displayKey),this.templates=l(i.templates,this.displayFn),this.source=i.source.__ttAdapter?i.source.__ttAdapter():i.source,this.async=e.isUndefined(i.async)?this.source.length>2:!!i.async,this._resetLastSuggestion(),this.$el=t(i.node).addClass(this.classes.dataset).addClass(this.classes.dataset+"-"+this.name)}return i={val:"tt-selectable-display",obj:"tt-selectable-object"},s=e.getIdGenerator(),r.extractData=function(e){var s=t(e);return s.data(i.obj)?{val:s.data(i.val)||"",obj:s.data(i.obj)||null}:null},e.mixin(r.prototype,o,{_overwrite:function(t,e){(e=e||[]).length?this._renderSuggestions(t,e):this.async&&this.templates.pending?this._renderPending(t):!this.async&&this.templates.notFound?this._renderNotFound(t):this._empty(),this.trigger("rendered",this.name,e,!1)},_append:function(t,e){(e=e||[]).length&&this.$lastSuggestion.length?this._appendSuggestions(t,e):e.length?this._renderSuggestions(t,e):!this.$lastSuggestion.length&&this.templates.notFound&&this._renderNotFound(t),this.trigger("rendered",this.name,e,!0)},_renderSuggestions:function(t,e){var i;i=this._getSuggestionsFragment(t,e),this.$lastSuggestion=i.children().last(),this.$el.html(i).prepend(this._getHeader(t,e)).append(this._getFooter(t,e))},_appendSuggestions:function(t,e){var i,s;s=(i=this._getSuggestionsFragment(t,e)).children().last(),this.$lastSuggestion.after(i),this.$lastSuggestion=s},_renderPending:function(t){var e=this.templates.pending;this._resetLastSuggestion(),e&&this.$el.html(e({query:t,dataset:this.name}))},_renderNotFound:function(t){var e=this.templates.notFound;this._resetLastSuggestion(),e&&this.$el.html(e({query:t,dataset:this.name}))},_empty:function(){this.$el.empty(),this._resetLastSuggestion()},_getSuggestionsFragment:function(s,o){var r,a=this;return r=document.createDocumentFragment(),e.each(o,(function(e){var o,n;n=a._injectQuery(s,e),o=t(a.templates.suggestion(n)).data(i.obj,e).data(i.val,a.displayFn(e)).addClass(a.classes.suggestion+" "+a.classes.selectable),r.appendChild(o[0])})),this.highlight&&n({className:this.classes.highlight,node:r,pattern:s}),t(r)},_getFooter:function(t,e){return this.templates.footer?this.templates.footer({query:t,suggestions:e,dataset:this.name}):null},_getHeader:function(t,e){return this.templates.header?this.templates.header({query:t,suggestions:e,dataset:this.name}):null},_resetLastSuggestion:function(){this.$lastSuggestion=t()},_injectQuery:function(t,i){return e.isObject(i)?e.mixin({_query:t},i):i},update:function(e){var i=this,s=!1,o=!1,n=0;function r(t){o||(o=!0,t=(t||[]).slice(0,i.limit),n=t.length,i._overwrite(e,t),n<i.limit&&i.async&&i.trigger("asyncRequested",e))}function a(o){o=o||[],!s&&n<i.limit&&(i.cancel=t.noop,n+=o.length,i._append(e,o.slice(0,i.limit-n)),i.async&&i.trigger("asyncReceived",e))}this.cancel(),this.cancel=function(){s=!0,i.cancel=t.noop,i.async&&i.trigger("asyncCanceled",e)},this.source(e,r,a),!o&&r([])},cancel:t.noop,clear:function(){this._empty(),this.cancel(),this.trigger("cleared")},isEmpty:function(){return this.$el.is(":empty")},destroy:function(){this.$el=t("<div>")}}),r;function a(t){return t=t||e.stringify,e.isFunction(t)?t:i;function i(e){return e[t]}}function l(i,s){return{notFound:i.notFound&&e.templatify(i.notFound),pending:i.pending&&e.templatify(i.pending),header:i.header&&e.templatify(i.header),footer:i.footer&&e.templatify(i.footer),suggestion:i.suggestion||o};function o(e){return t("<div>").text(s(e))}}function h(t){return/^[_a-zA-Z0-9-]+$/.test(t)}}(),l=function(){function i(i,s){var o=this;function n(e){var i=o.$node.find(e.node).first();return e.node=i.length?i:t("<div>").appendTo(o.$node),new a(e,s)}(i=i||{}).node||t.error("node is required"),s.mixin(this),this.$node=t(i.node),this.query=null,this.datasets=e.map(i.datasets,n)}return e.mixin(i.prototype,o,{_onSelectableClick:function(e){this.trigger("selectableClicked",t(e.currentTarget))},_onRendered:function(t,e,i,s){this.$node.toggleClass(this.classes.empty,this._allDatasetsEmpty()),this.trigger("datasetRendered",e,i,s)},_onCleared:function(){this.$node.toggleClass(this.classes.empty,this._allDatasetsEmpty()),this.trigger("datasetCleared")},_propagate:function(){this.trigger.apply(this,arguments)},_allDatasetsEmpty:function(){return e.every(this.datasets,t);function t(t){return t.isEmpty()}},_getSelectables:function(){return this.$node.find(this.selectors.selectable)},_removeCursor:function(){var t=this.getActiveSelectable();t&&t.removeClass(this.classes.cursor)},_ensureVisible:function(t){var e,i,s,o;i=(e=t.position().top)+t.outerHeight(!0),s=this.$node.scrollTop(),o=this.$node.height()+parseInt(this.$node.css("paddingTop"),10)+parseInt(this.$node.css("paddingBottom"),10),e<0?this.$node.scrollTop(s+e):o<i&&this.$node.scrollTop(s+(i-o))},bind:function(){var t,i=this;return t=e.bind(this._onSelectableClick,this),this.$node.on("click.tt",this.selectors.selectable,t),e.each(this.datasets,(function(t){t.onSync("asyncRequested",i._propagate,i).onSync("asyncCanceled",i._propagate,i).onSync("asyncReceived",i._propagate,i).onSync("rendered",i._onRendered,i).onSync("cleared",i._onCleared,i)})),this},isOpen:function(){return this.$node.hasClass(this.classes.open)},open:function(){this.$node.addClass(this.classes.open)},close:function(){this.$node.removeClass(this.classes.open),this._removeCursor()},setLanguageDirection:function(t){this.$node.attr("dir",t)},selectableRelativeToCursor:function(t){var e,i,s;return i=this.getActiveSelectable(),e=this._getSelectables(),-1===(s=(s=((s=(i?e.index(i):-1)+t)+1)%(e.length+1)-1)<-1?e.length-1:s)?null:e.eq(s)},setCursor:function(t){this._removeCursor(),(t=t&&t.first())&&(t.addClass(this.classes.cursor),this._ensureVisible(t))},getSelectableData:function(t){return t&&t.length?a.extractData(t):null},getActiveSelectable:function(){var t=this._getSelectables().filter(this.selectors.cursor).first();return t.length?t:null},getTopSelectable:function(){var t=this._getSelectables().first();return t.length?t:null},update:function(t){var i=t!==this.query;return i&&(this.query=t,e.each(this.datasets,s)),i;function s(e){e.update(t)}},empty:function(){function t(t){t.clear()}e.each(this.datasets,t),this.query=null,this.$node.addClass(this.classes.empty)},destroy:function(){function i(t){t.destroy()}this.$node.off(".tt"),this.$node=t("<div>"),e.each(this.datasets,i)}}),i}(),h=function(){var t=l.prototype;function i(){l.apply(this,[].slice.call(arguments,0))}return e.mixin(i.prototype,l.prototype,{open:function(){return!this._allDatasetsEmpty()&&this._show(),t.open.apply(this,[].slice.call(arguments,0))},close:function(){return this._hide(),t.close.apply(this,[].slice.call(arguments,0))},_onRendered:function(){return this._allDatasetsEmpty()?this._hide():this.isOpen()&&this._show(),t._onRendered.apply(this,[].slice.call(arguments,0))},_onCleared:function(){return this._allDatasetsEmpty()?this._hide():this.isOpen()&&this._show(),t._onCleared.apply(this,[].slice.call(arguments,0))},setLanguageDirection:function(e){return this.$node.css("ltr"===e?this.css.ltr:this.css.rtl),t.setLanguageDirection.apply(this,[].slice.call(arguments,0))},_hide:function(){this.$node.hide()},_show:function(){this.$node.css("display","block")}}),i}(),c=function(){function i(i,o){var n,r,a,l,h,c,d,u,p,m,g;(i=i||{}).input||t.error("missing input"),i.menu||t.error("missing menu"),i.eventBus||t.error("missing event bus"),o.mixin(this),this.eventBus=i.eventBus,this.minLength=e.isNumber(i.minLength)?i.minLength:1,this.input=i.input,this.menu=i.menu,this.enabled=!0,this.active=!1,this.input.hasFocus()&&this.activate(),this.dir=this.input.getLangDir(),this._hacks(),this.menu.bind().onSync("selectableClicked",this._onSelectableClicked,this).onSync("asyncRequested",this._onAsyncRequested,this).onSync("asyncCanceled",this._onAsyncCanceled,this).onSync("asyncReceived",this._onAsyncReceived,this).onSync("datasetRendered",this._onDatasetRendered,this).onSync("datasetCleared",this._onDatasetCleared,this),n=s(this,"activate","open","_onFocused"),r=s(this,"deactivate","_onBlurred"),a=s(this,"isActive","isOpen","_onEnterKeyed"),l=s(this,"isActive","isOpen","_onTabKeyed"),h=s(this,"isActive","_onEscKeyed"),c=s(this,"isActive","open","_onUpKeyed"),d=s(this,"isActive","open","_onDownKeyed"),u=s(this,"isActive","isOpen","_onLeftKeyed"),p=s(this,"isActive","isOpen","_onRightKeyed"),m=s(this,"_openIfActive","_onQueryChanged"),g=s(this,"_openIfActive","_onWhitespaceChanged"),this.input.bind().onSync("focused",n,this).onSync("blurred",r,this).onSync("enterKeyed",a,this).onSync("tabKeyed",l,this).onSync("escKeyed",h,this).onSync("upKeyed",c,this).onSync("downKeyed",d,this).onSync("leftKeyed",u,this).onSync("rightKeyed",p,this).onSync("queryChanged",m,this).onSync("whitespaceChanged",g,this).onSync("langDirChanged",this._onLangDirChanged,this)}return e.mixin(i.prototype,{_hacks:function(){var i,s;i=this.input.$input||t("<div>"),s=this.menu.$node||t("<div>"),i.on("blur.tt",(function(t){var o,n,r;o=document.activeElement,n=s.is(o),r=s.has(o).length>0,e.isMsie()&&(n||r)&&(t.preventDefault(),t.stopImmediatePropagation(),e.defer((function(){i.focus()})))})),s.on("mousedown.tt",(function(t){t.preventDefault()}))},_onSelectableClicked:function(t,e){this.select(e)},_onDatasetCleared:function(){this._updateHint()},_onDatasetRendered:function(t,e,i,s){this._updateHint(),this.eventBus.trigger("render",i,s,e)},_onAsyncRequested:function(t,e,i){this.eventBus.trigger("asyncrequest",i,e)},_onAsyncCanceled:function(t,e,i){this.eventBus.trigger("asynccancel",i,e)},_onAsyncReceived:function(t,e,i){this.eventBus.trigger("asyncreceive",i,e)},_onFocused:function(){this._minLengthMet()&&this.menu.update(this.input.getQuery())},_onBlurred:function(){this.input.hasQueryChangedSinceLastFocus()&&this.eventBus.trigger("change",this.input.getQuery())},_onEnterKeyed:function(t,e){var i;(i=this.menu.getActiveSelectable())&&this.select(i)&&e.preventDefault()},_onTabKeyed:function(t,e){var i;(i=this.menu.getActiveSelectable())?this.select(i)&&e.preventDefault():(i=this.menu.getTopSelectable())&&this.autocomplete(i)&&e.preventDefault()},_onEscKeyed:function(){this.close()},_onUpKeyed:function(){this.moveCursor(-1)},_onDownKeyed:function(){this.moveCursor(1)},_onLeftKeyed:function(){"rtl"===this.dir&&this.input.isCursorAtEnd()&&this.autocomplete(this.menu.getTopSelectable())},_onRightKeyed:function(){"ltr"===this.dir&&this.input.isCursorAtEnd()&&this.autocomplete(this.menu.getTopSelectable())},_onQueryChanged:function(t,e){this._minLengthMet(e)?this.menu.update(e):this.menu.empty()},_onWhitespaceChanged:function(){this._updateHint()},_onLangDirChanged:function(t,e){this.dir!==e&&(this.dir=e,this.menu.setLanguageDirection(e))},_openIfActive:function(){this.isActive()&&this.open()},_minLengthMet:function(t){return(t=e.isString(t)?t:this.input.getQuery()||"").length>=this.minLength},_updateHint:function(){var t,i,s,o,n,a;t=this.menu.getTopSelectable(),i=this.menu.getSelectableData(t),s=this.input.getInputValue(),!i||e.isBlankString(s)||this.input.hasOverflow()?this.input.clearHint():(o=r.normalizeQuery(s),n=e.escapeRegExChars(o),(a=new RegExp("^(?:"+n+")(.+$)","i").exec(i.val))&&this.input.setHint(s+a[1]))},isEnabled:function(){return this.enabled},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},isActive:function(){return this.active},activate:function(){return!!this.isActive()||!(!this.isEnabled()||this.eventBus.before("active"))&&(this.active=!0,this.eventBus.trigger("active"),!0)},deactivate:function(){return!this.isActive()||!this.eventBus.before("idle")&&(this.active=!1,this.close(),this.eventBus.trigger("idle"),!0)},isOpen:function(){return this.menu.isOpen()},open:function(){return this.isOpen()||this.eventBus.before("open")||(this.menu.open(),this._updateHint(),this.eventBus.trigger("open")),this.isOpen()},close:function(){return this.isOpen()&&!this.eventBus.before("close")&&(this.menu.close(),this.input.clearHint(),this.input.resetInputValue(),this.eventBus.trigger("close")),!this.isOpen()},setVal:function(t){this.input.setQuery(e.toStr(t))},getVal:function(){return this.input.getQuery()},select:function(t){var e=this.menu.getSelectableData(t);return!(!e||this.eventBus.before("select",e.obj)||(this.input.setQuery(e.val,!0),this.eventBus.trigger("select",e.obj),this.close(),0))},autocomplete:function(t){var e,i;return e=this.input.getQuery(),!(!(i=this.menu.getSelectableData(t))||e===i.val||this.eventBus.before("autocomplete",i.obj)||(this.input.setQuery(i.val),this.eventBus.trigger("autocomplete",i.obj),0))},moveCursor:function(t){var e,i,s,o;return e=this.input.getQuery(),i=this.menu.selectableRelativeToCursor(t),o=(s=this.menu.getSelectableData(i))?s.obj:null,!(this._minLengthMet()&&this.menu.update(e)||this.eventBus.before("cursorchange",o)||(this.menu.setCursor(i),s?this.input.setInputValue(s.val):(this.input.resetInputValue(),this._updateHint()),this.eventBus.trigger("cursorchange",o),0))},destroy:function(){this.input.destroy(),this.menu.destroy()}}),i;function s(t){var i=[].slice.call(arguments,1);return function(){var s=[].slice.call(arguments);e.each(i,(function(e){return t[e].apply(t,s)}))}}}();!function(){var o,n,a;function d(e,i){e.each((function(){var e,s=t(this);(e=s.data(n.typeahead))&&i(e,s)}))}function u(t,e){return t.clone().addClass(e.classes.hint).removeData().css(e.css.hint).css(m(t)).prop("readonly",!0).removeAttr("id name placeholder required").attr({autocomplete:"off",spellcheck:"false",tabindex:-1})}function p(t,e){t.data(n.attrs,{dir:t.attr("dir"),autocomplete:t.attr("autocomplete"),spellcheck:t.attr("spellcheck"),style:t.attr("style")}),t.addClass(e.classes.input).attr({autocomplete:"off",spellcheck:!1});try{!t.attr("dir")&&t.attr("dir","auto")}catch(t){}return t}function m(t){return{backgroundAttachment:t.css("background-attachment"),backgroundClip:t.css("background-clip"),backgroundColor:t.css("background-color"),backgroundImage:t.css("background-image"),backgroundOrigin:t.css("background-origin"),backgroundPosition:t.css("background-position"),backgroundRepeat:t.css("background-repeat"),backgroundSize:t.css("background-size")}}function g(t){var i,s;i=t.data(n.www),s=t.parent().filter(i.selectors.wrapper),e.each(t.data(n.attrs),(function(i,s){e.isUndefined(i)?t.removeAttr(s):t.attr(s,i)})),t.removeData(n.typeahead).removeData(n.www).removeData(n.attr).removeClass(i.classes.input),s.length&&(t.detach().insertAfter(s),s.remove())}function f(i){var s;return(s=e.isJQuery(i)||e.isElement(i)?t(i).first():[]).length?s:null}o=t.fn.typeahead,n={www:"tt-www",attrs:"tt-attrs",typeahead:"tt-typeahead"},a={initialize:function(o,a){var d;return a=e.isArray(a)?a:[].slice.call(arguments,1),d=i((o=o||{}).classNames),this.each(m);function m(){var i,m,g,v,y,b,w,x,k,S,E;e.each(a,(function(t){t.highlight=!!o.highlight})),i=t(this),m=t(d.html.wrapper),g=f(o.hint),v=f(o.menu),y=!1!==o.hint&&!g,b=!1!==o.menu&&!v,y&&(g=u(i,d)),b&&(v=t(d.html.menu).css(d.css.menu)),g&&g.val(""),i=p(i,d),(y||b)&&(m.css(d.css.wrapper),i.css(y?d.css.input:d.css.inputWithNoHint),i.wrap(m).parent().prepend(y?g:null).append(b?v:null)),E=b?h:l,w=new s({el:i}),x=new r({hint:g,input:i},d),k=new E({node:v,datasets:a},d),S=new c({input:x,menu:k,eventBus:w,minLength:o.minLength},d),i.data(n.www,d),i.data(n.typeahead,S)}},isEnabled:function(){var t;return d(this.first(),(function(e){t=e.isEnabled()})),t},enable:function(){return d(this,(function(t){t.enable()})),this},disable:function(){return d(this,(function(t){t.disable()})),this},isActive:function(){var t;return d(this.first(),(function(e){t=e.isActive()})),t},activate:function(){return d(this,(function(t){t.activate()})),this},deactivate:function(){return d(this,(function(t){t.deactivate()})),this},isOpen:function(){var t;return d(this.first(),(function(e){t=e.isOpen()})),t},open:function(){return d(this,(function(t){t.open()})),this},close:function(){return d(this,(function(t){t.close()})),this},select:function(e){var i=!1,s=t(e);return d(this.first(),(function(t){i=t.select(s)})),i},autocomplete:function(e){var i=!1,s=t(e);return d(this.first(),(function(t){i=t.autocomplete(s)})),i},moveCursor:function(t){var e=!1;return d(this.first(),(function(i){e=i.moveCursor(t)})),e},val:function(t){var e;return arguments.length?(d(this,(function(e){e.setVal(t)})),this):(d(this.first(),(function(t){e=t.getVal()})),e)},destroy:function(){return d(this,(function(t,e){g(e),t.destroy()})),this}},t.fn.typeahead=function(t){return a[t]?a[t].apply(this,[].slice.call(arguments,1)):a.initialize.apply(this,arguments)},t.fn.typeahead.noConflict=function(){return t.fn.typeahead=o,this}}()}(Po()));const Io=jQuery;class No extends Ut{constructor(e,i,o){super(e,i,o),this.label=this.label||(void 0===e.label?"Location":e.label),this.name="location",this.db_type="text",this.typeLabel="Location",this.languages=[{value:"sq",label:"Albanian"},{value:"ar",label:"Arabic"},{value:"eu",label:"Basque"},{value:"be",label:"Belarusian"},{value:"bg",label:"Bulgarian"},{value:"my",label:"Burmese"},{value:"bn",label:"Bengali"},{value:"ca",label:"Catalan"},{value:"zh-cn",label:"Chinese (simplified)"},{value:"zh-tw",label:"Chinese (traditional)"},{value:"hr",label:"Croatian"},{value:"cs",label:"Czech"},{value:"da",label:"Danish"},{value:"nl",label:"Dutch"},{value:"en",label:"English"},{value:"en-au",label:"English (australian)"},{value:"en-gb",label:"English (great Britain)"},{value:"fa",label:"Farsi"},{value:"fi",label:"Finnish"},{value:"fil",label:"Filipino"},{value:"fr",label:"French"},{value:"gl",label:"Galician"},{value:"de",label:"German"},{value:"el",label:"Greek"},{value:"gu",label:"Gujarati"},{value:"iw",label:"Hebrew"},{value:"hi",label:"Hindi"},{value:"hu",label:"Hungarian"},{value:"id",label:"Indonesian"},{value:"it",label:"Italian"},{value:"ja",label:"Japanese"},{value:"kn",label:"Kannada"},{value:"kk",label:"Kazakh"},{value:"ko",label:"Korean"},{value:"ky",label:"Kyrgyz"},{value:"lt",label:"Lithuanian"},{value:"lv",label:"Latvian"},{value:"mk",label:"Macedonian"},{value:"ml",label:"Malayalam"},{value:"mr",label:"Marathi"},{value:"no",label:"Norwegian"},{value:"pl",label:"Polish"},{value:"pt",label:"Portuguese"},{value:"pt-br",label:"Portuguese (brazil)"},{value:"pt-pt",label:"Portuguese (portugal)"},{value:"pa",label:"Punjabi"},{value:"ro",label:"Romanian"},{value:"ru",label:"Russian"},{value:"sr",label:"Serbian"},{value:"sk",label:"Slovak"},{value:"sl",label:"Slovenian"},{value:"es",label:"Spanish"},{value:"sv",label:"Swedish"},{value:"tl",label:"Tagalog"},{value:"ta",label:"Tamil"},{value:"te",label:"Telugu"},{value:"th",label:"Thai"},{value:"tr",label:"Turkish"},{value:"uk",label:"Ukrainian"},{value:"uz",label:"Uzbek"},{value:"vi",label:"Vietnamese"}],this.language=e.language,this.markerImages=s.markerImages,this.markersByField=e.markersByField,this.markerField=e.markerField,this.markersByFieldEnabled=t(e.markersByFieldEnabled),this.defaultMarkerPath=e.defaultMarkerPath||this.formBuilder.mapsvg.getData().options.defaultMarkerImage,this.templates.marker=Handlebars.compile(Io("#mapsvg-data-tmpl-marker").html())}init(){super.init(),this.value&&this.renderMarker(),this.renderMarkerSelector()}getSchema(){const e=super.getSchema();return e.language=this.language,e.defaultMarkerPath=this.defaultMarkerPath,e.markersByField=this.markersByField,e.markerField=this.markerField,e.markersByFieldEnabled=t(this.markersByFieldEnabled),e}getData(){return{name:this.name,value:this.value}}getDataForTemplate(){const e=super.getDataForTemplate();if(this.formBuilder.admin){e.languages=this.languages,e.markerImages=window.mapsvgAdmin?window.mapsvgAdmin.getData().options.markerImages:[],e.markersByField=this.markersByField,e.markerField=this.markerField,e.markersByFieldEnabled=t(this.markersByFieldEnabled);const i=this;e.markerImages.forEach((function(t){t.relativeUrl===i.defaultMarkerPath?t.default=!0:t.default=!1}))}return e.language=this.language,this.value&&(e.location=this.value,e.location.marker&&(e.location.img=(0===this.value.marker.src.indexOf(s.routes.uploads)?"uploads/":"")+this.value.marker.src.split("/").pop())),e.showUploadBtn=e.external.filtersMode,e}initEditor(){super.initEditor(),this.renderMarkerSelector(),this.fillMarkersByFieldOptions(this.markerField)}setDomElements(){super.setDomElements(),this.domElements.markerImageButton=Io(this.domElements.main).find("img")[0]}setEventHandlers(){super.setEventHandlers();const t=this,e=new At(s.routes.api);if(t.formBuilder.mapsvg.isGeo()){new yi({datumTokenizer:yi.tokenizers.obj.whitespace("formatted_address"),queryTokenizer:yi.tokenizers.whitespace,remote:{url:e.getUrl("geocoding")+"?address=%QUERY%&language="+this.language,wildcard:"%QUERY%",transform:function(t){return t.error_message&&alert(t.error_message),t.results},rateLimitWait:600}});const t=Io(this.domElements.main).find(".typeahead");t.typeahead({minLength:3},{name:"mapsvg-addresses",display:"formatted_address",async:!0,source:(t,e,i)=>{if(new RegExp(/^[-+]?([1-8]?\d(\.\d+)?|90(\.0+)?),\s*[-+]?(180(\.0+)?|((1[0-7]\d)|([1-9]?\d))(\.\d+)?)$/).test(t)){const i=t.split(",").map((t=>t.trim()));e([{formatted_address:i.join(","),address_components:[],geometry:{location:{lat:()=>i[0],lng:()=>i[1]}}}])}else p({address:t},i)}}).on("typeahead:asyncrequest",(function(t){Io(t.target).addClass("tt-loading")})).on("typeahead:asynccancel typeahead:asyncreceive",(function(t){Io(t.target).removeClass("tt-loading")})),t.on("typeahead:select",((e,i)=>{this.setValue(null,!1);const s={};s.formatted=i.formatted_address,i.address_components.forEach((t=>{const e=t.types[0];s[e]=t.long_name,t.short_name!=t.long_name&&(s[e+"_short"]=t.short_name)}));const o={address:s,geoPoint:new Tt(i.geometry.location.lat(),i.geometry.location.lng()),img:this.getMarkerImage(this.formBuilder.getData()),imagePath:this.getMarkerImage(this.formBuilder.getData())};this.setValue(o,!1),t.typeahead("val",""),this.triggerChanged()}))}Io(this.domElements.main).on("change",".marker-file-uploader",(function(){t.markerIconUpload(this)})),Io(this.domElements.main).on("click",".mapsvg-marker-image-btn-trigger",(function(e){e.preventDefault(),Io(this).toggleClass("active"),t.toggleMarkerSelector()})),Io(this.domElements.main).on("click",".mapsvg-marker-delete",(function(e){e.preventDefault(),t.setValue(null),t.triggerChanged()}))}setEditorEventHandlers(){super.setEditorEventHandlers();const t=this;Io(this.domElements.edit).on("change",".marker-file-uploader",(function(){t.markerIconUpload(this)})),Io(this.domElements.edit).on("change",'select[name="markerField"]',(function(){const e=Io(this).val();t.resetMarkersByField();const i=t.fillMarkersByFieldOptions(e);t.setMarkersByField(i)})),Io(this.domElements.edit).on("click",".mapsvg-marker-image-selector button",(function(e){e.preventDefault();const i=Io(this).find("img").attr("src");Io(this).parent().find("button").removeClass("active"),Io(this).addClass("active"),t.setDefaultMarkerPath(i)})),Io(this.domElements.edit).on("click",".mapsvg-marker-image-btn-trigger",(function(e){Io(this).toggleClass("active"),t.toggleMarkerSelectorInLocationEditor.call(t,Io(this),e)}))}markerIconUpload(t){const e=Io(t).closest(".btn-file").buttonLoading(!0);for(let i=0;i<t.files.length;i++){const i=new FormData;i.append("file",t.files[0]);new At(s.routes.api).ajax("markers",{type:"POST",data:i,processData:!1,contentType:!1}).done((t=>{if(t.error)alert(t.error);else{const e=t.marker,i=`\n                            <button class="btn btn-outline-secondary mapsvg-marker-image-btn mapsvg-marker-image-btn-choose active">\n                                <img src="${e.relativeUrl}" />\n                            </button>\n                            </button>\n                        `;Io(this.domElements.markerSelector).find(".mapsvg-marker-image-btn.active").removeClass("active"),Io(i).appendTo(this.domElements.markerSelector),this.setMarkerImage(e.relativeUrl);window.mapsvgAdmin.getData().options.markerImages.push(e)}})).always((function(){e.buttonLoading(!1)}))}}mayBeAddDistanceRow(){const t=this;this.domElements.editDistanceRow||(this.domElements.editDistanceRow=Io(Io("#mapsvg-edit-distance-row").html())[0]);const e=Io(this.domElements.edit).find(".mapsvg-edit-distance-row:last-child input");if(e&&e.last()&&e.last().val()&&(e.last().val()+"").trim().length){Io(this.templates.editDistanceRow).clone().insertAfter(Io(t.domElements.edit).find(".mapsvg-edit-distance-row:last-child"))}const i=Io(t.domElements.edit).find(".mapsvg-edit-distance-row"),s=i.eq(i.length-2),o=i.eq(i.length-1);s.length&&o.length&&!s.find("input:eq(0)").val().toString().trim()&&!o.find("input:eq(0)").val().toString().trim()&&o.remove()}fillMarkersByFieldOptions(t){const e=this,i=e.formBuilder.mapsvg.objectsRepository.getSchema().getField(t),s={};if(i){const t=e.formBuilder.mapsvg.options.defaultMarkerImage,o=[];i.options.forEach((function(n){const r="region"===i.type?n.id:n.value,a="region"===i.type?n.title||n.id:n.label,l=e.markersByField&&e.markersByField[r]?e.markersByField[r]:t;o.push('<tr data-option-id="'+r+'"><td>'+a+'</td><td><button class="btn dropdown-toggle btn-outline-secondary mapsvg-marker-image-btn-trigger mapsvg-marker-image-btn"><img src="'+l+'" class="new-marker-img" /><span class="caret"></span></button></td></tr>'),s[r]=l})),Io("#markers-by-field").empty().append(o)}return s}renderMarker(t){t&&t.location&&(this.value=t.location.getData()),this.renderMarkerHtml()}renderMarkerHtml(){this.value?Io(this.domElements.main).find(".mapsvg-new-marker").show().html(this.templates.marker(this.value)):Io(this.domElements.main).find(".mapsvg-new-marker").hide()}toggleMarkerSelector(){if(!this.domElements.markerSelectorWrap||!Io(this.domElements.markerSelectorWrap).is(":visible"))return this.domElements.markerSelectorWrap&&Io(this.domElements.markerSelectorWrap).not(":visible")?(Io(this.domElements.markerSelector).find(".active").removeClass("active"),this.value&&this.value.markerImagePath&&Io(this.domElements.markerSelector).find('[src="'+this.value.markerImagePath+'"]').parent().addClass("active"),void Io(this.domElements.markerSelectorWrap).show()):void 0;Io(this.domElements.markerSelectorWrap).hide()}renderMarkerSelector(){const t=this,e=this.formBuilder.editMode?this.domElements.edit:this.domElements.main;if(!e)return;const i=this.value?this.value.markerImagePath:null,s=(window.mapsvgAdmin?window.mapsvgAdmin.getData().options.markerImages:[]).map((function(t){return'<button class="btn btn-outline-secondary mapsvg-marker-image-btn mapsvg-marker-image-btn-choose '+(i==t.relativeUrl?"active":"")+'"><img src="'+t.relativeUrl+'" /></button>'}));this.domElements.markerSelectorWrap=Io(e).find(".mapsvg-marker-image-selector")[0],this.domElements.markerSelector=Io(this.domElements.markerSelectorWrap).find(".mapsvg-marker-images")[0],this.domElements.markerSelector&&Io(this.domElements.markerSelector).empty(),this.formBuilder.editMode||(this.domElements.markerSelectorWrap.style.display="none",Io(this.domElements.markerSelector).on("click",".mapsvg-marker-image-btn-choose",(function(e){e.preventDefault();const i=Io(this).find("img").attr("src");Io(t.domElements.markerSelectorWrap).hide(),Io(t.domElements.markerSelector).find(".active").removeClass("active"),Io(this).addClass("active"),Io(t.domElements.main).find(".mapsvg-marker-image-btn-trigger").toggleClass("active",!1),Io(t.domElements.markerImageButton).attr("src",i),t.setMarkerImage(i)}))),Io(this.domElements.markerSelector).html(s.join(""))}setMarkerImage(t){this.setDefaultMarkerPath(t);const e=this.value;e&&(e.img=t,e.imagePath=t,this.setValue(e),this.triggerChanged(),this.renderMarker())}toggleMarkerSelectorInLocationEditor(t,e){e.preventDefault();const i=this;if(t.data("markerSelector")&&t.data("markerSelector").is(":visible"))return void t.data("markerSelector").hide();if(t.data("markerSelector")&&t.data("markerSelector").not(":visible"))return void t.data("markerSelector").show();const s=Io(this).closest("td").find(".mapsvg-marker-image-btn-trigger").attr("src"),o=(window.mapsvgAdmin?window.mapsvgAdmin.getData().options.markerImages:[]).map((function(t){return'<button class="btn btn-outline-secondary mapsvg-marker-image-btn mapsvg-marker-image-btn-choose '+(s==t.relativeUrl?"active":"")+'"><img src="'+t.relativeUrl+'" /></button>'}));if(t.data("markerSelector"))t.data("markerSelector").empty();else{const e=Io('<div class="mapsvg-marker-image-selector"></div>');t.closest("td").append(e),t.data("markerSelector",e)}t.data("markerSelector").html(o.join("")),t.data("markerSelector").on("click",".mapsvg-marker-image-btn-choose",(function(e){e.preventDefault();const s=Io(this).find("img").attr("src");t.data("markerSelector").hide();const o=Io(this).closest("td"),n=Io(this).closest("tr").data("option-id"),r=o.find(".mapsvg-marker-image-btn-trigger");r.toggleClass("active",!1),r.find("img").attr("src",s),i.setMarkerByField(n,s)}))}setMarkersByField(t){this.markersByField=t}resetMarkersByField(){this.markersByField={}}setMarkerByField(t,e){this.markersByField=this.markersByField||{},this.markersByField[t]=e}deleteMarker(){Io(this.domElements.main).find(".mapsvg-new-marker").hide(),Io(this.domElements.main).find(".mapsvg-marker-id").attr("disabled","disabled")}destroy(){super.destroy(),this.domElements.markerSelector&&Io(this.domElements.markerSelector).popover("dispose")}setDefaultMarkerPath(t){this.defaultMarkerPath=t,this.formBuilder.mapsvg.setDefaultMarkerImage(t)}getMarkerImage(t){let e;return this.markersByFieldEnabled?(e=t[this.markerField],e?("regions"===this.markerField?e=e[0]&&e[0].id:"object"==typeof e&&e.length&&(e=e[0].value),this.markersByField[e]?this.markersByField[e]||this.defaultMarkerPath||s.defaultMarkerImage:void 0):this.defaultMarkerPath||s.defaultMarkerImage):this.defaultMarkerPath||s.defaultMarkerImage}setValue(t,e=!0){this.value=t,this.value&&(this.value.address||(this.value.address={}),Object.keys(this.value.address).length<2&&this.value.geoPoint&&(this.value.address.formatted=this.value.geoPoint.lat+","+this.value.geoPoint.lng)),this.renderMarker()}}jQuery;class Ho extends Ut{constructor(t,e,i){super(t,e,i),this.showButtonText=t.showButtonText,this.typeLabel="Modal"}getSchema(){const t=super.getSchema();return t.showButtonText=this.showButtonText,t}}const zo=jQuery;class Vo extends Ut{constructor(e,i,s){super(e,i,s),this.formBuilder.admin&&(this.post_types=this.formBuilder.admin.getPostTypes()),this.post_type=e.post_type||this.post_types[0],this.add_fields=t(e.add_fields),this.db_type="int(11)",this.name="post",this.typeLabel="WP Post",this.post=e.post}setDomElements(){super.setDomElements(),this.inputs.postSelect=zo(this.domElements.main).find(".mapsvg-find-post")[0]}getSchema(){const t=super.getSchema();return t.post_type=this.post_type,t.add_fields=this.add_fields,t}destroy(){if(zo().mselect2){const t=zo(this.domElements.main).find(".mapsvg-select2");t.length&&t.mselect2("destroy")}}getDataForTemplate(){const t=super.getDataForTemplate();return this.formBuilder.admin&&(t.post_types=this.formBuilder.admin.getPostTypes()),t.post_type=this.post_type,t.post=this.post,t.add_fields=this.add_fields||0,t}setEventHandlers(){super.setEventHandlers();const t=new At(s.routes.api);zo(this.inputs.postSelect).mselect2({placeholder:"Search post by title",allowClear:!0,disabled:this.readonly,ajax:{url:t.getUrl("posts"),dataType:"json",delay:250,data:t=>({filters:{post_type:this.post_type},search:t.term,page:t.page}),processResults:(t,e)=>(e.page=e.page||1,{results:t.posts?t.posts:[],pagination:{more:!1}}),cache:!0},escapeMarkup:t=>t,minimumInputLength:1,templateResult:this.formatRepo,templateSelection:this.formatRepoSelection}).on("select2:select",(t=>{const e=t.params.data;this.setValue(e),this.setInputValue(e),this.triggerChanged()})).on("change",(t=>{""===t.target.value&&(zo(this.domElements.main).find(".mapsvg-post-id").text(""),zo(this.domElements.main).find(".mapsvg-post-url").text(""),this.setValue(null,!1),this.triggerChanged())}))}formatRepo(t){return t.loading?t.text:"<div class='select2-result-repository clearfix'>"+t.post_title+"</div>"}formatRepoSelection(t){return(null==t?void 0:t.post_title)||t.text}setValue(t,e=!0){this.value=t,e&&this.setInputValue(t)}setInputValue(t){zo(this.domElements.main).find(".mapsvg-post-id").text(t.id),zo(this.domElements.main).find(".mapsvg-post-url").text(t.url).attr("href",t.url)}}const qo=jQuery;class Go extends Ut{constructor(t,e,i){super(t,e,i),this.setOptions(t.options)}setDomElements(){super.setDomElements(),this.inputs.radios=this.formBuilder.getForm().elements[this.name],this.$radios=qo(this.domElements.main).find('input[type="radio"]'),this.typeLabel="Radio"}setEventHandlers(){super.setEventHandlers(),this.$radios.on("change",(t=>{this.setValue(t.target.value,!1),this.triggerChanged()}))}setInputValue(t){null===t?this.$radios.prop("checked",!1):this.inputs.radios.value=t}}const Uo=jQuery;class Wo extends Ut{constructor(e,i,s){super(e,i,s),this.searchable=t(e.searchable),this.options=this.formBuilder.getRegionsList(),this.label=void 0===e.label?"Regions":e.label,this.name="regions",this.db_type="text",this.typeLabel="Regions",void 0===this.value&&(this.value=[]),this.regionsTableName=this.formBuilder.mapsvg.regionsRepository.getSchema().name}setDomElements(){super.setDomElements(),this.inputs.select=Uo(this.domElements.main).find("select")[0]}getData(){return{name:"regions",value:this.value}}getSchema(){const t=super.getSchema();t.multiselect&&(t.db_type="text");const e=h({},{options:this.options});return t.options=e.options,t.optionsDict={},t.options.forEach((function(e){t.optionsDict[e.id]=e.title||e.id})),t}getDataForTemplate(){const t=super.getDataForTemplate();return t.regionsTableName=this.regionsTableName,t.regionsFromCurrentTable=this.getRegionsForCurrentTable(),t}getRegionsForCurrentTable(){return this.value?this.value.filter((t=>t.tableName===this.regionsTableName)):[]}setEventHandlers(){super.setEventHandlers(),Uo(this.inputs.select).on("change",(t=>{const e=Array.from(this.inputs.select.selectedOptions).map((t=>t.value));this.setValue(e,!1),this.triggerChanged()}))}destroy(){if(Uo().mselect2){const t=Uo(this.domElements.main).find(".mapsvg-select2");t.length&&t.mselect2("destroy")}super.destroy()}setValue(t,e=!0){const i=this.value.filter((t=>t.tableName!==this.regionsTableName)),s=[];t.forEach((t=>{const e=this.formBuilder.mapsvg.getRegion(t);s.push({id:e.id,title:e.title,tableName:this.regionsTableName})})),this.value=s.concat(i),e&&this.setInputValue(t)}}const $o=jQuery;class Xo extends Ut{constructor(t,e,i){super(t,e,i),this.readonly=!0}setDomElements(){super.setDomElements(),this.inputs.btnSave=$o(this.domElements.main).find(".btn-save")[0],this.inputs.btnClose=$o(this.domElements.main).find(".mapsvg-close")[0]}setEventHandlers(){super.setEventHandlers(),$o(this.inputs.btnSave).on("click",(t=>{t.preventDefault(),this.events.trigger("click.btn.save")})),$o(this.inputs.btnClose).on("click",(t=>{t.preventDefault(),this.events.trigger("click.btn.close")}))}}const Qo=jQuery;class Yo extends Ut{constructor(e,i,s){super(e,i,s),this.searchable=t(e.searchable),this.multiselect=t(e.multiselect),this.optionsGrouped=e.optionsGrouped,this.db_type=this.multiselect?"text":"varchar(255)",this.typeLabel="Select",this.setOptions(e.options)}setDomElements(){super.setDomElements(),this.inputs.select=Qo(this.domElements.main).find("select")[0]}getSchema(){const e=super.getSchema();e.multiselect=t(this.multiselect),e.multiselect&&(e.db_type="text"),e.optionsGrouped=this.optionsGrouped;const i=h({},{options:this.options});return e.options=i.options||[],e.optionsDict={},e.options.forEach((function(t){e.optionsDict[t.value]=t.label})),e}setEventHandlers(){super.setEventHandlers(),Qo(this.inputs.select).on("change",(t=>{if(this.multiselect){const t=Array.from(this.inputs.select.selectedOptions).map((t=>({label:t.label,value:t.value})));this.setValue(t,!1),this.triggerChanged()}else this.setValue(this.inputs.select.value,!1),this.triggerChanged()}))}addSelect2(){if(Qo().mselect2){const t={};this.formBuilder.filtersMode&&"select"==this.type&&(t.placeholder=this.placeholder,this.multiselect||(t.allowClear=!0)),Qo(this.domElements.main).find("select").css({width:"100%",display:"block"}).mselect2(t).on("select2:focus",(function(){Qo(this).mselect2("open")})).on("select2:unselecting",(function(t){Qo(this).data("state","unselected")})).on("select2:open",(function(t){if("unselected"===Qo(this).data("state")){Qo(this).removeData("state");const t=Qo(this);setTimeout((function(){t.mselect2("close")}),1)}})),Qo(this.domElements.main).find(".select2-selection--multiple .select2-search__field").css("width","100%")}}setOptions(t){return t?(this.options=[],this.optionsDict={},t.forEach(((t,e)=>{this.options.push(t),this.optionsGrouped?t.options.forEach(((t,e)=>{this.optionsDict[t.value]=t})):this.optionsDict[e]=t})),this.options):this.setOptions([{label:"Option one",name:"option_one",value:1},{label:"Option two",name:"option_two",value:2}])}setInputValue(t){this.multiselect?this.value?Qo(this.inputs.select).val(this.value.map((t=>t.value))):Qo(this.inputs.select).val([]):this.inputs.select.value=this.value,Qo(this.inputs.select).trigger("change.select2")}}const Zo=jQuery;class Ko extends Ut{constructor(t,e,i){super(t,e,i),this.label=t.label||"Status",this.name="status",this.typeLabel="Status",this.setOptions(t.options)}setDomElements(){super.setDomElements(),this.inputs.select=Zo(this.domElements.main).find("select")[0],Zo().colorpicker&&(Zo(this.domElements.main).find(".cpicker").colorpicker().on("changeColor.colorpicker",(function(t){""==Zo(this).find("input").val()&&Zo(this).find("i").css({"background-color":""})})),this.domElements.edit&&Zo(this.domElements.edit).find(".cpicker").colorpicker().on("changeColor.colorpicker",(function(t){""==Zo(this).find("input").val()&&Zo(this).find("i").css({"background-color":""})})))}destroy(){if(Zo().mselect2){const t=Zo(this.domElements.main).find(".mapsvg-select2");t.length&&t.mselect2("destroy")}}setEditorEventHandlers(){super.setEditorEventHandlers();const t=this;Zo(this.domElements.edit).on("keyup change paste",".mapsvg-edit-status-row input",(function(){t.mayBeAddStatusRow()}))}initEditor(){super.initEditor();const t=this;Zo(t.domElements.edit).find(".cpicker").colorpicker().on("changeColor.colorpicker",(function(e){const i=Zo(this).find("input"),s=Zo(this).closest("tr").index();""==i.val()&&Zo(this).find("i").css({"background-color":""}),t.options[s]=t.options[s]||{label:"",value:"",color:"",disabled:!1},t.options[s].color=i.val()})),t.mayBeAddStatusRow()}mayBeAddStatusRow(){const t=this,e=Zo(Zo("#mapsvg-edit-status-row").html()),i=Zo(t.domElements.edit).find(".mapsvg-edit-status-label:last-child");if(i&&i.last()&&i.last().val()&&(i.last().val()+"").trim().length){const i=e.clone();i.insertAfter(Zo(t.domElements.edit).find(".mapsvg-edit-status-row:last-child")),i.find(".cpicker").colorpicker().on("changeColor.colorpicker",(function(e){const i=Zo(this).find("input"),s=Zo(this).closest("tr").index();""==i.val()&&Zo(this).find("i").css({"background-color":""}),t.options[s]=t.options[s]||{label:"",value:"",color:"",disabled:!1},t.options[s].color=i.val()}))}const s=Zo(t.domElements.edit).find(".mapsvg-edit-status-row"),o=s.eq(s.length-2),n=s.eq(s.length-1);o.length&&n.length&&!(o.find("input:eq(0)").val().toString().trim()||o.find("input:eq(1)").val().toString().trim()||o.find("input:eq(2)").val().toString().trim())&&!(n.find("input:eq(0)").val().toString().trim()||n.find("input:eq(1)").val().toString().trim()||n.find("input:eq(2)").val().toString().trim())&&n.remove()}setEventHandlers(){super.setEventHandlers(),Zo(this.inputs.select).on("change keyup paste",(t=>{this.setValue(t.target.value,!1),this.triggerChanged()}))}getSchema(){const e=super.getSchema(),i=h({},{options:this.options});return e.options=i.options,e.optionsDict={},e.options.forEach((function(i,s){""===e.options[s].value?e.options.splice(s,1):(e.options[s].disabled=t(e.options[s].disabled),e.optionsDict[i.value]=i)})),e}setInputValue(t){this.inputs.select.value=t}}const Jo=jQuery;class tn extends Ut{constructor(e,i,s){super(e,i,s),this.searchFallback=t(e.searchFallback),this.searchType=e.searchType,this.width=this.formBuilder.filtersHide&&!this.formBuilder.modal?null:e.width||"100%",this.db_type="varchar(255)",this.typeLabel="Text"}setDomElements(){super.setDomElements(),this.inputs.text=Jo(this.domElements.main).find('input[name="'+this.name+'"]')[0]}getSchema(){const t=super.getSchema();return t.searchType=this.searchType,t}setEventHandlers(){super.setEventHandlers(),Jo(this.inputs.text).on("change keyup paste",(t=>{this.setValue(t.target.value,!1),this.triggerChanged()}))}setInputValue(t){this.inputs.text.value=t}}const en=jQuery;class sn extends Ut{constructor(e,i,s){super(e,i,s),this.searchType=e.searchType||"fulltext",this.searchable=t(e.searchable),this.autobr=e.autobr,this.html=e.html,this.format=this.html?"html":e.format||"text",this.db_type="text",this.typeLabel="Long text"}setDomElements(){if(super.setDomElements(),this.inputs.textarea=en(this.domElements.main).find("textarea")[0],"text"!==this.format){const t={html:{name:"handlebars",base:"text/html"},json:{name:"javascript",json:!0}};this.editor=window.CodeMirror.fromTextArea(this.inputs.textarea,{mode:t[this.format],matchBrackets:!0,lineNumbers:!0,lint:{esversion:2023,asi:!0},extraKeys:{Tab:function(t){t.replaceSelection("  ","end")}},gutters:["CodeMirror-lint-markers"]}),this.formBuilder.admin&&this.editor.on("change",this.setTextareaValue)}}setEventHandlers(){super.setEventHandlers(),en(this.inputs.textarea).on("change keyup paste",(t=>{this.setValue(t.target.value,!1),this.triggerChanged()}))}getSchema(){const t=super.getSchema();return t.autobr=this.autobr,t.html=this.html,t}getDataForTemplate(){const t=super.getDataForTemplate();return t.html=this.html,t}setTextareaValue(t){const e=t.getValue();en(t.getTextArea()).val(e).trigger("change")}destroy(){const t=en(this.domElements.main).find(".CodeMirror");t.length&&t.empty().remove(),super.destroy()}}const on=jQuery;class nn extends Ut{constructor(e,i,s){super(e,i,s),this.searchFallback=t(e.searchFallback),this.width=this.formBuilder.filtersHide&&!this.formBuilder.modal?null:e.width||"100%",this.db_type="varchar(255)",this.typeLabel="Title"}setDomElements(){super.setDomElements(),this.inputs.text=on(this.domElements.main).find('input[type="text"]')[0]}getSchema(){const t=super.getSchema();return t.searchType=this.searchType,t}setEventHandlers(){super.setEventHandlers(),on(this.inputs.text).on("change keyup paste",(t=>{this.setValue(t.target.value,!1),this.triggerChanged()}))}setInputValue(t){this.inputs.text.value=t}}jQuery;class rn{constructor(t){this.mapsvg=t.mapsvg,this.editMode=t.editMode,this.filtersMode=t.filtersMode,this.namespace=t.namespace,this.mediaUploader=t.mediaUploader,this.formBuilder=t.formBuilder,this.showNames=!1!==t.showNames}create(t){this.types={checkbox:$t,checkboxes:Qt,date:Zt,distance:wi,empty:Si,id:Ei,image:Mo,location:No,modal:Ho,post:Vo,radio:Go,region:Wo,save:Xo,select:Yo,status:Ko,text:tn,textarea:sn,title:nn,colorpicker:ki};const e=new this.types[t.type](t instanceof vt?t:new vt(t),this.formBuilder,this.getExtraParams());return e.init(),e}getExtraParams(){const t=[],e=[],i=[],s=[],o=[],n=new dt("id");let r=!1;if(this.mapsvg){r=this.mapsvg.isGeo();const a=this.mapsvg.objectsRepository.getSchema();a&&a.getFields().forEach((function(s){"text"!=s.type&&"region"!=s.type&&"textarea"!=s.type&&"post"!=s.type&&"select"!=s.type&&"radio"!=s.type&&"checkbox"!=s.type||("post"==s.type?t.push("Object.post.post_title"):t.push("Object."+s.name)),"region"!=s.type&&"select"!=s.type&&"radio"!=s.type||(e.push("Object."+s.name),i.push(s.name))}));const l=this.mapsvg.regionsRepository.getSchema();l&&l.getFields().forEach((function(t){"status"!=t.type&&"text"!=t.type&&"textarea"!=t.type&&"post"!=t.type&&"select"!=t.type&&"radio"!=t.type&&"checkbox"!=t.type||("post"==t.type?s.push("Region.post.post_title"):s.push("Region."+t.name)),"status"!=t.type&&"select"!=t.type&&"radio"!=t.type||o.push("Region."+t.name)})),this.mapsvg.regions.forEach((t=>{n.push({id:t.id,title:t.title})}))}return{databaseFields:t,databaseFieldsFilterable:e,databaseFieldsFilterableShort:i,regionFields:s,regionFieldsFilterable:o,regions:n,mapIsGeo:r,mediaUploader:this.mediaUploader,filtersMode:this.filtersMode,showNames:this.showNames}}}const an=jQuery;var ln;!function(t){t.AFTER_LOAD="afterLoad",t.CLEAR="clear"}(ln||(ln={}));class hn{constructor(t){if(this.container=t.container,this.namespace=t.namespace,this.mediaUploader=t.mediaUploader,this.schema=t.schema||[],this.editMode=null!=t.editMode&&t.editMode,this.filtersMode=null!=t.filtersMode&&t.filtersMode,this.filtersHide=null!=t.filtersHide&&t.filtersHide,this.modal=null!=t.modal&&t.modal,this.admin=t.admin,this.mapsvg=t.mapsvg,this.data=t.data||{},this.clearButton=t.clearButton||!1,this.clearButtonText=t.clearButtonText||"",this.searchButton=t.searchButton||!1,this.searchButtonText=t.searchButtonText||"",this.showButtonText=t.showButtonText||"",this.scrollable=void 0!==t.scrollable?t.scrollable:!this.editMode&&!this.filtersMode,this.showNames=void 0===t.showNames||t.showNames,this.events=new mt({context:this,contextName:"form",map:this.mapsvg,parent:t.parent&&t.parent.events?t.parent.events:void 0}),this.formElementFactory=new rn({mapsvg:this.mapsvg,formBuilder:this,mediaUploader:this.mediaUploader,editMode:this.editMode,filtersMode:this.filtersMode,namespace:this.namespace,showNames:this.showNames}),t.events&&Object.keys(t.events).length>0)for(const e in t.events)this.events.on(e,t.events[e]);this.template="form-builder",this.closeOnSave=!0===t.closeOnSave,this.newRecord=!0===t.newRecord,this.types=t.types||["text","textarea","checkbox","radio","select","image","region","location","post","date"],this.templates={},this.elements={},this.view=an("<div />").addClass("mapsvg-form-builder")[0],this.editMode&&an(this.view).addClass("full-flex"),this.showNames||an(this.view).addClass("hide-names"),this.formElements=new dt("name")}loadTemplates(t){an.get(s.routes.root+"dist/"+this.template+".html?v="+s.version,(e=>{an(e).appendTo("body"),s.templatesLoaded[this.template]=!0,Handlebars.registerPartial("dataMarkerPartial",an("#mapsvg-data-tmpl-marker").html()),this.editMode&&Handlebars.registerPartial("markerByFieldPartial",an("#mapsvg-markers-by-field-tmpl-partial").html()),t()}))}init(){if(!s.templatesLoaded[this.template])return void this.loadTemplates((()=>this.init()));const t=this;if(this.form=document.createElement("form"),this.form.className="mapsvg-data-form-view",this.filtersMode||this.form.classList.add("form-horizontal"),this.editMode){const t=document.getElementById("mapsvg-form-editor-tmpl-ui").innerHTML,e=Handlebars.compile(t),s=this.types.map((t=>{const e="string"==typeof t?t:t.name;return{name:e,label:"distance"===e?"Address search":i(e),premium:"object"==typeof t&&t.premium}}));this.view.innerHTML=e({types:s}),this.view.classList.add("edit"),this.form.classList.add("mapsvg-data-flex-full"),this.form.classList.add("mapsvg-data-container"),an(this.view).find(".mapsvg-data-preview").prepend(this.form),this.formEditor=an(this.view).find("#mapsvg-data-form-edit")[0]}else this.view.appendChild(this.form);t.elements={buttons:{text:an(t.view).find("#mapsvg-data-btn-text")[0],textarea:an(t.view).find("#mapsvg-data-btn-textarea")[0],checkbox:an(t.view).find("#mapsvg-data-btn-checkbox")[0],radio:an(t.view).find("#mapsvg-data-btn-radio")[0],select:an(t.view).find("#mapsvg-data-btn-select")[0],image:an(t.view).find("#mapsvg-data-btn-image")[0],region:an(t.view).find("#mapsvg-data-btn-region")[0],marker:an(t.view).find("#mapsvg-data-btn-marker")[0],saveSchema:an(t.view).find("#mapsvg-data-btn-save-schema")[0]},containers:{buttons_add:an(t.view).find("#mapsvg-data-buttons-add")[0]}},t.redraw()}getForm(){return this.form}getFormEditor(){return this.formEditor}viewDidLoad(){}setEventHandlers(){const t=this;an(this.getForm()).on("submit",(t=>{t.preventDefault()})),this.filtersMode&&this.clearButton&&an(this.elements.buttons.clearButton).on("click",(t=>{t.preventDefault(),this.clearAllFields()})),this.editMode&&(an(this.view).on("click","#mapsvg-data-buttons-add button[data-create]",(function(e){e.preventDefault();const i=an(this).data("create"),s=t.formElementFactory.create({type:i});t.addField(s)})),an(this.view).on("click","#mapsvg-data-btn-save-schema",(function(e){e.preventDefault();const i=t.getSchema(),s={};t.formElements.forEach((function(t){s[t.name]=(s[t.name]||0)+1})),an(t.getForm()).find(".form-group").removeClass("has-error");const o=[],n=["lat","lon","lng","location","location_lat","location_lon","location_lng","location_address","location_img","marker","marker_id","regions","region_id","post","post_title","post_url","keywords","status"],r={regions:"region",status:"status",post:"post",marker:"marker",location:"location"};let a,l;t.formElements.forEach((function(e){let i=!1;if(!t.filtersMode)if(s[e.name]>1)a||(a="Field names should be unique",o.push(a),i=!0);else if(0===e.name.length)l||(l="Field name can't be empty",o.push(l),i=!0);else if(-1!=n.indexOf(e.name)&&(!r[e.name]||r[e.name]&&r[e.name]!=e.type)){const t='Field name "'+e.name+'" is reserved, please set another name';o.push(t),i=!0}if(e.options&&"region"!=e.type&&"marker"!=e.type){const t=e.options.map((function(t){return t.value})),s=[...Array.from(new Set(t).values())];t.length!=s.length&&(o.push('Check "Options" list - values should not repeat'),i=!0)}i&&an(e.domElements.main).addClass("has-error")})),0===o.length?t.events.trigger("saveSchema",{formBuilder:t,fields:i}):jQuery.growl.error({title:"Errors",message:o.join("<br />")})})),setTimeout((function(){const e=t.getForm();t.sortable=new Sortable(e,{animation:150,onStart:function(){an(t.getForm()).addClass("sorting")},onEnd:function(){setTimeout((function(){an(t.getForm()).removeClass("sorting"),t.formElements.clear(),an(e).find(".form-group").each((function(e,i){t.formElements.push(an(i).data("formElement"))}))}),500)}})}),1e3)),new u(this.view,(function(){t.scrollApi&&t.scrollApi.reinitialise()}))}clearAllFields(){this.formElements.forEach((t=>t.setValue(null))),this.events.trigger(ln.CLEAR,{formBuilder:this})}setFormElementEventHandlers(t){this.editMode&&(t.events.on("click",(t=>{const{formElement:e}=t.data;this.edit(e)})),t.events.on("delete",(t=>{const{formElement:e}=t.data;this.deleteField(e)})))}save(){const t=this;if(t.markerBackup){const e=t.mapsvg.getEditingMarker();e.events.off("change"),t.markerBackup=e.getOptions(),t.mapsvg.unsetEditingMarker()}const e=t.getData();t.saved=!0,this.events.trigger("save",{formBuilder:this,data:e})}getFormElementByType(t){return this.formElements.find((e=>e.type===t))}getFormElementByName(t){return this.formElements.find((e=>e.name===t))}getData(){const t={};return this.formElements.forEach((e=>{if("save"!==e.type&&"empty"!==e.type){const i=e.getData();t[i.name]=i.value}})),t}reset(){this.formElements.forEach((t=>{t.setValue(null)}))}update(t){this.schema.getFields().forEach((e=>{const i=this.formElements.get(e.name);i&&(void 0!==t[e.name]?i.getValue()!==t[e.name]&&i.setValue(t[e.name]):i.setValue(null))}))}redraw(){const t=this;if(delete t.markerBackup,an(this.container).empty(),an(this.getForm()).empty(),this.formElements.clear(),this.schema&&this.schema.fields.length>0&&this.schema.fields.forEach((t=>{this.filtersMode?"distance"==t.type?t.value=this.data.distance?this.data.distance:void 0!==t.value?t.value:null:"search"==t.type?t.value=this.data.search:t.value=this.data[t.parameterNameShort]:t.value=this.data?this.data[t.name]:void 0!==t.value?t.value:null,"location"!=t.type||this.editMode?"post"==t.type?t.post=this.data.post:"region"===t.type&&(t.options=new dt("id",this.getRegionsList())):(t.value&&t.value.marker&&t.value.marker.id,this.admin&&this.admin.setMode&&this.admin.setMode("editMarkers"),this.admin&&this.admin.enableMarkersMode(!0));const e=this.formElementFactory.create(t);this.filtersMode?(!this.filtersHide||this.filtersHide&&this.modal&&"search"!==t.type||!this.modal&&"search"===t.type)&&this.addField(e):this.addField(e)})),!t.editMode)if(0!==this.schema.fields.length||this.filtersMode){if(t.admin&&!t.admin.isMetabox){const e=this.formElementFactory.create({type:"save"});e.events.on("click.btn.save",(()=>{this.save()})),e.events.on("click.btn.close",(()=>{this.close()})),t.addField(e)}}else{const e=this.formElementFactory.create({type:"empty"});t.addField(e)}if(t.filtersMode&&t.filtersHide&&!t.modal){const e=this.formElementFactory.create({type:"modal",showButtonText:t.showButtonText});this.showFiltersButton=t.addField(e)}if(this.scrollable){const e=an('<div class="nano"></div>'),i=an('<div class="nano-content"></div>');e.append(i),i.append(this.view),an(t.container).append(e),e.jScrollPane({contentWidth:"0px",mouseWheelSpeed:30}),t.scrollApi=e.data("jsp")}else an(t.container).append(this.view);t.filtersMode&&t.clearButton&&(t.elements.buttons.clearButton=an('<div class="form-group mapsvg-filters-reset-container"><button type="button" class="btn btn-outline-secondary mapsvg-filters-reset">'+t.clearButtonText+"</button></div>")[0],an(this.getForm()).append(t.elements.buttons.clearButton)),t.filtersMode&&t.searchButton&&(t.elements.buttons.searchButton=an('<div class="form-group mapsvg-filters-reset-container" id="mapsvg-search-container"><button class="btn btn-outline-secondary mapsvg-filters-reset">'+t.searchButtonText+"</button></div>")[0],an(this.getForm()).append(t.elements.buttons.searchButton)),this.editMode||t.filtersMode||an(this.view).find("input:visible,textarea:visible").not(".tt-hint").first().focus();an(this.container).find(".CodeMirror").each((function(t,e){e&&e.CodeMirror.refresh()})),t.setEventHandlers();[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"][data-premium="true"]')).map((function(t){return new window.bootstrap.Popover(t,{content:'<i class="bi bi-star-fill"></i> Premium feature <a class="btn btn-xs btn-outline-primary" target="_blank" href="https://mapsvg.com/pricing">Upgrade</a>',html:!0,trigger:"focus",placement:"top"})})),this.events.trigger("init",{formBuilder:this,data:this.getData()}),this.events.trigger(ln.AFTER_LOAD,{formBuilder:this,data:this.getData()})}updateExtraParamsInFormElements(){this.formElements.forEach((t=>{t.setExternal(this.formElementFactory.getExtraParams()),"location"===t.type&&t.redraw()}))}deleteField(t){this.formElements.delete(t.name)}getExtraParams(){const t=[];this.mapsvg.objectsRepository.getSchema().getFields().forEach((function(e){"text"!=e.type&&"region"!=e.type&&"textarea"!=e.type&&"post"!=e.type&&"select"!=e.type&&"radio"!=e.type&&"checkbox"!=e.type||("post"==e.type?t.push("Object.post.post_title"):t.push("Object."+e.name))}));let e=[];e=this.mapsvg.objectsRepository.getSchema().getFields().filter((function(t){return"select"==t.type||"radio"==t.type||"region"==t.type})).map((function(t){return t.name}));let i=[];i=e.filter((t=>"select"===t.type||"radio"===t.type));const s=this.mapsvg.regionsRepository.getSchema().getFields().map((function(t){if("status"==t.type||"text"==t.type||"textarea"==t.type||"post"==t.type||"select"==t.type||"radio"==t.type||"checkbox"==t.type)return"post"==t.type?"Region.post.post_title":"Region."+t.name}));return{databaseFields:t,databaseFieldsFilterableShort:e,regionFields:s,markerFieldsShort:i}}addField(t){const e=this;if(-1!=["region","marker","post","status","distance","location","search"].indexOf(t.type)){let s=!1;if(e.formElements.forEach((function(e){e.type==t.type&&(s=!0)})),s)return void jQuery.growl.error({title:"Error",message:'You can add only 1 "'+i(t.type)+'" field'})}return e.formElements.push(t),e.getForm().append(t.domElements.main),this.setFormElementEventHandlers(t),this.editMode&&(t.protected?t.hide():this.edit(t)),t}edit(t){const e=this;e.currentlyEditing&&e.currentlyEditing.destroyEditor(),this.getFormEditor().appendChild(t.getEditor()),t.initEditor(),e.currentlyEditing=t,an(e.getForm()).find(".form-group.active").removeClass("active"),an(t.domElements.main).addClass("active")}get(){}getSchema(){return this.formElements.map((function(t){return t.getSchema()}))}close(){this.formElements.forEach((t=>t.destroy())),this.mediaUploader&&this.mediaUploader.off("select"),this.mapsvg&&an(window).off("keydown.form.mapsvg-"+this.mapsvg.id),this.events.trigger("close",{formBuilder:this})}destroy(){an(this.view).empty().remove(),this.mapsvg&&an(window).off("keydown.form.mapsvg-"+this.mapsvg.id),this.sortable=null}toJSON(t){const e={};function i(e,s,o){if(!t&&!o)return!1;1==s.length?e[s[0]]=o:(null==e[s[0]]&&(""===s[1]?e[s[0]]=[]:e[s[0]]={}),void 0!==e[s[0]].length?e[s[0]].push(o):i(e[s[0]],s.slice(1),o))}return an(this.elements.containers.formView).find("input, textarea, select").each((function(){if(!an(this).data("skip")&&!an(this).prop("disabled")&&an(this).attr("name")&&(t||"checkbox"!=an(this).attr("type")||null!=an(this).attr("checked"))&&("radio"!=an(this).attr("type")||null!=an(this).attr("checked"))){let t;t="checkbox"==an(this).attr("type")?an(this).prop("checked"):an(this).val(),i(e,an(this).attr("name").replace(/]/g,"").split("["),t)}})),e}getRegionsList(){return this.mapsvg.regions.map((function(t){return{id:t.id,title:t.title}}))}getRegionsAsArray(){return this.mapsvg.regions}setRegions(t){const e=this.formElements.get("regions");-1!==this.mapsvg.options.source.indexOf("/geo-calibrated/usa.svg")?e.setValue(["US-"+t.address.state_short]):-1!==this.mapsvg.options.source.indexOf("/geo-calibrated/world.svg")?t.address.country_short&&e.setValue([t.address.country_short]):t.address.administrative_area_level_1&&this.mapsvg.regions.forEach((i=>{i.title!==t.address.administrative_area_level_1&&i.title!==t.address.administrative_area_level_2&&i.id!==t.address.country_short+"-"+t.address.administrative_area_level_1_short||e.setValue([i.id])}))}setIsLoading(t){this.isLoading=t,this.searchButton&&(this.isLoading?an(this.elements.buttons.searchButton).find("button").attr("disabled","disabled"):an(this.elements.buttons.searchButton).find("button").removeAttr("disabled"))}}const cn=jQuery;var dn,un,pn;!function(t){t.CLICK_SHOW_FILTERS="click.btnShowFilters",t.CLICK_SEARCH="click.btnSearch"}(dn||(dn={}));class mn extends qt{constructor(t){super(t),this.name="filters",this.classList=["mapsvg-filters-wrap","mapsvg-filters-container","mapsvg-controller-no-padding"],this.position="relative",this.closable=!1,this.withToolbar=!1,this.showButtonText=t.showButtonText,this.clearButton=t.clearButton,this.clearButtonText=t.clearButtonText,this.searchButton=t.searchButton,this.searchButtonText=t.searchButtonText,this.schema=t.schema,this.hideFilters=t.hideFilters,this.query=t.query}viewDidRedraw(){super.viewDidLoad(),this.formBuilder&&this.formBuilder.destroy(),this.formBuilder=new hn({container:this.containers.contentView,filtersMode:!0,schema:this.schema,modal:this.modal,filtersHide:this.hideFilters,showButtonText:this.showButtonText,clearButton:this.clearButton,clearButtonText:this.clearButtonText,searchButton:this.searchButton,searchButtonText:this.searchButtonText,editMode:!1,mapsvg:this.map,data:Object.assign(Object.assign({},this.query.filters),{search:this.query.search}),admin:!1,parent:this,events:{"change.formElement":t=>{const{formElement:e,field:i,value:s}=t.data;if("search"===e.type)this.query.setSearch(s);else{const t={};let e=s;"regions"===i&&(e={},e.region_ids=s instanceof Array?s:[s],e.table_name=this.map.options.database.regionsTableName,0!==e.region_ids.length&&""!==e.region_ids[0]||(e=null)),"distance"!==i||e.geoPoint.lat&&e.geoPoint.lat?(t[i]=e,this.query.setFilters(t)):(delete t.distance,this.query.setFilters({distance:null}))}},clear:t=>{t.data,this.query.clearFilters()},afterLoad:t=>{t.data,this.updateScroll()}}}),this.formBuilder.init()}reset(){this.formBuilder&&this.formBuilder.reset()}update(t){const e=Object.assign({},t.filters);e.search=t.search,this.formBuilder&&this.formBuilder.update(e)}setFiltersCounter(){if(this.hideFilters){const t=Object.keys(this.query.filters).length,e=0===t?"":t.toString();this.formBuilder&&this.formBuilder.showFiltersButton&&cn(this.formBuilder.showFiltersButton.domElements.main).find("button").html(this.showButtonText+" <b>"+e+"</b>")}}setEventHandlers(){super.setEventHandlers();const t=this;cn(this.containers.view).on("click",".mapsvg-btn-show-filters",(function(){t.events.trigger(dn.CLICK_SHOW_FILTERS)})),cn(this.containers.view).on("click","#mapsvg-search-container button",(function(){t.events.trigger(dn.CLICK_SEARCH)}))}}class gn{constructor(t,e,i,s){this.x=0,this.y=0,this.width=0,this.height=0,this.initialized=!1,void 0!==t&&this.update(t,e,i,s)}update(t,e,i,s){if("object"==typeof t){if(!Array.isArray(t)&&Object.prototype.hasOwnProperty.call(t,"x")&&Object.prototype.hasOwnProperty.call(t,"y")&&Object.prototype.hasOwnProperty.call(t,"width")&&Object.prototype.hasOwnProperty.call(t,"height"))this.x="string"==typeof t.x?parseFloat(t.x):t.x,this.y="string"==typeof t.y?parseFloat(t.y):t.y,this.width="string"==typeof t.width?parseFloat(t.width):t.width,this.height="string"==typeof t.height?parseFloat(t.height):t.height,this.initialized=!0;else if(Array.isArray(t)){if(4!==t.length)throw new Error("ViewBox Array must have 4 elements");this.x="string"==typeof t[0]?parseFloat(t[0]):t[0],this.y="string"==typeof t[1]?parseFloat(t[1]):t[1],this.width="string"==typeof t[2]?parseFloat(t[2]):t[2],this.height="string"==typeof t[3]?parseFloat(t[3]):t[3],this.initialized=!0}}else"string"==typeof t&&void 0===e&&([t,e,i,s]=t.trim().split(" ").map((function(t){return parseFloat(t)}))),this.x="string"==typeof t?parseFloat(t):t,this.y="string"==typeof e?parseFloat(e):e,this.width="string"==typeof i?parseFloat(i):i,this.height="string"==typeof s?parseFloat(s):s,this.initialized=!0}toString(){return this.x+" "+this.y+" "+this.width+" "+this.height}toArray(){return[this.x,this.y,this.width,this.height]}clone(){return new gn({x:this.x,y:this.y,width:this.width,height:this.height})}fitsInViewBox(t,e){return!0===e?t.width>=this.width||t.height>=this.height:t.width>=this.width&&t.height>=this.height}addPadding(t){t.top&&(this.y-=t.top,this.height+=t.top),t.right&&(this.width+=t.right),t.bottom&&(this.height+=t.bottom),t.left&&(this.x-=t.left,this.width+=t.left)}}class fn{constructor(t,e){this.sw=t,this.ne=e}}jQuery,function(t){t.REGION="region",t.MARKER="marker",t.CLUSTER="cluster"}(un||(un={})),function(t){t.UPDATE="update",t.CLICK="click",t.MOUSEOVER="mouseOver",t.MOUSEOUT="mouseOut",t.MOUSEDOWN="mouseDown",t.MOUSEUP="mouseUp"}(pn||(pn={}));class vn{constructor(t,e){this.name="mapObject",this.id="",this.element=t,this.mapsvg=e,this.events=new mt({context:this,contextName:this.name,map:this.mapsvg,parent:this.mapsvg.events})}isRegion(){return this.type===un.REGION}isMarker(){return this.type===un.MARKER}isCluster(){return this.type===un.CLUSTER}getBBox(){return new gn(1,2,3,4)}getGeoBounds(){const t=this.getBBox(),e=new Et(t.x,t.y+t.height),i=new Et(t.x+t.width,t.y);return{sw:this.mapsvg.converter.convertSVGToGeo(e),ne:this.mapsvg.converter.convertSVGToGeo(i)}}getComputedStyle(t,e){return e=e||this.element,vn.getComputedStyle(t,e)}static getComputedStyle(t,e){const i=e.getAttribute(t);if(i)return i;const s=e.getAttribute("style");if(s){const e=s.split(";").filter((function(e){if((e=e.trim()).split(":")[0]==t)return!0}));if(e.length)return e[0].split(":").pop().trim()}const o=e.parentElement,n=o?o.tagName:null;return n&&"svg"!=n?vn.getComputedStyle(t,o):void 0}getStyle(t){const e=this.attr(t);if(e)return e;const i=this.attr("style");if(i){const e=i.split(";").filter((function(e){if(0===(e=e.trim()).indexOf(t))return e}));return e.length?e[0].split(":").pop().trim():void 0}return""}getCenter(){const t=this.element.getBoundingClientRect().left,e=this.element.getBoundingClientRect().top,i=this.element.getBoundingClientRect().width,s=this.element.getBoundingClientRect().height;return new kt(t+i/2,e+s/2)}getCenterSVG(){const t=Number(this.element.getAttribute("data-label-x")),e=Number(this.element.getAttribute("data-label-y"));if(t&&e)return new Et(t,e);{const t=this.getBBox();return new Et(t.x+t.width/2,t.y+t.height/2)}}getCenterLatLng(t){t=t||0;const e=this.getBBox(),i=e.x+e.width/2,s=e.y+e.height/2-t,o=new Et(i,s);return this.mapsvg.converter.convertSVGToGeo(o)}attr(t,e=null){const i=this.element;if("object"==typeof t)for(const e in t){const s=t[e];"string"!=typeof s&&"number"!=typeof s||i.setAttribute(e,""+s)}else if("string"!=typeof t||"string"!=typeof e&&"number"!=typeof e){if(null==e)return i.getAttribute(t)}else i.setAttribute(t,""+e)}setId(t){void 0!==t&&(this.id=t,this.element.setAttribute("id",t))}}const yn=jQuery;class bn extends vn{constructor(t){if(super(null,t.mapsvg),this.name="marker",this.type=un.MARKER,this.element=yn("<div />").addClass("mapsvg-marker")[0],this.image=yn('<img src="" />').addClass("mapsvg-marker-image")[0],this.image.style.visibility="hidden",t.object&&this.setObject(t.object),!(t.location instanceof _t))throw new Error("No Location provided for Marker initializaton");this.location=t.location,this.location.marker=this,this.setImage(this.location.imagePath),yn(this.element).append(this.image),t.width&&t.height?this.setSize(t.width,t.height):this.setSize(15,24),this.setId(t.id||(this.object?`marker_${this.object.id}`:this.mapsvg.markerId())),this.setSvgPointFromLocation(),this.setAltAttr()}reload(){this.setImage(),this.setSvgPointFromLocation()}getImagePath(){return this.object&&this.object.getMarkerImage()||this.location.getMarkerImage()}setSize(t,e){this.width=t,this.height=e,this.setCentered(this.width===this.height)}setSvgPointFromLocation(){const t=this.location.geoPoint&&0!==this.location.geoPoint.lat&&0!==this.location.geoPoint.lng?this.mapsvg.converter.convertGeoToSVG(this.location.geoPoint):this.location.svgPoint;t&&this.setSvgPoint(t)}setId(t){vn.prototype.setId.call(this,t),this.mapsvg.markers.reindex()}getBBox(){return this.centered?new gn(this.svgPoint.x-this.width/2/this.mapsvg.scale,this.svgPoint.y-this.height/2/this.mapsvg.scale,this.width/this.mapsvg.scale,this.height/this.mapsvg.scale):new gn(this.svgPoint.x-this.width/2/this.mapsvg.scale,this.svgPoint.y-this.height/this.mapsvg.scale,this.width/this.mapsvg.scale,this.height/this.mapsvg.scale)}getOptions(){const t={id:this.id,src:this.src,svgPoint:this.svgPoint,geoPoint:this.geoPoint};return yn.each(t,(function(e,i){null==i&&delete t[e]})),t}update(t){for(const e in t){const s="set"+i(e);s in this&&this[s](t[e])}}setImage(t,e=!1){t||(t=this.getImagePath()),this.src=m(t);const i=new Image;i.onload=()=>{"src"!==this.image.getAttribute("src")&&this.image.setAttribute("src",this.src),this.setSize(i.width,i.height),this.image.style.visibility="visible",this.adjustScreenPosition()},i.src=this.src,this.events.trigger("change")}setAltAttr(){const t=this;t.altAttr=void 0!==t.object&&void 0!==t.object.title&&""!==t.object.title?t.object.title:t.id,t.image.setAttribute("alt",t.altAttr)}setSvgPoint(t){this.svgPoint=t,this.adjustScreenPosition(),this.events.trigger("change")}adjustScreenPosition(){const t=this.mapsvg.converter.convertSVGToPixel(this.svgPoint);t.x-=this.width/2,t.y-=this.centered?this.height/2:this.height,this.setScreenPosition(t.x,t.y)}moveSrceenPositionBy(t,e){const i=this.screenPoint,s=i.x-t,o=i.y-e;this.setScreenPosition(s,o)}setScreenPosition(t,e){this.screenPoint instanceof kt?(this.screenPoint.x=t,this.screenPoint.y=e):this.screenPoint=new kt(t,e),this.updateVisibility(),!0===this.visible&&(this.element.style.transform="translate("+t+"px,"+e+"px)",this.adjustLabelScreenPosition())}adjustLabelScreenPosition(){if(this.label){const t=this.screenPoint;Math.round(t.x+this.width/2-yn(this.label).outerWidth()/2),Math.round(t.y-yn(this.label).outerHeight())}}inViewBox(){const t=this.screenPoint.x,e=this.screenPoint.y,i=this.mapsvg.containers.map.offsetWidth,s=this.mapsvg.containers.map.offsetHeight;return t-this.width/2<2*i&&t+this.width/2>-i&&e-this.height/2<2*s&&e+this.height/2>-s}updateVisibility(){return!0===this.inViewBox()?(this.visible=!0,this.element.classList.remove("mapsvg-out-of-sight"),this.label&&this.label.classList.remove("mapsvg-out-of-sight")):(this.visible=!1,this.element.classList.add("mapsvg-out-of-sight"),this.label&&this.label.classList.add("mapsvg-out-of-sight")),this.visible}isMoving(){return this.moving}setMoving(t){this.moving=t}drag(t,e,i,s){const o=this;this.svgPointBeforeDrag=new Et(this.svgPoint.x,this.svgPoint.y),this.setMoving(!0),yn("body").on("mousemove.drag.mapsvg",(function(i){i.preventDefault(),yn(o.mapsvg.containers.map).addClass("no-transitions");const s=g(i),n=s.x-t.x,r=s.y-t.y,a=new Et(o.svgPointBeforeDrag.x+n/e,o.svgPointBeforeDrag.y+r/e);o.setSvgPoint(a)})),yn("body").on("mouseup.drag.mapsvg",(function(n){n.preventDefault(),o.undrag();const r=g(n),a=r.x-t.x,l=r.y-t.y,h=new Et(o.svgPointBeforeDrag.x+a/e,o.svgPointBeforeDrag.y+l/e);o.setSvgPoint(h),o.mapsvg.isGeo()&&(o.geoPoint=o.mapsvg.converter.convertSVGToGeo(h)),i&&i.call(o),o.svgPointBeforeDrag.x==o.svgPoint.x&&o.svgPointBeforeDrag.y==o.svgPoint.y&&s&&s.call(o)}))}undrag(){this.setMoving(!1),yn("body").off(".drag.mapsvg"),yn(this.mapsvg.containers.map).removeClass("no-transitions")}delete(){this.label&&(this.label.remove(),this.label=null),yn(this.element).empty().remove()}setObject(t){this.object=t,yn(this.element).attr("data-object-id",this.object.id)}hide(){yn(this.element).addClass("mapsvg-marker-hidden"),this.label&&yn(this.label).hide()}show(){yn(this.element).removeClass("mapsvg-marker-hidden"),this.label&&yn(this.label).show()}highlight(){yn(this.element).addClass("mapsvg-marker-hover")}unhighlight(){yn(this.element).removeClass("mapsvg-marker-hover")}select(){this.selected=!0,yn(this.element).addClass("mapsvg-marker-active")}deselect(){this.selected=!1,yn(this.element).removeClass("mapsvg-marker-active")}getData(){return this.object}getChoroplethColor(){const t=parseFloat(this.object[this.mapsvg.options.choropleth.sourceField]);let e;if(t)if("gradient"===this.mapsvg.options.choropleth.coloring.mode){const i=this.mapsvg.options.choropleth.coloring.gradient,s=0===i.values.maxAdjusted?0:(t-i.values.min)/i.values.maxAdjusted,o=Math.round(i.colors.diffRGB.r*s+i.colors.lowRGB.r),n=Math.round(i.colors.diffRGB.g*s+i.colors.lowRGB.g),r=Math.round(i.colors.diffRGB.b*s+i.colors.lowRGB.b),a=(i.colors.diffRGB.a*s+i.colors.lowRGB.a).toFixed(2);e="rgba("+o+","+n+","+r+","+a+")"}else{const i=this.mapsvg.options.choropleth.coloring.palette.colors;!i[0].valueFrom&&t<i[0].valueTo?e=i[0].color:!i[i.length-1].valueTo&&t>i[i.length-1].valueFrom?e=i[i.length-1].color:(i.forEach((function(i){t>=i.valueFrom&&t<i.valueTo&&(e=i.color)})),e=e||this.mapsvg.options.choropleth.coloring.palette.outOfRange.color)}else e=this.mapsvg.options.choropleth.coloring.noData.color;return e}getBubbleSize(){let t;if(this.object[this.mapsvg.options.choropleth.sourceField]){const e=Number(this.mapsvg.options.choropleth.bubbleSize.max),i=Number(this.mapsvg.options.choropleth.bubbleSize.min),s=this.mapsvg.options.choropleth.coloring.gradient.values.max,o=this.mapsvg.options.choropleth.coloring.gradient.values.min;t=(parseFloat(this.object[this.mapsvg.options.choropleth.sourceField])-o)/(s-o)*(e-i)+Number(i)}else t=!1;return t}getBubbleScreenPosition(){const t=Number(this.getBubbleSize());return{x:this.width/2-t/2,y:this.height-t/2}}drawBubble(){const t="mapsvg-bubble-"+this.object.id;if(parseFloat(this.object[this.mapsvg.options.choropleth.sourceField])){this.bubble||(this.bubble=yn('<div id="'+t+'" data-marker-id="'+this.element.id+'" class="mapsvg-bubble mapsvg-marker-bubble"></div>')[0],yn(this.element).append(this.bubble));const e=this.getChoroplethColor(),i=Number(this.getBubbleSize());yn(this.bubble).css("background-color",e).css("width",i+"px").css("height",i+"px").css("lineHeight",i-2+"px")}else yn("#"+t).remove(),delete this.bubble}setBubbleMode(t){this.bubbleMode=t,t?(this.setCentered(!0),this.drawBubble(),this.bubble&&(this.width=this.bubble.offsetWidth,this.height=this.bubble.offsetHeight,this.adjustScreenPosition())):this.setImage(this.src)}setLabel(t){t?(this.label||(this.label=yn("<div />").addClass("mapsvg-marker-label")[0],yn(this.element).append(this.label)),yn(this.label).html(t)):this.label&&(yn(this.label).remove(),delete this.label)}setCentered(t){this.centered=t}}const wn=jQuery;class xn extends vn{constructor(t,e){super(null,e),this.type=un.CLUSTER,this.svgPoint=t.svgPoint,this.cellX=t.cellX,this.cellY=t.cellY,this.markers=t.markers||[],this.cellSize=50,this.width=30,this.elem=wn('<div class="mapsvg-marker-cluster">'+this.markers.length+"</div>")[0],wn(this.elem).data("cluster",this),this.markers.length<2&&wn(this.elem).hide(),this.adjustScreenPosition()}addMarker(t){if(this.markers.push(t),this.markers.length>1){if(2===this.markers.length&&wn(this.elem).show(),2===this.markers.length){const t=this.markers.map((function(t){return t.svgPoint.x}));this.min_x=Math.min.apply(null,t),this.max_x=Math.max.apply(null,t);const e=this.markers.map((function(t){return t.svgPoint.y}));this.min_y=Math.min.apply(null,e),this.max_y=Math.max.apply(null,e),this.svgPoint.x=this.min_x+(this.max_x-this.min_x)/2,this.svgPoint.y=this.min_y+(this.max_y-this.min_y)/2}this.markers.length>2&&(t.svgPoint.x<this.min_x?this.min_x=t.svgPoint.x:t.svgPoint.x>this.max_x&&(this.max_x=t.svgPoint.x),t.svgPoint.y<this.min_y?this.min_y=t.svgPoint.y:t.svgPoint.x>this.max_x&&(this.max_y=t.svgPoint.y),this.svgPoint.x=this.min_x+(this.max_x-this.min_x)/2,this.svgPoint.y=this.min_y+(this.max_y-this.min_y)/2)}else this.svgPoint.x=t.svgPoint.x,this.svgPoint.y=t.svgPoint.y;wn(this.elem).text(this.markers.length),this.adjustScreenPosition()}canTakeMarker(t){const e=this.mapsvg.converter.convertSVGToPixel(t.svgPoint);return this.cellX===Math.ceil(e.x/this.cellSize)&&this.cellY===Math.ceil(e.y/this.cellSize)}destroy(){this.markers=null,wn(this.elem).remove()}adjustScreenPosition(){const t=this.mapsvg.converter.convertSVGToPixel(this.svgPoint);t.x-=this.width/2,t.y-=this.width/2,this.setScreenPosition(t.x,t.y)}moveSrceenPositionBy(t,e){const i=this.screenPoint,s=i.x-t,o=i.y-e;this.setScreenPosition(s,o)}setScreenPosition(t,e){this.screenPoint instanceof kt?(this.screenPoint.x=t,this.screenPoint.y=e):this.screenPoint=new kt(t,e),this.updateVisibility(),!0===this.visible&&(this.elem.style.transform="translate("+t+"px,"+e+"px)")}inViewBox(){const t=this.screenPoint.x,e=this.screenPoint.y,i=this.mapsvg.containers.map.offsetWidth,s=this.mapsvg.containers.map.offsetHeight;return t-this.width/2<i&&t+this.width/2>0&&e-this.width/2<s&&e+this.width/2>0}updateVisibility(){return!0===this.inViewBox()?(this.visible=!0,this.elem.classList.remove("mapsvg-out-of-sight")):(this.visible=!1,this.elem.classList.add("mapsvg-out-of-sight")),this.visible}getBBox(){const t={x:this.svgPoint.x,y:this.svgPoint.y,width:this.cellSize/this.mapsvg.getScale(),height:this.cellSize/this.mapsvg.getScale()};return new gn(t.x,t.y,t.width,t.height)}getData(){return this.markers.map((t=>t.object))}}const kn=jQuery;class Sn extends Vt{constructor(t){super(t),this.autoresize=!0,this.name="popover",this.classList.push("mapsvg-popover"),this.opened=!1,this.closable=!0,this.point=t.point,this.yShift=t.yShift,this.mapObject=t.mapObject,this.id=this.mapObject.id+"_"+Math.random(),kn(this.containers.main).data("popover-id",this.id)}setPoint(t){this.point=t}viewDidAppear(){this.adjustScreenPosition()}adjustScreenPosition(){if(this.point){const t=this.map.converter.convertSVGToPixel(this.point);t.y-=this.yShift,t.x=Math.round(t.x),t.y=Math.round(t.y),this.setScreenPosition(t.x,t.y)}}moveSrceenPositionBy(t,e){const i=this.screenPoint,s=i.x-t,o=i.y-e;this.setScreenPosition(s,o)}setScreenPosition(t,e){this.screenPoint=new kt(t,e),this.containers.main.style.transform="translate(-50%) translate("+t+"px,"+e+"px)"}viewWillClose(){return"type"in this.mapObject&&this.mapObject.isRegion()&&this.map.deselectRegion(this.mapObject),"type"in this.mapObject&&this.mapObject.isMarker()&&this.map.deselectAllMarkers(),!0}}const En=jQuery;var Tn;!function(t){t[t.click=0]="click",t[t.mouseover=1]="mouseover",t[t.mouseout=2]="mouseout"}(Tn||(Tn={}));class _n extends vn{constructor(t){super(t.element,t.mapsvg),this.options=t.options||{},this.statusOptions=t.statusOptions||{1:{disabled:!1,label:"Enabled",color:"",value:"1"}},this.status="undefined",this.name="region",this.type=un.REGION,this.objects=new dt("id",[],{autoId:!1,unique:!0}),this.id=this.element.getAttribute("id"),this.title=this.element.getAttribute("title"),this.id_no_spaces=this.id.replace(/\s/g,"_"),this.element.setAttribute("class",(this.element.className||"")+" mapsvg-region"),this.setStyleInitial(),this.disabled=this.getDisabledState(),this.disabled&&this.attr("class",this.attr("class")+" mapsvg-disabled");const i=this.options,{selected:s}=i,o=e(i,["selected"]);this.selected=s,this.bbox=this.getBBox(),this.update(o),this.saveState()}adjustStroke(t){this.element.style.strokeWidth=this.style["stroke-width"]/t+"px"}setStyleInitial(){let t;this.style={fill:this.getComputedStyle("fill")},this.style.stroke=this.getComputedStyle("stroke")||"",t=this.getComputedStyle("stroke-width"),t=t?t.replace("px",""):"1",t=parseFloat(t),this.style["stroke-width"]=t,this.styleSvg=Object.assign({},this.style),En(this.element).attr("data-stroke-width",t)}saveState(){this.initialState=JSON.stringify(this.getOptions())}getBBox(){if(this.bbox&&this.bbox.width>0&&this.bbox.height>0)return this.bbox;const t=this.element.getBBox(),e=new gn(t.x,t.y,t.width,t.height),i=this.element.getTransformToElement(this.mapsvg.containers.svg);if(!i)return t;const s=e.x+e.width,o=e.y+e.height;let n=this.mapsvg.containers.svg.createSVGPoint();return n.x=e.x,n.y=e.y,n=n.matrixTransform(i),e.x=n.x,e.y=n.y,n.x=s,n.y=o,n=n.matrixTransform(i),e.width=n.x-e.x,e.height=n.y-e.y,this.bbox=e,e}changed(){return JSON.stringify(this.getOptions())!=this.initialState}edit(){this.elemOriginal=En(this.element).clone()[0]}editCommit(){this.elemOriginal=null}editCancel(){this.mapsvg.containers.svg.appendChild(this.elemOriginal),this.element=this.elemOriginal,this.elemOriginal=null}getOptions(t){const e={id:this.id,id_no_spaces:this.id_no_spaces,title:this.title,fill:this.mapsvg.options.regions[this.id]&&this.mapsvg.options.regions[this.id].style&&this.mapsvg.options.regions[this.id].style.fill,data:this.data,choroplethValue:this.choroplethValue,disabled:t?this.disabled:void 0};for(const t in e)void 0===e[t]&&delete e[t];if(this.customAttrs){const t=this;this.customAttrs.forEach((function(i){e[i]=t[i]}))}return e}forTemplate(){var t,e,i;return Object.assign(Object.assign({id:this.id,title:this.title},null===(t=this.data)||void 0===t?void 0:t.getData()),{objects:this.objects.map((t=>t.getData())),data:null===(e=this.data)||void 0===e?void 0:e.getData(),fill:null!==(i=this.style.fill)&&void 0!==i?i:""})}getData(){return this.forTemplate()}getModel(){return this.data}update(t){for(const e in t){const s="set"+i(e);s in this?this[s](t[e]):(this[e]=t[e],this.customAttrs=this.customAttrs||[],this.customAttrs.push(e))}}setTitle(t){t&&(this.title=t),this.element.setAttribute("title",this.title),this.events.trigger(pn.UPDATE,{region:this,data:{title:t}})}setStyle(t){h(this.style,t);for(const e in t)this.element.style[e]=t[e];this.events.trigger(pn.UPDATE,{region:this,data:{style:t}})}setStyleByType(t){t||(t=this.selected?"selected":this.hovered?"hover":"default"),this.styleByState[this.status]&&this.setStyle(this.styleByState[this.status][t])}setFill(t){const e=this.status||"undefined",i={[e]:{default:{fill:t}}};this.setStylesByState(i),this.events.trigger(pn.UPDATE,{region:this,data:{fill:t}})}setStylesByState(t,e=!0){e&&(this.styleByState||(this.styleByState={}),h(this.styleByState,t)),this.setStyleByType()}getChoroplethColor(){const t=this.mapsvg.options.choropleth;let e="";if(this.data&&(this.data[this.mapsvg.options.regionChoroplethField]||0===this.data[this.mapsvg.options.regionChoroplethField])){const i=0===t.maxAdjusted?0:(parseFloat(this.data[this.mapsvg.options.regionChoroplethField])-t.min)/t.maxAdjusted,s={r:Math.round(t.colors.diffRGB.r*i+t.colors.lowRGB.r),g:Math.round(t.colors.diffRGB.g*i+t.colors.lowRGB.g),b:Math.round(t.colors.diffRGB.b*i+t.colors.lowRGB.b),a:(t.colors.diffRGB.a*i+t.colors.lowRGB.a).toFixed(2)};e="rgba("+s.r+","+s.g+","+s.b+","+s.a+")"}else e=t.colors.noData;return e}getBubbleSize(){let t;if(this.data&&this.data[this.mapsvg.options.choropleth.sourceField]){const e=Number(this.mapsvg.options.choropleth.bubbleSize.max),i=Number(this.mapsvg.options.choropleth.bubbleSize.min),s=this.mapsvg.options.choropleth.coloring.gradient.values.max,o=this.mapsvg.options.choropleth.coloring.gradient.values.min;t=(parseFloat(this.data[this.mapsvg.options.choropleth.sourceField])-o)/(s-o)*(e-i)+i}else t=!1;return t}setDisabled(e,i){e=void 0!==e?t(e):this.getDisabledState();const s=this.disabled;this.disabled=e,this.attr("class",this.attr("class").replace("mapsvg-disabled","")),e&&this.attr("class",this.attr("class")+" mapsvg-disabled"),this.disabled!=s&&this.mapsvg.deselectRegion(this),!i&&this.events.trigger(pn.UPDATE,{region:this,data:{disabled:e}})}setStatus(t){const e=this.statusOptions[t],i=this.data;if(!e)return!1;this.status=t,i&&i.update({status:t}),this.setDisabled(e.disabled,!0),this.setStyleByType(),this.events.trigger(pn.UPDATE,{region:this,data:{status:t}})}setSelected(t){t?this.mapsvg.selectRegion(this):this.mapsvg.deselectRegion(this),this.events.trigger(pn.UPDATE,{region:this,data:{selected:t}})}setchoroplethValue(t){En.isNumeric(t)?("string"==typeof t&&(t=parseFloat(t)),this.choroplethValue=t):this.choroplethValue=void 0,this.events.trigger(pn.UPDATE,{region:this,data:{choroplethValue:this.choroplethValue}})}getDisabledState(t){return this.mapsvg.options.regions[this.id],!t&&this.options&&void 0!==this.options.disabled?this.options.disabled:this.mapsvg.options.disableAll||"none"===this.style.fill||"labels"==this.id||"Labels"==this.id}highlight(){this.hovered=!0,this.setStyleByType(),En(this.element).addClass("mapsvg-region-hover"),this.events.trigger(pn.UPDATE,{region:this,data:{hovered:!0}})}unhighlight(){this.hovered=!1,this.setStyleByType(),En(this.element).removeClass("mapsvg-region-hover"),this.events.trigger(pn.UPDATE,{region:this,data:{hovered:!1}})}select(){this.selected=!0,this.setStyleByType(),En(this.element).addClass("mapsvg-region-active"),this.events.trigger(pn.UPDATE,{region:this,data:{selected:!0}})}deselect(){this.selected=!1,this.setStyleByType(),En(this.element).removeClass("mapsvg-region-active"),this.events.trigger(pn.UPDATE,{region:this,data:{selected:!1}})}setData(t){var e;this.data=t,t&&"function"==typeof t.getData&&void 0!==(null===(e=t.getData())||void 0===e?void 0:e.title)&&this.setTitle(t.getData().title),this.events.trigger(pn.UPDATE,{region:this,data:{data:t}})}drawBubble(){if(this.data){const t="mapsvg-bubble-"+this.id,e=parseFloat(this.data[this.mapsvg.options.choropleth.sourceField]);if(e){this.center||(this.center=this.getCenterSVG());const i=this.mapsvg.converter.convertSVGToPixel(this.center);this.bubble||(this.bubble=En('<div id="'+t+'" class="mapsvg-bubble mapsvg-region-bubble">'+e+"</div>")[0],En(this.mapsvg.layers.bubbles).append(this.bubble));const s=this.getChoroplethColor(),o=Number(this.getBubbleSize());this.bubble.style.transform="translate(-50%,-50%) translate("+i.x+"px,"+i.y+"px)",this.bubble.style.backgroundColor=s,this.bubble.style.width=o+"px",this.bubble.style.height=o+"px",this.bubble.style.lineHeight=o-2+"px"}else delete this.bubble}}adjustLabelScreenPosition(){if(this.label){this.center||(this.center=this.getCenterSVG());const t=this.mapsvg.converter.convertSizePixelToSVG({width:this.label.offsetWidth,height:this.label.offsetHeight}),e=this.mapsvg.converter.convertSVGToPixel(this.center),i=e.x-this.label.offsetWidth/2,s=e.y-this.label.offsetHeight/2;this.setLabelScreenPosition(i,s);const o=this.getBBox();this.label.style.opacity=t.width>o.width?"0":"1"}}adjustBubbleScreenPosition(){if(this.bubble){this.center||(this.center=this.getCenterSVG());const t=this.mapsvg.converter.convertSVGToPixel(this.center),e=t.x-this.bubble.offsetWidth/2,i=t.y-this.bubble.offsetHeight/2;this.setBubbleScreenPosition(e,i)}}moveLabelScreenPositionBy(t,e){if(this.label){const i=window.getComputedStyle(this.label),s=(i.transform||i.webkitTransform).match(/matrix.*\((.+)\)/);if(s&&s.length>0){const i=s[1].split(", "),o=parseFloat(i[4])-t,n=parseFloat(i[5])-e;this.setLabelScreenPosition(o,n)}}}moveBubbleScreenPositionBy(t,e){if(this.bubble){const i=window.getComputedStyle(this.bubble),s=(i.transform||i.webkitTransform).match(/matrix.*\((.+)\)/)[1].split(", "),o=parseFloat(s[4])-t,n=parseFloat(s[5])-e;this.setBubbleScreenPosition(o,n)}}setLabelScreenPosition(t,e){this.label&&(this.label.style.transform="translate("+t+"px,"+e+"px)")}setBubbleScreenPosition(t,e){this.bubble&&(this.bubble.style.transform="translate("+t+"px,"+e+"px)")}}const Cn=jQuery;class Bn extends Vt{constructor(t){super(t),this.classList.push("mapsvg-tooltip"),this.name="tooltip",this.position="absolute",this.opened=!1,this.closable=!1,this.withToolbar=!1,this.scrollable=!1,this.withToolbar=!1,this.autoresize=!1,this.screenPoint=new kt(0,0),this.positionToCursor=t.positionToCursor||"",this.posOriginal={},this.posShifted={},this.posShiftedPrev={},this.mirror={}}setSize(t,e){}setPositionToCursor(t){const e=t.split("-");-1==e[0].indexOf("top")&&-1==e[0].indexOf("bottom")||(this.posOriginal.topbottom=e[0]),-1==e[0].indexOf("left")&&-1==e[0].indexOf("right")||(this.posOriginal.leftright=e[0]),e[1]&&(this.posOriginal.leftright=e[1]),this.containers.main.className=this.containers.main.className.replace(/(^|\s)mapsvg-tt-\S+/g,""),this.containers.main.classList.add("mapsvg-tt-"+t)}setScreenPoint(t,e){this.screenPoint.x=t,this.screenPoint.y=e}viewDidLoad(){super.viewDidLoad.call(this),this.setPositionToCursor(this.positionToCursor)}setScreenPosition(t,e){this.setScreenPoint(t,e),this.containers.main.style.transform="translateX(-50%) translate("+t+"px,"+e+"px)"}setEventHandlers(){const t="mousemove.tooltip.mapsvg-"+this.uid;Cn("body").off(t),Cn("body").on(t,(t=>this.move(t)))}destroy(){super.destroy(),Cn("body").off("mousemove.tooltip.mapsvg-"+this.uid)}move(t){{if(this.destroyed)return;this.containers.main.style.left=t.clientX+Cn(window).scrollLeft()-Cn(this.map.containers.map).offset().left+"px",this.containers.main.style.top=t.clientY+Cn(window).scrollTop()-Cn(this.map.containers.map).offset().top+"px";const e=new kt(t.clientX+Cn(window).scrollLeft(),t.clientY+Cn(window).scrollTop()),i=this.containers.main.getBoundingClientRect(),s=this.map.containers.map.getBoundingClientRect(),o={top:i.top+Cn(window).scrollTop(),bottom:i.bottom+Cn(window).scrollTop(),left:i.left+Cn(window).scrollLeft(),right:i.right+Cn(window).scrollLeft(),width:i.width,height:i.height},n={top:s.top+Cn(window).scrollTop(),bottom:s.bottom+Cn(window).scrollTop(),left:s.left+Cn(window).scrollLeft(),right:s.right+Cn(window).scrollLeft(),width:s.width,height:s.height};if(e.x>n.right||e.y>n.bottom||e.x<n.left||e.y<n.top)return;this.mirror.top||this.mirror.bottom?this.mirror.top&&e.y>this.mirror.top?(this.mirror.top=0,delete this.posShifted.topbottom):this.mirror.bottom&&e.y<this.mirror.bottom&&(this.mirror.bottom=0,delete this.posShifted.topbottom):o.bottom<n.top+o.height?(this.posShifted.topbottom="bottom",this.mirror.top=e.y):o.top>n.bottom-o.height&&(this.posShifted.topbottom="top",this.mirror.bottom=e.y),this.mirror.right||this.mirror.left?this.mirror.left&&e.x>this.mirror.left?(this.mirror.left=0,delete this.posShifted.leftright):this.mirror.right&&e.x<this.mirror.right&&(this.mirror.right=0,delete this.posShifted.leftright):o.right<n.left+o.width?(this.posShifted.leftright="right",this.mirror.left=e.x):o.left>n.right-o.width&&(this.posShifted.leftright="left",this.mirror.right=e.x);let r=Cn.extend({},this.posOriginal,this.posShifted);const a=[];r.topbottom&&a.push(r.topbottom),r.leftright&&a.push(r.leftright),r=a.join("-"),this.posShifted.topbottom==this.posOriginal.topbottom&&this.posShifted.leftright==this.posOriginal.leftright||(this.containers.main.className=this.containers.main.className.replace(/(^|\s)mapsvg-tt-\S+/g,""),this.containers.main.classList.add("mapsvg-tt-"+r),this.posShiftedPrev=r),this.opened||this.open()}}}class Dn{constructor(t){this.mapElement=t.containers.map,this.defViewBox=t.svgDefault.viewBox,this.viewBox=t.viewBox,this.map=t,this.yShift=0,t.geoViewBox&&this.setGeoViewBox(t.geoViewBox)}setYShift(){if(20426!==this.defViewBox.width){if(this.geoViewBox){const t=this.convertGeoToSVG(this.geoViewBox.ne);this.yShift=t.y-this.defViewBox.y}}else this.yShift=0}setGeoViewBox(t){this.geoViewBox=t,this.mapLonDelta=this.geoViewBox.ne.lng-this.geoViewBox.sw.lng,this.mapLatBottomDegree=this.geoViewBox.sw.lat*Math.PI/180,this.worldMapWidth=this.defViewBox.width/this.mapLonDelta*360,this.worldMapRadius=this.defViewBox.width/this.mapLonDelta*360/(2*Math.PI),this.setYShift()}setWorldShift(t){this.worldShift=t}getScale(){return this.mapElement.clientWidth/this.viewBox.width}convertSVGToPixel(t){const e=this.getScale();let i=0;return this.worldShift&&this.viewBox.x-this.defViewBox.x>this.defViewBox.width&&(i=this.worldMapWidth*Math.floor((this.viewBox.x-this.defViewBox.x)/this.defViewBox.width)),new kt((t.x-this.viewBox.x+i)*e,(t.y-this.viewBox.y+0)*e)}convertPixelToSVG(t){const e=this.getScale();return new Et(t.x/e+this.viewBox.x,t.y/e+this.viewBox.y)}convertSizePixelToSVG({width:t,height:e}){const i=this.getScale();return{width:t/i,height:e/i}}convertGeoToSVG(t){if(!this.geoViewBox)throw new Error("Can't do convertGeoToSVG() - geoViewBox is not provided.");let e=(t.lng-this.geoViewBox.sw.lng)*(this.defViewBox.width/this.mapLonDelta);const i=t.lat*Math.PI/180,s=this.worldMapRadius/2*Math.log((1+Math.sin(this.mapLatBottomDegree))/(1-Math.sin(this.mapLatBottomDegree)));let o=this.defViewBox.height-(this.worldMapRadius/2*Math.log((1+Math.sin(i))/(1-Math.sin(i)))-s);return e+=this.defViewBox.x,o+=this.defViewBox.y,o-=this.yShift,new Et(e,o)}convertSVGToGeo(t){if(!this.geoViewBox)throw new Error("Can't do convertSVGToGeo() - geoViewBox is not provided.");const e=t.x-this.defViewBox.x,i=t.y-this.defViewBox.y,s=this.worldMapRadius/2*Math.log((1+Math.sin(this.mapLatBottomDegree))/(1-Math.sin(this.mapLatBottomDegree))),o=(this.defViewBox.height+s-i)/this.worldMapRadius;let n=180/Math.PI*(2*Math.atan(Math.exp(o))-Math.PI/2),r=this.geoViewBox.sw.lng+e/this.defViewBox.width*this.mapLonDelta;return n=parseFloat(n.toFixed(6)),r=parseFloat(r.toFixed(6)),new Tt(n,r)}convertGoogleBoundsToViewBox(t){const e=t.getSouthWest(),i=t.getNorthEast(),s=this.convertGeoToSVG(new Tt(e.lat(),e.lng())),o=this.convertGeoToSVG(new Tt(i.lat(),i.lng()));return new gn(s.x,s.y,o.x-s.x,o.y-s.y)}}var Mn;!function(t){t.CLICK="click",t.MOUSEOVER="mouseover",t.MOUSEOUT="mouseout"}(Mn||(Mn={}));class Rn extends Vt{constructor(t){super(t=Object.assign(Object.assign({},t),{template:'\n    <div class="mapsvg-mobile-buttons">    \n      <div class="mapsvg-button mapsvg-button-menu" data-controller="menu"><i class="mapsvg-icon-menu"></i>\n          {{labelList}}\n      </div>\n      <div class="mapsvg-button mapsvg-button-map" data-controller="map"><i class="mapsvg-icon-map"></i>\n          {{labelMap}}\n      </div>\n    </div>',opened:!0,closable:!1,scrollable:!1,fullscreen:{sm:!1,md:!1,lg:!1},autoresize:!1,withToolbar:!1,noPadding:!0})),this.name="toolbar",this.classList.push("mapsvg-toolbar")}viewDidRedraw(){super.viewDidRedraw(),this.buttons={},this.buttons.menu=$(this.containers.view).find(".mapsvg-button-menu")[0],this.buttons.map=$(this.containers.view).find(".mapsvg-button-map")[0]}setEventHandlers(){super.setEventHandlers(),$(this.containers.view).on("click.toolbar.mapsvg",".mapsvg-button",(t=>{if("I"==t.target.nodeName)return;const e=t.target.getAttribute("data-controller"),i=this.buttons[e];$(this.containers.view).find(".mapsvg-button").removeClass("active"),$(i).addClass("active"),this.events.trigger("click",t,{target:i,buttonName:e})}))}show(t){$(this.buttons[t]).trigger("click")}}const An='<div>\n  <p>This is the demo content of the <strong>Region %templateType%</strong>.</p>\n  <p>How to edit it: if you are in mapsvg control panel now, click on the following link to open the template editor for this view: <a href="#" class="mapsvg-template-link" data-template="%templateTypeSnake%Region">Menu > Templates > Region %templateType%</a>.</p>\n  <p>More information about templates: <a href="https://mapsvg.com/docs/map-editor/templates" target="_blank">mapsvg.com/docs/map-editor/templates</a></p>\n</div>\n<hr />\n\n\x3c!-- Region fields are available in this template --\x3e\n<h5>{{#if title}} {{title}} {{else}} {{id}} {{/if}}</h5>\n<p>Status: {{status_text}}</p>\n\n\x3c!-- Show all linked Database Objects: --\x3e\n{{#each objects}}\n\n  \x3c!-- DB Object are available inside of this block --\x3e\n\n  <h5>{{title}}</h5>\n  \x3c!-- When you need to render a field as HTML, use 3 curly braces instead of 2:--\x3e\n  <p>{{{description}}}</p>\n  <p><em>{{location.address.formatted}}</em></p>\n\n  \x3c!-- Show all images: --\x3e\n  {{#each images}}\n    \x3c!-- Image fields "thumbnail", "medium", "full" --\x3e\n    \x3c!-- are available in this block                --\x3e\n    <img src="{{thumbnail}}" />\n  {{/each}}\n\n{{/each}}',jn='<div>\n  <p>This is the demo content of the <strong>DB Object %templateType%</strong>.</p>\n  <p>How to edit it: if you are in mapsvg control panel now, click on the following link to open the template editor for this view: <a href="#" class="mapsvg-template-link" data-template="%templateTypeSnake%">Menu > Templates > DB Object %templateType%</a>.</p>\n  <p>More information about templates: <a href="https://mapsvg.com/docs/map-editor/templates" target="_blank">mapsvg.com/docs/map-editor/templates</a></p>\n</div>\n<hr />\n\n\x3c!-- DB Object fields are available in this template. --\x3e\n<h5>{{title}}</h5>\n\x3c!-- When you need to render a fields as HTML, use 3 curly braces instead of 2:--\x3e\n<p>{{{description}}}</p>\n<p><em>{{location.address.formatted}}</em></p>\n\n\x3c!-- Show all images: --\x3e\n{{#each images}}\n  \x3c!-- Image fields "thumbnail", "medium", "full" --\x3e\n  \x3c!-- are available in this block                --\x3e\n  <img src="{{thumbnail}}" />\n{{/each}}\n\n\x3c!-- Show all linked Regions, comma-separated: --\x3e\n<p> Regions: \n  {{#each regions}}\n    \x3c!-- Region fields are available in this block --\x3e\n    {{#if title}}\n      {{title}}\n    {{else}}\n      {{id}}\n    {{/if}}{{#unless @last}}, {{/unless}}\n  {{/each}}\n</p>',Ln={source:"",markerLastID:0,regionLastID:0,dataLastID:1,disableAll:!1,width:void 0,height:void 0,lockAspectRatio:!1,padding:{top:0,left:0,right:0,bottom:0},maxWidth:void 0,maxHeight:void 0,minWidth:void 0,minHeight:void 0,loadingText:"",colorsIgnore:!1,colors:{baseDefault:"#000000",background:"#eeeeee",selected:40,hover:20,directory:"#fafafa",detailsView:"#ffffff",status:{},clusters:"",clustersBorders:"",clustersText:"",clustersHover:"",clustersHoverBorders:"",clustersHoverText:"",markers:{base:{opacity:100,saturation:100},hovered:{opacity:100,saturation:100},unhovered:{opacity:40,saturation:100},active:{opacity:100,saturation:100},inactive:{opacity:40,saturation:100}}},regions:{},clustering:{on:!1},viewBox:[],cursor:"default",manualRegions:!1,onClick:null,mouseOver:null,mouseOut:null,menuOnClick:null,beforeLoad:null,afterLoad:null,zoom:{on:!0,limit:[0,22],delta:2,buttons:{on:!0,location:"right"},mousewheel:!0,fingers:!0,hideSvg:!1,hideSvgZoomLevel:7},scroll:{on:!0,limit:!1,background:!1,spacebar:!1},responsive:!0,tooltips:{on:!1,position:"bottom-right",template:"",maxWidth:"",minWidth:100},popovers:{on:!1,position:"top",template:"",centerOn:!0,width:300,maxWidth:50,maxHeight:50},multiSelect:!1,regionStatuses:{1:{label:"Enabled",value:"1",color:"",disabled:!1},0:{label:"Disabled",value:"0",color:"",disabled:!0}},middlewares:{mapLoad:'function(data, ctx){\n  const { map } = ctx\n\n  // Example: Modify map options dynamically before applying them.\n  // You can conditionally change map settings based on factors like the current URL,\n  // user roles, or other runtime conditions.\n\n  // IMPORTANT: Consider checking if the map is being displayed in the WordPress admin area \n  // (by verifying map.inBackend). Typically, you don\'t want to run this middleware in the backend, \n  // because if you modify the map options here and then save the map, those modifications \n  // will be saved as default options in the database.\n\n  // For example, if the map is not in the backend and the user is viewing a specific post, \n  // you might disable the zoom controls:\n  // \n  // if (!map.inBackend && window.location.href.includes("/a-post-about-cats")) {\n  //   data.controls.zoom = false;\n  // }\n\n  // Always return the modified or unmodified data from the middleware:\n  return data\n}',render:'function(data, ctx){\n  const { controller } = ctx;\n\n  // This middleware function allows you to modify the data before it is sent to a specific controller.\n  // Available controllers: details, popover, tooltip, directory, filters.\n  // You can customize the data for different controllers, such as formatting numbers, strings, etc.\n\n  // Example: If the controller is "details", format the "totalAmount" field from "1000000" to "1,000,000".\n  // Uncomment and customize the following block to apply such transformations:\n  //\n  // if(controller.is("details")){\n  //    return { ...data, totalAmount: data.totalAmount.toLocaleString(\'en-US\') };  \n  // }\n\n  // Always return the data object after processing to ensure it continues through the middleware chain.\n  return data;      \n}',request:'function(data, ctx){\n  const { request, repository, map } = ctx;\n  \n  // This middleware function allows you to modify the request data before it is sent to the server.\n  // Use this when you need to interact with a custom API that expects a different query format from MapSVG.\n  \n  // Example: If the request is for the "users" repository and the action is "index",\n  // you can modify the request data by appending "_bar" to the "foo" property.\n  //\n  // if(repository.schema.objectNamePlural === "users" && request.action === "index") {\n  //   data = {\n  //     ...data,\n  //     foo: data.foo + "_bar"\n  //   };\n  // }\n\n  // Always return the data object after processing to ensure it continues through the middleware chain.\n  return data;\n}',response:'function(data, ctx){\n  const { request, response, repository, map } = ctx;\n  \n  // This middleware function allows you to modify the response data received from the server.\n  // Use this when working with a custom API that returns data in a format different from what MapSVG expects.\n  \n  // Example: A response format that is compatible with MapSVG might look like this:\n  // {\n  //   users: {\n  //     items: [\n  //       {id: 1, name: "John"},\n  //       {id: 2, name: "Anna"},\n  //     ],\n  //     hasMore: true\n  //   }\n  // }\n  //\n  // Suppose your actual API response has this structure:\n  // {\n  //   items: [\n  //     {id: 1, name: "John"},\n  //     {id: 2, name: "Anna"},\n  //   ],\n  //   page: 3,\n  //   totalPages: 120\n  // }\n  //\n  // The following code modifies the response for the "users" repository \n  // when fetching a list of models (the "index" action).\n  // \n  // if(repository.schema.objectNamePlural === "users" && request.action === "index") {\n  //   const dataParsed = typeof response.data === "string" ? JSON.parse(response.data) : data;\n  //   const dataFormatted = {\n  //     users: {\n  //       items: dataParsed.items,\n  //       hasMore: dataParsed.page < dataParsed.totalPages\n  //     }\n  //   };\n  //   return dataFormatted;\n  // } \n  \n  // Always return the data object after processing to ensure it continues through the middleware chain.\n  return data;    \n}\n'},events:{afterInit:"function(event) {\n  const { map } = event;\n\n  // This event handler triggers after the map has fully initialized and all data has loaded.\n  // It's a good place to execute any custom logic or manipulation that requires the map to be fully set up.\n\n  // \"map\" gives you access to the MapSVG instance, allowing you to:\n  // - Interact with the map's regions, markers, and other elements.\n  // - Access or modify the map's settings, such as zoom level, center position, etc.\n  // - Attach additional event listeners or perform post-initialization tasks.\n}\n",beforeInit:'function(event) {\n  const { map } = event;\n\n  // This event handler triggers just before the map begins its initialization process.\n  // It\'s a good place to set up any pre-initialization configurations or modifications.\n\n  // "map" provides access to the MapSVG instance, allowing you to:\n  // - Set or modify map settings before initialization starts (e.g., set default options).\n  // - Add or alter data that will be used during initialization, such as regions or markers.\n  // - Prepare any custom logic that needs to run early in the initialization phase.\n}\n',zoom:'function(event) {\n  const { map } = event;\n\n  // This event handler triggers whenever the map is zoomed in or out.\n  // It\'s useful for executing actions based on the zoom level of the map.\n\n  // "map.zoomLevel" provides the current zoom level of the map.\n  // You can use this to perform tasks like:\n  // - Adjusting the visibility of certain elements based on zoom.\n  // - Logging or displaying the current zoom level for debugging or user information.\n  // - Dynamically loading additional data or layers depending on the zoom level.\n\n  // Example usage:\n  // console.log(map.zoomLevel);\n}\n',afterLoadRegions:"function(event) {\n  const { map } = event;\n\n  // This event triggers after all regions from the regionsRepository have been fully loaded onto the map.\n  // At this point:\n  // - Regions are connected to their respective data objects.\n  // - The directory (if present) is refreshed and populated with the updated data.\n\n  // This is a good place to:\n  // - Perform actions that depend on the regions being fully available on the map.\n  // - Update or manipulate the directory based on the newly loaded data.\n  // - Implement custom logic or effects that require all regions to be loaded.\n\n  // Example:\n  // console.log('Regions are fully loaded and connected to data:', map.regions);\n}\n",afterLoadObjects:"function(event) {\n  const { map } = event;\n\n  // This event triggers after all objects from the objectsRepository have been fully loaded onto the map.\n  // At this point:\n  // - Objects are connected to their respective markers and regions.\n  // - The directory (if present) is updated with the new data for these objects.\n\n  // This is a good place to:\n  // - Perform actions that depend on the objects being fully loaded and connected.\n  // - Update or manipulate the maps markers or regions based on the newly loaded objects.\n  // - Implement custom logic or visual effects that require all objects to be loaded and displayed.\n\n  // Example:\n  // console.log('Objects are fully loaded and connected to markers and regions:', map.objects);\n}\n","beforeLoad.repository":"function(event) {\n  const { map, data: { repository } } = event  \n\n  // Perform actions or logging before the data is fetched from an API source into repository internal storage.\n\n}","afterLoad.repository":"function(event) {\n  const { map, data: { repository } } = event  \n\n  // Perform actions or logging before the data is fetched from an API source into repository internal storage.\n\n}","click.region":"function(event) {\n  const { map, data: { region } } = event\n\n  // Triggered when a region on the map is clicked.\n  // You can access the clicked region's data using the 'region' property.\n}","mouseover.region":"function(event) {\n  const { map, data: { region } } = event\n\n  // Triggered when the mouse pointer hovers over a region on the map.\n  // You can access the hovered region's data using the 'region' property.\n}","mouseout.region":"function(event) {\n  const { map, data: { region } } = event\n\n  // Triggered when the mouse pointer moves out of a region on the map.\n  // You can access the region's data using the 'region' property.\n}","click.marker":"function(event) {\n  const { map, data: { marker } } = event  \n  \n}","mouseover.marker":"function(event) {\n  const { map, data: { marker } } = event  \n  \n}","mouseout.marker":"function(event) {\n  const { map, data: { marker } } = event  \n  \n}","click.directoryItem":"function(event) {\n  const { map, data: { region, object, directoryItem } } = event      \n  \n}","mouseover.directoryItem":"function(event) {\n  const { map, data: { region, object, directoryItem } } = event      \n  \n}","mouseout.directoryItem":"function(event) {\n  const { map, data: { region, object, directoryItem } } = event        \n  \n}","beforeRedraw.popover":"function(event) {\n  const { map, data: { controller } } = event      \n}","afterRedraw.popover":"function(event) {\n  const { map, data: { controller } } = event      \n}","beforeShow.popover":"function(event) {\n  const { map, data: { controller } } = event      \n}","afterShow.popover":"function(event) {\n  const { map, data: { controller } } = event      \n  \n}","beforeClose.popover":"function(event) {\n  const { map, data: { controller } } = event      \n  \n}","afterClose.popover":"function(event) {\n  const { map, data: { controller } } = event      \n\n}","beforeRedraw.detailsView":"function(event) {\n  const { map, data: { controller } } = event      \n}","afterRedraw.detailsView":"function(event) {\n  const { map, data: { controller } } = event      \n  \n}","beforeClose.detailsView":"function(event) {\n  const { map, data: { controller } } = event      \n  \n}","afterClose.detailsView":"function(event) {\n  const { map, data: { controller } } = event      \n  \n}","beforeShow.detailsView":"function(event) {\n  const { map, data: { controller } } = event          \n\n}","afterShow.detailsView":"function(event) {\n  const { map, data: { controller } } = event          \n\n}","beforeRedraw.tooltip":"function(event) {\n  const { map, data: { controller } } = event      \n}","afterRedraw.tooltip":"function(event) {\n  const { map, data: { controller } } = event      \n}","beforeClose.tooltip":"function(event) {\n  const { map, data: { controller } } = event      \n}","afterClose.tooltip":"function(event) {\n  const { map, data: { controller } } = event      \n}","beforeShow.tooltip":"function(event) {\n  const { map, data: { controller } } = event          \n}","afterShow.tooltip":"function(event) {\n  const { map, data: { controller } } = event          \n}"},css:"#mapsvg-map-%id% .mapsvg-tooltip {\n\n}\n#mapsvg-map-%id% .mapsvg-popover {\n\n}\n#mapsvg-map-%id% .mapsvg-details-container {\n\n}\n#mapsvg-map-%id% .mapsvg-directory-item {\n\n}\n#mapsvg-map-%id% .mapsvg-region-label {\n  /* background-color: rgba(255,255,255,.6); */\n  font-size: 11px;\n  padding: 3px 5px;\n  border-radius: 4px;\n}\n#mapsvg-map-%id% .mapsvg-marker-label {\n  padding: 3px 5px;\n  /*\n  border-radius: 4px;\n  background-color: white;\n  margin-top: -4px;\n  */\n}\n#mapsvg-map-%id% .mapsvg-filters-wrap {\n\n}\n\n\n\n\n\n\n",templates:{list:'<div class="mapsvg-details-list">\n            {{#each objects}}\n          <div class="mapsvg-details-list-item">\n                  <div class="mapsvg-details-list-item-image">\n                    <img src="{{images.0.thumbnail}}" />\n                  </div>\n                  <div class="mapsvg-details-list-item-info">    \t      \n                    <h6>{{title}}</h6>\n                    <p class="mapsvg-details-address">{{location.address.formatted}}</p>   \n              <p class="mapsvg-details-category">{{category_text}}</p>                                   \n                    <p>{{description}}</p>  \n                <div class="mapsvg-details-link"><a href="{{link}}">{{link}}</a></div>              \n                  </div>\t            \n              </div>\n            {{/each}}\n          </div>',default:'<div class="mapsvg-details-flex">\n        \n        <div class="mapsvg-details-hero">\n          <img src="{{images.0.full}}" class="mapsvg-details-hero-image"/>\n        </div>\n        <div class="mapsvg-details-info">\n          <h4 class="mapsvg-details-header">{{#if title}} {{title}} {{else}} {{id}} {{/if}}</h4>\n          {{description}}\n        </div>\n      </div>    \n    ',post:"{{{post}}}",title:"{{title}}",imageTitle:'<div class="mapsvg-imageTitle-content">\n  <div class="mapsvg-imageTitle-image">\n    <img src="{{images.0.thumbnail}}" />\n  </div>\n  <div class="mapsvg-imageTitle-title">    \t      \n    {{title}}                                  \n  </div>\t            \n</div>',address:"{{#if location.address.formatted}}\n        {{location.address.formatted}}\n      {{else}}\n        {{#if location.geoPoint.lat}}\n          {{location.geoPoint.lat}}, {{location.geoPoint.lng}}\n        {{/if}}\n      {{/if}}",popoverRegion:An.replace(/%templateType%/g,"Popover").replace(/%templateTypeSnake%/g,"popover"),popoverMarker:jn.replace(/%templateType%/g,"Popover").replace(/%templateTypeSnake%/g,"popover"),tooltipRegion:"{{id}} - {{title}}",tooltipMarker:"{{title}}",detailsView:jn.replace(/%templateType%/g,"Details View").replace(/%templateTypeSnake%/g,"detailsView"),detailsViewRegion:An.replace(/%templateType%/g,"Details View").replace(/%templateTypeSnake%/g,"detailsView"),labelMarker:"{{#if location.address.formatted}}\n        {{location.address.formatted}}\n      {{else}}\n        {{#if location.geoPoint.lat}}\n          {{location.geoPoint.lat}}, {{location.geoPoint.lng}}\n        {{/if}}\n      {{/if}}",labelRegion:"{{title}}",labelLocation:"You are here!",directory:'{{#if categories}}\n  {{#each categories}}\n    {{>directoryCategoryItem}}\n  {{/each}}\n{{else}}  \n  {{#each items}}\n      {{>directoryItem}}      \n  {{/each}}\n  {{#unless items.length}}\n    <div class="mapsvg-no-results">{{noResultsLabel}}</div>\n  {{/unless}}\n{{/if}}',directoryItem:'<div id="mapsvg-directory-item-{{toSnakeCase id}}" class="mapsvg-directory-item" data-object-id="{{id}}">\n  {{title}} \n</div>',directoryCategoryItem:'<div id="mapsvg-category-item-{{value}}" class="mapsvg-category-item" data-category-value="{{value}}">\n  <span class="mapsvg-category-label">{{label}}</span>\n  <span class="mapsvg-category-counter">{{counter}}</span>\n  <span class="mapsvg-chevron"></span>\n</div>\n<div class="mapsvg-category-block" data-category-id="{{value}}">\n  {{#each items}}\n    {{>directoryItem}}\n  {{/each}}  \n</div>    \n    '},choropleth:{on:!1,source:"regions",sourceFieldSelect:{on:!1,variants:[]},bubbleMode:!1,bubbleSize:{min:20,max:40},labels:{low:"low",high:"high"},colors:{lowRGB:null,highRGB:null,low:"#550000",high:"#ee0000",noData:"#333333"},min:0,max:0,coloring:{mode:"gradient",noData:{color:"#999999",description:"No data"},gradient:{colors:{lowRGB:null,highRGB:null,diffRGB:null,low:"#550000",high:"#ee0000"},labels:{low:"low",high:"high"},values:{min:null,max:null,maxAdjusted:null}},palette:{outOfRange:{color:"#ececec",description:"Out of range"},colors:[{color:"#550000",valueFrom:0,valueTo:50,description:""}]},legend:{on:!0,layout:"vertical",container:"bottom-left",title:"Choropleth map",text:"",description:"",width:"20%",height:"20%"}}},filters:{on:!0,source:"database",location:"header",modalLocation:"map",width:"100%",hide:!1,showButtonText:"Filters",clearButtonText:"Clear all",clearButton:!1,searchButton:!1,searchButtonText:"Search",padding:""},menu:{on:!1,hideOnMobile:!0,location:"leftSidebar",locationMobile:"leftSidebar",search:!1,containerId:"",searchPlaceholder:"Search...",searchFallback:!1,source:"database",showFirst:"map",showMapOnClick:!0,minHeight:"400",sortBy:"id",sortDirection:"desc",categories:{on:!1,groupBy:"",hideEmpty:!0,collapse:!0,collapseOther:!0},clickActions:{region:"default",marker:"default",directoryItem:{triggerClick:!0,showPopover:!1,showDetails:!0}},detailsViewLocation:"overDirectory",noResultsText:"No results found",filterout:{field:"",cond:"=",val:""}},database:{on:!0,regionsTableName:"",objectsTableName:"",pagination:{on:!0,perpage:30,next:"Next",prev:"Prev.",showIn:"both"},loadOnStart:!0,table:"",schemas:{regions:{objectNameSingular:"region",objectNamePlural:"regions",name:"",apiEndpoints:[{url:"regions/%name%",method:"GET",name:"index"},{url:"regions/%name%/[:id]",method:"GET",name:"show"},{url:"regions/%name%",method:"POST",name:"create"},{url:"regions/%name%/[:id]",method:"PUT",name:"update"},{url:"regions/%name%/[:id]",method:"DELETE",name:"delete"},{url:"regions/%name%",method:"DELETE",name:"clear"}]},objects:{objectNameSingular:"object",objectNamePlural:"objects",name:"",apiEndpoints:[{url:"objects/%name%",method:"GET",name:"index"},{url:"objects/%name%/[:id]",method:"GET",name:"show"},{url:"objects/%name%",method:"POST",name:"create"},{url:"objects/%name%/[:id]",method:"PUT",name:"update"},{url:"objects/%name%/[:id]",method:"DELETE",name:"delete"},{url:"objects/%name%",method:"DELETE",name:"clear"}]}}},actions:{map:{afterLoad:{selectRegion:!0,selectMarker:!0}},region:{mouseover:{showTooltip:!1,tooltipTemplate:"title"},click:{addIdToUrl:!1,showDetails:!0,showDetailsFor:"region",detailsViewTemplate:"default",filterDirectory:!1,loadObjects:!1,showPopover:!1,showPopoverFor:"region",popoverTemplate:"default",goToLink:!1,linkField:"Region.link"},touch:{showPopover:!1}},marker:{mouseover:{showTooltip:!1,tooltipTemplate:"address"},click:{addIdToUrl:!1,showDetails:!0,detailsViewTemplate:"default",showPopover:!1,popoverTemplate:"default",goToLink:!1,linkField:"Object.link"},touch:{showPopover:!1}},directoryItem:{click:{showDetails:!0,detailsViewTemplate:"default",showPopover:!1,goToLink:!1,selectRegion:!0,fireRegionOnClick:!0,linkField:"Object.link"},hover:{centerOnMarker:!1}}},detailsView:{location:"map",containerId:"",width:"100%",mobileFullscreen:!0},mobileView:{labelMap:"Map",labelList:"List",labelClose:"Close"},googleMaps:{on:!1,apiKey:"",loaded:!1,center:"auto",type:"roadmap",minZoom:1,style:"default",styleJSON:[],language:"en"},groups:[],floors:[],layersControl:{on:!1,position:"top-left",label:"Show on map",expanded:!0,maxHeight:"100%"},floorsControl:{on:!1,position:"top-left",label:"Floors",expanded:!1,maxHeight:"100%"},containers:{leftSidebar:{on:!1,width:"250px"},rightSidebar:{on:!1,width:"250px"},header:{on:!0,height:"auto"},footer:{on:!1,height:"auto"}},labelsMarkers:{on:!1},labelsRegions:{on:!1},svgFileVersion:1,fitMarkers:!1,fitMarkersOnStart:!1,fitSingleMarkerZoom:20,controls:{location:"right",zoom:!0,zoomReset:!1,userLocation:!1,previousMap:!1},previousMapsIds:[]},Pn=jQuery;var Fn;!function(t){t.AFTER_INIT="afterInit",t.BEFORE_INIT="beforeInit",t.ZOOM="zoom",t.AFTER_CHANGE_BOUNDS="afterChangeBounds",t.RESIZE="resize"}(Fn||(Fn={}));class On{constructor(t,e,i={prefetch:!0,inBackend:!1}){var o;if(this.markerOptions={src:s.routes.root+"markers/pin1_red.png"},this.previousPaddingBottom=0,this.dirtyFields=[],this.regions=new dt("id"),this.objects=new dt("id"),this.geoCoordinates=!1,this.highlightedRegions=[],this.editRegions={on:!1},this.editMarkers={on:!1},this.editData={on:!1},this.googleMaps={loaded:!1,initialized:!1,map:null,zoomLimit:!0,maxZoomService:null},this.groups=new dt("id",[],{autoId:!0,unique:!0}),this.svgDefault={},this.viewBox=new gn,this._viewBox=new gn,this.geoViewBox=new fn(new Tt(0,0),new Tt(0,0)),this.isScrolling=!1,this.zoomDelta=0,this.scale=1,this.scroll={tx:0,ty:0,vxi:0,vyi:0,x:0,y:0,dx:0,dy:0,vx:0,vy:0,gx:0,gy:0,touchScrollStart:0},this.containers={},this.containersCreated=!1,this.eventsBaseInitialized=!1,this.controllers={},this.markers=new dt("id",[],{unique:!0}),this.markersClusters=new dt("id"),this.selected_id=[],this.layers={},this.eventsPreventList={},this.svgFileLoaded=!1,this.mapDataLoaded=!1,this.reloadRegionStyles=t=>{const e=this.getRegionStylesByState(t);e&&t.setStylesByState(e)},this.redrawGauge=()=>{this.updateGaugeMinMax(),this.reloadAllRegionStyles()},i?(this.extras=i,this.inBackend=null!==(o=i.inBackend)&&void 0!==o&&o):this.extras={},!e)throw new Error("To create a new map, you need to provide either SVG file URL or map ID and API url.");this.containerId=t,this.id=e.id,this.svgFileLastChanged="number"==typeof e.svgFileLastChanged?e.svgFileLastChanged:Number(e.svgFileLastChanged),this.events=new mt({context:this,contextName:"map",map:this}),this.options=h({},Ln,e.options),this.svgFileLoadedPromise=new Promise(((t,e)=>{this.svgFileLoadedResolve=t})),this.setLoadingText(e.options&&e.options.loadingText||""),this.addLoadingMessage(),this.showLoadingMessage(),this.middlewares=new gt,this.init()}loadSvgFile(t,e=1){return this.svgFilePromise=fetch(t+"?version="+(e||"")).then((t=>a(this,void 0,void 0,(function*(){if(!t.ok){if(404===t.status){const t="MapSVG couldn't load SVG file. Please check if the file exists: "+this.options.source+". If the file exists, please contact support (this message is showing up only in wp-admin area).";throw new Error(t)}throw t.status,new Error(`MapSVG: SVG file loading error! status: ${t.status}`)}return(yield t.text()).trim()})))).then((t=>a(this,void 0,void 0,(function*(){const e=(new DOMParser).parseFromString(t,"image/svg+xml");setTimeout((()=>{this.renderSvgData(e),this.svgFileLoaded=!0,this.reloadRegions(),this.decrementAfterloadBlockers(),this.svgFileLoadedResolve(!0)}),500)})))).catch((t=>{this.inBackend?Pn.growl.error({message:t,duration:6e4}):console.error("MapSVG couldn't load SVG file")})),this.svgFilePromise}init(){var t,i;s.addInstance(this),this.afterLoadBlockers=2,this.loaded=!1,this.afterLoadBlockers+=this.extras.prefetch?2:0;const o=this.options;if(e(o,["filters"]),this.setEventHandlers(),this.id&&!1!==this.extras.prefetch){const o=!0===(null===(i=null===(t=this.options)||void 0===t?void 0:t.database)||void 0===i?void 0:i.loadOnStart)||this.inBackend?"objects,regions":"regions";this.mapDataPromise=fetch(s.routes.api+`maps/${this.id}?withData=${o}`).then((t=>a(this,void 0,void 0,(function*(){if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return yield t.json()})))).then((t=>a(this,void 0,void 0,(function*(){const i=t.map;if(this.version=i.version,this.svgFileLastChanged=i.svgFileLastChanged,h(this.options,i.options),Array.isArray(this.options.regions)){const t={};this.options.regions.forEach(((e,i)=>{"string"==typeof i&&(t[i]=e)})),this.options.regions=t}if(Array.isArray(this.options.regionStatuses)){const t={};this.options.regionStatuses.forEach(((e,i)=>{t[i]=e})),this.options.regionStatuses=t}this.setRegionPrefix(this.options.regionPrefix||""),this.setLoadingText(this.options.loadingText||""),this.events&&this.options&&this.options.events&&this.options.events.beforeInit&&this.setEvents({beforeInit:this.options.events.beforeInit}),this.events.trigger(Fn.BEFORE_INIT,{options:this.options}),this.createContainers();const o=f(this.options.source)&&!v(this.options.source,s.routes.home)?s.routes.api+`maps/${this.id}/svg`:this.urlToRelativePath(this.options.source);if(this.loadSvgFile(o,this.svgFileLastChanged),yield this.initMap(this.options),!t.regions&&this.id&&this.options.database.regionsTableName)this.regionsRepository.events.once(Lt.AFTER_LOAD,(()=>{this.decrementAfterloadBlockers()}));else if(t.regions){this.regionsRepository.events.once(Lt.AFTER_LOAD,(()=>{this.decrementAfterloadBlockers()}));const i={repository:this.regionsRepository,url:this.regionsRepository.getApiEndpoint("index").url||"",action:"index",method:"GET"},s=t.regions,{schema:o}=s,n=e(s,["schema"]);this.regionsRepository.schema.update(o),this.regionsRepository.loadDataFromResponse(n,{request:i,response:{data:n}})}else this.decrementAfterloadBlockers();if(!t.objects&&this.id&&i.options.database.objectsTableName)i.options.database.loadOnStart?this.objectsRepository.events.once(Lt.AFTER_LOAD,(()=>{this.decrementAfterloadBlockers()})):this.decrementAfterloadBlockers();else if(t.objects&&(this.inBackend||i.options.database.loadOnStart)){this.objectsRepository.events.once(Lt.AFTER_LOAD,(()=>{this.decrementAfterloadBlockers()}));const i={repository:this.objectsRepository,url:this.objectsRepository.getApiEndpoint("index").url||"",action:"index",method:"GET"},s=t.objects,{schema:o}=s,n=e(s,["schema"]);this.objectsRepository.schema.update(o),"api"===this.objectsRepository.schema.type?this.objectsRepository.find():this.objectsRepository.loadDataFromResponse(n,{request:i,response:{data:n}})}else this.decrementAfterloadBlockers()})))).catch((t=>{console.error("Fetch error:",t)}))}else{this.events.trigger(Fn.BEFORE_INIT,{options:this.options}),this.createContainers();const t=f(this.options.source)&&!v(this.options.source,s.routes.home)?s.routes.api+`maps/${this.id}/svg`:this.urlToRelativePath(this.options.source);this.loadSvgFile(t,this.svgFileLastChanged).then((()=>a(this,void 0,void 0,(function*(){yield this.svgFileLoadedPromise,this.loadMockRegions()})))),this.updateOutdatedOptions({version:this.version||"1.0.0",options:this.options}).then((({version:t,options:e})=>{this.version=t,this.initMap(e)})).catch((t=>{console.error("Failed to update options:",t)}))}return this.debouncedShowTooltip=y((t=>{this.showTooltip(t)}),20),this}initMap(t,i){return a(this,void 0,void 0,(function*(){const{data_regions:i,data_objects:o,events:n,middlewares:r}=t;let a=e(t,["data_regions","data_objects","events","middlewares"]);n&&this.setEvents(n,!0);const{mapLoad:l}=r,c=e(r,["mapLoad"]);l&&this.setMiddlewares({mapLoad:l},!0),a=this.middlewares.run(lt.MAP_LOAD,[a,{map:this}]),this.regionsRepository=It(a.database.schemas.regions,this),this.regionsRepository.init(),this.regionsRepository.query.update({perpage:0}),this.objectsRepository=It(a.database.schemas.objects,this),this.objectsRepository.init(),this.objectsRepository.query.update({perpage:a.database.pagination.on?a.database.pagination.perpage:0}),this.setMiddlewares(c,!0),this.setRepositoryEvents(),this.mapDataLoaded=!0,yield this.svgFileLoadedPromise,a=h({},this.svgDefault,a);const{viewBox:d,width:u,height:p,responsive:m}=a,g=e(a,["viewBox","width","height","responsive"]),f={width:Number(u)||this.viewBox.width||this.svgDefault.width,height:Number(p)||this.viewBox.height||this.svgDefault.height,responsive:m};this.setSvgTagViewBox(this.svgDefault.viewBox),this.setSize(f.width,f.height,f.responsive);const v=d&&d.length>0?new gn(d):this.svgDefault.viewBox;this.setInitialViewBox(v),this.setWhRatio(v.width/v.height),this.setViewBox(v),this.initialZoomLevel=this.zoomLevel,this.converter=new Dn(this),this.geoViewBox&&this.converter.setGeoViewBox(this.geoViewBox),this.update(g),this.options.googleMaps.on&&this.afterLoadBlockers++,this.filtersShouldBeShown()&&this.afterLoadBlockers++,s.googleMaps.apiKey&&(this.inBackend||this.options.googleMaps.on||this.options.filters.on&&this.options.filtersSchema&&this.options.filtersSchema.find((t=>"distance"===t.type)))&&this.loadGoogleMapsAPI((()=>1),(()=>1)),this.options.colors&&this.options.colors.background&&(this.containers.map.style.background=this.options.colors.background),this.decrementAfterloadBlockers()}))}loadMockRegions(){const t={repository:this.regionsRepository,url:this.regionsRepository.getApiEndpoint("index").url||"",action:"index",method:"GET"},e={items:this.regions.map((t=>({id:t.id,title:t.title}))),schema:{fields:[{type:"id",name:"id"},{type:"text",name:"title"}]},hasMore:!1,page:1,perpage:0};this.regionsRepository.loadDataFromResponse(e,{request:t,response:{data:e}})}urlToRelativePath(t){return t=0===t.indexOf("//")?t.replace(/^\/\/[^/]+/,"").replace("//","/"):t.replace(/^.*:\/\/[^/]+/,"").replace("//","/")}setGroups(t){t&&(this.groups.clear(),this.groups.push(...t),this.options.groups=this.groups),this.groups.forEach((t=>{t.objects&&t.objects.length&&t.objects.forEach((e=>{const i=this.containers.svg.querySelector("#"+e.value);i&&i.classList.toggle("mapsvg-hidden",!t.visible)}))}))}getGroupSelectOptions(){const t=[],e=[],i=[];return Pn(this.containers.svg).find("g").each((function(t){const i=Pn(this)[0].getAttribute("id");if(i){const t=Pn(this)[0].getAttribute("title");e.push({label:t||i,value:i})}})),t.push({title:"SVG Layers / Groups",options:e}),Pn(this.containers.svg).find("path,ellipse,circle,polyline,polygon,rectangle,img,text").each((function(t){const e=Pn(this)[0].getAttribute("id");if(e){const t=Pn(this)[0].getAttribute("title");i.push({label:t||e,value:e})}})),t.push({title:"Other SVG objects",options:i}),t}setLayersControl(t){const e=this;if(t&&h(this.options.layersControl,t),this.options.layersControl.on){if(!this.containers.layersControl){this.containers.layersControl=document.createElement("div"),this.containers.layersControl.classList.add("mapsvg-layers-control"),this.containers.layersControlLabel=document.createElement("div"),this.containers.layersControlLabel.classList.add("mapsvg-layers-label"),this.containers.layersControl.appendChild(this.containers.layersControlLabel);const t=document.createElement("div");t.classList.add("mapsvg-layers-list-wrap"),this.containers.layersControl.appendChild(t),this.containers.layersControlListNano=document.createElement("div"),this.containers.layersControlListNano.classList.add("nano"),t.appendChild(this.containers.layersControlListNano),this.containers.layersControlList=document.createElement("div"),this.containers.layersControlList.classList.add("mapsvg-layers-list"),this.containers.layersControlList.classList.add("nano-content"),this.containers.layersControlListNano.appendChild(this.containers.layersControlList),this.containers.mapContainer.appendChild(this.containers.layersControl)}for(this.containers.layersControl.style.display="block",this.containers.layersControlLabel.innerHTML=this.options.layersControl.label,this.containers.layersControlLabel.style.display="block",this.containers.layersControlList.innerHTML="";this.containers.layersControlList.firstChild;)this.containers.layersControlList.removeChild(this.containers.layersControlList.firstChild);this.containers.layersControl.classList.remove("mapsvg-top-left","mapsvg-top-right","mapsvg-bottom-left","mapsvg-bottom-right"),this.containers.layersControl.classList.add("mapsvg-"+this.options.layersControl.position),this.options.menu.on&&!this.options.menu.customContainer&&-1!==this.options.layersControl.position.indexOf("left")&&(this.containers.layersControl.style.left=this.options.menu.width),this.containers.layersControl.style.maxHeight=this.options.layersControl.maxHeight,this.options.groups.forEach((t=>{const e=document.createElement("div");e.classList.add("mapsvg-layers-item"),e.setAttribute("data-group-id",t.id),e.innerHTML='<input type="checkbox" class="ios8-switch ios8-switch-sm" '+(t.visible?"checked":"")+" /><label>"+t.title+"</label>",this.containers.layersControlList.appendChild(e)})),Pn(this.containers.layersControlListNano).nanoScroller({preventPageScrolling:!0,iOSNativeScrolling:!0}),Pn(this.containers.layersControl).off(),Pn(this.containers.layersControl).on("click",".mapsvg-layers-item",(function(){const t=Pn(this).data("group-id"),i=Pn(this).find("input");i.prop("checked",!i.prop("checked")),e.groups.forEach((function(e){e.id===t&&(e.visible=!e.visible)})),e.setGroups()})),Pn(this.containers.layersControlLabel).off(),Pn(this.containers.layersControlLabel).on("click",(()=>{Pn(e.containers.layersControl).toggleClass("closed")})),Pn(this.containers.layersControl).toggleClass("closed",!this.options.layersControl.expanded)}else this.containers.layersControl&&(this.containers.layersControl.style.display="none")}loadDataObjects(t){return this.objectsRepository.find(t)}loadItemsToDirectory(){var t,e,i,s,o,n,r,a,l;let h=[];const c=this;if(!(null===(t=this.controllers.directory)||void 0===t?void 0:t.repository)||!(null===(e=this.controllers.directory)||void 0===e?void 0:e.repository.loaded))return!1;if(this.options.menu.categories&&this.options.menu.categories.on&&this.options.menu.categories.groupBy){const t=this.options.menu.categories.groupBy;if(void 0===(null===(i=this.controllers.directory)||void 0===i?void 0:i.repository.getSchema().getField(t))||void 0===(null===(s=this.controllers.directory)||void 0===s?void 0:s.repository.getSchema().getField(t).options))return!1;(null===(o=this.controllers.directory)||void 0===o?void 0:o.repository.getSchema().getField(t).options).forEach((e=>{var i;let s=null===(i=this.controllers.directory)||void 0===i?void 0:i.repository.getLoaded().map((t=>t.getData()));s=this.directoryFilterOut(s);const o=[];s.forEach((t=>{o.push(t)}));const n=o.filter((function(i){if("regions"===t){return-1!==(void 0!==i[t]&&i[t].length?i[t]:[]).map((function(t){return t.id})).indexOf(e.id)}return i[t]==e.value}));e.counter=n.length,"regions"===t&&(e.label=e.title,e.value=e.id),n.sort((function(t,e){const i=c.options.menu.sortBy,s="asc"===c.options.menu.sortDirection?1:-1;return t[i]===e[i]?0:t[i]>e[i]?s:-s})),h.push(Object.assign(Object.assign({},e),{items:n}))})),this.options.menu.categories.hideEmpty&&(h=h.filter((function(t){return t.counter>0}))),null===(n=this.controllers.directory)||void 0===n||n.setState({categories:h,items:null})}else"regions"===this.options.menu.source?(h=null===(r=this.controllers.directory)||void 0===r?void 0:r.repository.getLoaded().map((t=>{const e=t.getData();return this.getRegion(e.id)?(e.objects=this.getRegion(e.id).objects,e):null})).filter((t=>null!==t)),h=this.directoryFilterOut(h)):h=null===(a=this.controllers.directory)||void 0===a?void 0:a.repository.getLoaded().map((t=>t.getData())),null===(l=this.controllers.directory)||void 0===l||l.setState({categories:null,items:h})}directoryFilterOut(t){var e;const i=this;if(-1!==(null===(e=this.controllers.directory)||void 0===e?void 0:e.repository.schema.objectNameSingular.indexOf("region"))){const e={field:"",val:""};this.options.menu.filterout.field&&(e.field=this.options.menu.filterout.field,e.val=this.options.menu.filterout.val),t=t.filter((function(t){let s=!0;const o=i.options.regionStatuses;return o[t.status]&&(s=!o[t.status].disabled),s&&e.field&&(s=t[e.field]!=e.val),s}))}return t}loadDirectory(){(this.inBackend||"database"!==this.options.menu.source||this.objectsRepository.loaded)&&(this.options.menu.on&&this.controllers.directory&&this.loadItemsToDirectory(),this.setPagination())}setPagination(){var t;this.containers.pagerMap&&Pn(this.containers.pagerMap).empty().remove(),this.containers.pagerDir&&Pn(this.containers.pagerDir).empty().remove();const e=["map","both"].includes(this.options.database.pagination.showIn),i=["directory","both"].includes(this.options.database.pagination.showIn),s=this.options.database.pagination.on&&0!==this.options.database.pagination.perpage,o=i&&s&&this.controllers.directory&&this.options.menu.on?this.getPagination():null;this.controllers.directory&&(null===(t=this.controllers.directory)||void 0===t||t.setPagination(o));const n=e&&s;this.containers.pagerMap=n?this.getPagination():null,this.containers.pagerMap&&this.containers.map.appendChild(this.containers.pagerMap)}getPagination(t){const e=this,i=Pn('<nav class="mapsvg-pagination"><ul class="pager">\x3c!--<li class="mapsvg-first"><a href="#">First</a></li>--\x3e<li class="mapsvg-prev"><a href="#">&larr; '+e.options.database.pagination.prev+" "+e.options.database.pagination.perpage+'</a></li><li class="mapsvg-next"><a href="#">'+e.options.database.pagination.next+" "+e.options.database.pagination.perpage+' &rarr;</a></li>\x3c!--<li class="mapsvg-last"><a href="#">Last</a></li>--\x3e</ul></nav>');return this.objectsRepository?(this.objectsRepository.onFirstPage()&&this.objectsRepository.onLastPage()?i.hide():(i.find(".mapsvg-prev").removeClass("disabled"),i.find(".mapsvg-first").removeClass("disabled"),i.find(".mapsvg-last").removeClass("disabled"),i.find(".mapsvg-next").removeClass("disabled"),this.objectsRepository.onLastPage()&&i.find(".mapsvg-next").addClass("disabled")&&i.find(".mapsvg-last").addClass("disabled"),this.objectsRepository.onFirstPage()&&i.find(".mapsvg-prev").addClass("disabled")&&i.find(".mapsvg-first").addClass("disabled")),i.on("click",".mapsvg-next:not(.disabled)",(e=>{if(e.preventDefault(),this.objectsRepository.onLastPage())return;const i=new Mt({page:this.objectsRepository.query.page+1});this.objectsRepository.find(i).done((function(){t&&t()}))})).on("click",".mapsvg-prev:not(.disabled)",(function(i){if(i.preventDefault(),e.objectsRepository.onFirstPage())return;const s=new Mt({page:e.objectsRepository.query.page-1});e.objectsRepository.find(s).done((function(){t&&t()}))})).on("click",".mapsvg-first:not(.disabled)",(function(i){if(i.preventDefault(),e.objectsRepository.onFirstPage())return;const s=new Mt({page:1});e.objectsRepository.find(s).done((function(){t&&t()}))})).on("click",".mapsvg-last:not(.disabled)",(function(i){if(i.preventDefault(),e.objectsRepository.onLastPage())return;const s=new Mt({lastpage:!0});e.objectsRepository.find(s).done((function(){t&&t()}))})),i[0]):i[0]}deleteMarkers(){for(;this.markers.length;)this.markerDelete(this.markers[0])}deleteClusters(){this.markersClusters&&(this.markersClusters.forEach((function(t){t.destroy()})),this.markersClusters.clear()),this.clustersFromWorker=[]}addLocation(t){let e=this.objectsRepository.getSchema().getFieldByType("location");if(e&&(e=e.name,e)){this.firstDataLoad&&this.setMarkerImagesDependency();const i=t[e];if(i.img&&(i.geoPoint||i.svgPoint)){const e=new bn({location:i,object:t,mapsvg:this});this.markerAdd(e)}}}addClustersFromWorker(t){this.clustersFromWorker=[];for(const e in t){const i=t[e].markers.map((t=>{const e=this.objectsRepository.objects.findById(t.id);if(e&&e.location)return e.location.marker}));this.clustersFromWorker.push(new xn({markers:i,svgPoint:new Et(t[e].x,t[e].y),cellX:t[e].cellX,cellY:t[e].cellY},this))}this.clusterizeMarkers()}startClusterizer(){return a(this,void 0,void 0,(function*(){if(this.clustersFromWorker=[],!this.objectsRepository||0===this.objectsRepository.getLoaded().length)return;if(!this.objectsRepository.getSchema().getFieldByType("location"))return!1;this.clusterizerWorker||(this.clusterizerWorker=new Worker(s.routes.root+"js/mapsvg/Core/ClusteringWorker.js"),this.clusterizerWorker.onmessage=t=>{t.data.clusters&&this.addClustersFromWorker(t.data.clusters)},this.events.on(Fn.ZOOM,(()=>{this.clusterizerWorker&&this.options.clustering.on&&this.clusterizerWorker.postMessage({message:"zoom",zoomLevel:this.zoomLevel,viewBox:this.viewBox})})),this.events.on(Fn.RESIZE,(t=>{this.clusterizerWorker&&this.options.clustering.on&&this.clusterizerWorker.postMessage({message:"resize",viewBox:t.data.viewBox,mapWidth:t.data.mapWidth,mapHeight:t.data.mapHeight})})));const t=[];this.objectsRepository.getLoaded().filter((t=>t.location&&t.location.marker)).forEach((e=>{const{x:i,y:s}=e.location.marker.svgPoint;t.push({id:e.getData().id,x:i,y:s})})),this.clusterizerWorker.postMessage({objects:t,cellSize:50,mapWidth:this.containers.map.clientWidth,zoomLevel:this.zoomLevel,zoomDelta:this.zoomDelta,svgViewBox:this.svgDefault.viewBox,viewBox:this.viewBox})}))}clusterizeMarkers(t){Pn(this.layers.markers).children().each(((t,e)=>{Pn(e).detach()})),this.markers.clear(),this.markersClusters.clear(),Pn(this.containers.map).addClass("no-transitions-markers"),this.clustersFromWorker.length>0&&this.clustersFromWorker.forEach((t=>{this.googleMaps.map&&this.googleMaps.map.getZoom()>=17?this.markerAdd(t.markers[0]):t.markers.length>1?this.markersClusterAdd(t):this.markerAdd(t.markers[0])})),this.editingMarker&&this.markerAdd(this.editingMarker),t||this.mayBeFitMarkers(),this.options.labelsMarkers.on&&this.setLabelsMarkers(),Pn(this.containers.map).removeClass("no-transitions-markers")}getCssUrl(){return s.routes.root+"css/mapsvg.css"}isGeo(){return this.mapIsGeo}getOptions(t,e){const i=h({},this.options);return function t(e){for(const i in e)e[i]&&"object"==typeof e[i]&&(t(e[i]),0===Object.keys(e[i]).length&&delete e[i])}(i.regions),h(i,this.optionsDelta),i.viewBox=this._viewBox.toArray(),this.filtersSchema&&(i.filtersSchema=this.filtersSchema.getFields(),i.filtersSchema.length>0&&i.filtersSchema.forEach((t=>{"distance"===t.type&&(t.value="")}))),delete i.markers,t&&(i.svgFilename=i.source.split("/").pop(),i.svgFiles=s.svgFiles),e&&Pn.each(i,((t,e)=>{JSON.stringify(e)==JSON.stringify(this.defaults[t])&&delete i[t]})),i}restoreDeltaOptions(){this.update(this.optionsDelta),this.optionsDelta={}}setMiddlewares(t,e=!1){let i;for(const s in t){if("string"==typeof t[s]){if(i=""!=t[s]?b(t[s]):null,!i||i.error||i instanceof TypeError||i instanceof SyntaxError)continue}else"function"==typeof t[s]&&(i=t[s]);this.setMiddleware(s,i,e)}h(this.options.middlewares,t)}setMiddleware(t,e,i=!1){switch(this.middlewares.add(t,e,i),t){case lt.REQUEST:case lt.RESPONSE:this.objectsRepository&&this.objectsRepository.middlewares.add(t,e,i),this.regionsRepository&&this.regionsRepository.middlewares.add(t,e,i)}}setEvents(t,e){var i,s;let o;for(const n in t){if("string"==typeof t[n]){if(o=""!=t[n]?b(t[n]):null,!o||o.error||o instanceof TypeError||o instanceof SyntaxError)continue}else"function"==typeof t[n]&&(o=t[n]);if(this.events.on(n,o,{unique:null!=e&&e}),-1!==n.indexOf("directory")){const t=n.split(".")[0];this.controllers&&this.controllers.directory&&(null===(i=this.controllers.directory)||void 0===i||i.events.off(t),null===(s=this.controllers.directory)||void 0===s||s.events.on(t,o))}}h(this.options.events,t)}setActions(t){h(this.options.actions,t)}setDetailsView(t){t=t||this.options.detailsView||{},h(this.options.detailsView,t)}setMobileView(t){h(this.options.mobileView,t)}attachDataToRegions(t){const e=t.getRegionsForTable(this.options.database.regionsTableName).map((t=>t.id));this.regions.filter((t=>e.includes(t.id))).forEach((t=>{t.objects.clear()})),this.objectsRepository.getLoaded().forEach(((t,e)=>{const i=t.getRegionsForTable(this.options.database.regionsTableName);i&&i.length&&i.forEach((e=>{const i=this.getRegion(e.id);i&&i.objects.push(t)}))}))}setTemplates(t){var e;this.templates=this.templates||{};for(const i in t)if(void 0!==i){if(this.options.templates[i]=t[i],"directoryItem"==i||"directoryCategoryItem"==i){Handlebars.unregisterPartial(i);try{Handlebars.registerPartial(i,t[i])}catch(t){Handlebars.registerPartial(i,""),console.error(t)}}else try{this.options.templates[i]=t[i],this.templates[i]=Handlebars.compile(t[i],{strict:!1})}catch(t){console.error(t),this.templates[i]=Handlebars.compile("",{strict:!1})}this.inBackend&&("directory"==i||"directoryCategoryItem"==i||"directoryItem"==i)&&this.controllers&&this.controllers.directory&&(this.controllers.directory.templates.main=this.templates.directory,null===(e=this.controllers.directory)||void 0===e||e.redraw())}}update(t){var s,o;if(!t)return;const{width:n,height:r,responsive:a}=t,l=e(t,["width","height","responsive"]);for(const e in l)if("regions"==e)for(const e in t.regions){const i=this.getRegion(e);i&&i.update(t.regions[e]),this.reloadRegionStyles(i),i&&(this.options.regions[e]=Object.assign(Object.assign({},this.options.regions[e]),t.regions[e])),void 0!==t.regions[e].disabled&&(this.deselectRegion(i),this.options.regions[e]=this.options.regions[e]||{},this.options.regions[e].disabled=i.disabled)}else{const s="set"+i(e);"function"==typeof this[s]?this[s](t[e]):this.options[e]=t[e]}if(n||r){const t={width:void 0!==n?Number(n):null!==(s=this.options.width)&&void 0!==s?s:this.svgDefault.width,height:void 0!==r?Number(r):null!==(o=this.options.height)&&void 0!==o?o:this.svgDefault.height,responsive:void 0!==a?!!a:this.options.responsive};this.setSize(t.width,t.height,t.responsive)}}getDirtyFields(){return this.getData()}clearDirtyFields(){this.dirtyFields=[]}setTitle(t){t&&(this.options.title=t)}setExtension(t){t?this.options.extension=t:delete this.options.extension}setDisableLinks(t){(t=w.numbers.parseBoolean(t))?Pn(this.containers.map).on("click.a.mapsvg","a",(function(t){t.preventDefault()})):Pn(this.containers.map).off("click.a.mapsvg"),this.disableLinks=t}setLoadingText(t){this.options.loadingText=t,this.containers.loading&&(Pn(this.containers.loading).find(".mapsvg-loading-text")[0].innerHTML=this.options.loadingText)}setLockAspectRatio(t){this.options.lockAspectRatio=w.numbers.parseBoolean(t)}setMarkerEditHandler(t){this.markerEditHandler=t}setChoroplethSourceField(t){this.options.choropleth.sourceField=t,this.redrawChoropleth()}setRegionEditHandler(t){this.regionEditHandler=t}setDisableAll(t){t=w.numbers.parseBoolean(t),h(this.options,{disableAll:t}),Pn(this.containers.map).toggleClass("mapsvg-disabled-regions",t)}getChoroplethColor(t){const e=this.options.choropleth;let i="";if(t.data&&(t.data[this.options.regionChoroplethField]||0===t.data[this.options.regionChoroplethField])){const s=0===e.maxAdjusted?0:(parseFloat(t.data[this.options.regionChoroplethField])-e.min)/e.maxAdjusted,o={r:Math.round(e.colors.diffRGB.r*s+e.colors.lowRGB.r),g:Math.round(e.colors.diffRGB.g*s+e.colors.lowRGB.g),b:Math.round(e.colors.diffRGB.b*s+e.colors.lowRGB.b),a:(e.colors.diffRGB.a*s+e.colors.lowRGB.a).toFixed(2)};i="rgba("+o.r+","+o.g+","+o.b+","+o.a+")"}else i=e.colors.noData;return i}getBubbleSize(t){let e;if(t.data&&t.data[this.options.choropleth.sourceField]){const i=Number(this.options.choropleth.bubbleSize.max),s=Number(this.options.choropleth.bubbleSize.min),o=this.options.choropleth.coloring.gradient.values.max,n=this.options.choropleth.coloring.gradient.values.min;e=(parseFloat(t.data[this.options.choropleth.sourceField])-n)/(o-n)*(i-s)+s}else e=!1;return e}getRegionStylesByState(t){var e,i;if(!t)return null;const s={},o=t,n=this.regionsRepository.getSchema().getFieldByType("status")||{options:[]},r=n?n.options.map((t=>t.value)):[];r.push("undefined");for(const t of r){const r={},a={},l={},h=n.options.find((e=>e.value===t));(null==h?void 0:h.color)?r.fill=h.color:this.options.choropleth.on?r.fill=this.getChoroplethColor(o):this.options.regions[o.id]&&this.options.regions[o.id].style&&this.options.regions[o.id].style.fill?r.fill=this.options.regions[o.id].style.fill:this.options.colors.base?r.fill=this.options.colors.base:"none"!=o.styleSvg.fill?r.fill=null!==(e=o.styleSvg.fill)&&void 0!==e?e:this.options.colors.baseDefault:r.fill="none",x(this.options.colors.selected)?a.fill=R(r.fill).lighten(parseFloat(""+this.options.colors.selected)).toRgbString():a.fill=this.options.colors.selected,x(this.options.colors.hover)?l.fill=R(r.fill).lighten(parseFloat(""+this.options.colors.hover)).toRgbString():l.fill=this.options.colors.hover,"none"!=o.style.stroke&&null!=this.options.colors.stroke?r.stroke=this.options.colors.stroke:r.stroke=null!==(i=o.style.stroke)&&void 0!==i?i:"",a.stroke=r.stroke,l.stroke=r.stroke,s[t]={selected:a,hover:l,default:r}}return s}setRegions(t){for(const[e,i]of Object.entries(t)){if(Array.isArray(i.style)){console.error("MapSVG: wrong format of region style options.");continue}this.options.regions[e]?Object.assign(this.options.regions[e],i):this.options.regions[e]=i;const t=this.getRegion(e);t&&t.update(this.options.regions[e])}}setRegionStatuses(t){this.options.regionStatuses=t;const e={};for(const i in t){const s=t[i];e[s.value]=s.color.length?s.color:null}this.setColors({status:e})}setColorsIgnore(t){this.options.colorsIgnore=w.numbers.parseBoolean(t),this.reloadAllRegionStyles()}setColors(t){var e;for(const e in t)if("status"===e)for(const i in t[e])k(t[e][i]);else"string"==typeof t[e]&&k(t[e]);if(h(this.options,{colors:t}),t&&t.status&&(this.options.colors.status=t.status),this.options.colors.markers)for(const t in this.options.colors.markers)for(const e in this.options.colors.markers[t])this.options.colors.markers[t][e]=parseInt(this.options.colors.markers[t][e]);this.options.colors.background&&Pn(this.containers.map).css({background:this.options.colors.background}),this.options.colors.hover&&(this.options.colors.hover=isNaN(this.options.colors.hover)?this.options.colors.hover:parseInt(this.options.colors.hover+"")),this.options.colors.selected&&(this.options.colors.selected=isNaN(this.options.colors.selected)?this.options.colors.selected:parseInt(this.options.colors.selected+"")),Pn(this.containers.leftSidebar).css({"background-color":this.options.colors.leftSidebar}),Pn(this.containers.rightSidebar).css({"background-color":this.options.colors.rightSidebar}),Pn(this.containers.header).css({"background-color":this.options.colors.header}),Pn(this.containers.footer).css({"background-color":this.options.colors.footer}),this.controllers.detailsView&&void 0!==this.options.colors.detailsView&&this.controllers.detailsView.setStyles({backgroundColor:this.options.colors.detailsView}),this.controllers.directory&&void 0!==this.options.colors.directory&&(null===(e=this.controllers.directory)||void 0===e||e.setStyles({backgroundColor:this.options.colors.directory})),this.controllers.filters&&(this.options.colors.directorySearch?this.controllers.filters.setStyles({backgroundColor:this.options.colors.directorySearch}):this.controllers.filters.setStyles({backgroundColor:""})),Pn(this.containers.filtersModal)&&void 0!==this.options.colors.modalFilters&&Pn(this.containers.filtersModal).css({"background-color":this.options.colors.modalFilters}),this.containers.clustersCss||(this.containers.clustersCss=Pn("<style></style>").appendTo("body")[0]);let i="";this.options.colors.clusters&&(i+="background-color: "+this.options.colors.clusters+";"),this.options.colors.clustersBorders&&(i+="border-color: "+this.options.colors.clustersBorders+";"),this.options.colors.clustersText&&(i+="color: "+this.options.colors.clustersText+";"),Pn(this.containers.clustersCss).html(".mapsvg-marker-cluster {"+i+"}"),this.containers.clustersHoverCss||(this.containers.clustersHoverCss=Pn("<style></style>").appendTo("body")[0]);let s="";this.options.colors.clustersHover&&(s+="background-color: "+this.options.colors.clustersHover+";"),this.options.colors.clustersHoverBorders&&(s+="border-color: "+this.options.colors.clustersHoverBorders+";"),this.options.colors.clustersHoverText&&(s+="color: "+this.options.colors.clustersHoverText+";"),Pn(this.containers.clustersHoverCss).html(".mapsvg-marker-cluster:hover {"+s+"}"),this.containers.markersCss||(this.containers.markersCss=Pn("<style></style>").appendTo("head")[0]);const o=".mapsvg-with-marker-active .mapsvg-marker {\n  opacity: "+this.options.colors.markers.inactive.opacity/100+";\n  -webkit-filter: grayscale("+(100-this.options.colors.markers.inactive.saturation)+"%);\n  filter: grayscale("+(100-this.options.colors.markers.inactive.saturation)+"%);\n}\n.mapsvg-with-marker-active .mapsvg-marker-active {\n  opacity: "+this.options.colors.markers.active.opacity/100+";\n  -webkit-filter: grayscale("+(100-this.options.colors.markers.active.saturation)+"%);\n  filter: grayscale("+(100-this.options.colors.markers.active.saturation)+"%);\n}\n.mapsvg-with-marker-hover .mapsvg-marker {\n  opacity: "+this.options.colors.markers.unhovered.opacity/100+";\n  -webkit-filter: grayscale("+(100-this.options.colors.markers.unhovered.saturation)+"%);\n  filter: grayscale("+(100-this.options.colors.markers.unhovered.saturation)+"%);\n}\n.mapsvg-with-marker-hover .mapsvg-marker-hover {\n  opacity: "+this.options.colors.markers.hovered.opacity/100+";\n  -webkit-filter: grayscale("+(100-this.options.colors.markers.hovered.saturation)+"%);\n  filter: grayscale("+(100-this.options.colors.markers.hovered.saturation)+"%);\n}\n";Pn(this.containers.markersCss).html(o),Pn.each(this.options.colors,((t,e)=>{null===e&&delete this.options.colors[t]})),this.reloadAllRegionStyles()}setTooltips(t){void 0!==t.on&&(t.on=w.numbers.parseBoolean(t.on)),h(this.options,{tooltips:t}),this.controllers.tooltips={}}setPopovers(t){void 0!==t.on&&(t.on=w.numbers.parseBoolean(t.on)),h(this.options.popovers,t)}setRegionPrefix(t){this.options.regionPrefix=t}setInitialViewBox(t){this._viewBox.update(t)}setWhRatio(t){this.whRatio={original:this.svgDefault.viewBox.width/this.svgDefault.viewBox.height,current:t}}setSvgTagViewBox(t){this.containers.svg.setAttribute("viewBox",t.toString()),this.vbStart=!0}setViewBox(t,e=!0){if(!this.svgFileLoaded)return;let i=!1;t&&(i=this.checkIfZoomIsNeeded(t),this.viewBox.update(t));const s=100*this.viewBox.height/this.viewBox.width;Math.abs(s-this.previousPaddingBottom)>1&&(Pn(this.containers.map).css({width:"100%",height:"0","padding-bottom":s+"%"}),this.previousPaddingBottom=s),this.whRatio.current=this.viewBox.width/this.viewBox.height,this.scale=this.getScale(),this.whRatio.current,this.whRatio.original;const o=this.whRatio.current,n=this.whRatio.original;if(this.superScale=Math.max(o/n,n/o),this.scroll.tx=Math.round((this.svgDefault.viewBox.x-this.viewBox.x)*this.scale),this.scroll.ty=Math.round((this.svgDefault.viewBox.y-this.viewBox.y)*this.scale),this.googleMaps.map&&!1!==e){const t=this.googleMaps.map.getZoom();i&&this.googleFitCurrentGeoBounds(),t!==this.googleMaps.map.getZoom()&&this.googleMaps.map.setCenter(this.getCenterGeoPoint())}else{const t=this.getRelativeScale();this.containers.scrollpane.style.transform=`translate(${this.scroll.tx}px, ${this.scroll.ty}px) scale(${t})`,this.events.trigger(Fn.AFTER_CHANGE_BOUNDS,{center:{geoPoint:this.getCenterGeoPoint(),svgPoint:this.getCenterSvgPoint()},viewBox:this.viewBox,zoomLevel:this.zoomLevel,scale:this._scale})}return this.movingItemsAdjustScreenPosition(),i&&(this.adjustStrokes(),this.throttle(this.toggleSvgLayerOnZoom,50,this),this.options.clustering.on?this.throttle(this.clusterizeOnZoom,400,this):this.events.trigger(Fn.ZOOM)),!0}getCenterGeoPoint(t=!1,e){return this.isGeo()?this.converter?this.converter.convertSVGToGeo(this.getCenterSvgPoint(t,e)):new Tt(0,0):null}getCenterSvgPoint(t=!1,e){return t?new Et(this.svgDefault.viewBox.x+this.svgDefault.viewBox.width/2,this.svgDefault.viewBox.y+this.svgDefault.viewBox.height/2):e?new Et(e.x+e.width/2,e.y+e.height/2):new Et(this.viewBox.x+this.viewBox.width/2,this.viewBox.y+this.viewBox.height/2)}getZoomRange(){const t={min:0,max:0};return t.min=this.options.zoom.limit[0],t.max=this.options.zoom.limit[1],t}enableMovingElementsAnimation(){Pn(this.containers.map).removeClass("no-transitions-markers no-transitions-labels no-transitions-bubbles")}disableMovingElementsAnimation(){Pn(this.containers.map).addClass("no-transitions-markers no-transitions-labels no-transitions-bubbles")}clusterizeOnZoom(){this.events.trigger(Fn.ZOOM),this.clusterizeMarkers(!0)}throttle(t,e,i,s){clearTimeout(t._tId),t._tId=setTimeout((function(){t.apply(i,s)}),e)}googleFitCurrentGeoBounds(){const t=this.getGeoBounds();this.googleMaps.map.fitBounds({south:t.sw.lat,west:t.sw.lng,north:t.ne.lat,east:t.ne.lng},0)}setViewBoxByGoogleMapBounds(){const t=this.googleMaps.map.getBounds();if(!t)return;const e=t.toJSON();-180==e.west&&180==e.east&&this.googleMaps.map.getCenter().toJSON();const i=new Tt(t.getNorthEast().lat(),t.getNorthEast().lng()),s=new Tt(t.getSouthWest().lat(),t.getSouthWest().lng()),o=this.converter.convertGeoToSVG(i),n=this.converter.convertGeoToSVG(s);if(o.x<n.y){const t=this.svgDefault.viewBox.width/this.converter.mapLonDelta*360;n.x=-(t-n.y)}const r=o.x-n.x,a=n.y-o.y,l=new gn(n.x,o.y,r,a);this.setViewBox(l)}redraw(){var t,e;this.disableAnimation(),this.googleMaps.map?google.maps.event.trigger(this.googleMaps.map,"resize"):this.setViewBox(this.viewBox),Pn(this.containers.popover)&&Pn(this.containers.popover).css({"max-height":this.options.popovers.maxHeight*Pn(this.containers.wrap).outerHeight()/100+"px"}),this.controllers&&this.controllers.directory&&(null===(t=this.controllers.directory)||void 0===t||t.updateTopShift(),null===(e=this.controllers.directory)||void 0===e||e.updateScroll()),this.movingItemsAdjustScreenPosition(),this.adjustStrokes(),this.options.choropleth.on&&this.options.choropleth.bubbleMode&&this.redrawBubbles(),setTimeout((()=>{this.enableAnimation()}),400)}setSize(t,e,i){this.options.width=t,this.options.height=e,this.options.responsive=null!=i&&null!=i?w.numbers.parseBoolean(i):this.options.responsive,this.options.width||this.options.height?!this.options.width&&this.options.height?this.options.width=this.options.height*this.svgDefault.width/this.svgDefault.height:this.options.width&&!this.options.height&&(this.options.height=this.options.width*this.svgDefault.height/this.svgDefault.width):(this.options.width=this.svgDefault.width,this.options.height=this.svgDefault.height),this.scale=this.getScale(),this.setResponsive(i),this.loaded&&this.redraw()}setResponsive(t){t=null!=t?w.numbers.parseBoolean(t):this.options.responsive,Pn(this.containers.wrap).css({width:"100%",height:"auto"}),h(this.options,{responsive:t})}setScroll(t,e){null!=t.on&&(t.on=w.numbers.parseBoolean(t.on)),null!=t.limit&&(t.limit=w.numbers.parseBoolean(t.limit)),h(this.options,{scroll:t}),!e&&this.setEventHandlers()}setZoom(t){null!=(t=t||{}).on&&(t.on=w.numbers.parseBoolean(t.on)),null!=t.fingers&&(t.fingers=w.numbers.parseBoolean(t.fingers)),null!=t.mousewheel&&(t.mousewheel=w.numbers.parseBoolean(t.mousewheel)),t.limit&&("string"==typeof t.limit&&(t.limit=t.limit.split(";")),t.limit=[parseInt(t.limit[0]),parseInt(t.limit[1])]),h(this.options,{zoom:t}),Pn(this.containers.scrollpaneWrap).off("wheel.mapsvg"),this.options.zoom.mousewheel&&(w.env.getBrowser().firefox&&(this.firefoxScroll={insideIframe:!1,scrollX:0,scrollY:0},Pn(this.containers.scrollpaneWrap).on("mouseenter",(()=>{this.firefoxScroll.insideIframe=!0,this.firefoxScroll.scrollX=window.scrollX,this.firefoxScroll.scrollY=window.scrollY})).on("mouseleave",(()=>{this.firefoxScroll.insideIframe=!1})),Pn(document).scroll((()=>{this.firefoxScroll.insideIframe&&window.scrollTo(this.firefoxScroll.scrollX,this.firefoxScroll.scrollY)}))),Pn(this.containers.scrollpaneWrap).on("wheel.mapsvg",(t=>(t.preventDefault(),this.mouseWheelZoom(t),!1))),Pn(this.layers.markers).on("wheel.mapsvg",(t=>(t.preventDefault(),this.mouseWheelZoom(t),!1)))),this.canZoom=!0}mouseWheelZoom(t){t.preventDefault();const e=Math.sign(-t.originalEvent.deltaY),i=this.getSvgPointAtClick(t.originalEvent);e>0?this.zoomIn(i):this.zoomOut(i)}setControls(t){t=t||{},h(this.options,{controls:t}),this.options.controls.zoom=w.numbers.parseBoolean(this.options.controls.zoom),this.options.controls.zoomReset=w.numbers.parseBoolean(this.options.controls.zoomReset),this.options.controls.userLocation=w.numbers.parseBoolean(this.options.controls.userLocation),this.options.controls.previousMap=w.numbers.parseBoolean(this.options.controls.previousMap);const e=this.options.controls.location||"right";if(!this.containers.controls){const t=Pn("<div />").addClass("mapsvg-buttons"),e=Pn("<div />").addClass("mapsvg-btn-group").appendTo(t),i=Pn("<div />").addClass("mapsvg-btn-map mapsvg-in");i.on("touchend click",(t=>{t.cancelable&&t.preventDefault(),t.stopPropagation(),this.zoomIn()}));const s=Pn("<div />").addClass("mapsvg-btn-map mapsvg-out");s.on("touchend click",(t=>{t.cancelable&&t.preventDefault(),t.stopPropagation(),this.zoomOut()})),e.append(i).append(s);const o=Pn("<div />").addClass("mapsvg-btn-map mapsvg-btn-location");o.on("touchend click",(t=>{t.cancelable&&t.preventDefault(),t.stopPropagation(),this.showUserLocation((t=>{this.options.scroll.on&&this.centerOn(t.marker)}))}));const n='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 447.342 447.342" style="enable-background:new 0 0 447.342 447.342;" xml:space="preserve"><path d="M443.537,3.805c-3.84-3.84-9.686-4.893-14.625-2.613L7.553,195.239c-4.827,2.215-7.807,7.153-7.535,12.459 c0.254,5.305,3.727,9.908,8.762,11.63l129.476,44.289c21.349,7.314,38.125,24.089,45.438,45.438l44.321,129.509 c1.72,5.018,6.325,8.491,11.63,8.762c5.306,0.271,10.244-2.725,12.458-7.535L446.15,18.429 C448.428,13.491,447.377,7.644,443.537,3.805z"/></svg>';o.html(n);const r=Pn("<div />").addClass("mapsvg-btn-group").appendTo(t);r.append(o);const a='<svg height="14px" version="1.1" viewBox="0 0 14 14" width="14px" xmlns="http://www.w3.org/2000/svg" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" xmlns:xlink="http://www.w3.org/1999/xlink"><g fill="none" fill-rule="evenodd" id="Page-1" stroke="none" stroke-width="1"><g fill="#000000" transform="translate(-215.000000, -257.000000)"><g id="fullscreen" transform="translate(215.000000, 257.000000)"><path d="M2,9 L0,9 L0,14 L5,14 L5,12 L2,12 L2,9 L2,9 Z M0,5 L2,5 L2,2 L5,2 L5,0 L0,0 L0,5 L0,5 Z M12,12 L9,12 L9,14 L14,14 L14,9 L12,9 L12,12 L12,12 Z M9,0 L9,2 L12,2 L12,5 L14,5 L14,0 L9,0 L9,0 Z" /></g></g></g></svg>',l=Pn("<div />").html(a).addClass("mapsvg-btn-map mapsvg-btn-zoom-reset");l.on("touchend click",(t=>{t.cancelable&&t.preventDefault(),t.stopPropagation(),this.viewBoxReset("custom")}));const h=Pn("<div />").addClass("mapsvg-btn-group").appendTo(t);h.append(l),this.containers.controls=t[0],this.controls={zoom:e[0],userLocation:r[0],zoomReset:h[0]},Pn(this.containers.map).append(Pn(this.containers.controls))}Pn(this.controls.zoom).toggle(this.options.controls.zoom),Pn(this.controls.userLocation).toggle(this.options.controls.userLocation),Pn(this.controls.zoomReset).toggle(this.options.controls.zoomReset),Pn(this.containers.controls).removeClass("left"),Pn(this.containers.controls).removeClass("right"),"right"!==e&&"left"!==e||Pn(this.containers.controls).addClass(e)}getZoomLevelViewBox(t){const e=this.getAdjustedSvgDefaultViewBox(),i=this.googleMaps.map?2:this.options.zoom.delta,s=t>=0?Math.pow(i,t):1/Math.pow(i,Math.abs(t));return e.update(0,0,e.width/s,e.height/s),e}setCursor(t){t="pointer"==t?"pointer":"default",this.options.cursor=t,"pointer"==t?Pn(this.containers.map).addClass("mapsvg-cursor-pointer"):Pn(this.containers.map).removeClass("mapsvg-cursor-pointer")}setMultiSelect(t,e){this.options.multiSelect=w.numbers.parseBoolean(t),!1!==e&&this.deselectAllRegions()}_new_setChoropleth(t){if(null!=(t=t||this.options.choropleth).on&&(t.on=w.numbers.parseBoolean(t.on)),void 0===t.coloring||void 0===t.coloring.palette||void 0===t.coloring.palette.colors)void 0===t.sourceFieldSelect||void 0===t.sourceFieldSelect.variants?h(this.options.choropleth,t):this.options.choropleth.sourceFieldSelect.variants=t.sourceFieldSelect.variants;else{const e=Object.keys(t.coloring.palette.colors);if(e.length>1||"0"==e[0]&&Object.keys(t.coloring.palette.colors[0]).length>1)this.options.choropleth.coloring.palette.colors=t.coloring.palette.colors;else{const e=Object.keys(t.coloring.palette.colors)[0];h(this.options.choropleth.coloring.palette.colors[e],t.coloring.palette.colors[e])}}if(this.updateChoroplethMinMax(),this.options.choropleth.on&&this.options.choropleth.sourceFieldSelect.on&&this.options.choropleth.sourceFieldSelect.variants)if(this.containers.choroplethSourceSelect)Pn(this.containers.choroplethSourceSelect.select).mselect2("destroy"),Pn(this.containers.choroplethSourceSelect.select).find("option").remove(),this.containers.choroplethSourceSelect.options=[],this.options.choropleth.sourceFieldSelect.variants.forEach((t=>{this.containers.choroplethSourceSelect.options.push(Pn('<option value="'+t+'" '+(t===this.options.choropleth.sourceField?"selected":"")+">"+t+"</option>")[0])})),Pn(this.containers.choroplethSourceSelect.select).append(this.containers.choroplethSourceSelect.options),Pn(this.containers.choroplethSourceSelect.select).mselect2({width:"100%"});else{const t=[];this.options.choropleth.sourceFieldSelect.variants.forEach((e=>{t.push(Pn('<option value="'+e+'" '+(e===this.options.choropleth.sourceField?"selected":"")+">"+e+"</option>"))})),this.containers.choroplethSourceSelect={container:Pn('<div class="mapsvg-choropleth-source-field"></div>')[0],select:Pn('<select id="mapsvg-choropleth-source-field-select" class="mapsvg-select2"></select>')[0],options:t},Pn(this.containers.choroplethSourceSelect.select).append(this.containers.choroplethSourceSelect.options),Pn(this.containers.choroplethSourceSelect.container).append(Pn(this.containers.choroplethSourceSelect.select)),Pn(this.containers.map).append(Pn(this.containers.choroplethSourceSelect.container)),Pn(this.containers.choroplethSourceSelect.select).mselect2(),Pn(this.containers.choroplethSourceSelect.select).mselect2().on("select2:select select2:unselecting",(t=>{t.cancelable&&t.preventDefault(),t.stopPropagation(),this.setChoropleth({sourceField:Pn(t.target).mselect2().val()})}))}if(this.options.choropleth.on&&this.options.choropleth.sourceFieldSelect.on||!this.containers.choroplethSourceSelect||!Pn(this.containers.choroplethSourceSelect.container).is(":visible")?this.options.choropleth.on&&this.options.choropleth.sourceFieldSelect.on&&this.containers.choroplethSourceSelect&&!Pn(this.containers.choroplethSourceSelect.container).is(":visible")&&Pn(this.containers.choroplethSourceSelect.container).show():Pn(this.containers.choroplethSourceSelect.container).hide(),Pn(this.containers.map).find(".mapsvg-choropleth-legend").remove(),this.options.choropleth.on&&this.options.choropleth.coloring.legend.on){const t=this.options.choropleth.coloring.legend;let e="";if("gradient"===this.options.choropleth.coloring.mode){e+='<div class="mapsvg-choropleth-legend-gradient-no-data">'+this.options.choropleth.coloring.noData.description+"</div>";let t="";for(let e=1;e<5;e++)t+='<div class="mapsvg-choropleth-legend-gradient-chunk">'+(this.options.choropleth.coloring.gradient.values.maxAdjusted*e/5+this.options.choropleth.coloring.gradient.values.min)+"</div>";e+='<div class="mapsvg-choropleth-legend-gradient-colors">'+t+"</div>"}else{e+='<div class="mapsvg-choropleth-legend-palette-color-wrap" data-idx="no-data"><div class="mapsvg-choropleth-legend-palette-color"></div><div class="mapsvg-choropleth-legend-palette-color-description">'+this.options.choropleth.coloring.noData.description+"</div></div>",e+='<div class="mapsvg-choropleth-legend-palette-color-wrap" data-idx="out-of-range"><div class="mapsvg-choropleth-legend-palette-color"></div><div class="mapsvg-choropleth-legend-palette-color-description">'+this.options.choropleth.coloring.palette.outOfRange.description+"</div></div>";const i=this.options.choropleth.coloring.palette.colors;i.forEach(((s,o)=>{let n="";n=s.description?s.description:0!==o||s.valueFrom||0===s.valueFrom?o!==i.length-1||s.valueTo?s.valueFrom+" &#8804; "+s.valueTo:"vertical"===t.layout?s.valueFrom+" or more":s.valueFrom+" <":"vertical"===t.layout?"Less then "+s.valueTo:"< "+s.valueTo,e+='<div class="mapsvg-choropleth-legend-palette-color-wrap" data-idx="'+o+'"><div class="mapsvg-choropleth-legend-palette-color"></div><div class="mapsvg-choropleth-legend-palette-color-description">'+n+"</div></div>"}))}this.containers.legend={title:Pn('<div class="mapsvg-choropleth-legend-title">'+t.title+"</div>")[0],text:Pn('<div class="mapsvg-choropleth-legend-text">'+t.text+"</div>")[0],coloring:Pn('<div class="mapsvg-choropleth-legend-'+this.options.choropleth.coloring.mode+'">'+e+"</div>")[0],description:Pn('<div class="mapsvg-choropleth-legend-description">'+t.description+"</div>")[0],container:Pn("<div />").addClass("mapsvg-choropleth-legend mapsvg-choropleth-legend-"+t.layout+" mapsvg-choropleth-legend-container-"+t.container)[0]},Pn(this.containers.legend.container).append(this.containers.legend.title).append(this.containers.legend.text).append(this.containers.legend.coloring).append(this.containers.legend.description),Pn(this.containers.map).append(this.containers.legend.container),this.setChoroplethLegendCSS(),this.regionsRepository.events.on(Lt.AFTER_UPDATE,(()=>{this.redrawChoropleth()})),this.objectsRepository.events.on(Lt.AFTER_UPDATE,(()=>{this.redrawChoropleth()}))}if(this.options.choropleth.on&&"gradient"===this.options.choropleth.coloring.mode){const t=this.options.choropleth.coloring.gradient.colors;t&&(t.lowRGB=R(t.low).toRgb(),t.highRGB=R(t.high).toRgb(),t.diffRGB={r:t.highRGB.r-t.lowRGB.r,g:t.highRGB.g-t.lowRGB.g,b:t.highRGB.b-t.lowRGB.b,a:t.highRGB.a-t.lowRGB.a},this.containers.legend&&this.setChoroplethLegendCSS())}this.redrawChoropleth()}redrawChoropleth(){this.updateChoroplethMinMax(),this.redrawBubbles(),this.reloadAllRegionStyles()}updateChoroplethMinMax(){if(this.options.choropleth.on){const t=this.options.choropleth.coloring.gradient,e=[];t.values.min=0,t.values.max=null,"regions"===this.options.choropleth.source?this.regionsRepository.getLoaded().forEach((t=>{const i=t.getData()[this.options.choropleth.sourceField];i&&e.push(i)})):this.objectsRepository.objects.forEach((t=>{const i=t.getData()[this.options.choropleth.sourceField];null!=i&&""!==i&&e.push(i)})),e.length>0&&(t.values.min=Math.min.apply(null,e),t.values.max=Math.max.apply(null,e),t.values.maxAdjusted=t.values.max-t.values.min)}}setChoroplethLegendCSS(){const t=this.options.choropleth.coloring.gradient,e=this.options.choropleth.coloring.legend,i=this.options.choropleth.coloring.noData,s=this.options.choropleth.coloring.palette.outOfRange;if(Pn(".mapsvg-choropleth-legend").css({width:e.width,height:e.height}),"gradient"===this.options.choropleth.coloring.mode)"horizontal"===e.layout?Pn(".mapsvg-choropleth-legend-horizontal .mapsvg-choropleth-legend-gradient-colors").css({background:"linear-gradient(to right,"+t.colors.low+" 1%,"+t.colors.high+" 100%)"}):Pn(".mapsvg-choropleth-legend-vertical .mapsvg-choropleth-legend-gradient-colors").css({background:"linear-gradient(to bottom,"+t.colors.low+" 1%,"+t.colors.high+" 100%)"}),Pn(".mapsvg-choropleth-legend-gradient-no-data").css({"background-color":i.color});else{this.options.choropleth.coloring.palette.colors.forEach((function(t,e){Pn('.mapsvg-choropleth-legend-palette-color-wrap[data-idx="'+e+'"] .mapsvg-choropleth-legend-palette-color').css({"background-color":t.color})})),Pn('.mapsvg-choropleth-legend-palette-color-wrap[data-idx="no-data"] .mapsvg-choropleth-legend-palette-color').css({"background-color":i.color}),Pn('.mapsvg-choropleth-legend-palette-color-wrap[data-idx="out-of-range"] .mapsvg-choropleth-legend-palette-color').css({"background-color":s.color})}}setCss(t){t&&-1!==t.indexOf("%id%")&&(t=t.replace(/%id%/g,""+this.id)),this.options.css=t||this.options.css,this.liveCss=this.liveCss||Pn("<style></style>").appendTo("head")[0],Pn(this.liveCss).html(this.options.css)}setFiltersSchema(t){h(this.options,{filtersSchema:t}),this.filtersSchema||(this.filtersSchema=new wt({objectNamePlural:"filters",objectNameSingular:"filter",fields:this.options.filtersSchema})),this.filtersSchema.setFields(t),this.setFilters()}setFilters(t){var e,i;if(null!=(t=t||this.options.filters).on&&(t.on=w.numbers.parseBoolean(t.on)),null!=t.hide&&(t.hide=w.numbers.parseBoolean(t.hide)),h(this.options,{filters:t}),void 0!==this.filtersSchema){if(!s.googleMapsApiLoaded&&this.options.filters.on&&this.filtersSchema&&this.filtersSchema.getField("distance")&&this.loadGoogleMapsAPI((()=>1),(()=>1)),-1===["leftSidebar","rightSidebar","header","footer","custom","map"].indexOf(this.options.filters.location)&&(this.options.filters.location="leftSidebar"),this.options.filters.on){let t;if(this.formBuilder&&this.formBuilder.destroy(),this.containers.filters?(Pn(this.containers.filters).empty(),Pn(this.containers.filters).show()):this.containers.filters=Pn('<div class="mapsvg-filters-wrap"></div>')[0],Pn(this.containers.filtersModal)&&Pn(this.containers.filtersModal).css({width:this.options.filters.width}),"custom"===this.options.filters.location){if(!Pn("#"+this.options.filters.containerId).length)return this.decrementAfterloadBlockers(),void console.error("MapSVG: filter container #"+this.options.filters.containerId+" does not exist");t=Pn("#"+this.options.filters.containerId)[0]}else if(c())t=this.containers.header,this.setContainers({header:{on:!0}});else{const i=c()?"header":this.options.filters.location;if(this.options.menu.on&&this.controllers.directory&&this.options.menu.location===this.options.filters.location){if(t=Pn(null===(e=this.controllers.directory)||void 0===e?void 0:e.containers.view).find(".mapsvg-directory-filter-wrap")[0],!t)return}else t=this.containers[i]}(this.regionsRepository||this.objectsRepository)&&this.loadFiltersController(t,!1),this.updateFiltersState()}else this.controllers.filters&&this.controllers.filters.destroy(),this.controllers.filters=null;this.controllers.directory&&this.options.menu.location===this.options.filters.location&&(null===(i=this.controllers.directory)||void 0===i||i.updateTopShift())}}updateFiltersState(){this.options.filters&&this.options.filters.on&&this.controllers.filters&&(this.controllers.filters.update(this.filtersRepository.query),this.updateFilterTags())}setGlobalDistanceFilter(){this.objectsRepository&&this.objectsRepository.query.filters&&this.objectsRepository.query.filters.distance?(this.objectsRepository.query.filters.distance,s.distanceSearch=this.objectsRepository.query.filters.distance):s.distanceSearch=null}updateFilterTags(){var t,e;Pn(this.containers.filterTags)&&Pn(this.containers.filterTags).empty();for(const i in this.objectsRepository.query.filters){let s=this.objectsRepository.query.filters[i],o=i;const n=this.filtersSchema.getField(o);"regions"==i?(o="",s=s.region_ids.map((t=>this.getRegion(t).title))):o=n&&n.label,"distance"!==i&&(this.containers.filterTags||(this.containers.filterTags=Pn('<div class="mapsvg-filter-tags"></div>')[0],Pn(this.containers.filters)||(this.options.menu.on&&this.controllers.directory?(Pn(null===(t=this.controllers.directory)||void 0===t?void 0:t.containers.toolbar).append(this.containers.filterTags),null===(e=this.controllers.directory)||void 0===e||e.updateTopShift()):(Pn(this.containers.map).append(this.containers.filterTags),this.options.zoom.buttons.on&&(this.options.layersControl.on?"top-left"==this.options.layersControl.position?Pn(this.containers.filterTags).css({right:0,bottom:0}):Pn(this.containers.filterTags).css({bottom:0}):"left"==this.options.zoom.buttons.location&&Pn(this.containers.filterTags).css({right:0})))),Pn(this.containers.filterTags).on("click",".mapsvg-filter-delete",(t=>{const e=Pn(t.target).data("filter");Pn(t.target).parent().remove(),this.objectsRepository.query.removeFilter(e),this.deselectAllRegions(),this.options.database.on&&this.loadDataObjects()}))),Pn(this.containers.filterTags).append('<div class="mapsvg-filter-tag">'+(o?o+": ":"")+s+' <span class="mapsvg-filter-delete" data-filter="'+i+'"></span></div>'))}}createContainers(){this.containers=Object.assign(Object.assign({},this.containers),{map:document.getElementById(this.containerId),scrollpane:Pn('<div class="mapsvg-scrollpane"></div>')[0],scrollpaneWrap:Pn('<div class="mapsvg-scrollpane-wrap"></div>')[0],layers:Pn('<div class="mapsvg-layers-wrap"></div>')[0]}),this.containers.map.appendChild(this.containers.layers),this.containers.map.appendChild(this.containers.scrollpaneWrap),this.containers.scrollpaneWrap.appendChild(this.containers.scrollpane),this.containers.map.classList.add("mapsvg"),this.containers.wrapAll=document.createElement("div"),this.containers.wrapAll.classList.add("mapsvg-wrap-all"),this.containers.wrapAll.id="mapsvg-map-"+this.id,this.containers.wrapAll.setAttribute("data-map-id",this.id?this.id.toString():""),this.containers.wrap=document.createElement("div"),this.containers.wrap.classList.add("mapsvg-wrap"),this.containers.mapContainer=document.createElement("div"),this.containers.mapContainer.classList.add("mapsvg-map-container"),this.containers.leftSidebar=document.createElement("div"),this.containers.leftSidebar.className="mapsvg-sidebar mapsvg-top-container mapsvg-sidebar-left",this.containers.rightSidebar=document.createElement("div"),this.containers.rightSidebar.className="mapsvg-sidebar mapsvg-top-container mapsvg-sidebar-right",this.containers.header=document.createElement("div"),this.containers.header.className="mapsvg-header mapsvg-top-container",this.containers.footer=document.createElement("div"),this.containers.footer.className="mapsvg-footer mapsvg-top-container",this.containers.wrapAll=Pn('<div class="mapsvg-wrap-all"></div>').attr("id","mapsvg-map-"+this.id).attr("data-map-id",this.id)[0],this.containers.wrap=Pn('<div class="mapsvg-wrap"></div>')[0],this.containers.mapContainer=Pn('<div class="mapsvg-map-container"></div>')[0],this.containers.leftSidebar=Pn('<div class="mapsvg-sidebar mapsvg-top-container mapsvg-sidebar-left"></div>').hide()[0],this.containers.rightSidebar=Pn('<div class="mapsvg-sidebar mapsvg-top-container mapsvg-sidebar-right"></div>').hide()[0],this.containers.header=Pn('<div class="mapsvg-header mapsvg-top-container"></div>').hide()[0],this.containers.footer=Pn('<div class="mapsvg-footer mapsvg-top-container"></div>').hide()[0],this.containers.map.parentNode.insertBefore(this.containers.wrapAll,this.containers.map),this.containers.wrapAll.appendChild(this.containers.header),this.containers.wrapAll.appendChild(this.containers.wrap),this.containers.wrapAll.appendChild(this.containers.footer),this.containers.mapContainer.appendChild(this.containers.map),this.containers.wrap.appendChild(this.containers.leftSidebar),this.containers.wrap.appendChild(this.containers.mapContainer),this.containers.wrap.appendChild(this.containers.rightSidebar),this.containersCreated=!0,this.resizeSensor||(this.resizeSensor=new u(this.containers.map,(()=>{this.throttle((()=>{this.redraw(),this.events.trigger(Fn.RESIZE,{viewBox:this.viewBox,mapWidth:this.containers.map.clientWidth,mapHeight:this.containers.map.clientHeight})}),50,this)}))),this.containers.toolbar=Pn('<div class="mapsvg-map-toolbar"></div>')[0],this.containers.wrapAll.appendChild(this.containers.toolbar),this.disableAnimation(),this.addLayer("markers"),this.addLayer("labels"),this.addLayer("bubbles"),this.addLayer("popovers"),this.addLayer("scrollpane")}setContainers(t){const e=this;t=t||e.options.containers||{};for(const i in t){void 0!==t[i].on&&(t[i].on=w.numbers.parseBoolean(t[i].on)),t[i].width&&(("string"!=typeof t[i].width||-1===t[i].width.indexOf("px")&&-1===t[i].width.indexOf("%")&&"auto"!==t[i].width)&&(t[i].width=t[i].width+"px"),Pn(e.containers[i]).css({"flex-basis":t[i].width})),t[i].height&&(("string"!=typeof t[i].height||-1===t[i].height.indexOf("px")&&-1===t[i].height.indexOf("%")&&"auto"!==t[i].height)&&(t[i].height=t[i].height+"px"),Pn(e.containers[i]).css({"flex-basis":t[i].height,height:t[i].height})),h(e.options,{containers:t});let s=e.options.containers[i].on;c()&&e.options.menu.hideOnMobile&&(e.options.menu.location===i||"custom"===e.options.menu.location)&&-1!==["leftSidebar","rightSidebar"].indexOf(i)?s=!1:c()&&!e.options.menu.hideOnMobile&&e.options.menu.location===i&&-1!==["leftSidebar","rightSidebar"].indexOf(i)&&Pn(e.containers.wrapAll).addClass("mapsvg-directory-visible"),Pn(e.containers[i]).toggle(s)}e.setDetailsView()}createToolbar(){this.controllers.toolbar&&this.controllers.toolbar.destroy(),this.controllers.toolbar=new Rn({map:this,parent:this,container:this.containers.toolbar,state:Object.assign({active:"map"},this.options.mobileView),events:{click:t=>{const{buttonName:e}=t.data;switch(e){case"map":Pn(this.containers.mapContainer).show(),Pn(this.controllers.directory.containers.parent).hide(),c()&&(Pn(this.containers.wrap).css("height","auto"),this.controllers.directory.updateScroll()),this.redraw();break;case"menu":Pn(this.containers.mapContainer).hide(),Pn(this.controllers.directory.containers.parent).show(),c()&&Pn(this.controllers.directory.containers.main).height()<parseInt(this.controllers.directory.options.minHeight)&&(Pn(this.containers.wrap).css("height",parseInt(this.controllers.directory.options.minHeight)+"px"),this.controllers.directory.updateScroll())}this.controllers.directory.updateTopShift()}}}),this.controllers.toolbar.init()}shouldBeScrollable(t){const e=this;switch(t){case"map":case"fullscreen":case"leftSidebar":case"rightSidebar":return!0;case"custom":default:return!1;case"header":case"footer":return!(!e.options.containers[t].height||"auto"===e.options.containers[t].height||"100%"===e.options.containers[t].height)}}extractField(t,e,i,s){const{object:o,field:n}=S(i);let r;if(!s)throw new Error("extractField: no callback provided");if(o&&n){if(!["Region","Object"].includes(o))throw new Error("extractField: Incorrect object type "+o);const i="Region"==o?t.getData():e.getData();return r=E(i,n),s(r)}}setDatabase(t){(t=t||this.options.database).noFiltersNoLoad&&this.objectsRepository&&this.objectsRepository.setNoFiltersNoLoad(!0),t.pagination&&(null!=t.pagination.on&&(t.pagination.on=w.numbers.parseBoolean(t.pagination.on)),null!=t.pagination.perpage&&(t.pagination.perpage=parseInt(t.pagination.perpage)));const e=Object.assign({},this.options.database.pagination);if(h(this.options,{database:t}),t.pagination)if(void 0!==t.pagination.on&&e.on!==t.pagination.on||void 0!==t.pagination.perpage&&e.perpage!==t.pagination.perpage){const t=new Mt({perpage:this.options.database.pagination.on?this.options.database.pagination.perpage:0});this.options.database.on&&this.objectsRepository&&this.objectsRepository.find(t)}else this.setPagination()}updateGoogleMapsMaxZoom(t){this.googleMaps.maxZoomService.getMaxZoomAtLatLng(t,(t=>{"OK"===t.status&&(this.googleMaps.currentMaxZoom=t.zoom)}))}setGoogleMaps(t){if(null!=(t=t||this.options.googleMaps).on&&(t.on=w.numbers.parseBoolean(t.on)),this.googleMaps||(this.googleMaps={loaded:!1,initialized:!1,map:null,overlay:null}),h(this.options,{googleMaps:t}),this.options.googleMaps.on){if(!s.googleMaps.apiKey)return void console.error("Google Maps API key is required no enable Google Maps");if(Pn(this.containers.map).toggleClass("mapsvg-with-google-map",!0),s.googleMaps.loaded)if(this.googleMaps.map)this.googleMaps.map.setZoom(this.zoomLevel),this.googleMaps.map.setCenter(this.getCenterGeoPoint()),Pn(this.containers.googleMaps)&&Pn(this.containers.googleMaps).css({opacity:1}),t.type&&this.googleMaps.map.setMapTypeId(t.type);else{this.containers.googleMaps=Pn('<div class="mapsvg-layer mapsvg-layer-gm" id="mapsvg-google-maps-'+this.id+'"></div>').prependTo(this.containers.map)[0],Pn(this.containers.googleMaps).css({position:"absolute",top:0,left:0,bottom:0,right:0,"z-index":"0",opacity:1}),this.googleMaps.map=new google.maps.Map(this.containers.googleMaps,{mapTypeId:t.type,fullscreenControl:!1,keyboardShortcuts:!1,mapTypeControl:!1,scaleControl:!1,scrollwheel:!1,streetViewControl:!1,zoomControl:!1,styles:t.styleJSON,tilt:0});const e=new google.maps.LatLng(this.geoViewBox.sw.lat,this.geoViewBox.sw.lng),i=new google.maps.LatLng(this.geoViewBox.ne.lat,this.geoViewBox.ne.lng),s=new google.maps.LatLngBounds(e,i);this.googleMaps.overlay=this.createGoogleMapOverlay(s,this.googleMaps.map),this.googleFitCurrentGeoBounds(),this.googleMaps.maxZoomService=new google.maps.MaxZoomService,this.googleMaps.map.addListener("idle",(()=>{this.isZooming=!1})),google.maps.event.addListenerOnce(this.googleMaps.map,"idle",(()=>{setTimeout((()=>{Pn(this.containers.map).addClass("mapsvg-fade-in"),setTimeout((()=>{this.googleMaps.initialized=!0,Pn(this.containers.map).removeClass("mapsvg-google-map-loading"),Pn(this.containers.map).removeClass("mapsvg-fade-in"),this.options.googleMaps.center&&this.options.googleMaps.zoom||(this.options.googleMaps.center=this.googleMaps.map.getCenter().toJSON(),this.options.googleMaps.zoom=this.googleMaps.map.getZoom()),this.updateGoogleMapsMaxZoom(this.options.googleMaps.center),this.setViewBoxByGoogleMapsOverlay(),this.throttle(this.toggleSvgLayerOnZoom,50,this),this.events.trigger("afterLoad.googleMaps"),this.decrementAfterloadBlockers(),this.finalizeMapLoading()}),400)}),1)})),this.events.on("boundsChanged.googleMaps",(({data:t})=>{this.setViewBoxByGoogleMapsOverlay()}))}else this.loadGoogleMapsAPI((()=>{this.setGoogleMaps()}),(()=>{this.setGoogleMaps({on:!1})}))}else Pn(this.containers.googleMaps)&&Pn(this.containers.googleMaps).css({opacity:0});this.converter&&this.converter.setWorldShift(!!this.googleMaps.map)}createGoogleMapOverlay(t,e){class i extends google.maps.OverlayView{constructor(t,e,i){super(),this.bounds_=t,this.map_=e,this.mapsvg=i,this.setMap(e),this.prevCoords={sw:{x:0,y:0},sw2:{x:0,y:0},ne:{x:0,y:0},ne2:{x:0,y:0}}}draw(){this.mapsvg.events.trigger("boundsChanged.googleMaps",{bounds:this.getPixelBounds(),map:this.map_})}getScale(){const t=this.getPixelBounds();return t?(t.ne.x-t.sw.x)/this.mapsvg.svgDefault.viewBox.width:null}onAdd(){this.element=document.createElement("div"),this.element.style.borderStyle="none",this.element.style.borderWidth="0px",this.element.style.position="absolute";this.getPanes().overlayLayer.appendChild(this.element)}getPixelBounds(){const t=this.getProjection();if(!t)return;const e=this.bounds_.getSouthWest(),i=this.bounds_.getNorthEast(),s={sw:t.fromLatLngToDivPixel(e),ne:t.fromLatLngToDivPixel(i),sw2:t.fromLatLngToContainerPixel(e),ne2:t.fromLatLngToContainerPixel(i)},o=t.getWorldWidth();return this.prevCoords.sw&&s.ne.x<s.sw.x&&(Math.abs(this.prevCoords.sw.x-s.sw.x)>Math.abs(this.prevCoords.ne.x-s.ne.x)?s.sw.x=s.sw.x-o:s.ne.x=s.ne.x+o,Math.abs(this.prevCoords.sw2.x-s.sw2.x)>Math.abs(this.prevCoords.ne2.x-s.ne2.x)?s.sw2.x=s.sw2.x-o:s.ne2.x=s.ne2.x+o),this.element.style.left=s.sw.x+"px",this.element.style.top=s.ne.y+"px",this.element.style.width=s.ne.x-s.sw.x+"px",this.element.style.height=s.sw.y-s.ne.y+"px",this.prevCoords=s,{sw:s.sw2,ne:s.ne2}}}return new i(t,e,this)}loadGoogleMapsAPI(t,e){if(!s.googleMaps.apiKey)return void console.error("MapSVG: can't load Google API because no API key has been provided");if(void 0!==window.google&&google.maps&&(s.googleMaps.loaded=!0),s.googleMaps.loaded)return void("function"==typeof t&&t());if(Pn(this.containers.map).addClass("mapsvg-google-map-loading"),s.googleMaps.onLoadCallbacks=s.googleMaps.onLoadCallbacks||[],"function"==typeof t&&s.googleMaps.onLoadCallbacks.push(t),s.googleMaps.apiIsLoading)return;s.googleMaps.apiIsLoading=!0,window.gm_authFailure=()=>{console.error("MapSVG: Google maps API key is incorrect.")},this.googleMapsScript=document.createElement("script"),this.googleMapsScript.async=!0,window.mapsvgInitGoogleMap=()=>{s.googleMaps.loaded=!0,s.googleMaps.onLoadCallbacks.forEach((e=>{"function"==typeof t&&e()}))};const i=[];this.options.googleMaps.drawingTools&&i.push("drawing"),this.options.googleMaps.geometry&&i.push("geometry");let o="";i.length>0&&(o="&libraries="+i.join(",")),this.googleMapsScript.src="https://maps.googleapis.com/maps/api/js?language="+this.options.googleMaps.language+"&loading=async&callback=mapsvgInitGoogleMap&key="+s.googleMaps.apiKey+o;try{document.head.appendChild(this.googleMapsScript)}catch(t){console.error(t),this.decrementAfterloadBlockers(),this.finalizeMapLoading()}}showDetails(t,e){this.loadDetailsView(t,e)}loadDetailsView(t,e){this.controllers.popover&&this.controllers.popover.close(),this.controllers.detailsView&&this.controllers.detailsView.destroy();const i="fullscreen"===this.options.detailsView.location||c()&&this.options.detailsView.mobileFullscreen&&"custom"!==this.options.detailsView.location;let s;Pn(this.containers.detailsView)&&void 0!==this.options.colors.detailsView&&Pn(this.containers.detailsView).css({"background-color":this.options.colors.detailsView}),s="custom"===this.options.detailsView.location?Pn("#"+this.options.detailsView.containerId)[0]:this.containers[this.options.detailsView.location];const o=e?this.options.templates[e]:"type"in t&&t.isRegion()?this.options.templates.detailsViewRegion:this.options.templates.detailsView;this.controllers.detailsView=new qt({map:this,parent:this,styles:{backgroundColor:this.options.colors.detailsView,margin:this.options.detailsView.margin,width:this.options.detailsView.width},autoresize:!i&&this.options.detailsView.autoresize,container:s,template:o,state:t.getData(),scrollable:i||this.shouldBeScrollable(this.options.detailsView.location),withToolbar:!((c()||d())&&this.options.detailsView.mobileFullscreen),fullscreen:{sm:this.options.detailsView.mobileFullscreen||"fullscreen"===this.options.detailsView.location,md:this.options.detailsView.mobileFullscreen||"fullscreen"===this.options.detailsView.location,lg:"fullscreen"===this.options.detailsView.location},position:["custom","header","footer"].includes(this.options.detailsView.location)?"relative":"absolute",events:{afterShow:t=>{t.data},afterClose:t=>{var e;t.data,this.deselectAllRegions(),this.deselectAllMarkers(),this.controllers&&this.controllers.directory&&(null===(e=this.controllers.directory)||void 0===e||e.deselectItems())}},middleware:this.middlewares.middlewares.filter((t=>t.name==lt.RENDER))}),this.controllers.detailsView.init(),this.controllers.detailsView.open()}loadFiltersModal(){"custom"!=this.options.filters.modalLocation?(this.containers.filtersModal||(this.containers.filtersModal=Pn('<div class="mapsvg-details-container mapsvg-filters-wrap"></div>')[0]),this.setColors(),Pn(this.containers.filtersModal).css({width:this.options.filters.width}),c()?(Pn("body").append(Pn(this.containers.filtersModal)),Pn(this.containers.filtersModal).css({width:""})):Pn(this.containers[this.options.filters.modalLocation]).append(Pn(this.containers.filtersModal))):(this.containers.filtersModal=Pn("#"+this.options.filters.containerId)[0],Pn(this.containers.filtersModal).css({width:""})),this.loadFiltersController(this.containers.filtersModal,!0)}loadFiltersController(t,e=!1){var i,s,o;if(!this.filtersShouldBeShown())return void(null===(i=this.controllers.filters)||void 0===i||i.destroy());let n;c()?(n=!0,this.options.filters.hideOnMobile):(n=this.options.menu.on&&this.controllers.directory&&this.options.menu.location===this.options.filters.location,this.options.filters.hide),this.filtersRepository="regions"===this.options.filters.source?this.regionsRepository:this.objectsRepository,this.options.filters.searchButton?(this.changedFields=null,this.changedSearch=null):(this.changedSearch=()=>{this.filtersRepository.query.searchFallback=this.filtersSchema.getFieldByType("search").searchFallback,this.throttle(this.filtersRepository.reload,400,this.filtersRepository)},this.changedFields=()=>{this.throttle(this.filtersRepository.reload,400,this.filtersRepository)}),null===(s=this.controllers.filters)||void 0===s||s.destroy(),this.controllers.filters=new mn({map:this,parent:this,middleware:this.middlewares.middlewares.filter((t=>t.name===lt.RENDER)),container:t,classList:"custom"===this.options.filters.location?["mapsvg-filter-container-custom"]:[],styles:{backgroundColor:this.options.colors.directorySearch,width:Pn(t).hasClass("mapsvg-map-container")?this.options.filters.width:"100%",padding:this.options.filters.padding},query:null===(o=this.filtersRepository)||void 0===o?void 0:o.query,schema:this.filtersSchema,template:'<div class="mapsvg-filters-container"></div>',scrollable:e||!n&&-1!==["leftSidebar","rightSidebar"].indexOf(this.options.filters.location),modal:e,withToolbar:!c()&&e,modalLocation:this.options.filters.modalLocation,hideFilters:this.options.filters.hide,hideOnMobile:this.options.filters.hideOnMobile,showButtonText:this.options.filters.showButtonText,clearButton:this.options.filters.clearButton,clearButtonText:this.options.filters.clearButtonText,searchButton:this.options.filters.searchButton,searchButtonText:this.options.filters.searchButtonText,events:{afterRedraw:()=>{var t;n&&(null===(t=this.controllers.directory)||void 0===t||t.updateTopShift())},"clear.form":t=>{this.deselectAllRegions(),this.filtersRepository.find()},"change.formElement.form":t=>{const{formElement:e}=t.data;"search"===e.type?this.changedSearch&&this.changedSearch():this.changedFields&&this.changedFields()},"click.btnSearch":()=>{this.filtersRepository.find()},"afterLoad.form":()=>{var t;this.controllers.directory&&(null===(t=this.controllers.directory)||void 0===t||t.updateTopShift()),this.decrementAfterloadBlockers()},"click.btnShowFilters":()=>{this.loadFiltersModal()}}}),this.controllers.filters.init()}filtersShouldBeShown(){return this.options.filters.on&&this.options.filtersSchema&&this.options.filtersSchema.length>0}textSearch(t,e=!1){const i=new Mt({filters:{search:t},searchFallback:e});this.filtersRepository.find(i)}getRegion(t){return this.regions.findById(t)}getRegions(){return this.regions}getMarker(t){return this.markers.findById(t)}checkId(t){return this.getRegion(t)?{canUse:!1,error:"This ID is already being used by a Region"}:this.markers.findById(t)?{canUse:!1,error:"This ID is already being used by another Marker"}:{canUse:!0,error:""}}reloadAllRegionStyles(){this.regions.forEach(this.reloadRegionStyles)}redrawBubbles(){Pn(this.containers.map).removeClass("bubbles-regions-on bubbles-database-on"),this.options.choropleth.on&&this.options.choropleth.bubbleMode&&Pn(this.containers.map).addClass("bubbles-"+this.options.choropleth.source+"-on"),this.regions.forEach((function(t){t.drawBubble()}));const t=this.options.choropleth.on&&"database"==this.options.choropleth.source&&this.options.choropleth.bubbleMode;this.markers.forEach((function(e){e.setBubbleMode(t)}))}destroy(){var t;this.controllers&&this.controllers.directory&&(null===(t=this.controllers.directory)||void 0===t||t.mobileButtons.remove()),Pn(this.containers.map).empty().insertBefore(Pn(this.containers.wrapAll)).attr("class","mapsvg"),this.controllers.popover&&this.controllers.popover.close(),this.controllers.detailsView&&this.controllers.detailsView.destroy(),Pn(this.containers.detailsView).remove(),Pn(this.containers.popover).remove(),Pn(this.containers.tooltipRegion).remove(),Pn(this.containers.tooltipCluster).remove(),Pn(this.containers.tooltipMarker).remove(),Pn(this.containers.wrapAll).remove();const e=s.instances.findIndex((t=>t.id===this.id));-1!==e&&s.instances.splice(e,1)}getData(){return{id:this.id,title:this.options.title,options:this.getOptions(!1,!1),version:this.version,svgFileLastChanged:this.svgFileLastChanged}}mayBeFitMarkers(){this.lastTimeFitWas||(this.lastTimeFitWas=Date.now()-99999),this.fitDelta=Date.now()-this.lastTimeFitWas;const{fitMarkersOnStart:t,fitMarkers:e}=this.options,i=!this.fitOnDataLoadDone&&(this.firstDataLoad?t:e);this.fitDelta>1e3&&i&&(this.options.googleMaps.on&&!this.googleMaps.map?this.events.on("afterLoad.googleMaps",(()=>{this.fitMarkers()})):this.fitMarkers(),this.fitOnDataLoadDone=!0),this.lastTimeFitWas=Date.now()}fitMarkers(){const t=this.objectsRepository.getLoaded();if(t&&0!==t.length)if(this.googleMaps.map){const e=[],i=[];if(t.length>1){t.forEach((t=>{t.getData().location&&t.getData().location.geoPoint&&(e.push(t.getData().location.geoPoint.lat),i.push(t.getData().location.geoPoint.lng))}));const s=Math.min.apply(null,e),o=Math.max.apply(null,e),n=Math.min.apply(null,i),r=Math.max.apply(null,i),a=new google.maps.LatLngBounds({lat:s,lng:n},{lat:o,lng:r});this.googleMaps.map.fitBounds(a,0)}else if(t[0].getData().location&&t[0].getData().location.geoPoint.lat&&t[0].getData().location.geoPoint.lng){const e={lat:t[0].getData().location.geoPoint.lat,lng:t[0].getData().location.geoPoint.lng};this.googleMaps.map&&(this.googleMaps.map.setCenter(e),this.googleMaps.map.setZoom(this.options.fitSingleMarkerZoom))}}else{if(this.options.clustering.on){const t=[];return this.markersClusters.forEach((e=>{t.push(e)})),this.markers.forEach((e=>{t.push(e)})),void this.zoomTo(t)}this.zoomTo(this.markers)}}setFitSingleMarkerZoom(t){this.options.fitSingleMarkerZoom=parseInt(t)}showUserLocation(t){this.getUserLocation((e=>{this.userLocation=null,this.userLocation=new _t({geoPoint:e,img:s.routes.root+"/markers/user-location.svg"}),this.userLocationMarker&&this.userLocationMarker.delete(),this.userLocationMarker=new bn({location:this.userLocation,mapsvg:this,width:15,height:15}),Pn(this.userLocationMarker.element).addClass("mapsvg-user-location"),this.userLocationMarker.centered=!0,this.getLayer("markers").append(this.userLocationMarker.element),this.userLocationMarker.adjustScreenPosition(),t&&t(this.userLocation)}))}getUserLocation(t){return!!navigator.geolocation&&(navigator.geolocation.getCurrentPosition((function(e){const i=new Tt(e.coords.latitude,e.coords.longitude);t&&t(i)})),!0)}getScale(){return this.containers.map.clientWidth/this.viewBox.width||1}getAdjustedSvgDefaultViewBox(){return this.adjustViewBoxToSize(this.svgDefault.viewBox,this.options.width,this.options.height)}getRelativeScale(){return this.svgDefault.viewBox.width/this.viewBox.width}get _scale(){return this.getRelativeScale()}get zoomLevel(){if(this.googleMaps.map)return this.googleMaps.map.getZoom();{const t=this.getAdjustedSvgDefaultViewBox().width/this.viewBox.width;return Math.round(Math.log(t)/Math.log(this.options.zoom.delta)*10)/10}}getViewBox(){return this.viewBox}setRatio(t){let e,i;this.getCenterSvgPoint();t>this.svgDefault.viewBox.width/this.svgDefault.viewBox.height?(e=this.svgDefault.viewBox.height*t,i=this.svgDefault.viewBox.height):(e=this.svgDefault.viewBox.width,i=this.svgDefault.viewBox.width/t),this.viewBoxSetBySize(e,i)}adjustViewBoxToSize(t,e,i){const s=t.clone(),o=s.x+s.width/2,n=s.y+s.height/2,r=e/i;let a,l;r>s.width/s.height?(l=s.height,a=l*r):(a=s.width,l=a/r);const h=o-a/2,c=n-l/2;return s.update({x:h,y:c,width:a,height:l}),s}viewBoxSetBySize(t,e){this.setSize(t,e);const i=this.adjustViewBoxToSize(this._viewBox,t,e);this.setInitialViewBox(i);const s=this.adjustViewBoxToSize(this.viewBox,t,e);return this.setViewBox(s),this.setSize(t,e),this.viewBox}viewBoxGetByRatio(t){const e=this.svgDefault.viewBox.width/this.svgDefault.viewBox.height,i=this.svgDefault.viewBox.clone();return t!=e&&(t>e?(i.width=this.svgDefault.viewBox.height*t,i.x=this.svgDefault.viewBox.x-(i.width-this.svgDefault.viewBox.width)/2):(i.height=this.svgDefault.viewBox.width/t,i.y=this.svgDefault.viewBox.y-(i.height-this.svgDefault.viewBox.height)/2)),i}viewBoxGetBySize(t,e){const i=t/e,s=this.svgDefault.viewBox.width/this.svgDefault.viewBox.height,o=this.svgDefault.viewBox.clone();return i!=s&&(i>s?(o.width=this.svgDefault.viewBox.height*i,o.x=this.svgDefault.viewBox.x-(o.width-this.svgDefault.viewBox.width)/2):(o.height=this.svgDefault.viewBox.width/i,o.y=this.svgDefault.viewBox.y-(o.height-this.svgDefault.viewBox.height)/2)),o}viewBoxReset(t="custom"){const e=this.getViewBoxByState(t);if(this.googleMaps.map){switch(t){case"custom":{const t=this.getGeoBounds(this._viewBox),e=new google.maps.LatLngBounds(new google.maps.LatLng(t.sw),new google.maps.LatLng(t.ne));this.googleMaps.map.fitBounds(e,0);break}case"initial":{const t=this.getGeoBounds(this.svgDefault.viewBox),e=new google.maps.LatLngBounds(new google.maps.LatLng(t.sw),new google.maps.LatLng(t.ne));this.googleMaps.map.fitBounds(e,0);break}}return e}return this.setViewBox(e),this.viewBox}getViewBoxByState(t){switch(t){case"custom":return this._viewBox;case"initial":return this.getAdjustedSvgDefaultViewBox();case"svg":return this.svgDefault.viewBox}}getGeoViewBox(){const t=this.viewBox,e=new Et(t.x,t.y),i=new Et(t.x+t.width,t.y),s=new Et(t.x,t.y),o=new Et(t.x,t.y+t.height),n=this.converter.convertSVGToGeo(e).lng,r=this.converter.convertSVGToGeo(i).lng;return[n,this.converter.convertSVGToGeo(s).lat,r,this.converter.convertSVGToGeo(o).lat]}getGeoBounds(t){const e=null!=t?t:this.viewBox,i=new Et(e.x,e.y),s=new Et(e.x+e.width,e.y),o=new Et(e.x,e.y),n=new Et(e.x,e.y+e.height),r=this.converter.convertSVGToGeo(i).lng,a=this.converter.convertSVGToGeo(s).lng,l=this.converter.convertSVGToGeo(o).lat;return{sw:{lng:r,lat:this.converter.convertSVGToGeo(n).lat},ne:{lng:a,lat:l}}}setStrokes(){Pn(this.containers.svg).find("path, polygon, circle, ellipse, rect, line, polyline").each(((t,e)=>{const i=vn.getComputedStyle("stroke-width",e);i&&Pn(e).attr("data-stroke-width",i.replace("px",""))}))}adjustStrokes(){Pn(this.containers.svg).find("path, polygon, circle, ellipse, rect, line, polyline").each(((t,e)=>{const i=e.getAttribute("data-stroke-width");i&&Pn(e).css("stroke-width",Number(i)/this.scale)}))}zoomIn(t){this.requestZoom()&&this.zoom(this.zoomLevel+1,t)}zoomOut(t){this.requestZoom()&&this.zoom(this.zoomLevel-1,t)}zoomTo(t,e){var i;if(Array.isArray(t)||t.type===un.REGION){const s=Array.isArray(t)?t:[t];if(!(null===(i=this.googleMaps)||void 0===i?void 0:i.map)){const t=this.getGroupBBox(s);return this.fitViewBox(t,e)}{const t=this.getGroupBounds(s),e=new google.maps.LatLngBounds(new google.maps.LatLng(t.sw),new google.maps.LatLng(t.ne));this.googleMaps.map.fitBounds(e,10)}}else if(t.isMarker()||t.isCluster())return this.zoomToMarkerOrCluster(t,e)}zoomToMarkerOrCluster(t,e){if(this.requestZoom()){const i=null!=e?e:1,s=this.getZoomLevelViewBox(i),o=new gn(t.svgPoint.x-s.width/2,t.svgPoint.y-s.height/2,s.width,s.height);return this.setViewBox(o),!0}return!1}getGroupBounds(t){const e=[],i=[];if(t.forEach((t=>{const s=t.getGeoBounds();e.push(s.sw.lat,s.ne.lat),i.push(s.sw.lng,s.ne.lng)})),0===e.length||0===i.length)throw new Error("No valid geo points found in the provided objects.");const s=Math.min(...e),o=Math.max(...e),n=Math.min(...i),r=Math.max(...i);return{sw:new Tt(s,n),ne:new Tt(o,r)}}getGroupBBox(t){let e;const i=[],s=[],o=[],n=[];for(let r=0;r<t.length;r++){e=t[r].getBBox(),o.push(e.x),n.push(e.y);const a=e.x+e.width,l=e.y+e.height;i.push(a),s.push(l)}const r=Math.min(...o),a=Math.min(...n),l=Math.max(...i)-r,h=Math.max(...s)-a;let c=10;const d=new kt(c,0),u=new kt(0,0);return c=this.converter.convertPixelToSVG(d).x-this.converter.convertPixelToSVG(u).x,new gn(r-c,a-c,l+2*c,h+2*c)}getZoomLevelByViewBox(t,e){if(void 0!==e)return this.getZoomLevelViewBox(e);const i=this.getAdjustedSvgDefaultViewBox(),s=i.width/t.width,o=i.height/t.height,n=Math.min(s,o),r=Math.floor(Math.log(n)/Math.log(this.options.zoom.delta));return this.getZoomLevelViewBox(r)}checkIfZoomIsNeeded(t){return t.width!==this.viewBox.width||t.height!==this.viewBox.height}requestZoom(){return!!this.canZoom&&(this.isZooming=!0,this.canZoom=!1,setTimeout((()=>{this.isZooming=!1,this.canZoom=!0}),700),!0)}fitViewBox(t,e){const i=this.getZoomLevelByViewBox(t,e);if(this.googleMaps.map){const e=this.getGeoBounds(t),i=new google.maps.LatLngBounds(new google.maps.LatLng(e.sw),new google.maps.LatLng(e.ne));return this.googleMaps.map.fitBounds(i,10),!0}{const e=new gn(t.x-i.width/2+t.width/2,t.y-i.height/2+t.height/2,i.width,i.height);return this.enableAnimation(),this.setViewBox(e),!0}}zoomToRegion(t,e){return this.fitViewBox(t.getBBox(),e),!0}setZoomLevel(t){this.zoom(t)}setCenter(t){let e;if(t instanceof Tt){if(!this.isGeo())throw new Error("MapSVG: can't center on a lat,lng point on a non-geo map.");e=this.converter.convertGeoToSVG(t)}else e=t;return this.centerOn(e),t}centerOn(t,e){if(e=e?(e+12)/this.getScale():0,t||(t=this.getCenterSvgPoint(!0)),t instanceof Et||St(t)||t instanceof Tt||"object"==typeof(i=t)&&"lat"in i&&"lng"in i){const i=St(t)?t:this.converter.convertGeoToSVG(t),s=this.viewBox,o=new gn(i.x-s.width/2,i.y-s.height/2-e,s.width,s.height);this.setViewBox(o)}else{if(!this.googleMaps.map){const i=t.getBBox(),s=this.viewBox,o=new gn(i.x-s.width/2+i.width/2,i.y-s.height/2+i.height/2-e,s.width,s.height);return this.setViewBox(o),o}{Pn(this.containers.map).addClass("scrolling");const i=t.getCenterLatLng(e);this.googleMaps.map.panTo(i),setTimeout((()=>{Pn(this.containers.map).removeClass("scrolling")}),100)}}var i}zoom(t,e){const i=t>this.zoomLevel?1:-1,s=i>0,o=i<0,n=this.getZoomRange(),r=this.zoomLevel>=n.min&&this.zoomLevel<=n.max,a=r&&(t>n.max||t<n.min&&t<this.initialZoomLevel),l=!r&&(s&&t>n.max||o&&t<n.min);if(a||l)return;let h=[];const c=this.googleMaps.map?this.viewBox.clone():this.getZoomLevelViewBox(t);if(this.googleMaps.map){const e=Math.pow(2,t-this.zoomLevel);c.width/=e,c.height/=e}if(e){const t=this.svgDefault.viewBox.width/c.width,i=this.svgDefault.viewBox.height/c.height,s=Math.min(t,i),o=this.svgDefault.viewBox.width/this.viewBox.width,n=this.svgDefault.viewBox.height/this.viewBox.height,r=Math.min(o,n)/s;c.x=this.viewBox.x+(e.x-this.viewBox.x)*(1-r),c.y=this.viewBox.y+(e.y-this.viewBox.y)*(1-r)}else h=[(this.viewBox.width-c.width)/2,(this.viewBox.height-c.height)/2],c.x=this.viewBox.x+h[0],c.y=this.viewBox.y+h[1];this.shiftViewBoxToScrollBoundaries(c),this.googleMaps.map?(this.googleMaps.map.setZoom(t),e&&this.googleMaps.map.setCenter(this.getCenterGeoPoint(!1,c))):this.setViewBox(c)}toggleSvgLayerOnZoom(){this.googleMaps.map&&this.options.zoom.hideSvg&&this.googleMaps.map.getZoom()>=this.options.zoom.hideSvgZoomLevel?Pn(this.containers.svg).hasClass("mapsvg-invisible")||Pn(this.containers.svg).animate({opacity:0},400,"linear",(()=>{Pn(this.containers.svg).addClass("mapsvg-invisible")})):Pn(this.containers.svg).hasClass("mapsvg-invisible")&&Pn(this.containers.svg).animate({opacity:1},400,"linear",(()=>{Pn(this.containers.svg).removeClass("mapsvg-invisible")}))}shiftViewBoxToScrollBoundaries(t){return this.options.scroll.limit&&(t.x<this.svgDefault.viewBox.x?t.x=this.svgDefault.viewBox.x:t.x+t.width>this.svgDefault.viewBox.x+this.svgDefault.viewBox.width&&(t.x=this.svgDefault.viewBox.x+this.svgDefault.viewBox.width-t.width),t.y<this.svgDefault.viewBox.y?t.y=this.svgDefault.viewBox.y:t.y+t.height>this.svgDefault.viewBox.y+this.svgDefault.viewBox.height&&(t.y=this.svgDefault.viewBox.y+this.svgDefault.viewBox.height-t.height)),t}markerDelete(t){this.editingMarker&&this.editingMarker.id==t.id&&this.unsetEditingMarker(),this.markers.findById(t.id)&&this.markers.delete(t.id),t.delete(),t=null,0===this.markers.length&&(this.options.markerLastID=0)}markersClusterAdd(t){this.layers.markers.append(t.elem),this.markersClusters.push(t),t.adjustScreenPosition()}markerAdd(t){Pn(t.element).hide(),t.adjustScreenPosition(),this.layers.markers.append(t.element),this.markers.push(t),t.mapped=!0,setTimeout((function(){Pn(t.element).show()}),100)}markerRemove(t){this.editingMarker&&this.editingMarker.id==t.id&&(this.editingMarker=null,delete this.editingMarker),this.markers.findById(t.id)&&(this.markers.findById(t.id).delete(),this.markers.delete(t.id),t=null),0===this.markers.length&&(this.options.markerLastID=0)}markerId(){this.options.markerLastID=this.options.markerLastID+1;const t="marker_"+this.options.markerLastID;return this.markers.findById(t)?this.markerId():t}movingItemsAdjustScreenPosition(){this.markersAdjustScreenPosition(),this.popoverAdjustScreenPosition(),this.bubblesRegionsAdjustScreenPosition(),this.labelsRegionsAdjustScreenPosition()}movingItemsMoveScreenPositionBy(t,e){this.markersMoveScreenPositionBy(t,e),this.popoverMoveScreenPositionBy(t,e),this.bubblesRegionsMoveScreenPositionBy(t,e),this.labelsRegionsMoveScreenPositionBy(t,e)}labelsRegionsAdjustScreenPosition(){Pn(this.containers.map).is(":visible")&&this.regions.forEach((function(t){t.adjustLabelScreenPosition()}))}bubblesRegionsAdjustScreenPosition(){Pn(this.containers.map).is(":visible")&&this.regions.forEach((function(t){t.adjustBubbleScreenPosition()}))}labelsRegionsMoveScreenPositionBy(t,e){Pn(this.containers.map).is(":visible")&&this.regions.forEach((function(i){i.moveLabelScreenPositionBy(t,e)}))}bubblesRegionsMoveScreenPositionBy(t,e){Pn(this.containers.map).is(":visible")&&this.regions.forEach((i=>{i.moveBubbleScreenPositionBy(t,e)}))}markersAdjustScreenPosition(){this.markers.forEach((t=>{t.adjustScreenPosition()})),this.markersClusters.forEach((t=>{t.adjustScreenPosition()})),this.userLocationMarker&&this.userLocationMarker.adjustScreenPosition()}markersMoveScreenPositionBy(t,e){this.markers.forEach((i=>{i.moveSrceenPositionBy(t,e)})),this.markersClusters.forEach((i=>{i.moveSrceenPositionBy(t,e)})),this.userLocationMarker&&this.userLocationMarker.moveSrceenPositionBy(t,e)}setEditingMarker(t){this.editingMarker=t,this.editingMarker.mapped||this.markerAdd(this.editingMarker)}unsetEditingMarker(){this.editingMarker&&this.editingMarker.mapped&&this.markerRemove(this.editingMarker),this.editingMarker=null}getEditingMarker(){return this.editingMarker}isLinkClicked(t){return!!(t.target&&Pn(t.target).is("a")||Pn(t.target).closest("a").length)}handleLinkClick(t){if(this.isLinkClicked(t)){const e=Pn(t.target).is("a")?t.target:Pn(t.target).closest("a")[0],i=Pn(e),s=i.attr("href");s&&s.startsWith("http")&&(t.preventDefault(),"_blank"===i.attr("target")?window.open(s,"_blank"):window.location.href=s),s&&s.startsWith("#")&&t.preventDefault()}}scrollStart(t,e){if(Pn(t.target).hasClass("mapsvg-btn-map")||Pn(t.target).closest(".mapsvg-choropleth").length)return;if(this.editMarkers.on&&Pn(t.target).hasClass("mapsvg-marker"))return;t.preventDefault(),Pn(this.containers.map).addClass("no-transitions");const i=t.originalEvent&&t.originalEvent.touches&&t.originalEvent.touches[0]?t.originalEvent.touches[0]:t;this.scrollStarted=!0,this.scroll={tx:this.scroll.tx||0,ty:this.scroll.ty||0,vxi:this.viewBox.x,vyi:this.viewBox.y,x:i.clientX,y:i.clientY,dx:0,dy:0,vx:0,vy:0,gx:i.clientX,gy:i.clientY,touchScrollStart:0},0===t.type.indexOf("mouse")&&(Pn(document).on("mousemove.scroll.mapsvg",(t=>{this.scrollMove(t)})),this.options.scroll.spacebar?Pn(document).on("keyup.scroll.mapsvg",(t=>{32==t.keyCode&&this.scrollEnd(t,e)})):Pn(document).on("mouseup.scroll.mapsvg",(t=>{this.scrollEnd(t,e)})))}scrollMove(t){t.preventDefault(),this.isScrolling||(this.isScrolling=!0,Pn(this.containers.map).addClass("scrolling"));const e=t.originalEvent&&t.originalEvent.touches&&t.originalEvent.touches[0]?t.originalEvent.touches[0]:t;this.panBy(this.scroll.gx-e.clientX,this.scroll.gy-e.clientY),this.scroll.gx=e.clientX,this.scroll.gy=e.clientY,this.scroll.dx=this.scroll.x-e.clientX,this.scroll.dy=this.scroll.y-e.clientY;let i=this.scroll.vxi+this.scroll.dx/this.scale,s=this.scroll.vyi+this.scroll.dy/this.scale;this.options.scroll.limit&&(i<this.svgDefault.viewBox.x?i=this.svgDefault.viewBox.x:this.viewBox.width+i>this.svgDefault.viewBox.x+this.svgDefault.viewBox.width&&(i=this.svgDefault.viewBox.x+this.svgDefault.viewBox.width-this.viewBox.width),s<this.svgDefault.viewBox.y?s=this.svgDefault.viewBox.y:this.viewBox.height+s>this.svgDefault.viewBox.y+this.svgDefault.viewBox.height&&(s=this.svgDefault.viewBox.y+this.svgDefault.viewBox.height-this.viewBox.height)),this.scroll.vx=i,this.scroll.vy=s}scrollEnd(t,e,i){if(setTimeout((()=>{this.enableAnimation(),this.scrollStarted=!1,this.isScrolling=!1}),100),this.googleMaps.map&&this.googleMaps.overlay&&this.googleMaps.overlay.draw(),Pn(this.containers.map).removeClass("scrolling"),Pn(document).off("keyup.scroll.mapsvg"),Pn(document).off("mousemove.scroll.mapsvg"),Pn(document).off("mouseup.scroll.mapsvg"),!0!==i&&Math.abs(this.scroll.dx)<5&&Math.abs(this.scroll.dy)<5){if(this.isLinkClicked(t))return void this.handleLinkClick(t);this.editMarkers.on?this.clickAddsMarker&&this.markerAddClickHandler(t):this.objectClickedBeforeScroll&&(this.objectClickedBeforeScroll.isMarker()?this.markerClickHandler(t,this.objectClickedBeforeScroll):this.objectClickedBeforeScroll.isRegion()?this.regionClickHandler(t,this.objectClickedBeforeScroll):this.objectClickedBeforeScroll.isCluster()&&this.markerClusterClickHandler(t,this.objectClickedBeforeScroll))}this.viewBox.x=this.scroll.vx||this.viewBox.x,this.viewBox.y=this.scroll.vy||this.viewBox.y}setViewBoxByGoogleMapsOverlay(){if(!this.googleMaps.initialized)return;const t=this.googleMaps.overlay.getPixelBounds(),e=this.googleMaps.overlay.getScale();if(!e||!t)return;const i=new gn(this.svgDefault.viewBox.x-t.sw.x/e,this.svgDefault.viewBox.y-t.ne.y/e,this.containers.map.offsetWidth/e,this.containers.map.offsetHeight/e);this.setViewBox(i,!1)}panBy(t,e){let i=this.scroll.tx-t,s=this.scroll.ty-e;const o={x:!0,y:!0};if(this.options.scroll.limit){const n=Pn(this.containers.svg)[0].getBoundingClientRect(),r=Pn(this.containers.map)[0].getBoundingClientRect();(n.left-t>r.left&&t<0||n.right-t<r.right&&t>0)&&(i=this.scroll.tx,o.x=!1),(n.top-e>r.top&&e<0||n.bottom-e<r.bottom&&e>0)&&(s=this.scroll.ty,o.y=!1)}const n=this.svgDefault.viewBox.width/this.viewBox.width;if(this.containers.scrollpane.style.transform="translate("+i+"px, "+s+"px) scale("+n+")",this.scroll.tx=i,this.scroll.ty=s,o.x||o.y){const i=o.x?t:0,s=o.y?e:0;if(this.movingItemsMoveScreenPositionBy(i,s),this.googleMaps.map){let t=this.googleMaps.map.getCenter();const e=this.googleMaps.overlay.getProjection(),o=e.fromLatLngToDivPixel(t);o.x+=i,o.y+=s,t=e.fromDivPixelToLatLng(o),this.googleMaps.map.setCenter(t)}}return o}setObjectClickedBeforeScroll(t){this.objectClickedBeforeScroll=t}touchStart(t,e){t.preventDefault(),this.scrollStarted&&this.scrollEnd(t,e,!0);const i=t.originalEvent;this.options.zoom.fingers&&i.touches&&2==i.touches.length?(this.touchZoomStart=!0,this.scaleDistStart=Math.hypot(i.touches[0].pageX-i.touches[1].pageX,i.touches[0].pageY-i.touches[1].pageY)):i.touches&&1==i.touches.length&&this.scrollStart(t,e),Pn(document).on("touchmove.scroll.mapsvg",(t=>{t.preventDefault(),this.touchMove(t,this)})).on("touchend.scroll.mapsvg",(t=>{t.preventDefault(),this.touchEnd(t,this)}))}touchMove(t,e){t.preventDefault();const i=t.originalEvent;if(this.options.zoom.fingers&&i.touches&&2==i.touches.length){if(T.getDevice().ios||(i.scale=Math.hypot(i.touches[0].pageX-i.touches[1].pageX,i.touches[0].pageY-i.touches[1].pageY)/this.scaleDistStart),1!=i.scale&&this.canZoom){const t=i.scale>1?1:-1,e=i.touches[0].pageX>=i.touches[1].pageX?i.touches[0].pageX-(i.touches[0].pageX-i.touches[1].pageX)/2-Pn(this.containers.map).offset().left:i.touches[1].pageX-(i.touches[1].pageX-i.touches[0].pageX)/2-Pn(this.containers.map).offset().left,s=i.touches[0].pageY>=i.touches[1].pageY?i.touches[0].pageY-(i.touches[0].pageY-i.touches[1].pageY)-Pn(this.containers.map).offset().top:i.touches[1].pageY-(i.touches[1].pageY-i.touches[0].pageY)-Pn(this.containers.map).offset().top,o=this.converter.convertPixelToSVG(new kt(e,s));t>0?this.zoomIn(o):this.zoomOut(o)}}else i.touches&&1==i.touches.length&&this.scrollMove(t)}touchEnd(t,e){t.preventDefault(),t.originalEvent,this.touchZoomStart?this.touchZoomStart=!1:this.scrollStarted&&this.scrollEnd(t,e),Pn(document).off("touchmove.scroll.mapsvg"),Pn(document).off("touchend.scroll.mapsvg")}getSelected(){return this.selected_id}selectRegion(t,e){var i,s,o;let n,r;if(n="string"==typeof t?this.getRegion(t):t,!n)return;if(this.options.multiSelect&&!this.editRegions.on){if(n.selected)return this.deselectRegion(n),void(!e&&this.options.menu.on&&("database"==this.options.menu.source?n.objects&&n.objects.length&&(r=n.objects.map((t=>t.getData().id.toString()))):r=[n.id],null===(i=this.controllers.directory)||void 0===i||i.deselectItems()))}else this.selected_id.length>0&&(this.deselectAllRegions(),!e&&this.options.menu.on&&("database"==this.options.menu.source?n.objects&&n.objects.length&&(r=n.objects.map((t=>t.getData().id.toString()))):r=[n.id],null===(s=this.controllers.directory)||void 0===s||s.deselectItems()));this.unhighlightRegions();const a=this.highlightedRegions.indexOf(n);a>-1&&(n.unhighlight(),this.highlightedRegions.splice(a,1)),this.selected_id.push(n.id),n.select();!this.options.actions.region.click.filterDirectory&&!e&&this.options.menu.on&&this.controllers&&this.controllers.directory&&(r="database"==this.options.menu.source&&n.objects&&n.objects.length?n.objects.map((t=>t.getData().id.toString())):[n.id],null===(o=this.controllers.directory)||void 0===o||o.selectItems(r)),this.options.actions.region.click.addIdToUrl&&!this.options.actions.region.click.showAnotherMap&&(window.location.hash="/m/r/"+n.id)}deselectAllRegions(){Pn.each(this.selected_id,((t,e)=>{this.deselectRegion(this.getRegion(e))}))}deselectRegion(t){if(t||(t=this.getRegion(this.selected_id[0])),t){t.deselect();const e=Pn.inArray(t.id,this.selected_id);this.selected_id.splice(e,1)}this.options.actions.region.click.addIdToUrl&&-1!==window.location.hash.indexOf(t.id)&&history.replaceState(null,null," ")}highlightRegions(t){t.forEach((t=>{!t||t.selected||t.disabled||(this.highlightedRegions.push(t),t.highlight())}))}unhighlightRegions(){this.highlightedRegions.forEach((t=>{!t||t.selected||t.disabled||t.unhighlight()})),this.highlightedRegions=[]}selectMarker(t){var e,i;t.isMarker()&&(this.deselectAllMarkers(),t.select(),this.selected_marker=t,Pn(this.layers.markers).addClass("mapsvg-with-marker-active"),this.options.menu.on&&"database"==this.options.menu.source&&(null===(e=this.controllers.directory)||void 0===e||e.deselectItems(),null===(i=this.controllers.directory)||void 0===i||i.selectItems(t.object.getData().id)))}deselectAllMarkers(){this.selected_marker&&this.selected_marker.deselect(),Pn(this.layers.markers).removeClass("mapsvg-with-marker-active")}deselectMarker(t){t&&t.deselect()}highlightMarker(t){Pn(this.layers.markers).addClass("mapsvg-with-marker-hover"),t.highlight(),this.highlighted_marker=t}unhighlightMarker(){Pn(this.layers.markers).removeClass("mapsvg-with-marker-hover"),this.highlighted_marker&&this.highlighted_marker.unhighlight()}convertMouseToSVG(t){const e=g(t),i=e.x-Pn(this.containers.map).offset().left,s=e.y-Pn(this.containers.map).offset().top,o=new kt(i,s);return this.converter.convertPixelToSVG(o)}pickChoroplethColor(t){const e=(t-this.options.choropleth.coloring.gradient.values.min)/this.options.choropleth.coloring.gradient.values.maxAdjusted;return{r:Math.round(this.options.choropleth.coloring.gradient.colors.diffRGB.r*e+this.options.choropleth.coloring.gradient.colors.lowRGB.r),g:Math.round(this.options.choropleth.coloring.gradient.colors.diffRGB.g*e+this.options.choropleth.coloring.gradient.colors.lowRGB.g),b:Math.round(this.options.choropleth.coloring.gradient.colors.diffRGB.b*e+this.options.choropleth.coloring.gradient.colors.lowRGB.b),a:Math.round(this.options.choropleth.coloring.gradient.colors.diffRGB.a*e+this.options.choropleth.coloring.gradient.colors.lowRGB.a)}}isRegionDisabled(t,e){return!(!this.options.regions[t]||!this.options.regions[t].disabled&&"none"!=e)||!(null!=this.options.regions[t]&&!w.numbers.parseBoolean(this.options.regions[t].disabled)||!this.options.disableAll&&"none"!=e&&"labels"!=t&&"Labels"!=t)}markerClusterClickHandler(t,e){this.objectClickedBeforeScroll=null,this.eventsPreventList.click||this.zoomTo(e.markers)}regionClickHandler(t,e){if(this.objectClickedBeforeScroll=null,this.eventsPreventList.click)return;if(this.editRegions.on)return void this.regionEditHandler.call(e);const i=this.options.actions;if(i.region.click.zoom&&this.zoomTo(e,void 0!==i.region.click.zoomToLevel?parseInt(i.region.click.zoomToLevel):void 0),i.region.click.filterDirectory&&this.options.database.on){const t=new Mt({filters:{regions:{table_name:this.regionsRepository.getSchema().name,region_ids:[e.id]}}});this.objectsRepository.query.resetFilters(),this.setFilterOut(),this.objectsRepository.find(t).done((()=>{this.controllers.popover&&this.controllers.popover.setState(e.getData()),this.controllers.detailsView&&this.controllers.detailsView.setState(e.getData())})),this.updateFiltersState()}if(i.region.click.showDetails){const t=this.options.actions.region.click.detailsViewTemplate;this.loadDetailsView(e,t)}if(i.region.click.showPopover){const t=this.options.actions.region.click.popoverTemplate,s=i.region.click.zoom?400:0;setTimeout((()=>{this.showPopover(e,t)}),s)}else if(t&&-1!==t.type.indexOf("touch")&&i.region.touch.showPopover){const t=this.options.actions.region.click.popoverTemplate;i.region.click.zoom,setTimeout((()=>{this.showPopover(e,t)}),400)}this.selectRegion(e.id),this.events.trigger("click.region",t,{region:e})}markerClickHandler(t,e){if(this.objectClickedBeforeScroll=null,this.eventsPreventList.click)return;const i=this.options.actions;this.selectMarker(e);const s=e.object;if(i.marker.click.zoom&&this.zoomTo(e,void 0!==i.marker.click.zoomToLevel?parseInt(i.marker.click.zoomToLevel):void 0),i.marker.click.filterDirectory&&this.options.database.on){const t=new Mt({filters:{id:e.object.getData().id}});this.objectsRepository.find(t),this.updateFiltersState()}if(i.marker.click.showDetails){const t=this.options.actions.marker.click.detailsViewTemplate;this.loadDetailsView(s,t)}if(i.marker.click.showPopover){const t=this.options.actions.marker.click.popoverTemplate,e=i.marker.click.zoom&&this.googleMaps.map?700:0;setTimeout((()=>{this.showPopover(s,t)}),e)}else if(t&&-1!==t.type.indexOf("touch")&&i.marker.touch.showPopover){const t=this.options.actions.marker.click.popoverTemplate,e=i.marker.click.zoom&&this.googleMaps.map?700:0;setTimeout((()=>{this.showPopover(s,t)}),e)}this.options.actions.marker.click.addIdToUrl&&!this.options.actions.marker.click.showAnotherMap&&(window.location.hash="/m/db/"+e.object.getData().id),this.events.trigger("click.marker",t,{marker:e})}fileExists(t){if("data"==t.substr(0,4))return!0;const e=new XMLHttpRequest;return e.open("HEAD",t,!1),e.send(),404!=e.status}hideMarkers(){this.markers.forEach((function(t){t.hide()})),Pn(this.containers.wrap).addClass("mapsvg-edit-marker-mode")}hideMarkersExceptOne(t){this.markers.forEach((function(e){(void 0===t||e.object&&t!==String(e.id))&&e.hide()})),Pn(this.containers.wrap).addClass("mapsvg-edit-marker-mode")}showMarkers(){this.markers.forEach((function(t){t.show()})),this.deselectAllMarkers(),Pn(this.containers.wrap).removeClass("mapsvg-edit-marker-mode")}markerAddClickHandler(t){if(Pn(t.target).hasClass("mapsvg-marker"))return;const e=this.getSvgPointAtClick(t),i=this.isGeo()?this.converter.convertSVGToGeo(e):null;if(!Pn.isNumeric(e.x)||!Pn.isNumeric(e.y))return;if(this.editingMarker)return void(i?this.editingMarker.location.setGeoPoint(i):this.editingMarker.location.setSvgPoint(e));const s=new _t({svgPoint:e,geoPoint:i,img:this.options.defaultMarkerImage}),o=new bn({location:s,mapsvg:this});this.markerAdd(o),this.markerEditHandler&&this.markerEditHandler.call(s,s)}getSvgPointAtClick(t){const e=g(t),i=e.x-Pn(this.containers.map).offset().left,s=e.y-Pn(this.containers.map).offset().top,o=new kt(i,s);return this.converter.convertPixelToSVG(o)}setDefaultMarkerImage(t){this.options.defaultMarkerImage=t}setMarkerImagesDependency(){this.locationField=this.objectsRepository.schema.getFieldByType("location"),this.locationField&&this.locationField.markersByFieldEnabled&&this.locationField.markerField&&Object.values(this.locationField.markersByField).length>0?this.setMarkersByField=!0:this.setMarkersByField=!1}getMarkerImage(t,e){let i;return this.setMarkersByField&&("object"==typeof t?(i=t[this.locationField.markerField],"regions"===this.locationField.markerField?i=i[0]&&i[0].id:"object"==typeof i&&i.length&&(i=i[0].value)):i=t,this.locationField.markersByField[i])?this.locationField.markersByField[i]:e&&e.imagePath?e.imagePath:this.options.defaultMarkerImage?this.options.defaultMarkerImage:s.routes.root+"markers/_pin_default.png"}setMarkersEditMode(t,e){this.editMarkers.on=w.numbers.parseBoolean(t),this.clickAddsMarker=this.editMarkers.on,this.setEventHandlers()}setRegionsEditMode(t){this.editRegions.on=w.numbers.parseBoolean(t),this.deselectAllRegions(),this.setEventHandlers()}setEditMode(t){this.inBackend=t}setDataEditMode(t){this.editData.on=w.numbers.parseBoolean(t),this.deselectAllRegions(),this.setEventHandlers()}download(){window.location.href=window.location.origin+this.options.source}popoverAdjustScreenPosition(){this.controllers.popover instanceof Sn&&this.controllers.popover.adjustScreenPosition()}popoverMoveScreenPositionBy(t,e){this.controllers.popover instanceof Sn&&this.controllers.popover.moveSrceenPositionBy(t,e)}showPopover(t,e){const i="type"in t&&t.isRegion()?t:t.location&&t.location.marker?t.location.marker:null;if(!i)return;let s;s=i.isMarker()?i.svgPoint:i.getCenterSVG();const o=e?this.options.templates[e]:"type"in t&&t.isRegion()?this.options.templates.popoverRegion:this.options.templates.popoverMarker;this.controllers.popover&&this.controllers.popover.destroy(),this.controllers.popover=new Sn({map:this,parent:this,container:this.layers.popovers,point:s,yShift:"type"in i&&i.isMarker()?i.height:i.isRegion()&&i.label?i.label.offsetHeight/2:0,template:o,state:t.getData(),mapObject:i,scrollable:!0,fullscreen:{sm:this.options.popovers.mobileFullscreen,md:this.options.popovers.mobileFullscreen,lg:!1},withToolbar:!(c()&&this.options.popovers.mobileFullscreen),styles:{width:this.options.popovers.width+"px",backgroundColor:this.options.colors.popover,maxWidth:this.options.popovers.maxWidth+"%",maxHeight:parseInt(this.options.popovers.maxHeight+"")*Pn(this.layers.popovers).outerHeight()/100+"px"},middleware:this.middlewares.middlewares.filter((t=>t.name===lt.RENDER)),events:{afterShow:t=>{const{controller:e}=t.data;if(this.options.popovers.centerOn){const t=e.containers.main.offsetHeight/2;!this.options.popovers.centerOn||c()&&this.options.popovers.mobileFullscreen||this.centerOn(i,t)}this.popoverShowingFor=i},afterClose:t=>{var e;t.data,this.options.popovers.resetViewboxOnClose&&this.viewBoxReset("custom"),this.popoverShowingFor=null,"type"in i&&i.isRegion()?this.deselectRegion(i):"type"in i&&i.isMarker()&&this.deselectAllMarkers(),this.controllers&&this.controllers.directory&&(null===(e=this.controllers.directory)||void 0===e||e.deselectItems()),Pn("body").off(`mouseup.popover.mapsvg-${this.id} touchend.popover.mapsvg-${this.id}`)},resize:t=>{const{controller:e}=t.data;if(this.options.popovers.centerOn){const t=e.containers.main.offsetHeight/2;!this.options.popovers.centerOn||c()&&this.options.popovers.mobileFullscreen||this.centerOn(i,t)}}}}),this.controllers.popover.init(),this.controllers.popover.open(),setTimeout((()=>{Pn("body").on(`mouseup.popover.mapsvg-${this.id} touchend.popover.mapsvg-${this.id}`,(t=>{this.isScrolling||Pn(t.target).closest(".mapsvg-directory").length||Pn(t.target).closest(".mapsvg-popover").length||Pn(t.target).hasClass("mapsvg-btn-map")||this.controllers.popover.close()}))}),50)}hidePopover(){this.controllers.popover&&this.controllers.popover.close()}popoverOffHandler(t){this.isScrolling||Pn(t.target).closest(".mapsvg-popover").length||Pn(t.target).hasClass("mapsvg-btn-map")}mouseOverHandler(t,e){var i;if(this.eventsPreventList.mouseover)return;if(e.isMarker()&&this.options.actions.marker.mouseover.showTooltip){const t=this.options.actions.marker.mouseover.tooltipTemplate;this.showTooltip(e,t)}if(e.isRegion()&&this.options.actions.region.mouseover.showTooltip){const t=this.options.actions.region.mouseover.tooltipTemplate;this.showTooltip(e,t)}let s;this.options.menu.on&&this.controllers.directory&&("database"==this.options.menu.source?(e.isRegion()&&e.objects.length&&(s=e.objects.map((t=>t.getData().id))),e.isMarker()&&(s=e.object?[e.object.getData().id]:[])):(e.isRegion()&&(s=[e.id]),e.isMarker()&&e.object.getData().regions&&e.object.getData().regions.length&&(s=e.object.getData().regions.map((t=>t.id)))),null===(i=this.controllers.directory)||void 0===i||i.highlightItems(s)),e.isRegion()?(e.selected||e.highlight(),this.events.trigger("mouseover.region",t,{region:e})):(this.highlightMarker(e),this.events.trigger("mouseover.marker",t,{marker:e}))}showTooltip(t,e){let s,o;if(t.isRegion()?(s="region",o=t):t.isMarker()?(s="marker",o=t.object):(s="cluster",o=t),null!=o&&this.popoverShowingFor!==t){const n=`tooltip${i(s)}`;this.controllers.tooltips[n]&&this.controllers.tooltips[n].destroy();const r=e?this.options.templates[e]:this.options.templates[n],a=new Bn({map:this,parent:this,middleware:this.middlewares.middlewares.filter((t=>t.name===lt.RENDER)),state:o.getData(),template:r,container:this.containers.map,styles:{backgroundColor:this.options.colors.tooltip,minWidth:this.options.tooltips.minWidth?this.options.tooltips.minWidth+"px":"auto",maxWidth:this.options.tooltips.maxWidth?this.options.tooltips.maxWidth+"px":"auto"},positionToCursor:this.options.tooltips.position});t.tooltip=a,a.init(),this.controllers.tooltips[n]=a}}mouseOutHandler(t,e){var i;if(!this.eventsPreventList.mouseout&&(e.tooltip&&(e.tooltip.destroy(),e.tooltip=null),e.isRegion()?(e.unhighlight(),this.events.trigger("mouseout.region",t,{region:e})):(this.unhighlightMarker(),this.events.trigger("mouseout.marker",t,{marker:e})),this.options.menu.on&&this.controllers.directory)){if("database"==this.options.menu.source&&e.isMarker()){const t=e;!t.object||t.object.getData().id}null===(i=this.controllers.directory)||void 0===i||i.unhighlightItems()}}eventsPrevent(t){this.eventsPreventList[t]=!0}eventsRestore(t){t?this.eventsPreventList[t]=!1:this.eventsPreventList={}}linkObjectToRegions(t){var e;if(0===this.regions.length)return;const i=t.getRegionsForTable(null===(e=this.regionsRepository.schema)||void 0===e?void 0:e.name).map((t=>t.id));i.length>0&&this.regions.filter((t=>i.includes(t.id))).forEach((e=>{e.objects.get(t.getData().id)||e.objects.push(t)}))}addObject(t){this.addLocation(t)}objectsLoadedToMapHandler(){var t;this.mayBeFitMarkers(),this.fixMarkersWorldScreen(),this.loadDirectory(),this.options.labelsMarkers.on&&this.setLabelsMarkers(),-1!==this.options.templates.labelRegion.indexOf("{{objects")&&this.setLabelsRegions(),this.options.filters.on&&"database"===this.options.filters.source&&this.controllers.filters&&this.controllers.filters.hideFilters&&this.controllers.filters.setFiltersCounter(),this.hideLoadingMessage(),this.updateFiltersState(),(null===(t=this.options.choropleth)||void 0===t?void 0:t.on)&&this.setChoropleth(),this.events.trigger("afterLoadObjects",{objects:this.objectsRepository.getLoaded()})}setRepositoryEvents(){var t;this.eventsBaseInitialized=!0,this.objectsRepository.events.on(Lt.BEFORE_LOAD,(()=>{this.showLoadingMessage(),void 0===this.firstDataLoad?this.firstDataLoad=!0:!0===this.firstDataLoad&&(this.firstDataLoad=!1)})),this.objectsRepository.events.on(Lt.FAILED_LOAD,(()=>{this.hideLoadingMessage(),console.error("Could not load objects")})),this.objectsRepository.events.on(Lt.AFTER_LOAD,(t=>{const{repository:e}=t.data;this.fitOnDataLoadDone=!1,this.setGlobalDistanceFilter(),this.deleteMarkers(),this.deleteClusters(),e.objects.filter((t=>t.getData().regions&&t.getData().regions.length>0)).forEach((t=>this.linkObjectToRegions(t))),e.objects.filter((t=>t.getData().location)).forEach((t=>this.addObject(t))),this.options.clustering.on&&this.startClusterizer(),this.objectsLoadedToMapHandler()})),null===(t=this.objectsRepository.schema)||void 0===t||t.events.on(yt.UPDATE,(()=>{this.objectsRepository.find()})),this.objectsRepository.events.on(Lt.AFTER_UPDATE,(t=>{const{object:e,updatedFields:i}=t.data;i.regions&&this.linkObjectToRegions(e),this.objectsLoadedToMapHandler()})),this.objectsRepository.events.on(Lt.AFTER_CREATE,(t=>{const{object:e}=t.data;this.linkObjectToRegions(e),this.objectsLoadedToMapHandler()})),this.objectsRepository.events.on(Lt.AFTER_DELETE,(t=>{const{id:e}=t.data;this.regions.forEach((t=>{const i=t.objects.findIndex((t=>t.getData().id===e));-1!==i&&t.objects.delete(i)})),this.objectsLoadedToMapHandler()})),this.regionsRepository.events.on(Lt.BEFORE_LOAD,(()=>{this.showLoadingMessage()})),this.regionsRepository.events.on(Lt.FAILED_LOAD,(()=>{this.hideLoadingMessage(),console.error("Could not load regions")})),this.regionsRepository.events.on(Lt.AFTER_LOAD,(()=>{this.hideLoadingMessage(),this.reloadRegionsFull(),this.events.trigger("afterLoadRegions",{regions:this.regions})})),this.regionsRepository.events.on(Lt.AFTER_UPDATE,(()=>{this.reloadRegionsFull()})),this.regionsRepository.events.on(Lt.AFTER_CREATE,(()=>{this.reloadRegionsFull()})),this.regionsRepository.events.on(Lt.AFTER_DELETE,(()=>{this.reloadRegionsFull()}))}setEventHandlers(){const t=this;Pn(t.containers.map).off(".common.mapsvg"),Pn(t.containers.scrollpane).off(".common.mapsvg"),Pn(document).off(".scroll.mapsvg"),Pn(document).off(".scrollInit.mapsvg"),t.editMarkers.on&&Pn(t.containers.map).on("touchstart.common.mapsvg mousedown.common.mapsvg",".mapsvg-marker",(e=>{e.originalEvent.preventDefault();const i=Pn(e.target.id).attr("id"),s=this.markers.get(i),o=g(e);s.drag(o,t.scale)})),t.editMarkers.on||Pn(t.containers.map).on("mouseover.common.mapsvg",".mapsvg-region",(function(e){const i=Pn(this).attr("id");t.mouseOverHandler.call(t,e,t.getRegion(i))})).on("mouseleave.common.mapsvg",".mapsvg-region",(function(e){const i=Pn(this).attr("id");t.mouseOutHandler.call(t,e,t.getRegion(i))})),this.editRegions.on||Pn(this.containers.map).on("mouseover.common.mapsvg",".mapsvg-marker",(t=>{const e=t.target.id;this.mouseOverHandler.call(this,t,this.markers.get(e))})).on("mouseleave.common.mapsvg",".mapsvg-marker",(t=>{const e=t.target.id;this.mouseOutHandler.call(this,t,this.markers.get(e))})),t.options.scroll.spacebar?Pn(document).on("keydown.scroll.mapsvg",(function(e){"INPUT"===document.activeElement.tagName&&"text"===Pn(document.activeElement).attr("type")||t.isScrolling||32!=e.keyCode||(e.preventDefault(),Pn(t.containers.map).addClass("mapsvg-scrollable"),Pn(document).on("mousemove.scrollInit.mapsvg",(function(e){t.isScrolling=!0,Pn(document).off("mousemove.scrollInit.mapsvg"),t.scrollStart(e,t)})).on("keyup.scroll.mapsvg",(function(e){32==e.keyCode&&(Pn(document).off("mousemove.scrollInit.mapsvg"),Pn(t.containers.map).removeClass("mapsvg-scrollable"))})))})):t.options.scroll.on?Pn(t.containers.map).on("touchstart.common.mapsvg mousedown.common.mapsvg",(function(e){if(Pn(e.target).hasClass("mapsvg-popover")||Pn(e.target).closest(".mapsvg-popover").length||Pn(e.target).hasClass("mapsvg-details-container")||Pn(e.target).closest(".mapsvg-details-container").length||Pn(e.target).closest(".mapsvg-popover-container").length)return void(Pn(e.target).hasClass("mapsvg-popover-close")&&"touchstart"==e.type&&e.cancelable&&e.preventDefault());let i;if("touchstart"==e.type&&e.cancelable&&e.preventDefault(),e.target&&Pn(e.target).attr("class")&&-1!=Pn(e.target).attr("class").indexOf("mapsvg-region"))i=t.getRegion(Pn(e.target).attr("id")),t.setObjectClickedBeforeScroll(i);else if(e.target&&Pn(e.target).attr("class")&&-1!=Pn(e.target).attr("class").indexOf("mapsvg-marker")&&-1===Pn(e.target).attr("class").indexOf("mapsvg-marker-cluster")){if(t.editMarkers.on)return;const s=Pn(e.target).closest(".mapsvg-marker").attr("id")||e.target.id;i=t.markers.get(s),t.setObjectClickedBeforeScroll(i)}else if(e.target&&Pn(e.target).attr("class")&&-1!=Pn(e.target).attr("class").indexOf("mapsvg-marker-cluster")){if(t.editMarkers.on)return;i=Pn(e.target).data("cluster"),t.setObjectClickedBeforeScroll(i)}"mousedown"==e.type?t.scrollStart(e,t):t.touchStart(e,t)})):t.editMarkers.on?t.clickAddsMarker&&Pn(t.containers.map).on("touchend.common.mapsvg mouseup.common.mapsvg",(function(e){e.cancelable&&e.preventDefault(),t.markerAddClickHandler(e)})):(Pn(t.containers.map).on("touchstart.common.mapsvg",".mapsvg-region",(function(e){t.scroll.touchScrollStart=Pn(window).scrollTop()})),Pn(t.containers.map).on("touchstart.common.mapsvg",".mapsvg-marker",(function(e){t.scroll.touchScrollStart=Pn(window).scrollTop()})),Pn(t.containers.map).on("touchstart.common.mapsvg mousedown.common.mapsvg",(function(e){if(Pn(e.target).hasClass("mapsvg-popover")||Pn(e.target).closest(".mapsvg-popover").length||Pn(e.target).hasClass("mapsvg-details-container")||Pn(e.target).closest(".mapsvg-details-container").length||Pn(e.target).closest(".mapsvg-popover-container").length)Pn(e.target).hasClass("mapsvg-popover-close")&&"touchstart"==e.type&&e.cancelable&&e.preventDefault();else if("touchstart"==e.type&&e.cancelable&&e.preventDefault(),!t.scroll.touchScrollStart&&t.scroll.touchScrollStart===Pn(window).scrollTop()){if(t.isLinkClicked(e))return t.handleLinkClick(e),!0;if(e.target&&Pn(e.target).attr("class")&&-1!=Pn(e.target).attr("class").indexOf("mapsvg-region")&&t.regionClickHandler(e,t.getRegion(Pn(this).attr("id"))),e.target&&Pn(e.target).attr("class")&&-1!=Pn(e.target).attr("class").indexOf("mapsvg-marker")&&-1===Pn(e.target).attr("class").indexOf("mapsvg-marker-cluster")){const i=e.target.id;t.markerClickHandler.call(this,e,t.markers.get(i))}if(e.target&&Pn(e.target).attr("class")&&-1!==Pn(e.target).attr("class").indexOf("mapsvg-marker-cluster")){const e=Pn(this).data("cluster");t.zoomTo(e.markers)}}})),Pn(t.containers.map).on("touchend.common.mapsvg mouseup.common.mapsvg",".mapsvg-region",(function(e){e.cancelable&&e.preventDefault(),t.scroll.touchScrollStart&&t.scroll.touchScrollStart!==Pn(window).scrollTop()||t.regionClickHandler(e,t.getRegion(Pn(this).attr("id")))})),Pn(this.containers.map).on("touchend.common.mapsvg mouseup.common.mapsvg",".mapsvg-marker",(t=>{if(t.cancelable&&t.preventDefault(),!this.scroll.touchScrollStart||this.scroll.touchScrollStart===Pn(window).scrollTop()){const e=t.target.id;this.markerClickHandler.call(this,t,this.markers.get(e))}})),Pn(t.containers.map).on("touchend.common.mapsvg mouseup.common.mapsvg",".mapsvg-marker-cluster",(function(e){if(e.cancelable&&e.preventDefault(),!t.scroll.touchScrollStart||t.scroll.touchScrollStart==Pn(window).scrollTop()){const e=Pn(this).data("cluster");t.zoomTo(e.markers)}}))),Pn(t.containers.map).on("mouseleave.common.mapsvg",".mapsvg-choropleth-gradient-wrap",(t=>{this.controllers.tooltips.region.close()}))}setLabelsRegions(t){null!=(t=t||this.options.labelsRegions).on&&(t.on=w.numbers.parseBoolean(t.on)),h(this.options,{labelsRegions:t}),this.options.labelsRegions.on?(this.regions.forEach((t=>{t.label||(t.label=document.createElement("div"),t.label.className="mapsvg-region-label",t.label.setAttribute("data-region-id",t.id),Pn(this.layers.labels).append(t.label));try{Pn(t.label).html(this.templates.labelRegion(t.forTemplate()))}catch(t){console.error('MapSVG: Error in the "Region Label" template')}})),this.labelsRegionsAdjustScreenPosition()):this.regions.forEach((t=>{t.label&&(Pn(t.label).remove(),t.label=null,delete t.label)}))}setLabelsMarkers(t){null!=(t=t||this.options.labelsMarkers).on&&(t.on=w.numbers.parseBoolean(t.on)),h(this.options,{labelsMarkers:t}),this.options.labelsMarkers.on?this.markers.forEach((t=>{try{t.setLabel(this.templates.labelMarker(t.object.getData()))}catch(t){console.error('MapSVG: Error in the "Marker Label" template')}})):this.markers.forEach((t=>{t.setLabel("")}))}addLayer(t){return this.layers[t]=Pn('<div class="mapsvg-layer mapsvg-layer-'+t+'"></div>')[0],this.containers.layers.appendChild(this.layers[t]),this.layers[t]}getLayer(t){return this.layers[t]}getDb(){return this.objectsRepository}getDbRegions(){return this.regionsRepository}regionAdd(t){const e=new _n({element:t,mapsvg:this,options:this.options.regions[t.id],statusOptions:this.options.regionStatuses});return this.reloadRegionStyles(e),e.events.on(pn.UPDATE,(t=>{const{region:e,data:i}=t.data;["choroplethValue"].some((t=>t in i))&&this.reloadRegionStyles(e)})),this.regions.push(e),this.regions.sort((function(t,e){return t.id==e.id?0:+(t.id>e.id)||-1})),e}regionDelete(t){this.regions.findById(t)?(this.regions.findById(t).elem.remove(),this.regions.delete(t)):Pn("#"+t).length&&Pn("#"+t).remove()}reloadRegions(){this.regions.clear(),Pn(this.containers.svg).find(".mapsvg-region").removeClass("mapsvg-region"),Pn(this.containers.svg).find(".mapsvg-region-disabled").removeClass("mapsvg-region-disabled"),Pn(this.containers.svg).find("path, polygon, circle, ellipse, rect").each(((t,e)=>{const i=e;Pn(i).closest("defs").length||(i.getAttribute("data-stroke-width")&&(i.style["stroke-width"]=i.getAttribute("data-stroke-width")),i.getAttribute("id")&&(!this.options.regionPrefix||this.options.regionPrefix&&0===i.getAttribute("id").indexOf(this.options.regionPrefix))&&this.regionAdd(i))}))}reloadRegionsFull(){this.reloadAllRegionStyles();const t=this.regionsRepository.getSchema().getFieldByType("status");this.regions.forEach((e=>{const i=this.regionsRepository.getLoaded().findById(e.id);if(i)e.setData(i),t&&void 0!==i.getData().status&&null!==i.getData().status&&e.setStatus(i.getData().status);else if(this.options.filters.filteredRegionsStatus||0===this.options.filters.filteredRegionsStatus||"regions"===this.options.menu.source&&this.options.menu.filterout&&"status"===this.options.menu.filterout.field&&this.options.menu.filterout.val||0===this.options.menu.filterout.val){const t=this.options.filters.filteredRegionsStatus||0===this.options.filters.filteredRegionsStatus?this.options.filters.filteredRegionsStatus:this.options.menu.filterout.val;e.setStatus(t)}})),this.loadDirectory(),this.setChoropleth(),this.setLayersControl(),this.setGroups(),this.options.labelsRegions.on&&this.setLabelsRegions(),this.options.filters.on&&"regions"===this.options.filters.source&&this.controllers.filters&&this.controllers.filters.hideFilters&&this.controllers.filters.setFiltersCounter()}fixMarkersWorldScreen(){this.googleMaps.map&&setTimeout((()=>{const t={left:0,right:0,leftOut:0,rightOut:0};if(this.markers.length>1&&(this.markers.forEach((e=>{Pn(e.element).offset().left<Pn(this.containers.map).offset().left+this.containers.map.clientWidth/2?(t.left++,Pn(e.element).offset().left<Pn(this.containers.map).offset().left&&t.leftOut++):(t.right++,Pn(e.element).offset().left>Pn(this.containers.map).offset().left+this.containers.map.clientWidth&&t.rightOut++)})),0===t.left&&t.rightOut||0===t.right&&t.leftOut)){const e=0===t.left?1:-1,i=this.svgDefault.viewBox.width/this.converter.mapLonDelta*360*this.getScale();this.googleMaps.map.panBy(e*i,0)}}),600)}updateOutdatedOptions(t){return a(this,arguments,void 0,(function*({version:t,options:e}){if(this.version&&_(this.version,s.version)<0){const t=yield import("./migrate-CaVuzqDS.js"),{options:i,success:o}=t.migrate(this.version,e);if(o)return{version:s.version,options:i};throw Error("Could not update options")}return{version:t,options:e}}))}getContainer(t){return this.containers[t]}renderSvgData(t){const e=Pn(t).find("svg");if(this.containers.svg=e[0],e.attr("width")&&e.attr("height"))this.svgDefault.width=parseFloat(e.attr("width").replace(/px/g,"")),this.svgDefault.height=parseFloat(e.attr("height").replace(/px/g,"")),this.svgDefault.viewBox=e.attr("viewBox")?new gn(e.attr("viewBox").split(" ")):new gn(0,0,this.svgDefault.width,this.svgDefault.height);else{if(!e.attr("viewBox")){const t="MapSVG couldn't load SVG file. Please check if the file exists: "+this.options.source+". If the file exists, please contact support (this message is showing up only in wp-admin area).";return this.inBackend?Pn.growl.error({message:t,duration:6e4}):console.error("MapSVG couldn't load SVG file"),!1}this.svgDefault.viewBox=new gn(e.attr("viewBox").split(" ")),this.svgDefault.width=this.svgDefault.viewBox.width,this.svgDefault.height=this.svgDefault.viewBox.height}this.viewBox.update(this.svgDefault.viewBox),this.geoViewBox=this.getGeoViewBoxFromSvgTag(this.containers.svg),e.attr("preserveAspectRatio","xMidYMid meet"),e.removeAttr("width"),e.removeAttr("height"),Pn(this.containers.scrollpane).append(e),this.containers.svg.style.width="auto",Pn(this.containers.svg).find("path, polygon, circle, ellipse, rect, line, polyline").each(((t,e)=>{const i=vn.getComputedStyle("stroke-width",e);i&&Pn(e).attr("data-stroke-width",i.replace("px",""))}))}setFilterOut(){if(this.objectsRepository)if(this.options.menu.filterout.field){const t={};t[this.options.menu.filterout.field]=this.options.menu.filterout.val,"regions"==this.options.menu.source||this.objectsRepository.query.setFilterOut(t)}else this.objectsRepository.query.setFilterOut(null)}getGeoViewBoxFromSvgTag(t){const e=Pn(t).attr("mapsvg:geoViewBox")||Pn(t).attr("mapsvg:geoviewbox");if(!e)return null;{const t=e.split(" ").map((t=>parseFloat(t)));if(4==t.length){this.mapIsGeo=!0,this.geoCoordinates=!0;const e=new Tt(t[3],t[0]),i=new Tt(t[1],t[2]);return new fn(e,i)}}}svgLoadingFailed(t){if(404==t.status){let t="MapSVG: file not found - "+this.options.source+"\n\nIf you moved MapSVG from another server please read the following docs page: https://mapsvg.com/docs/installation/moving";if(this.inBackend){t+="\n\nIf you know the correct path for the SVG file, please write it and press OK:";const e=this.options.source,i=prompt(t,e);null!==i?Pn.ajax({url:i+"?v="+this.svgFileLastChanged}).fail((function(){location.reload()})).done((t=>{this.options.source=i,this.renderSvgData(t);It("maps",this).update(this)})):location.reload()}else console.error(t)}else{const t="MapSVG: can't load SVG file for unknown reason. Please contact support.";this.inBackend?alert(t):console.error(t)}}addLoadingMessage(){this.containers.loading=document.createElement("div"),this.containers.loading.className="mapsvg-loading";const t=document.createElement("div");t.className="mapsvg-loading-text",t.innerHTML=this.options.loadingText;const e=document.createElement("div");e.className="spinner-border spinner-border-sm",this.containers.loading.appendChild(e),this.containers.loading.appendChild(t),document.getElementById(this.containerId).appendChild(this.containers.loading)}hideLoadingMessage(){Pn(this.containers.loading).hide()}showLoadingMessage(){Pn(this.containers.loading).show()}disableAnimation(){this.containers.map.classList.add("no-transitions")}enableAnimation(){this.containers.map.classList.remove("no-transitions")}loadExtensions(){if(this.options.extension&&Pn().mapSvg.extensions&&Pn().mapSvg.extensions[_this.options.extension]){const t=Pn().mapSvg.extensions[_this.options.extension];t&&t.common(this)}}decrementAfterloadBlockers(){this.afterLoadBlockers>0&&(this.afterLoadBlockers--,0===this.afterLoadBlockers&&this.finalizeMapLoading())}finalizeMapLoading(){this.afterLoadBlockers>0||this.loaded||(this.selectObjectsByIdFromUrl(),this.redraw(),setTimeout((()=>{if(c()&&this.options.menu.on&&this.options.menu.hideOnMobile)switch(this.options.menu.showFirst){case"map":this.controllers.toolbar.show("map");break;case"directory":this.controllers.toolbar.show("menu")}setTimeout((()=>{this.hideLoadingMessage(),Pn(this.containers.loading).find(".mapsvg-loading-text").hide()}),400)}),100),this.loaded=!0,this.events.trigger(Fn.AFTER_INIT,{mapsvg:this}))}selectObjectsByIdFromUrl(){const t=RegExp("[?&]mapsvg_select=([^&]*)").exec(window.location.search);if(t){const e=decodeURIComponent(t[1].replace(/\+/g," "));this.selectRegion(e)}if(window.location.hash&&-1!==window.location.hash.indexOf("#/m/")){let t=window.location.hash.replace("#/m/","");if(this.options.actions.map.afterLoad.selectRegion&&(0===t.indexOf("r/")||-1===t.indexOf("r/")&&-1===t.indexOf("db/"))){0===t.indexOf("r/")&&(t=t.replace("r/",""));const e=this.getRegion(t);e&&this.regionClickHandler(null,e)}else if(this.options.actions.map.afterLoad.selectMarker&&0===t.indexOf("db/")){t=t.replace("db/","");const e=t=>{const e=this.markers.get(`marker_${t.getData().id}`);e&&this.markerClickHandler.call(this,null,e)},i=this.objectsRepository.getLoaded().find((e=>e.getData().id===t));i?e(i):this.objectsRepository.findById(t,!1).done((t=>{this.addObject(t),this.objectsLoadedToMapHandler(),e(t)}))}}}getConverter(){return this.converter}setChoropleth(t){const e=this;null!=(t=t||e.options.choropleth).on&&(t.on=w.numbers.parseBoolean(t.on)),h(e.options,{choropleth:t});let i=!1;if(!e.$gauge){e.$gauge={},e.$gauge.gradient=Pn("<td>&nbsp;</td>").addClass("mapsvg-gauge-gradient"),e.setGaugeGradientCSS(),e.$gauge.container=Pn("<div />").addClass("mapsvg-gauge").hide(),e.$gauge.table=Pn("<table />");const t=Pn("<tr />");e.$gauge.labelLow=Pn("<td>"+e.options.choropleth.labels.low+"</td>"),e.$gauge.labelHigh=Pn("<td>"+e.options.choropleth.labels.high+"</td>"),t.append(e.$gauge.labelLow),t.append(e.$gauge.gradient),t.append(e.$gauge.labelHigh),e.$gauge.table.append(t),e.$gauge.container.append(e.$gauge.table),e.$gauge.container.append(e.$gauge.table),Pn(e.containers.map).append(e.$gauge.container)}!e.options.choropleth.on&&e.$gauge.container.is(":visible")?(e.$gauge.container.hide(),i=!0):e.options.choropleth.on&&!e.$gauge.container.is(":visible")&&(e.$gauge.container.show(),i=!0,this.regionsRepository.events.on(Lt.AFTER_UPDATE,this.redrawGauge),this.regionsRepository.events.on(Lt.AFTER_LOAD,this.redrawGauge)),this.options.choropleth.on||(this.regionsRepository.events.off(Lt.AFTER_UPDATE,this.redrawGauge),this.regionsRepository.events.off(Lt.AFTER_LOAD,this.redrawGauge)),t.colors&&(e.options.choropleth.colors.lowRGB=R(e.options.choropleth.colors.low).toRgb(),e.options.choropleth.colors.highRGB=R(e.options.choropleth.colors.high).toRgb(),e.options.choropleth.colors.diffRGB={r:e.options.choropleth.colors.highRGB.r-e.options.choropleth.colors.lowRGB.r,g:e.options.choropleth.colors.highRGB.g-e.options.choropleth.colors.lowRGB.g,b:e.options.choropleth.colors.highRGB.b-e.options.choropleth.colors.lowRGB.b,a:e.options.choropleth.colors.highRGB.a-e.options.choropleth.colors.lowRGB.a},i=!0,e.$gauge&&e.setGaugeGradientCSS()),t.labels&&(e.$gauge.labelLow.html(e.options.choropleth.labels.low),e.$gauge.labelHigh.html(e.options.choropleth.labels.high)),i&&e.redrawGauge()}updateGaugeMinMax(){const t=this;t.options.choropleth.min=0,t.options.choropleth.max=!1;const e=[];t.regions.forEach((function(i){const s=i.data&&i.data[t.options.regionChoroplethField];null!=s&&e.push(s)})),e.length>0&&(t.options.choropleth.min=1==e.length?0:Math.min.apply(null,e),t.options.choropleth.max=Math.max.apply(null,e),t.options.choropleth.maxAdjusted=t.options.choropleth.max-t.options.choropleth.min)}setGaugeGradientCSS(){const t=this;t.$gauge.gradient.css({background:"linear-gradient(to right,"+t.options.choropleth.colors.low+" 1%,"+t.options.choropleth.colors.high+" 100%)",filter:'progid:DXImageTransform.Microsoft.gradient( startColorstr="'+t.options.choropleth.colors.low+'", endColorstr="'+t.options.choropleth.colors.high+'",GradientType=1 )'})}setSvgFileLastChanged(t){this.svgFileLastChanged=t}get $map(){return Pn(this.getContainer("map"))}get $svg(){return Pn(this.getContainer("svg"))}get $popover(){return Pn(this.getContainer("popover"))}get $details(){return Pn(this.getContainer("detailsView"))}get $directory(){return Pn(this.getContainer("directory"))}get database(){return this.objectsRepository}get regionsDatabase(){return this.regionsRepository}}class In extends Pt{constructor(){super("map","maps"),this.path="maps-v2/"}encodeData(t){const e={};return e.options=JSON.stringify(t.options),e.options=e.options.replace(/select/g,"!mapsvg-encoded-slct"),e.options=e.options.replace(/table/g,"!mapsvg-encoded-tbl"),e.options=e.options.replace(/database/g,"!mapsvg-encoded-db"),e.options=e.options.replace(/varchar/g,"!mapsvg-encoded-vc"),e.id=t.id,e.title=t.title,e}defaultResponseMiddleware(t){let e;return e="string"==typeof t?JSON.parse(t):t,e}}class Nn extends C{constructor(){super(),this.arrayIndexed=dt,this.customObject=Bt,this.formBuilder=hn,this.geoPoint=Tt,this.location=_t,this.mapsRepository=Ot,this.mapsV2Repository=In,this.marker=bn,this.region=_n,this.query=Mt,this.repository=Pt,this.schema=wt,this.schemaRepository=Ft,this.screenPoint=kt,this.server=At,this.svgPoint=SVGPoint,this.map=On,this.utils=w,this.instances=s.instances,this.nonce=s.nonce,this.mediaUploader=s.mediaUploader,this.templatesLoaded=s.templatesLoaded,this.routes=s.routes,this.mouse=s.mouse,this.useRepository=It}}const Hn=()=>{window.mapsvg=new Nn,window.MapSVG=Object.assign(Object.create(Object.getPrototypeOf(window.mapsvg)),window.mapsvg),Object.assign(window.MapSVG,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({mouseCoords:w.env.getMouseCoords,isPhone:w.env.isPhone},s),w.env),w.files),w.funcs),w.http),w.numbers),w.strings)),window.mapsvg.initialized=!0,window.dispatchEvent(new Event("mapsvgClientInitialized"))};export{Nn as MapsvgClient,Hn as initGlobals};
//# sourceMappingURL=InitGlobals-DCSOJFi4.js.map
