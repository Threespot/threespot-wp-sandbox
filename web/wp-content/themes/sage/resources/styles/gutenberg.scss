//------------------------------------------------------------------------
// Gutenberg editor styles (see admin.scss for global amdin styles)
//------------------------------------------------------------------------
// Threespot CSS reset
// https://github.com/Threespot/frontline-css-reset
@use "frontline-css-reset" as *;

// Includes Frontline plus project vars, functions, and mixins
@use "@styles/globals" as * with ($is-admin--globals: true);

// Base styles (e.g. html, body, @font-face, print)
@use "base/index" as * with (
  $enable-dark-mode--base: true,
  $is-admin--base: false,
);

// Helper classes
@use "helpers/index" as *;

// Custom components
@use "components/index" as *;

// Default Gutenberg blocks
@use "default-blocks/index" as *;

#wpwrap {
  min-height: unset !important;
}

// Apply default font-family to wysiwyg fields
#tinymce {
  font-family: var(--neue-haas-grotesk);
}

// Custom Gutenberg editor overrides
.interface-interface-skeleton__content {
  & > .edit-post-visual-editor {
    background-color: var(--default-bg-color);
    @include default-padding;
  }
}

.editor-styles-wrapper {
  font-family: var(--default-font) !important;
  padding: 0 !important;

  // Undo default WP reset styles (/wp-includes/css/dist/block-library/reset.min.css)
  // Note: Specificty must equal 1 to avoid overriding custom styles
  @at-root :where(#{&}) {
    p:where([class]) {
      font-size: inherit;
      line-height: inherit;
      margin: inherit inherit 1em;
      text-wrap: pretty;
    }

    a:where([class]) {
      color: inherit;
    }

    ol:where([class], [role="list"]),
    ul:where([class], [role="list"]) {
      list-style-type: none;
      margin: inherit;
      padding: inherit;
    }
  }

  .wp-block[data-align="full"] {
    margin-left: 0 !important;
    margin-right: 0 !important;
  }
}// end editor-styles-wrapper

// Add richtext styles to editor and default blocks (e.g. Cover, Media & Text)
// Note: These blocks have an inner wrapper so we can’t easily add the
//       “u-richtext” class in the admin since add_filter('render_block')
//       only works on the public site, and the “blocks.getBlockDefaultClassName”
//       JS hook only allows us to add a class to the outer wrapper.
:is(
  .edit-post-visual-editor .is-root-container,
  .wp-block-cover .wp-block-cover__inner-container,
  .wp-block-media-text .wp-block-media-text__content
) {
  @include text-size-scale;
  @include richtext;
}

.edit-post-visual-editor {
  // Parent wrapper of editor content
  .is-root-container {
    color: var(--default-text-color);
    margin-left: auto;
    margin-right: auto;
    max-width: var(--layout-max-width-narrow);
    padding-bottom: 1.5em;// breathing room above metaboxes
  }

  &__post-title-wrapper {
    margin-top: 40px;
  }

  .editor-post-title {
    margin-bottom: 0.75em;
    margin-top: 0 !important;

    &__input {
      @include post-title;
      // Optional: Reduce title font-size in editor
      // font-size: scale-clamp((375px: 30px, $layout-text-scale-end-bp: 40px));
      text-transform: none !important;// reveal any capitalization errors
    }
  }

  // Remove SVG margin coming from our default link styles on the WP buttons
  .has-icon svg {
    margin-left: 0;
  }
}// end editor-styles-wrapper

// Hide H1 button in heading block
[aria-label="Heading 1"] {
  display: none !important;
}

// Disable drop cap styles in block style thumbnails since
// we’ve disabled them in theme.json
.has-drop-cap::first-letter {
  float: none !important;
  font-size: inherit !important;
  font-style: inherit !important;
  font-weight: inherit !important;
  line-height: inherit !important;
  margin: inherit !important;
  text-transform: inherit !important;
}

// Ensure custom blocks that support left/right alignement are clickable
.block-editor-block-list__block {
  &[data-align] {
    z-index: 2;
  }
}

// Fix line-height in block style thumbnail previews
.wp-block.has-drop-cap.rich-text {
  line-height: 1.5;

  &.is-style-intro {
    font-size: 32px !important;
  }
}

// Add outlines and labels to groups on hover/focus to improve UX (WP 5.9)
.wp-block-group {
  $outline-width: 1px;
  outline: $outline-width dotted transparent;
  position: relative;
  transition: outline 150ms ease-in-out;

  // Disable in block pattern preview
  .block-editor-block-preview__content iframe & {
    outline: none !important;

    &:before {
      display: none !important;
    }
  }

  &:hover,
  &:focus-within,
  &.has-child-selected {
    outline-color: #ccc;
  }

  &:hover {
    &:before {
      opacity: 1;
    }
  }

  &:focus-within,
  &.has-child-selected {
    &:before {
      opacity: 0;
    }
  }

  &:before {
    background-color: #eee;
    bottom: 100%;
    color: #444;
    content: 'Group';
    font-family: sans-serif;
    font-size: 11px;
    font-weight: normal;
    left: -$outline-width;
    line-height: 1;
    opacity: 0;
    padding: 4px 6px;
    position: absolute;
    transition: opacity 150ms ease-in-out;
  }
}// end .wp-block-group

// Add outlines to highlight columns
.wp-block-columns {
  outline: 1px solid #fff;
  transition: outline 150ms ease-in-out;

  // Disable in block pattern preview
  .block-editor-block-preview__content iframe & {
    outline: none !important;

    * {
      outline: none !important;
    }
  }

  .wp-block-column {
    outline: 1px dotted #fff;
    transition: outline 150ms ease-in-out;
  }

  &:hover,
  &:focus-within,
  &.has-child-selected {
    outline-color: #ccc;

    .wp-block-column {
      outline-color: #ccc;
    }
  }
}

// Add outline to separator on hover and increase click target size
.wp-block-separator {
  position: relative;

  &:not(.is-selected) {
    &:after {
      border: 1px dotted #ccc;
      bottom: -20px;
      content: '';
      left: 0;
      opacity: 0;
      position: absolute;
      top: -20px;
      transition: opacity 150ms ease-in-out;
      width: 100%;
      z-index: 1;
    }

    &:hover {
      &:after {
        opacity: 1;
      }
    }
  }
}

// Add outline and label to spacer block
.wp-block-spacer:not(.is-selected) {
  border: 1px dashed transparent;
  position: relative;
  transition: border-color 150ms ease-in-out;

  &:hover {
    border-color: #ddd;

    &:after {
      opacity: 1;
    }
  }

  &:after {
    background-color: #eee;
    bottom: 100%;
    color: #444;
    content: 'Spacer';
    font-family: sans-serif;
    font-size: 11px;
    left: -1px;
    line-height: 1;
    opacity: 0;
    padding: 4px 6px;
    position: absolute;
    transition: opacity 150ms ease-in-out;
  }
}

// Custom field metaboxes
.postbox-header {
  // Increase font-weight of headings
  .hndle {
    font-weight: 500;
  }
}

.wp-block {
  opacity: inherit !important;// show animated images in the editor

  // Don’t float ACF block wrappers when using default left/right alignment
  // (floats should be applied to the block itself)
  &[data-align="left"],
  &[data-align="right"] {
    height: auto;

    .acf-block-component {
      float: none;
    }
  }

  &[data-align="left"] {
    .acf-block-component {
      margin-right: 0;
    }
  }

  &[data-align="right"] {
    .acf-block-component {
      margin-left: 0;
    }
  }
}// end wp-block

// Make ACF field group headings in sidebar
// match default WP styles.
#side-sortables {
  .acf-postbox {
    .hndle {
      color: #1e1e1e !important;
      font-size: 13px !important;
      font-weight: 500 !important;
      line-height: 1.4 !important;
      padding: 16px 24px 16px 16px !important;
    }

    .toggle-indicator {
      color: #1e1e1e !important;

      &:before {
        content: '\f343' !important;
        font-size: 17px !important;
      }
    }

    &.closed {
      .toggle-indicator {
        &:before {
          content: '\f347' !important;
        }
      }
    }
  }
}

// Update line-height on metabox select fields to avoid cutting off descenders
.components-panel select {
  line-height: 1.1 !important;
}

// Block pattern preview fixes
.block-editor-inserter__panel-content {
  iframe {
    max-width: none;// override Frontline CSS reset
  }
}

// Use wide layout for all top-level ACF block fields
.is-root-container > [class*="wp-block-acf-"]:has(.acf-block-fields) {
  max-width: none !important;
  @include layout-wide;

  // But not when inside of group blocks
  .wp-block-group & {
    left: auto !important;
    margin-left: auto !important;
    margin-right: auto !important;
    right: auto !important;
    width: 100% !important;
  }
}

// Remove underline from ACF icon buttons (added by WP styles)
[class*="acf-icon"] {
  text-decoration: none !important;
}

// Fix block pattern preview iframe width (override CSS reset)
.block-editor-block-preview__content iframe {
  max-width: none;
}

// Fix custom block icon vertical alignment
//
// The Sage ACF Gutenberg Blocks plugin adds a plain div wrapper
// around the SVG icon, messing up the vertical alignment, so
// we’re applying “display: contents;” to fix it.
.block-editor-block-icon > div:not([class]) {
  display: contents;
}
